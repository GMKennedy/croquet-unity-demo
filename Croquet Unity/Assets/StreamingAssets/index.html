<html>
    <head>
        <meta charset="utf-8">
        <title>unity-blocks</title>
        <style>body {
                overflow: hidden;
                background: rgb(54, 223, 104);
            }</style>
    </head>
    <body>
        <script>parcelRequire=function(t,e,n,r){var i,o="function"==typeof parcelRequire&&parcelRequire,a="function"==typeof require&&require;function s(n,r){if(!e[n]){if(!t[n]){var i="function"==typeof parcelRequire&&parcelRequire;if(!r&&i)return i(n,!0);if(o)return o(n,!0);if(a&&"string"==typeof n)return a(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}l.resolve=function(e){return t[n][1][e]||e},l.cache={};var u=e[n]=new s.Module(n);t[n][0].call(u.exports,l,u,u.exports,this)}return e[n].exports;function l(t){return s(l.resolve(t))}}s.isParcelRequire=!0,s.Module=function(t){this.id=t,this.bundle=s,this.exports={}},s.modules=t,s.cache=e,s.parent=o,s.register=function(e,n){t[e]=[function(t,e){e.exports=n},{}]};for(var c=0;c<n.length;c++)try{s(n[c])}catch(t){i||(i=t)}if(n.length){var u=s(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define(function(){return u})}if(parcelRequire=s,i)throw i;return s}({KA2S:[function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,o=Object.create(i.prototype),a=new O(r||[]);return o._invoke=function(t,e,n){var r=l;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=u(t,e,n);if("normal"===c.type){if(r=n.done?f:h,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(t,n,a),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l="suspendedStart",h="suspendedYield",d="executing",f="completed",p={};function v(){}function y(){}function m(){}var g={};g[o]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(M([])));w&&w!==n&&r.call(w,o)&&(g=w);var _=m.prototype=v.prototype=Object.create(g);function k(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t,e){var n;this._invoke=function(i,o){function a(){return new e(function(n,a){!function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(h).then(function(t){l.value=t,a(l)},function(t){return n("throw",t,a,s)})}s(c.arg)}(i,o,n,a)})}return n=n?n.then(a,a):a()}}function x(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function M(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:A}}function A(){return{value:e,done:!0}}return y.prototype=_.constructor=m,m.constructor=y,m[s]=y.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},k(S.prototype),S.prototype[a]=function(){return this},t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new S(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},k(_),_[s]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=M,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:M(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),p}},t}("object"==typeof e?e.exports:{});try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},{}],wCDd:[function(t,e,n){e.exports=t("regenerator-runtime")},{"regenerator-runtime":"KA2S"}],gS1u:[function(t,e,n){e.exports=function(t){if(Array.isArray(t))return t}},{}],xf9w:[function(t,e,n){e.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}},{}],h39S:[function(t,e,n){e.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},{}],FHJE:[function(t,e,n){var r=t("./arrayLikeToArray");e.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},{"./arrayLikeToArray":"h39S"}],XxeS:[function(t,e,n){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],qmoa:[function(t,e,n){var r=t("./arrayWithHoles"),i=t("./iterableToArrayLimit"),o=t("./unsupportedIterableToArray"),a=t("./nonIterableRest");e.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||a()}},{"./arrayWithHoles":"gS1u","./iterableToArrayLimit":"xf9w","./unsupportedIterableToArray":"FHJE","./nonIterableRest":"XxeS"}],Vopi:[function(t,e,n){var r=t("./arrayLikeToArray");e.exports=function(t){if(Array.isArray(t))return r(t)}},{"./arrayLikeToArray":"h39S"}],dzIy:[function(t,e,n){e.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},{}],qtGd:[function(t,e,n){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],wyMK:[function(t,e,n){var r=t("./arrayWithoutHoles"),i=t("./iterableToArray"),o=t("./unsupportedIterableToArray"),a=t("./nonIterableSpread");e.exports=function(t){return r(t)||i(t)||o(t)||a()}},{"./arrayWithoutHoles":"Vopi","./iterableToArray":"dzIy","./unsupportedIterableToArray":"FHJE","./nonIterableSpread":"qtGd"}],RTfL:[function(t,e,n){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(t){return typeof t}:e.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}e.exports=r},{}],zdnk:[function(t,e,n){function r(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}e.exports=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,c,"next",t)}function c(t){r(a,i,o,s,c,"throw",t)}s(void 0)})}}},{}],PLl6:[function(t,e,n){e.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},{}],D2QR:[function(t,e,n){var r,i;r=this,i=function(t){var e=function(t){return new e.lib.init(t)};function n(t,e){return!(!t||"string"!=typeof e)&&!!(t.className&&t.className.trim().split(/\s+/gi).indexOf(e)>-1)}return e.lib=e.prototype={toastify:"1.7.0",constructor:e,init:function(t){return t||(t={}),this.options={},this.toastElement=null,this.options.text=t.text||"Hi there!",this.options.duration=0===t.duration?0:t.duration||3e3,this.options.selector=t.selector,this.options.callback=t.callback||function(){},this.options.destination=t.destination,this.options.newWindow=t.newWindow||!1,this.options.close=t.close||!1,this.options.gravity="bottom"===t.gravity?"toastify-bottom":"toastify-top",this.options.positionLeft=t.positionLeft||!1,this.options.position=t.position||"",this.options.backgroundColor=t.backgroundColor,this.options.avatar=t.avatar||"",this.options.className=t.className||"",this.options.stopOnFocus=void 0===t.stopOnFocus||t.stopOnFocus,this.options.onClick=t.onClick,this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var t=document.createElement("div");if(t.className="toastify on "+this.options.className,this.options.position?t.className+=" toastify-"+this.options.position:!0===this.options.positionLeft?(t.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):t.className+=" toastify-right",t.className+=" "+this.options.gravity,this.options.backgroundColor&&(t.style.background=this.options.backgroundColor),t.innerHTML=this.options.text,""!==this.options.avatar){var e=document.createElement("img");e.src=this.options.avatar,e.className="toastify-avatar","left"==this.options.position||!0===this.options.positionLeft?t.appendChild(e):t.insertAdjacentElement("beforeend",e)}if(!0===this.options.close){var n=document.createElement("span");n.innerHTML="&#10006;",n.className="toast-close",n.addEventListener("click",function(t){t.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var r=window.innerWidth>0?window.innerWidth:screen.width;("left"==this.options.position||!0===this.options.positionLeft)&&r>360?t.insertAdjacentElement("afterbegin",n):t.appendChild(n)}if(this.options.stopOnFocus&&this.options.duration>0){const e=this;t.addEventListener("mouseover",function(e){window.clearTimeout(t.timeOutValue)}),t.addEventListener("mouseleave",function(){t.timeOutValue=window.setTimeout(function(){e.removeElement(t)},e.options.duration)})}return void 0!==this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),!0===this.options.newWindow?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),"function"==typeof this.options.onClick&&void 0===this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),this.options.onClick()}.bind(this)),t},showToast:function(){var t;if(this.toastElement=this.buildToast(),!(t=void 0===this.options.selector?document.body:document.getElementById(this.options.selector)))throw"Root element is not defined";return t.insertBefore(this.toastElement,t.firstChild),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(t){t.className=t.className.replace(" on",""),window.setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),this.options.callback.call(t),e.reposition()}.bind(this),400)}},e.reposition=function(){for(var t,e={top:15,bottom:15},r={top:15,bottom:15},i={top:15,bottom:15},o=document.getElementsByClassName("toastify"),a=0;a<o.length;a++){t=!0===n(o[a],"toastify-top")?"toastify-top":"toastify-bottom";var s=o[a].offsetHeight;t=t.substr(9,t.length-1);(window.innerWidth>0?window.innerWidth:screen.width)<=360?(o[a].style[t]=i[t]+"px",i[t]+=s+15):!0===n(o[a],"toastify-left")?(o[a].style[t]=e[t]+"px",e[t]+=s+15):(o[a].style[t]=r[t]+"px",r[t]+=s+15)}return this},e.lib.init.prototype=e.lib,e},"object"==typeof e&&e.exports?e.exports=i():r.Toastify=i()},{}],sC8V:[function(t,e,n){},{}],u80Q:[function(t,e,n){var r;arguments[3];!function(n,i){var o,a=(0,eval)("this"),s=256,c=6,u="random",l=i.pow(s,c),h=i.pow(2,52),d=2*h,f=s-1;function p(t,e,r){var f=[],p=m(function t(e,n){var r,i=[],o=typeof e;if(n&&"object"==o)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==o?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,g(n)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(s):(t=new Uint8Array(s),(a.crypto||a.msCrypto).getRandomValues(t)),g(t)}catch(t){var e=a.navigator,r=e&&e.plugins;return[+new Date,a,r,a.screen,g(n)]}}():t,3),f),b=new v(f),w=function(){for(var t=b.g(c),e=l,n=0;t<h;)t=(t+n)*s,e*=s,n=b.g(1);for(;t>=d;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,m(g(b.S),n),(e.pass||r||function(t,e,n,r){return r&&(r.S&&y(r,b),t.state=function(){return y(b,{})}),n?(i[u]=t,e):t})(w,p,"global"in e?e.global:this==i,e.state)}function v(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<s;)a[i]=i++;for(i=0;i<s;i++)a[i]=a[o=f&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=f&i+1],n=n*s+a[f&(a[i]=a[o=f&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(s)}function y(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",i=0;i<r.length;)e[f&i]=f&(n^=19*e[f&i])+r.charCodeAt(i++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(i["seed"+u]=p,m(i.random(),n),"object"==typeof e&&e.exports){e.exports=p;try{o=t("crypto")}catch(t){}}else"function"==typeof r&&r.amd&&r(function(){return p})}([],Math)},{crypto:"sC8V"}],rsNN:[function(t,e,n){e.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},{}],rYje:[function(t,e,n){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},{}],vwDV:[function(t,e,n){"use strict";e.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var n,r="boolean"==typeof e.cycles&&e.cycles,i=e.cmp&&(n=e.cmp,function(t){return function(e,r){var i={key:e,value:t[e]},o={key:r,value:t[r]};return n(i,o)}}),o=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var n,a;if(Array.isArray(e)){for(a="[",n=0;n<e.length;n++)n&&(a+=","),a+=t(e[n])||"null";return a+"]"}if(null===e)return"null";if(-1!==o.indexOf(e)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=o.push(e)-1,c=Object.keys(e).sort(i&&i(e));for(a="",n=0;n<c.length;n++){var u=c[n],l=t(e[u]);l&&(a&&(a+=","),a+=JSON.stringify(u)+":"+l)}return o.splice(s,1),"{"+a+"}"}}(t)}},{}],Mrsy:[function(t,e,n){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}e.exports=r},{}],jOCc:[function(t,e,n){var r=t("./getPrototypeOf");e.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}},{"./getPrototypeOf":"Mrsy"}],V9yb:[function(t,e,n){var r=t("./superPropBase");function i(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(t,e,n){var i=r(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},i(t,n,o||t)}e.exports=i},{"./superPropBase":"jOCc"}],fHK5:[function(t,e,n){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,n)}e.exports=r},{}],NdUb:[function(t,e,n){var r=t("./setPrototypeOf");e.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},{"./setPrototypeOf":"fHK5"}],KZS0:[function(t,e,n){e.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},{}],Guyn:[function(t,e,n){var r=t("../helpers/typeof"),i=t("./assertThisInitialized");e.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e}},{"../helpers/typeof":"RTfL","./assertThisInitialized":"KZS0"}],wmWq:[function(t,e,n){"use strict";var r=function(t,e){return t<e};function i(t){if(!(this instanceof i))return new i(t);this.array=[],this.size=0,this.compare=t||r}i.prototype.clone=function(){var t=new i(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},i.prototype.add=function(t){var e,n,r=this.size;for(this.array[this.size]=t,this.size+=1;r>0&&(e=r-1>>1,n=this.array[e],this.compare(t,n));)this.array[r]=n,r=e;this.array[r]=t},i.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},i.prototype._percolateUp=function(t,e){for(var n,r,i=this.array[t];t>0&&(n=t-1>>1,r=this.array[n],e||this.compare(i,r));)this.array[t]=r,t=n;this.array[t]=i},i.prototype._percolateDown=function(t){for(var e,n,r,i=this.size,o=this.size>>>1,a=this.array[t];t<o&&(n=(e=1+(t<<1))+1,r=this.array[e],n<i&&this.compare(this.array[n],r)&&(e=n,r=this.array[n]),this.compare(r,a));)this.array[t]=r,t=e;this.array[t]=a},i.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},i.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},i.prototype._batchRemove=function(t,e){var n=new Array(e||this.size),r=0;if("function"==typeof t&&this.size)for(var i=0;i<this.size&&r<n.length;)t(this.array[i])?(n[r]=this._removeAt(i),r++,i>>=1):i++;return n.length=r,n},i.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},i.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},i.prototype.peek=function(){if(0!=this.size)return this.array[0]},i.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},i.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},i.prototype.trim=function(){this.array=this.array.slice(0,this.size)},i.prototype.isEmpty=function(){return 0===this.size},i.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,n=this.clone();!n.isEmpty();)t(n.poll(),e++)},i.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,n=this.array,r=new i(function(t,r){return e(n[t],n[r])});t=Math.min(this.size,t);var o=new Array(t),a=0;for(r.add(0);a<t;){var s=r.poll();o[a++]=this.array[s];var c=1+(s<<1),u=c+1;c<this.size&&r.add(c),u<this.size&&r.add(u)}return o};t.main===e&&function(){var t=new i(function(t,e){return t<e});for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),e.exports=i},{}],AhBs:[function(t,e,n){var r=t("./arrayWithHoles"),i=t("./iterableToArray"),o=t("./unsupportedIterableToArray"),a=t("./nonIterableRest");e.exports=function(t){return r(t)||i(t)||o(t)||a()}},{"./arrayWithHoles":"gS1u","./iterableToArray":"dzIy","./unsupportedIterableToArray":"FHJE","./nonIterableRest":"XxeS"}],Euax:[function(t,e,n){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}},{}],lHWF:[function(t,e,n){var r=t("./setPrototypeOf"),i=t("./isNativeReflectConstruct");function o(t,n,a){return i()?e.exports=o=Reflect.construct:e.exports=o=function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}e.exports=o},{"./setPrototypeOf":"fHK5","./isNativeReflectConstruct":"Euax"}],JNpU:[function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(t[r]=n[r])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],a.set(o,i),i+=o.length;return a}},a={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],ckcG:[function(t,e,n){"use strict";var r=t("../utils/common"),i=4,o=0,a=1,s=2;function c(t){for(var e=t.length;--e>=0;)t[e]=0}var u=0,l=1,h=2,d=29,f=256,p=f+1+d,v=30,y=19,m=2*p+1,g=15,b=16,w=7,_=256,k=16,S=17,x=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=new Array(2*(p+2));c(A);var T=new Array(2*v);c(T);var P=new Array(512);c(P);var I=new Array(256);c(I);var j=new Array(d);c(j);var N,D,R,q=new Array(v);function L(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function B(t){return t<256?P[t]:P[256+(t>>>7)]}function U(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function F(t,e,n){t.bi_valid>b-n?(t.bi_buf|=e<<t.bi_valid&65535,U(t,t.bi_buf),t.bi_buf=e>>b-t.bi_valid,t.bi_valid+=n-b):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function H(t,e,n){F(t,n[2*e],n[2*e+1])}function V(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function J(t,e,n){var r,i,o=new Array(g+1),a=0;for(r=1;r<=g;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=V(o[s]++,s))}}function W(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<v;e++)t.dyn_dtree[2*e]=0;for(e=0;e<y;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*_]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function $(t){t.bi_valid>8?U(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function G(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function K(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&G(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!G(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function Z(t,e,n){var r,i,o,a,s=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0===r?H(t,i,e):(H(t,(o=I[i])+f+1,e),0!==(a=C[o])&&F(t,i-=j[o],a),H(t,o=B(--r),n),0!==(a=E[o])&&F(t,r-=q[o],a))}while(s<t.last_lit);H(t,_,e)}function Y(t,e){var n,r,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,c=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=m,n=0;n<c;n++)0!==o[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)K(t,o,n);i=c;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],K(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,K(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,o,a,s,c=e.dyn_tree,u=e.max_code,l=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,v=0;for(o=0;o<=g;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<m;n++)(o=c[2*c[2*(r=t.heap[n])+1]+1]+1)>p&&(o=p,v++),c[2*r+1]=o,r>u||(t.bl_count[o]++,a=0,r>=f&&(a=d[r-f]),s=c[2*r],t.opt_len+=s*(o+a),h&&(t.static_len+=s*(l[2*r+1]+a)));if(0!==v){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,v-=2}while(v>0);for(o=p;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>u||(c[2*i+1]!==o&&(t.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),r--)}}(t,e),J(o,u,t.bl_count)}function Q(t,e,n){var r,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=e[2*(r+1)+1],++s<c&&i===a||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*k]++):s<=10?t.bl_tree[2*S]++:t.bl_tree[2*x]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function X(t,e,n){var r,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),r=0;r<=n;r++)if(i=a,a=e[2*(r+1)+1],!(++s<c&&i===a)){if(s<u)do{H(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(H(t,i,t.bl_tree),s--),H(t,k,t.bl_tree),F(t,s-3,2)):s<=10?(H(t,S,t.bl_tree),F(t,s-3,3)):(H(t,x,t.bl_tree),F(t,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}c(q);var tt=!1;function et(t,e,n,i){F(t,(u<<1)+(i?1:0),3),function(t,e,n,i){$(t),i&&(U(t,n),U(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}n._tr_init=function(t){tt||(function(){var t,e,n,r,i,o=new Array(g+1);for(n=0,r=0;r<d-1;r++)for(j[r]=n,t=0;t<1<<C[r];t++)I[n++]=r;for(I[n-1]=r,i=0,r=0;r<16;r++)for(q[r]=i,t=0;t<1<<E[r];t++)P[i++]=r;for(i>>=7;r<v;r++)for(q[r]=i<<7,t=0;t<1<<E[r]-7;t++)P[256+i++]=r;for(e=0;e<=g;e++)o[e]=0;for(t=0;t<=143;)A[2*t+1]=8,t++,o[8]++;for(;t<=255;)A[2*t+1]=9,t++,o[9]++;for(;t<=279;)A[2*t+1]=7,t++,o[7]++;for(;t<=287;)A[2*t+1]=8,t++,o[8]++;for(J(A,p+1,o),t=0;t<v;t++)T[2*t+1]=5,T[2*t]=V(t,5);N=new L(A,C,f+1,p,g),D=new L(T,E,0,v,g),R=new L(new Array(0),O,0,y,w)}(),tt=!0),t.l_desc=new z(t.dyn_ltree,N),t.d_desc=new z(t.dyn_dtree,D),t.bl_desc=new z(t.bl_tree,R),t.bi_buf=0,t.bi_valid=0,W(t)},n._tr_stored_block=et,n._tr_flush_block=function(t,e,n,r){var c,u,d=0;t.level>0?(t.strm.data_type===s&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return a;return o}(t)),Y(t,t.l_desc),Y(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),e=y-1;e>=3&&0===t.bl_tree[2*M[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),c=t.opt_len+3+7>>>3,(u=t.static_len+3+7>>>3)<=c&&(c=u)):c=u=n+5,n+4<=c&&-1!==e?et(t,e,n,r):t.strategy===i||u===c?(F(t,(l<<1)+(r?1:0),3),Z(t,A,T)):(F(t,(h<<1)+(r?1:0),3),function(t,e,n,r){var i;for(F(t,e-257,5),F(t,n-1,5),F(t,r-4,4),i=0;i<r;i++)F(t,t.bl_tree[2*M[i]+1],3);X(t,t.dyn_ltree,e-1),X(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),Z(t,t.dyn_ltree,t.dyn_dtree)),W(t),r&&$(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(I[n]+f+1)]++,t.dyn_dtree[2*B(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){F(t,l<<1,3),H(t,_,A),function(t){16===t.bi_valid?(U(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":"JNpU"}],PDe7:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+e[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],Nls6:[function(t,e,n){"use strict";var r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,i){var o=r,a=i+n;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],NGcu:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],X2fg:[function(t,e,n){"use strict";var r,i=t("../utils/common"),o=t("./trees"),a=t("./adler32"),s=t("./crc32"),c=t("./messages"),u=0,l=1,h=3,d=4,f=5,p=0,v=1,y=-2,m=-3,g=-5,b=-1,w=1,_=2,k=3,S=4,x=0,C=2,E=8,O=9,M=15,A=8,T=286,P=30,I=19,j=2*T+1,N=15,D=3,R=258,q=R+D+1,L=32,z=42,B=69,U=73,F=91,H=103,V=113,J=666,W=1,$=2,G=3,K=4,Z=3;function Y(t,e){return t.msg=c[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function X(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function et(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function nt(t,e){t.pending_buf[t.pending++]=e}function rt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var n,r,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,c=t.strstart>t.w_size-q?t.strstart-(t.w_size-q):0,u=t.window,l=t.w_mask,h=t.prev,d=t.strstart+R,f=u[o+a-1],p=u[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(n=e)+a]===p&&u[n+a-1]===f&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<d);if(r=R-(d-o),o=d-R,r>a){if(t.match_start=e,a=r,r>=s)break;f=u[o+a-1],p=u[o+a]}}}while((e=h[e&l])>c&&0!=--i);return a<=t.lookahead?a:t.lookahead}function ot(t){var e,n,r,o,c,u,l,h,d,f,p=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-q)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=p?r-p:0}while(--n);e=n=p;do{r=t.prev[--e],t.prev[e]=r>=p?r-p:0}while(--n);o+=p}if(0===t.strm.avail_in)break;if(u=t.strm,l=t.window,h=t.strstart+t.lookahead,d=o,f=void 0,(f=u.avail_in)>d&&(f=d),n=0===f?0:(u.avail_in-=f,i.arraySet(l,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=a(u.adler,l,f,h):2===u.state.wrap&&(u.adler=s(u.adler,l,f,h)),u.next_in+=f,u.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=D)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+D-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<D)););}while(t.lookahead<q&&0!==t.strm.avail_in)}function at(t,e){for(var n,r;;){if(t.lookahead<q){if(ot(t),t.lookahead<q&&e===u)return W;if(0===t.lookahead)break}if(n=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-q&&(t.match_length=it(t,n)),t.match_length>=D)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-D),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=D){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=t.strstart<D-1?t.strstart:D-1,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}function st(t,e){for(var n,r,i;;){if(t.lookahead<q){if(ot(t),t.lookahead<q&&e===u)return W;if(0===t.lookahead)break}if(n=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=D-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-q&&(t.match_length=it(t,n),t.match_length<=5&&(t.strategy===w||t.match_length===D&&t.strstart-t.match_start>4096)&&(t.match_length=D-1)),t.prev_length>=D&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-D,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-D),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=D-1,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return W}else if(t.match_available){if((r=o._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return W}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<D-1?t.strstart:D-1,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}function ct(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function ut(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*j),this.dyn_dtree=new i.Buf16(2*(2*P+1)),this.bl_tree=new i.Buf16(2*(2*I+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(N+1),this.heap=new i.Buf16(2*T+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*T+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function lt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=C,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?z:V,t.adler=2===e.wrap?0:1,e.last_flush=u,o._tr_init(e),p):Y(t,y)}function ht(t){var e,n=lt(t);return n===p&&((e=t.state).window_size=2*e.w_size,X(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=D-1,e.match_available=0,e.ins_h=0),n}function dt(t,e,n,r,o,a){if(!t)return y;var s=1;if(e===b&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>O||n!==E||r<8||r>15||e<0||e>9||a<0||a>S)return Y(t,y);8===r&&(r=9);var c=new ut;return t.state=c,c.strm=t,c.wrap=s,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+D-1)/D),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=a,c.method=n,ht(t)}r=[new ct(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ot(t),0===t.lookahead&&e===u)return W;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,et(t,!1),0===t.strm.avail_out))return W;if(t.strstart-t.block_start>=t.w_size-q&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:K):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),W)}),new ct(4,4,8,4,at),new ct(4,5,16,8,at),new ct(4,6,32,32,at),new ct(4,4,16,16,st),new ct(8,16,32,32,st),new ct(8,16,128,128,st),new ct(8,32,128,256,st),new ct(32,128,258,1024,st),new ct(32,258,258,4096,st)],n.deflateInit=function(t,e){return dt(t,e,E,M,A,x)},n.deflateInit2=dt,n.deflateReset=ht,n.deflateResetKeep=lt,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?y:(t.state.gzhead=e,p):y},n.deflate=function(t,e){var n,i,a,c;if(!t||!t.state||e>f||e<0)return t?Y(t,y):y;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===J&&e!==d)return Y(t,0===t.avail_out?g:y);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===z)if(2===i.wrap)t.adler=0,nt(i,31),nt(i,139),nt(i,8),i.gzhead?(nt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),nt(i,255&i.gzhead.time),nt(i,i.gzhead.time>>8&255),nt(i,i.gzhead.time>>16&255),nt(i,i.gzhead.time>>24&255),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(nt(i,255&i.gzhead.extra.length),nt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=B):(nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,Z),i.status=V);else{var m=E+(i.w_bits-8<<4)<<8;m|=(i.strategy>=_||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=L),m+=31-m%31,i.status=V,rt(i,m),0!==i.strstart&&(rt(i,t.adler>>>16),rt(i,65535&t.adler)),t.adler=1}if(i.status===B)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending!==i.pending_buf_size));)nt(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=F)}else i.status=F;if(i.status===F)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=H)}else i.status=H;if(i.status===H&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(nt(i,255&t.adler),nt(i,t.adler>>8&255),t.adler=0,i.status=V)):i.status=V),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(n)&&e!==d)return Y(t,g);if(i.status===J&&0!==t.avail_in)return Y(t,g);if(0!==t.avail_in||0!==i.lookahead||e!==u&&i.status!==J){var b=i.strategy===_?function(t,e){for(var n;;){if(0===t.lookahead&&(ot(t),0===t.lookahead)){if(e===u)return W;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}(i,e):i.strategy===k?function(t,e){for(var n,r,i,a,s=t.window;;){if(t.lookahead<=R){if(ot(t),t.lookahead<=R&&e===u)return W;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=D&&t.strstart>0&&(r=s[i=t.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){a=t.strstart+R;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);t.match_length=R-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=D?(n=o._tr_tally(t,1,t.match_length-D),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}(i,e):r[i.level].func(i,e);if(b!==G&&b!==K||(i.status=J),b===W||b===G)return 0===t.avail_out&&(i.last_flush=-1),p;if(b===$&&(e===l?o._tr_align(i):e!==f&&(o._tr_stored_block(i,0,0,!1),e===h&&(X(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,p}return e!==d?p:i.wrap<=0?v:(2===i.wrap?(nt(i,255&t.adler),nt(i,t.adler>>8&255),nt(i,t.adler>>16&255),nt(i,t.adler>>24&255),nt(i,255&t.total_in),nt(i,t.total_in>>8&255),nt(i,t.total_in>>16&255),nt(i,t.total_in>>24&255)):(rt(i,t.adler>>>16),rt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:v)},n.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==z&&e!==B&&e!==U&&e!==F&&e!==H&&e!==V&&e!==J?Y(t,y):(t.state=null,e===V?Y(t,m):p):y},n.deflateSetDictionary=function(t,e){var n,r,o,s,c,u,l,h,d=e.length;if(!t||!t.state)return y;if(2===(s=(n=t.state).wrap)||1===s&&n.status!==z||n.lookahead)return y;for(1===s&&(t.adler=a(t.adler,e,d,0)),n.wrap=0,d>=n.w_size&&(0===s&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,e,d-n.w_size,n.w_size,0),e=h,d=n.w_size),c=t.avail_in,u=t.next_in,l=t.input,t.avail_in=d,t.next_in=0,t.input=e,ot(n);n.lookahead>=D;){r=n.strstart,o=n.lookahead-(D-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+D-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=D-1,ot(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=D-1,n.match_available=0,t.next_in=u,t.input=l,t.avail_in=c,n.wrap=s,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":"JNpU","./trees":"ckcG","./adler32":"PDe7","./crc32":"Nls6","./messages":"NGcu"}],JPkB:[function(t,e,n){"use strict";var r=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,n.string2buf=function(t){var e,n,i,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},n.buf2binstring=function(t){return c(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,i,o,s=e||t.length,u=new Array(2*s);for(r=0,n=0;n<s;)if((i=t[n++])<128)u[r++]=i;else if((o=a[i])>4)u[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&t[n++],o--;o>1?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return c(u,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+a[t[n]]>e?n:e}},{"./common":"JNpU"}],w28B:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],KDqm:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),s=t("./zlib/zstream"),c=Object.prototype.toString,u=0,l=-1,h=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({level:l,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==u)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==u)throw new Error(a[n]);this._dict_set=!0}}function p(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}f.prototype.push=function(t,e){var n,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=r.deflate(s,a))&&n!==u)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u):2!==a||(this.onEnd(u),s.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=f,n.deflate=p,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./zlib/deflate":"X2fg","./utils/common":"JNpU","./utils/strings":"JPkB","./zlib/messages":"NGcu","./zlib/zstream":"w28B"}],odtK:[function(t,e,n){"use strict";e.exports=function(t,e){var n,r,i,o,a,s,c,u,l,h,d,f,p,v,y,m,g,b,w,_,k,S,x,C,E;n=t.state,r=t.next_in,C=t.input,i=r+(t.avail_in-5),o=t.next_out,E=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,v=n.lencode,y=n.distcode,m=(1<<n.lenbits)-1,g=(1<<n.distbits)-1;t:do{p<15&&(f+=C[r++]<<p,p+=8,f+=C[r++]<<p,p+=8),b=v[f&m];e:for(;;){if(f>>>=w=b>>>24,p-=w,0===(w=b>>>16&255))E[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=v[(65535&b)+(f&(1<<w)-1)];continue e}if(32&w){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}_=65535&b,(w&=15)&&(p<w&&(f+=C[r++]<<p,p+=8),_+=f&(1<<w)-1,f>>>=w,p-=w),p<15&&(f+=C[r++]<<p,p+=8,f+=C[r++]<<p,p+=8),b=y[f&g];n:for(;;){if(f>>>=w=b>>>24,p-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=y[(65535&b)+(f&(1<<w)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(k=65535&b,p<(w&=15)&&(f+=C[r++]<<p,(p+=8)<w&&(f+=C[r++]<<p,p+=8)),(k+=f&(1<<w)-1)>c){t.msg="invalid distance too far back",n.mode=30;break t}if(f>>>=w,p-=w,k>(w=o-a)){if((w=k-w)>l&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(S=0,x=d,0===h){if(S+=u-w,w<_){_-=w;do{E[o++]=d[S++]}while(--w);S=o-k,x=E}}else if(h<w){if(S+=u+h-w,(w-=h)<_){_-=w;do{E[o++]=d[S++]}while(--w);if(S=0,h<_){_-=w=h;do{E[o++]=d[S++]}while(--w);S=o-k,x=E}}}else if(S+=h-w,w<_){_-=w;do{E[o++]=d[S++]}while(--w);S=o-k,x=E}for(;_>2;)E[o++]=x[S++],E[o++]=x[S++],E[o++]=x[S++],_-=3;_&&(E[o++]=x[S++],_>1&&(E[o++]=x[S++]))}else{S=o-k;do{E[o++]=E[S++],E[o++]=E[S++],E[o++]=E[S++],_-=3}while(_>2);_&&(E[o++]=E[S++],_>1&&(E[o++]=E[S++]))}break}}break}}while(r<i&&o<s);r-=_=p>>3,f&=(1<<(p-=_<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=p}},{}],Zotp:[function(t,e,n){"use strict";var r=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,c,u,l,h,d){var f,p,v,y,m,g,b,w,_,k=d.bits,S=0,x=0,C=0,E=0,O=0,M=0,A=0,T=0,P=0,I=0,j=null,N=0,D=new r.Buf16(16),R=new r.Buf16(16),q=null,L=0;for(S=0;S<=15;S++)D[S]=0;for(x=0;x<c;x++)D[e[n+x]]++;for(O=k,E=15;E>=1&&0===D[E];E--);if(O>E&&(O=E),0===E)return u[l++]=20971520,u[l++]=20971520,d.bits=1,0;for(C=1;C<E&&0===D[C];C++);for(O<C&&(O=C),T=1,S=1;S<=15;S++)if(T<<=1,(T-=D[S])<0)return-1;if(T>0&&(0===t||1!==E))return-1;for(R[1]=0,S=1;S<15;S++)R[S+1]=R[S]+D[S];for(x=0;x<c;x++)0!==e[n+x]&&(h[R[e[n+x]]++]=x);if(0===t?(j=q=h,g=19):1===t?(j=i,N-=257,q=o,L-=257,g=256):(j=a,q=s,g=-1),I=0,x=0,S=C,m=l,M=O,A=0,v=-1,y=(P=1<<O)-1,1===t&&P>852||2===t&&P>592)return 1;for(;;){b=S-A,h[x]<g?(w=0,_=h[x]):h[x]>g?(w=q[L+h[x]],_=j[N+h[x]]):(w=96,_=0),f=1<<S-A,C=p=1<<M;do{u[m+(I>>A)+(p-=f)]=b<<24|w<<16|_|0}while(0!==p);for(f=1<<S-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,x++,0==--D[S]){if(S===E)break;S=e[n+h[x]]}if(S>O&&(I&y)!==v){for(0===A&&(A=O),m+=C,T=1<<(M=S-A);M+A<E&&!((T-=D[M+A])<=0);)M++,T<<=1;if(P+=1<<M,1===t&&P>852||2===t&&P>592)return 1;u[v=I&y]=O<<24|M<<16|m-l|0}}return 0!==I&&(u[m+I]=S-A<<24|64<<16|0),d.bits=O,0}},{"../utils/common":"JNpU"}],PRZ0:[function(t,e,n){"use strict";var r=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),c=0,u=1,l=2,h=4,d=5,f=6,p=0,v=1,y=2,m=-2,g=-3,b=-4,w=-5,_=8,k=1,S=2,x=3,C=4,E=5,O=6,M=7,A=8,T=9,P=10,I=11,j=12,N=13,D=14,R=15,q=16,L=17,z=18,B=19,U=20,F=21,H=22,V=23,J=24,W=25,$=26,G=27,K=28,Z=29,Y=30,Q=31,X=32,tt=852,et=592,nt=15;function rt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,p):m}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,ot(t)):m}function st(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?m:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,at(t))):m}function ct(t,e){var n,r;return t?(r=new it,t.state=r,r.window=null,(n=st(t,e))!==p&&(t.state=null),n):m}var ut,lt,ht=!0;function dt(t){if(ht){var e;for(ut=new r.Buf32(512),lt=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(u,t.lens,0,288,ut,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(l,t.lens,0,32,lt,0,t.work,{bits:5}),ht=!1}t.lencode=ut,t.lenbits=9,t.distcode=lt,t.distbits=5}function ft(t,e,n,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,e,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,e,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}n.inflateReset=at,n.inflateReset2=st,n.inflateResetKeep=ot,n.inflateInit=function(t){return ct(t,nt)},n.inflateInit2=ct,n.inflate=function(t,e){var n,tt,et,nt,it,ot,at,st,ct,ut,lt,ht,pt,vt,yt,mt,gt,bt,wt,_t,kt,St,xt,Ct,Et=0,Ot=new r.Buf8(4),Mt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return m;(n=t.state).mode===j&&(n.mode=N),it=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,st=n.hold,ct=n.bits,ut=ot,lt=at,St=p;t:for(;;)switch(n.mode){case k:if(0===n.wrap){n.mode=N;break}for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(2&n.wrap&&35615===st){n.check=0,Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0),st=0,ct=0,n.mode=S;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&st)<<8)+(st>>8))%31){t.msg="incorrect header check",n.mode=Y;break}if((15&st)!==_){t.msg="unknown compression method",n.mode=Y;break}if(ct-=4,kt=8+(15&(st>>>=4)),0===n.wbits)n.wbits=kt;else if(kt>n.wbits){t.msg="invalid window size",n.mode=Y;break}n.dmax=1<<kt,t.adler=n.check=1,n.mode=512&st?P:j,st=0,ct=0;break;case S:for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(n.flags=st,(255&n.flags)!==_){t.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=st>>8&1),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0)),st=0,ct=0,n.mode=x;case x:for(;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.time=st),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,Ot[2]=st>>>16&255,Ot[3]=st>>>24&255,n.check=o(n.check,Ot,4,0)),st=0,ct=0,n.mode=C;case C:for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.xflags=255&st,n.head.os=st>>8),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0)),st=0,ct=0,n.mode=E;case E:if(1024&n.flags){for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.length=st,n.head&&(n.head.extra_len=st),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0)),st=0,ct=0}else n.head&&(n.head.extra=null);n.mode=O;case O:if(1024&n.flags&&((ht=n.length)>ot&&(ht=ot),ht&&(n.head&&(kt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,ht,kt)),512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,n.length-=ht),n.length))break t;n.length=0,n.mode=M;case M:if(2048&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.name+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(4096&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.comment+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.comment=null);n.mode=T;case T:if(512&n.flags){for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(st!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Y;break}st=0,ct=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=j;break;case P:for(;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}t.adler=n.check=rt(st),st=0,ct=0,n.mode=I;case I:if(0===n.havedict)return t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ct,y;t.adler=n.check=1,n.mode=j;case j:if(e===d||e===f)break t;case N:if(n.last){st>>>=7&ct,ct-=7&ct,n.mode=G;break}for(;ct<3;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}switch(n.last=1&st,ct-=1,3&(st>>>=1)){case 0:n.mode=D;break;case 1:if(dt(n),n.mode=U,e===f){st>>>=2,ct-=2;break t}break;case 2:n.mode=L;break;case 3:t.msg="invalid block type",n.mode=Y}st>>>=2,ct-=2;break;case D:for(st>>>=7&ct,ct-=7&ct;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if((65535&st)!=(st>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&st,st=0,ct=0,n.mode=R,e===f)break t;case R:n.mode=q;case q:if(ht=n.length){if(ht>ot&&(ht=ot),ht>at&&(ht=at),0===ht)break t;r.arraySet(et,tt,nt,ht,it),ot-=ht,nt+=ht,at-=ht,it+=ht,n.length-=ht;break}n.mode=j;break;case L:for(;ct<14;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(n.nlen=257+(31&st),st>>>=5,ct-=5,n.ndist=1+(31&st),st>>>=5,ct-=5,n.ncode=4+(15&st),st>>>=4,ct-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=z;case z:for(;n.have<n.ncode;){for(;ct<3;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.lens[Mt[n.have++]]=7&st,st>>>=3,ct-=3}for(;n.have<19;)n.lens[Mt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,xt={bits:n.lenbits},St=s(c,n.lens,0,19,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=B;case B:for(;n.have<n.nlen+n.ndist;){for(;mt=(Et=n.lencode[st&(1<<n.lenbits)-1])>>>16&255,gt=65535&Et,!((yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(gt<16)st>>>=yt,ct-=yt,n.lens[n.have++]=gt;else{if(16===gt){for(Ct=yt+2;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(st>>>=yt,ct-=yt,0===n.have){t.msg="invalid bit length repeat",n.mode=Y;break}kt=n.lens[n.have-1],ht=3+(3&st),st>>>=2,ct-=2}else if(17===gt){for(Ct=yt+3;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}ct-=yt,kt=0,ht=3+(7&(st>>>=yt)),st>>>=3,ct-=3}else{for(Ct=yt+7;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}ct-=yt,kt=0,ht=11+(127&(st>>>=yt)),st>>>=7,ct-=7}if(n.have+ht>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Y;break}for(;ht--;)n.lens[n.have++]=kt}}if(n.mode===Y)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,xt={bits:n.lenbits},St=s(u,n.lens,0,n.nlen,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,xt={bits:n.distbits},St=s(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,xt),n.distbits=xt.bits,St){t.msg="invalid distances set",n.mode=Y;break}if(n.mode=U,e===f)break t;case U:n.mode=F;case F:if(ot>=6&&at>=258){t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ct,a(t,lt),it=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,st=n.hold,ct=n.bits,n.mode===j&&(n.back=-1);break}for(n.back=0;mt=(Et=n.lencode[st&(1<<n.lenbits)-1])>>>16&255,gt=65535&Et,!((yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(mt&&0==(240&mt)){for(bt=yt,wt=mt,_t=gt;mt=(Et=n.lencode[_t+((st&(1<<bt+wt)-1)>>bt)])>>>16&255,gt=65535&Et,!(bt+(yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}st>>>=bt,ct-=bt,n.back+=bt}if(st>>>=yt,ct-=yt,n.back+=yt,n.length=gt,0===mt){n.mode=$;break}if(32&mt){n.back=-1,n.mode=j;break}if(64&mt){t.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&mt,n.mode=H;case H:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.length+=st&(1<<n.extra)-1,st>>>=n.extra,ct-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=V;case V:for(;mt=(Et=n.distcode[st&(1<<n.distbits)-1])>>>16&255,gt=65535&Et,!((yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(0==(240&mt)){for(bt=yt,wt=mt,_t=gt;mt=(Et=n.distcode[_t+((st&(1<<bt+wt)-1)>>bt)])>>>16&255,gt=65535&Et,!(bt+(yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}st>>>=bt,ct-=bt,n.back+=bt}if(st>>>=yt,ct-=yt,n.back+=yt,64&mt){t.msg="invalid distance code",n.mode=Y;break}n.offset=gt,n.extra=15&mt,n.mode=J;case J:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.offset+=st&(1<<n.extra)-1,st>>>=n.extra,ct-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Y;break}n.mode=W;case W:if(0===at)break t;if(ht=lt-at,n.offset>ht){if((ht=n.offset-ht)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Y;break}ht>n.wnext?(ht-=n.wnext,pt=n.wsize-ht):pt=n.wnext-ht,ht>n.length&&(ht=n.length),vt=n.window}else vt=et,pt=it-n.offset,ht=n.length;ht>at&&(ht=at),at-=ht,n.length-=ht;do{et[it++]=vt[pt++]}while(--ht);0===n.length&&(n.mode=F);break;case $:if(0===at)break t;et[it++]=n.length,at--,n.mode=F;break;case G:if(n.wrap){for(;ct<32;){if(0===ot)break t;ot--,st|=tt[nt++]<<ct,ct+=8}if(lt-=at,t.total_out+=lt,n.total+=lt,lt&&(t.adler=n.check=n.flags?o(n.check,et,lt,it-lt):i(n.check,et,lt,it-lt)),lt=at,(n.flags?st:rt(st))!==n.check){t.msg="incorrect data check",n.mode=Y;break}st=0,ct=0}n.mode=K;case K:if(n.wrap&&n.flags){for(;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(st!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Y;break}st=0,ct=0}n.mode=Z;case Z:St=v;break t;case Y:St=g;break t;case Q:return b;case X:default:return m}return t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ct,(n.wsize||lt!==t.avail_out&&n.mode<Y&&(n.mode<G||e!==h))&&ft(t,t.output,t.next_out,lt-t.avail_out)?(n.mode=Q,b):(ut-=t.avail_in,lt-=t.avail_out,t.total_in+=ut,t.total_out+=lt,n.total+=lt,n.wrap&&lt&&(t.adler=n.check=n.flags?o(n.check,et,lt,t.next_out-lt):i(n.check,et,lt,t.next_out-lt)),t.data_type=n.bits+(n.last?64:0)+(n.mode===j?128:0)+(n.mode===U||n.mode===R?256:0),(0===ut&&0===lt||e===h)&&St===p&&(St=w),St)},n.inflateEnd=function(t){if(!t||!t.state)return m;var e=t.state;return e.window&&(e.window=null),t.state=null,p},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?m:(n.head=e,e.done=!1,p):m},n.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&n.mode!==I?m:n.mode===I&&i(1,e,r,0)!==n.check?g:ft(t,e,r,r)?(n.mode=Q,b):(n.havedict=1,p):m},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":"JNpU","./adler32":"PDe7","./crc32":"Nls6","./inffast":"odtK","./inftrees":"Zotp"}],NNt1:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],bEbX:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],iCYE:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),c=t("./zlib/zstream"),u=t("./zlib/gzheader"),l=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[n])}function d(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(t,e){var n,s,c,u,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,v=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?d.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===v&&(n=a.Z_OK,v=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(d.output,d.next_out),u=d.next_out-c,h=o.buf2string(d.output,c),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,c,u,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(v=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./zlib/inflate":"PRZ0","./utils/common":"JNpU","./utils/strings":"JPkB","./zlib/constants":"NNt1","./zlib/messages":"NGcu","./zlib/zstream":"w28B","./zlib/gzheader":"bEbX"}],JWfd:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/utils/common":"JNpU","./lib/deflate":"KDqm","./lib/inflate":"iCYE","./lib/zlib/constants":"NNt1"}],nlD3:[function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("@babel/runtime/regenerator")),o=r(t("@babel/runtime/helpers/slicedToArray")),a=r(t("@babel/runtime/helpers/toConsumableArray")),s=r(t("@babel/runtime/helpers/typeof")),c=r(t("@babel/runtime/helpers/asyncToGenerator")),u=r(t("@babel/runtime/helpers/defineProperty")),l=r(t("toastify-js")),h=r(t("seedrandom/seedrandom")),d=r(t("@babel/runtime/helpers/classCallCheck")),f=r(t("@babel/runtime/helpers/createClass")),p=r(t("fast-json-stable-stringify")),v=r(t("@babel/runtime/helpers/get")),y=r(t("@babel/runtime/helpers/inherits")),m=r(t("@babel/runtime/helpers/possibleConstructorReturn")),g=r(t("@babel/runtime/helpers/getPrototypeOf")),b=r(t("fastpriorityqueue")),w=r(t("@babel/runtime/helpers/toArray")),_=r(t("@babel/runtime/helpers/construct"));const k="production";if(void 0===window.TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(t){for(var e=t.length,n=-1,r="undefined"==typeof Uint8Array?new Array(1.5*e):new Uint8Array(3*e),i=0,o=0,a=0;a!==e;){if(i=t.charCodeAt(a),a+=1,i>=55296&&i<=56319){if(a===e){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;break}if(!((o=t.charCodeAt(a))>=56320&&o<=57343)){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;continue}if(a+=1,(i=1024*(i-55296)+o-56320+65536)>65535){r[n+=1]=240|i>>>18,r[n+=1]=128|i>>>12&63,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i;continue}}i<=127?r[n+=1]=0|i:i<=2047?(r[n+=1]=192|i>>>6,r[n+=1]=128|63&i):(r[n+=1]=224|i>>>12,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?r.subarray(0,n+1):(r.length=n+1,r)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(r){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}var S;!function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;e<r;e++){var i=[],o=this.data.charCodeAt(e);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;e<n;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+n][e+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=i.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e},createMovieClip:function(t,e,n){var r=t.createEmptyMovieClip(e,n);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,a=0;a<this.modules[i].length;a++){var s=1*a;this.modules[i][a]&&(r.beginFill(0,100),r.moveTo(s,o),r.lineTo(s+1,o),r.lineTo(s+1,o+1),r.lineTo(s,o+1),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=i.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=t[e],o=t[n];if(null==this.modules[r][o])for(var a=-2;a<=2;a++)for(var s=-2;s<=2;s++)this.modules[r+a][o+s]=-2==a||2==a||-2==s||2==s||0==a&&0==s}},setupTypeNumber:function(t){for(var e=i.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++)r=!t&&1==(e>>n&1),this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,r=i.getBCHTypeInfo(n),o=0;o<15;o++){var a=!t&&1==(r>>o&1);o<6?this.modules[o][8]=a:o<8?this.modules[o+1][8]=a:this.modules[this.moduleCount-15+o][8]=a}for(o=0;o<15;o++)a=!t&&1==(r>>o&1),o<8?this.modules[8][this.moduleCount-o-1]=a:o<9?this.modules[8][15-o-1+1]=a:this.modules[8][15-o-1]=a;this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,r=this.moduleCount-1,o=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var c=0;c<2;c++)if(null==this.modules[r][s-c]){var u=!1;a<t.length&&(u=1==(t[a]>>>o&1)),i.getMask(e,r,s-c)&&(u=!u),this.modules[r][s-c]=u,-1==--o&&(a++,o=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,r){for(var o=c.getRSBlocks(t,n),a=new u,s=0;s<r.length;s++){var l=r[s];a.put(l.mode,4),a.put(l.getLength(),i.getLengthInBits(l.mode,t)),l.write(a)}var h=0;for(s=0;s<o.length;s++)h+=o[s].dataCount;if(a.getLengthInBits()>8*h)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*h+")");for(a.getLengthInBits()+4<=8*h&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*h||(a.put(e.PAD0,8),a.getLengthInBits()>=8*h));)a.put(e.PAD1,8);return e.createBytes(a,o)},e.createBytes=function(t,e){for(var n=0,r=0,o=0,a=new Array(e.length),c=new Array(e.length),u=0;u<e.length;u++){var l=e[u].dataCount,h=e[u].totalCount-l;r=Math.max(r,l),o=Math.max(o,h),a[u]=new Array(l);for(var d=0;d<a[u].length;d++)a[u][d]=255&t.buffer[d+n];n+=l;var f=i.getErrorCorrectPolynomial(h),p=new s(a[u],f.getLength()-1).mod(f);for(c[u]=new Array(f.getLength()-1),d=0;d<c[u].length;d++){var v=d+p.getLength()-c[u].length;c[u][d]=v>=0?p.get(v):0}}var y=0;for(d=0;d<e.length;d++)y+=e[d].totalCount;var m=new Array(y),g=0;for(d=0;d<r;d++)for(u=0;u<e.length;u++)d<a[u].length&&(m[g++]=a[u][d]);for(d=0;d<o;d++)for(u=0;u<e.length;u++)d<c[u].length&&(m[g++]=c[u][d]);return m};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},i={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;i.getBCHDigit(e)-i.getBCHDigit(i.G15)>=0;)e^=i.G15<<i.getBCHDigit(e)-i.getBCHDigit(i.G15);return(t<<10|e)^i.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;i.getBCHDigit(e)-i.getBCHDigit(i.G18)>=0;)e^=i.G18<<i.getBCHDigit(e)-i.getBCHDigit(i.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return i.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case 0:return(e+n)%2==0;case 1:return e%2==0;case 2:return n%3==0;case 3:return(e+n)%3==0;case 4:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case 5:return e*n%2+e*n%3==0;case 6:return(e*n%2+e*n%3)%2==0;case 7:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new s([1],0),n=0;n<t;n++)e=e.multiply(new s([1,o.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,r=0;r<e;r++)for(var i=0;i<e;i++){for(var o=0,a=t.isDark(r,i),s=-1;s<=1;s++)if(!(r+s<0||e<=r+s))for(var c=-1;c<=1;c++)i+c<0||e<=i+c||0==s&&0==c||a==t.isDark(r+s,i+c)&&o++;o>5&&(n+=3+o-5)}for(r=0;r<e-1;r++)for(i=0;i<e-1;i++){var u=0;t.isDark(r,i)&&u++,t.isDark(r+1,i)&&u++,t.isDark(r,i+1)&&u++,t.isDark(r+1,i+1)&&u++,0!=u&&4!=u||(n+=3)}for(r=0;r<e;r++)for(i=0;i<e-6;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(n+=40);for(i=0;i<e;i++)for(r=0;r<e-6;r++)t.isDark(r,i)&&!t.isDark(r+1,i)&&t.isDark(r+2,i)&&t.isDark(r+3,i)&&t.isDark(r+4,i)&&!t.isDark(r+5,i)&&t.isDark(r+6,i)&&(n+=40);var l=0;for(i=0;i<e;i++)for(r=0;r<e;r++)t.isDark(r,i)&&l++;return n+Math.abs(100*l/e/e-50)/5*10}},o={glog:function(t){if(t<1)throw new Error("glog("+t+")");return o.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return o.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},a=0;a<8;a++)o.EXP_TABLE[a]=1<<a;for(a=8;a<256;a++)o.EXP_TABLE[a]=o.EXP_TABLE[a-4]^o.EXP_TABLE[a-5]^o.EXP_TABLE[a-6]^o.EXP_TABLE[a-8];for(a=0;a<255;a++)o.LOG_TABLE[o.EXP_TABLE[a]]=a;function s(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var r=0;r<t.length-n;r++)this.num[r]=t[r+n]}function c(t,e){this.totalCount=t,this.dataCount=e}function u(){this.buffer=[],this.length=0}s.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<t.getLength();r++)e[n+r]^=o.gexp(o.glog(this.get(n))+o.glog(t.get(r)));return new s(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=o.glog(this.get(0))-o.glog(t.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<t.getLength();r++)n[r]^=o.gexp(o.glog(t.get(r))+e);return new s(n,0).mod(t)}},c.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],c.getRSBlocks=function(t,e){var n=c.getRsBlockTable(t,e);if(null==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=n.length/3,i=[],o=0;o<r;o++)for(var a=n[3*o+0],s=n[3*o+1],u=n[3*o+2],l=0;l<a;l++)i.push(new c(s,u));return i},c.getRsBlockTable=function(t,e){switch(e){case r.L:return c.RS_BLOCK_TABLE[4*(t-1)+0];case r.M:return c.RS_BLOCK_TABLE[4*(t-1)+1];case r.Q:return c.RS_BLOCK_TABLE[4*(t-1)+2];case r.H:return c.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},u.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],h=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,n=this._htOption,r=t.getModuleCount(),i=n.width/r,o=n.height/r,a=Math.round(i),s=Math.round(o);this.clear();for(var c=0;c<r;c++)for(var u=0;u<r;u++){var l=t.isDark(c,u),h=u*i,d=c*o;e.strokeStyle=l?n.colorDark:n.colorLight,e.lineWidth=1,e.fillStyle=l?n.colorDark:n.colorLight,e.fillRect(h,d,i,o),e.strokeRect(Math.floor(h)+.5,Math.floor(d)+.5,a,s),e.strokeRect(Math.ceil(h)-.5,Math.ceil(d)-.5,a,s)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();(S=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:r.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(h=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new h(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(function(t,e){for(var n=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),o=0,a=l.length;o<=a;o++){var s=0;switch(e){case r.L:s=l[o][0];break;case r.M:s=l[o][1];break;case r.Q:s=l[o][2];break;case r.H:s=l[o][3]}if(i<=s)break;n++}if(n>l.length)throw new Error("Too long data");return n}(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},S.prototype.clear=function(){this._oDrawing.clear()},S.prototype.getCanvas=function(){for(var t=0;t<this._el.children.length;t++){var e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},S.CorrectLevel=r}();var x=S;function C(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}"object"===(void 0===e?"undefined":s(e))&&e.bundle&&e.bundle.modules&&e.bundle.cache&&function(){for(var t=e.bundle,n={},r={},i={},s=0,c=Object.entries(t.modules);s<c.length;s++){var u=o(c[s],2),l=u[0],h=u[1],d=""+t.modules[l][0],f=r[d];f?i[l]=f:r[d]=l;for(var p=0,v=Object.entries(h[1]);p<v.length;p++){var y=o(v[p],2),m=y[0],g=y[1];(n[g]||(n[g]=new Set)).add(m)}}for(var b=function(t){return n[t]?"".concat(a(n[t]).sort().join('" and "')):"top-level"},w={},_=[],k=0,S=Object.entries(t.modules);k<S.length;k++)for(var x=o(S[k],2),E=x[0],O=x[1],M=0,A=Object.entries(O[1]);M<A.length;M++){var T=o(A[M],2),P=T[0],I=T[1],j=i[I];j&&(t.cache[I]?w[j]=I:(O[1][P]=j,delete t.modules[I],_.push('"'.concat(P,'" in "').concat(b(E),'" (').concat(E,")"))))}for(var N=0,D=Object.entries(t.modules);N<D.length;N++)for(var R=o(D[N],2),q=R[0],L=R[1],z=0,B=Object.entries(L[1]);z<B.length;z++){var U=o(B[z],2),F=U[0],H=U[1],V=w[H];V&&(t.cache[H]?console.warn('Could not deduplicate import "'.concat(F,'" in "').concat(b(q),'" (to fix, import "').concat(b(e.id),'" earlier)')):(L[1][F]=V,delete t.modules[H],_.push('"'.concat(F,'" in "').concat(b(q),'" (').concat(q,")"))))}var J,W=C(_.sort());try{for(W.s();!(J=W.n()).done;){var $=J.value;console.log("Deduplicated import",$)}}catch(t){W.e(t)}finally{W.f()}}();var M=window.location.hostname.endsWith("croquet.studio"),A="",T="";function P(t,e){if(e){var n,r=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(e.split("&"));try{for(r.s();!(n=r.n()).done;){var i=n.value.split("="),o=i[0],a=!0;if(i.length>1&&(a=decodeURIComponent(i.slice(1).join("="))).match(/^(true|false|null|[0-9.]*|["[{].*)$/))try{a=JSON.parse(a)}catch(t){"["===a[0]&&(a=a.slice(1,-1).split(","))}t[o]=a}}catch(t){r.e(t)}finally{r.f()}}}var I=new(function(){function t(){d(this,t),this.getSession(),P(this,window.location.search.slice(1)),P(this,M?window.location.hash.slice(1):T),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}return f(t,[{key:"has",value:function(t,e,n){"boolean"!=typeof n&&(n=this.isHost(n));var r=this[t];if("string"!=typeof r)return n;var i=r.split(",");return!0===n&&(e="no".concat(e)),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes("".concat(e,"s"))?!n:n}},{key:"getSession",value:function(){if(M){var t=window.location.pathname.match(/^\/([^/]+)\/(.*)$/);if(t)return A=t[1],t[2]}else{var e=window.location.hash.match(/^#([^&]+)&?(.*)$/);if(e)return e[1].includes("=")?(T="".concat(e[1],"&").concat(e[2]),""):(T=e[2],e[1])}return"string"==typeof this.session?(T=window.location.hash.slice(1),this.session):""}},{key:"setSession",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==M&&this.getSession();var n=window.location,r=n.search,i=n.hash,o=M?"/".concat(A,"/").concat(t).concat(r).concat(i):"#".concat(t).concat(T?"&"+T:"");e?window.history.replaceState({},"",o):window.history.pushState({},"",o)}},{key:"isHost",value:function(t){var e=window.location.hostname;return e===t||"localhost"===t&&(!!e.endsWith(".ngrok.io")||["127.0.0.1","::1"].includes(e))}},{key:"isLocalhost",value:function(){return this.isHost("localhost")}}]),t}());function j(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var D=Date.now();"undefined"==typeof performance&&(window.performance={now:function(){return Date.now()-D}});var R=["simulate","update","render","snapshot"],q={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"},L=null,z=null,B=null,U=null;var F=[],H=0,V=!1,J=W(0);function W(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:V}}function $(t){for(J.total=t-J.start,F.push(J);F.length>Math.min(120,window.innerWidth);)F.shift();if(L&&"none"!==window.getComputedStyle(L).display){var e=F.slice(1).filter(function(t){return t.total}),n=e.map(function(t){return t.total}).reduce(function(t,e){return t+e},0)/e.length;Math.max.apply(Math,a(e.map(function(t){return Math.max(t.backlog,t.network)}))),H=1e3,z.parentElement||(console.warn("who broke the stats div and canvas?"),L.appendChild(z),L.appendChild(B)),z.innerText="".concat(J.users," users, ").concat(Math.round(1e3/n)," fps, ")+(J.backlog<100&&J.activity<1e3?"latency: ".concat(J.latency," ms"):"backlog: ".concat(J.backlog<100?"0.0":(J.backlog/1e3).toFixed(1)," s")),U.clearRect(0,0,B.width,B.height);for(var r=function(t){return 20*(1-t/(1e3/60))+60},i=function(t){return r(t/H*-2*(1e3/60))+5},o=0;o<F.length;o++){var s=F[o],c=o+.5,u=r(0);U.beginPath(),U.moveTo(c,u),U.lineTo(c,r(s.total)),U.strokeStyle=q[s.connected?"total":"network"],U.stroke(),U.beginPath(),U.moveTo(c,u),u=r(s.total);var l,h=0,d=j(R);try{for(d.s();!(l=d.n()).done;){var f=l.value;s.items[f]&&(h+=s.items[f],u=r(h),U.lineTo(c,u),U.strokeStyle=q[f],U.stroke(),U.beginPath(),U.moveTo(c,u))}}catch(t){d.e(t)}finally{d.f()}s.network&&(U.beginPath(),U.moveTo(c,i(0)),U.lineTo(c,i(s.network)),U.strokeStyle=q.network,U.stroke())}U.strokeStyle="rgba(255, 255, 255, 0.2)";for(var p=0;p<60;p+=1e3/60)U.moveTo(0,r(p)),U.lineTo(120,r(p)),U.stroke()}}var G=[],K={animationFrame:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(t),J=W(t);for(var n=0,r=Object.entries(e);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];this[a](s)}},begin:function(t){var e=performance.now();J.items[t]=(J.items[t]||0)-e;var n=G[G.length-1];return n&&(J.items[n]+=e),G.push(t),e},end:function(t){var e=performance.now();if(J.items[t]+=e,G.pop()!==t)throw Error("Unmatched stats calls for "+t);var n=G[G.length-1];return n&&(J.items[n]-=e),e},backlog:function(t){J.backlog=Math.max(t,J.backlog)},network:function(t){J.network=t},starvation:function(t){J.network=t},latency:function(t){J.latency=t},activity:function(t){J.activity=t},users:function(t){J.users=t},connected:function(t){J.connected=V=t}};function Z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Q,X,tt,et="ontouchstart"in document.documentElement,nt=et?20:12,rt=et?0:15;Q="\n        #croquet_dock { position: absolute; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 84px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all ".concat(.3,"s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n\n        .croquet_dock_button { position: absolute; width: ").concat(nt,"%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ").concat(2+rt+nt+2,"% }\n        #croquet_dock_right { right: ").concat(2+rt,"%; }\n        #croquet_dock_pin { right: ").concat(2,"%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: ").concat(2,"px; top: ").concat(2,"px; right: ").concat(2,"px; bottom: ").concat(2,"px; background: white; }\n        #croquet_dock:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; border: 6px solid white; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader:before,\n        #croquet_loader:after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader:before,\n        #croquet_loader:after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader:before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader:after { left: 3.5em; }\n"),(X=document.createElement("style")).innerHTML=Q,document.head.insertBefore(X,document.head.getElementsByTagName("style")[0]),(tt=document.createElement("style")).innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n",document.head.insertBefore(tt,document.head.getElementsByTagName("style")[0]);var it=new Set;function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&gt.showMessage(t,Y({},e,{level:"error"}))}function at(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&gt.showMessage(t,Y({},e,{level:"warning"}))}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&gt.showMessage(t,Y({},e,{level:"status"}))}function ct(t,e){console.error("Error during ".concat(t),e);var n=(e.stack||"").split("\n").filter(function(t){return!t.match(/croquet-.*\.min.js/)}).join("\n");gt.showMessage("<b>Error during ".concat(t,": ").concat(e.message,"</b>\n\n").concat(n).replace(/\n/g,"<br>"),{level:"error",duration:1e4,stopOnFocus:!0})}function ut(t,e){var n=gt.root;if(!1===n)return null;var r,i=Y({text:t,duration:3e3,gravity:"bottom",position:"left",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)",stopOnFocus:!0},e);return n instanceof Element&&n!==document.body?(r=n.id)||(n.id=r="_croquetToastParent"):"string"==typeof n&&(r=n),r&&(i.selector=r),l(i).showToast()}var lt,ht,dt=!1,ft=null;function pt(t,e,n){var r=document.createElement("canvas"),i=r.width=40*nt/12,o=r.height=60,a=r.getContext("2d");a.font="36px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(t,i/2,.55*o);var s=document.createElement("button");s.id=e,s.className="croquet_dock_button";var c=function(t){t.preventDefault(),t.stopPropagation(),n()};return et?s.ontouchstart=c:s.onclick=c,s.appendChild(r),s}function vt(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.firstChild;)t.removeChild(t.firstChild);return new x(t,Y({text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:x.CorrectLevel.L},n))}var yt=0;function mt(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){var n=document.getElementById(t);if(n)return n}return e?e():null}var gt={sessionURL:window.location.href,root:document.body,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!I.nodock){var e=document.getElementById("croquet_dock");e&&e.parentElement.removeChild(e);var n=mt(gt.root);if(n){var r=document.createElement("div");r.id="croquet_dock",n.appendChild(r);var i,o=document.createElement("div");o.id="croquet_dock_bar",r.appendChild(o),!1!==t.badge&&((i=document.createElement("div")).id="croquet_badge",o.appendChild(i),gt.badge=i);var a=document.createElement("div");a.id="croquet_dock_content",r.appendChild(a);var s,c,u=[];if(!1!==t.qrcode){var l=gt.sessionURL;l&&((s=document.createElement("div")).id="croquet_qrcode",a.appendChild(s),u.push(s.id),gt.qrcode=s)}if(!1!==t.stats&&((c=document.createElement("div")).id="croquet_stats",a.appendChild(c),u.push(c.id),gt.stats=c),u.length){var h=function(t){var e,n=u.length,r=0;if(ft){var i=u.indexOf(ft);i>=0?(r=i,e=document.getElementById(ft)):ft=null}var o,a=u[(r+n+t)%n];a===ft?o=e:(e&&e.classList.remove("active"),o=document.getElementById(a)),o&&o.classList.add("active"),ft=a};u.length>1&&(o.appendChild(pt("<","croquet_dock_left",function(){return h(-1)})),o.appendChild(pt(">","croquet_dock_right",function(){return h(1)}))),h(0)}if(!et){var d=pt("","croquet_dock_pin",function(){dt=!dt,f()}),f=function(){dt?d.classList.add("pinned"):d.classList.remove("pinned")};f(),o.appendChild(d)}var p=200,v=166,y=8,m=function(t){r.style.width="".concat(t,"px"),r.style.height="".concat(1.18*t,"px");var e=18*t/100;o.style.height="".concat(e,"px"),a.style.top="".concat(e+2,"px"),i&&(i.style.height="".concat(.9*e,"px"),i.style.width="".concat(.9*e*3,"px")),s&&(s.style.border="".concat(y*t/p,"px solid white"))},g=function(){r.style.width=r.style.height="",o.style.height="",a.style.top="",i&&(i.style.height=i.style.width=""),s&&(s.style.border="")},b=p,w=function(){return r.classList.contains("active")},_=function(){r.classList.add("active"),m(b),setTimeout(function(){return r.style.transition="none"},300)},k=function(){r.style.transition="",r.classList.remove("active"),g()};if(et)k(),r.ontouchstart=function(t){t.preventDefault(),t.stopPropagation(),w()?k():_()};else{dt?_():k();var S=0;r.onwheel=function(t){t.preventDefault(),t.stopPropagation();var e=Date.now();if(!(e-S<100)){S=e;var n=t.deltaY;n=Math.sign(n)*Math.min(5,Math.abs(n));var i=.8*Math.min(window.innerWidth,window.innerHeight);b=Math.max(v,Math.min(i,r.offsetWidth*Math.pow(1.05,n))),m(b)}},r.onmouseenter=_,r.onmouseleave=function(){dt||k()}}}}},makeSessionWidgets:function(t){!function(t){if(t&&!1!==gt.root){var e=mt(gt.badge);e&&function(t,e){if(!1!==gt.badge){var n=function(t){for(var e=new h(t),n=["bcdfghjklmnpqrstvwxyz","aeiou"],r="",i=0;i<5;i++)r+=n[i%2][e.quick()*n[i%2].length|0];return r}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+n;t.firstChild;)t.removeChild(t.firstChild);var r=document.createElement("canvas"),i=r.width=120,o=r.height=40;r.style.width="100%",t.appendChild(r);var a=r.getContext("2d"),s=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new h(t),r=[],i=0;i<e;i++)r.push("hsl(".concat(360*n.quick(),", 50%, 70%)"));return r}(e,2);a.fillStyle=s[0],a.beginPath(),a.moveTo(0,0),a.lineTo(0,o),a.lineTo(i,0),a.closePath(),a.fill(),a.fillStyle=s[1],a.beginPath(),a.moveTo(i,o),a.lineTo(i,0),a.lineTo(0,o),a.closePath(),a.fill(),a.font="30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(n,i/2,o/2)}}(e,t)}}(t),function(){if(!1!==gt.root&&!1!==gt.qrcode&&!I.noqr){var t=gt.sessionURL;if(t){var e=mt(gt.qrcode);e&&(et||(e.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.open(t)}),vt(e,t).getCanvas().style.width="100%")}else console.warn("App.sessionURL is not set")}}(),function(){if(!1!==gt.root&&!I.nostats){var t=mt(gt.stats);t&&function(t){for(L=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",(z=document.createElement("div")).id="text_stats",z.style.padding=5,z.style.background="rgba(255,255,255,0.2)",z.style.fontFamily="sans-serif",t.appendChild(z),t.title=Object.entries(q).map(function(t){var e=o(t,2),n=e[0],r=e[1];return"".concat(r,": ").concat(n)}).join("\n"),(B=document.createElement("canvas")).width=Math.min(125,window.innerWidth)*window.devicePixelRatio,B.height=125*window.devicePixelRatio,B.style.width="100%",t.appendChild(B),(U=B.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio)}(t)}}()},makeQRCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!gt.sessionURL)return null;var e=document.createElement("div"),n=vt(e,gt.sessionURL,t);return n&&n.getCanvas()},clearSessionMoniker:function(){!1!==gt.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait:function(t){!1===gt.root&&(t=!1),function(t){if(ht!==t)if(!1===gt.sync&&(t=!1),t&&!lt&&(lt=function(){var t=document.createElement("div");t.id="croquet_spinnerOverlay";var e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}()),ht=t,t)clearTimeout(yt),yt=setTimeout(function(){ht&&(mt(gt.root,function(){return document.body}).appendChild(lt),lt.style.opacity=.9)},500);else{if(!lt)return;clearTimeout(yt),lt.style.opacity=0,yt=setTimeout(function(){ht||lt.parentElement&&lt.parentElement.removeChild(lt)},500)}}(t)},messageFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("once"===e.only){if(it.has(t))return null;it.add(t)}var n,r=e.level;return"error"===r?(n="red",console.error(t)):"warning"===r?(n="gold",console.warn(t)):n="#aaa",ut(t,Y({backgroundColor:n},e))},showMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return I.nomessages||!1===gt.root||!1===gt.messages||!gt.messageFunction?null:gt.messageFunction(t,e)}};function bt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={};try{r=JSON.parse(localStorage.croquetUser||"{}")}catch(t){}return t in r?r[t]:n?(r[t]=n(),r[t]!==e&&(localStorage.croquetUser=JSON.stringify(r)),r[t]):e}function wt(){return function(){return c(i.mark(function t(){return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!I.nologin){t.next=2;break}return t.abrupt("return",!1);case 2:if(!bt("name")||I.user){t.next=4;break}return t.abrupt("return",!0);case 4:return t.abrupt("return",new Promise(function(t){var e=document.createElement("style");e.innerHTML='\n            .overlay {\n                z-index: 1010;\n                position: fixed;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                background-color:#333;\n                opacity:0.9;\n                display:flex;\n                align-items:center;\n                justify-content:center\n            }\n            form {\n                background-color: #fff;\n                color: #666;\n                border-radius: 10px;\n                padding: 16px;\n                font-size: 14px;\n            }\n            form dt { margin: 4px 0 }\n            form dd { margin-left: 0 }\n            form input {\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                min-height: 46px;\n                padding: 10px;\n                font-size: 16px;\n                width: 100%;\n                box-shadow: inset 0 1px 2px #666;\n            }\n            form input:invalid { border: 1px solid red; }\n            form input:valid   { border: 1px solid #ccc; }\n            form button {\n                padding: 20px 32px;\n                background-color: #3b5;\n                color: #fff;\n                border-radius: 50px;\n                border-width:0;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n            }\n            .error {\n                visibility: hidden;\n                width: 250px;\n                background-color: #fcc;\n                color: #900;\n                padding: 5px;\n                border-radius: 6px;\n                border: 1px solid #c99;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n            .error::after {\n                content: " ";\n                position: absolute;\n                bottom: 100%;  /* At the top of message */\n                left: 10px;\n                border-width: 5px;\n                border-style: solid;\n                border-color: transparent transparent #c99 transparent;\n            }\n            .notice {\n                visibility: hidden;\n                width: 270px;\n                height: 70px;\n                background-color: #fff;\n                padding: 5px;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n        ',document.head.appendChild(e);var n=document.createElement("form");n.innerHTML='\n            <dl>\n                <dt><label for="user[name]">Username</label></dt>\n                <dd>\n                    <input type="text" required pattern="^[a-zA-Z0-9_]*$" minlength="2" maxlength="15" name="user[name]" id="user[name]" placeholder="Enter a username" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n                <dd class="notice"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[email]">Email</label></dt>\n                <dd>\n                    <input type="email" required id="user[email]" placeholder="you@example.com" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[password]">Password</label></dt>\n                <dd>\n                    <input type="password" required minlength="8" id="user[password]" placeholder="Create a password" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <button id="user[create]">Sign up / Log in</button>\n            <div style="margin:16px auto;text-align: center"> OR </div>\n            <button id="user[guest]" style="background-color: #999">Continue as Croquet Guest</button>\n            <div style="max-width:280px;text-align: center;font-size:11px;margin:4px auto">\n                Continuing from this screen to our website indicates that you agree to our\n                <a href="/terms.html" target="_blank" style="color:#36c;text-decoration:none">terms of service</a>\n                and\n                <a href="/privacy.html" target="_blank" style="color:#36c;text-decoration:none">privacy statement</a>.\n            </div>\n        ';var r=document.createElement("div");r.classList.add("overlay"),r.appendChild(n),document.body.appendChild(r);var a=n.getElementsByTagName("input"),s=o(a,3),u=s[0],l=s[1],h=s[2],d=n.getElementsByClassName("error"),f=o(d,3),p=f[0],v=f[1],y=f[2],m=n.getElementsByClassName("notice"),g=o(m,1)[0],b=n.getElementsByTagName("button"),w=o(b,2),_=w[0],k=w[1];"string"==typeof I.user?u.value=I.user:bt("name")&&(u.value=bt("name"));var S=0;u.oninput=function(){clearTimeout(S),S=setTimeout(function(){return M()},300)},P(!0),u.oninput();var x=0;l.oninput=function(){clearTimeout(x),x=setTimeout(function(){return A()},300)};var C=0;function E(){n.reset(),document.head.removeChild(e),document.body.removeChild(r)}function O(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".json";return"".concat(Ct(),"/user/").concat(t.toLowerCase(),"/").concat(e).concat(n)}function M(){return function(){return c(i.mark(function t(){var e,n,r,o,a,s=arguments;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]&&s[0],p.style.visibility="hidden",e||P(!0),(n=u.value.trim())||e){t.next=6;break}return t.abrupt("return",!1);case 6:if(!u.validity.tooShort&&!u.validity.tooLong){t.next=10;break}return p.innerHTML="Your username must be between ".concat(u.minLength," and ").concat(u.maxLength," characters long."),p.style.visibility="visible",t.abrupt("return",!1);case 10:if(!u.validity.patternMismatch){t.next=14;break}return p.innerHTML="Your username can only contain alphanumeric characters (letters A-Z, numbers 0-9) and underscores.",p.style.visibility="visible",t.abrupt("return",!1);case 14:return t.prev=14,r=S,t.next=18,fetch(O(n,"salt"),{mode:"cors"});case 18:if(o=t.sent,r===S||e){t.next=21;break}return t.abrupt("return",!1);case 21:if(!o.ok){t.next=27;break}return e||P(!1),t.next=25,o.json();case 25:return a=t.sent,t.abrupt("return",{name:n,salt:Tt(a.salt)});case 27:t.next=31;break;case 29:t.prev=29,t.t0=t.catch(14);case 31:return t.abrupt("return",{name:n});case 32:case"end":return t.stop()}},t,null,[[14,29]])})).apply(this,arguments)}.apply(this,arguments)}function A(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v.style.visibility="hidden";var e=l.value.trim();return!(!e&&!t)&&(l.validity.valid?e:(v.innerHTML="Please enter a valid email address.",v.style.visibility="visible",!1))}function T(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.style.visibility="hidden";var e=h.value;return!(!e&&!t)&&(h.validity.tooShort?(y.innerHTML="Your password must be at least ".concat(h.minLength," characters long."),y.style.visibility="visible",!1):e)}function P(t){var e=u.value.trim();g.innerHTML="".concat(e," is already registered as a user.<br><br>\n                If this is you, please enter your password below to continue.\n                Otherwise, please pick a different name."),g.style.visibility=t?"hidden":"visible",l.disabled=!t,h.placeholder=e?t?"Create a password for ".concat(e,""):"Enter password for ".concat(e,""):"Enter a password",_.innerHTML=e?t?"Sign up as ".concat(e,""):"Log in as ".concat(e,""):"Sign up / Log in"}h.oninput=function(){clearTimeout(C),C=setTimeout(function(){return T()},300)},_.onclick=function(){var e=c(i.mark(function e(n){var r,o,a,s,c,u,l,h,d,f,p,v,m;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,M(!0);case 3:if(r=e.sent,o=r.name,a=r.salt,s=!!a||A(!0),c=T(!0),o&&s&&c){e.next=10;break}return e.abrupt("return");case 10:return(u=a)||(u=crypto.getRandomValues(new Uint8Array(8)),fetch(O(o,"salt"),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({salt:Pt(u)})})),e.next=14,window.crypto.subtle.importKey("raw",(new TextEncoder).encode(c),{name:"PBKDF2"},!1,["deriveBits"]);case 14:return l=e.sent,e.next=17,window.crypto.subtle.deriveBits({name:"PBKDF2",salt:u,iterations:5e5,hash:"SHA-256"},l,256);case 17:if(h=e.sent,d=Pt(h),!a){e.next=40;break}return e.prev=20,e.next=23,fetch(O(o,d),{mode:"cors"});case 23:if((f=e.sent).ok){e.next=26;break}throw Error("wrong password");case 26:return e.next=28,f.json();case 28:p=e.sent,console.log("Logged in as ".concat(p.name," <").concat(p.email,">")),localStorage.croquetUser=JSON.stringify(p),e.next=38;break;case 33:return e.prev=33,e.t0=e.catch(20),y.innerHTML="Wrong password for ".concat(o,""),y.style.visibility="visible",e.abrupt("return");case 38:e.next=45;break;case 40:v=crypto.getRandomValues(new Uint8Array(16)),m={name:o,email:s,salt:Pt(u),secret:Pt(v)},localStorage.croquetUser=JSON.stringify(m),fetch(O(o,d),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),console.log("Signed up as ".concat(m.name," <").concat(m.email,">"));case 45:E(),t(!0);case 47:case"end":return e.stop()}},e,null,[[20,33]])}));return function(t){return e.apply(this,arguments)}}(),k.onclick=function(e){e.preventDefault(),delete localStorage.croquetUser,E(),t(!1)}}));case 5:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}function _t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xt=window.location.hostname.endsWith("croquet.io")?window.location.host:"croquet.io";function Ct(){var t="string"==typeof I.files?I.files:"https://".concat(xt,"/files/v1");return t.endsWith("/")?t.slice(0,-1):t}function Et(){return e.bundle?e.bundle.modules:[]}function Ot(){return Object.keys(Et()).filter(function(t){return!t.endsWith("hmr-runtime.js")})}function Mt(t){return Et()[t]}function At(t){var e,n,r;return n=(e=""+Mt(t)[0]).indexOf("{"),r=e.lastIndexOf("}"),e.slice(n+1,r).trim()}function Tt(t){return new Uint8Array(atob(t.padEnd(t.length+3&-4,"=").replace(/-/g,"+").replace(/_/g,"/")).split("").map(function(t){return t.charCodeAt(0)}))}function Pt(t){return btoa(String.fromCharCode.apply(String,a(new Uint8Array(t)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function It(t){return function(){return c(i.mark(function t(e){var n;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return","47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU");case 2:return t.next=4,window.crypto.subtle.digest("SHA-256",e);case 4:return n=t.sent,t.abrupt("return",Pt(n));case 6:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}function jt(){return I.has("debug","hashing",!1)}window.crypto&&window.crypto.subtle&&"function"==typeof window.crypto.subtle.digest||console.error("ERROR: crypto.subtle.digest() browser API not available. Please access this page via https or localhost.");var Nt={},Dt={was_initialized:!1};function Rt(t){return Dt.was_initialized||function(){var t,e=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return St(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?St(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(Ot());try{for(e.s();!(t=e.n()).done;)for(var n=t.value,r=0,i=Object.entries(Mt(n)[1]);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1],u=Dt[c]||"",l=s.replace(/^[./]*/,"");l.length>u.length&&(Dt[c]=l)}}catch(t){e.e(t)}finally{e.f()}Dt.was_initialized=!0}(),Dt[t]||t}var qt=new TextEncoder;function Lt(t){return function(){return c(i.mark(function t(e){var n,r;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=qt.encode(e),t.next=3,It(n);case 3:return r=t.sent,jt()&&(Nt[r]={string:e,buffer:n}),t.abrupt("return",r);case 6:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}var zt={};function Bt(t){return function(){return c(i.mark(function t(e){var n,r;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!zt[e]){t.next=2;break}return t.abrupt("return",zt[e]);case 2:return n=At(e).replace(/\s+/g," "),t.next=5,Lt(n);case 5:return r=t.sent,jt()&&(Nt[r].name="Module ".concat(Rt(e))),t.abrupt("return",zt[e]=r);case 8:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}var Ut=[];function Ft(t){var e=Lt(function(t){var e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}"),i=e.slice(0,n).replace(/\s+/g," ").trim(),o=e.slice(n+1,r).trim();return"".concat(i," {\n").concat(o,"}")}(t));e.then(function(e){console.log("hashing class ".concat(t.name,": ").concat(e)),jt()&&(Nt[e].name="Class ".concat(t.name))}),Ut.push(e)}function Ht(t,e){return Vt.apply(this,arguments)}function Vt(){return(Vt=c(i.mark(function t(e,n){var r,o,s,c,u;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="production"===k?[]:Ot().filter(function(t){var e=t.endsWith("/package.json")||t.endsWith("/ar.js");return e&&console.warn("excluding ".concat(t," from code hash")),!e}).sort(),t.next=4,Promise.all([].concat(a(r.map(Bt)),Ut));case 4:return o=t.sent,t.next=7,Lt([n].concat(a(o)).join("|"));case 7:return s=t.sent,t.next=10,Lt([e,s].join("|"));case 10:return c=t.sent,jt()&&(Nt[s].name="All code",Nt[c].name="Session name and code",u=[].concat(a(o),[s,c]).map(function(t){return kt({hash:t},Nt[t])}),console.log("Debug Hashing for session ".concat(c),u)),t.abrupt("return",{hash:c,codeHash:s});case 13:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Wt=function(){function t(){d(this,t),this.values=[],this.resolves=[]}var e;return f(t,[{key:"next",value:(e=c(i.mark(function t(){var e=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.values.length>0)){t.next=2;break}return t.abrupt("return",this.values.shift());case 2:return t.abrupt("return",new Promise(function(t){return e.resolves.push(t)}));case 3:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"put",value:function(t){var e=this.resolves.shift();e?e(t):this.values.push(t)}},{key:"putAll",value:function(t){var e,n=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jt(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.put(r)}}catch(t){n.e(t)}finally{n.f()}}},{key:"peek",value:function(){return this.values[0]}},{key:"nextNonBlocking",value:function(){return this.values.shift()}},{key:"allNonBlocking",value:function(){if(0===this.values.length)return[];var t=this.values;return this.values=[],t}},{key:"size",get:function(){return this.values.length-this.resolves.length}}]),t}();function $t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}var Gt=function(t){y(r,b);var e,n=(e=r,function(){var t,n=g(e);if($t()){var r=g(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return m(this,t)});function r(){return d(this,r),n.apply(this,arguments)}return f(r,[{key:"poll",value:function(){var t=v(g(r.prototype),"poll",this).call(this);return this.array[this.size]=null,t}},{key:"asArray",value:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t}},{key:"asUnsortedArray",value:function(){return this.array.slice(0,this.size)}}]),r}();function Kt(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zt(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yt(t,e){function n(t){var n,r=Kt(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.for===e&&t.delete(i)}}catch(t){r.e(t)}finally{r.f()}}return n(t.immediate),n(t.oncePerFrame),n(t.oncePerFrameWhileSynced),n(t.queued),t.immediate.size+t.queued.size+t.oncePerFrame.size+t.oncePerFrameWhileSynced.size}var Qt=new(function(){function t(){d(this,t),this.subscriptions={},this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.id=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}),this.lastId=0}return f(t,[{key:"register",value:function(t){return this.id+"/V"+ ++this.lastId}},{key:"deregister",value:function(t){}},{key:"addSubscription",value:function(t,e,n,r,i){if("vote"!==i){var o=t+":"+e,a=r;a.for=n;var s=this.subscriptions[o];if(s||(s=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!s[i])throw Error('Unknown subscribe() option: handling="'.concat(i,'"'));s[i].add(a)}else this.addSubscription(t,e+"#__vote",n,r,"immediate")}},{key:"removeSubscription",value:function(t,e,n){var r=t+":"+e,i=this.subscriptions[r];i&&0===Yt(i,n)&&delete this.subscriptions[r],e.endsWith("#__vote")||this.removeSubscription(t,e+"#__vote",n)}},{key:"removeAllSubscriptionsFor",value:function(t){for(var e="".concat(t,":"),n=0,r=Object.entries(this.subscriptions);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];a.startsWith(e)?delete this.subscriptions[a]:0===Yt(s,t)&&delete this.subscriptions[a]}}},{key:"handleEvent",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t()},r=this.subscriptions[t];r&&(r.queued.size>0&&this.queuedEvents.push({topic:t,data:e}),r.oncePerFrame.size>0&&this.perFrameEvents.set(t,e),r.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(t,e),r.immediate.size>0&&n(function(){var t,n=Kt(r.immediate);try{for(n.s();!(t=n.n()).done;)(0,t.value)(e)}catch(t){n.e(t)}finally{n.f()}}))}},{key:"processFrameEvents",value:function(t){var e,n=this,r=0,i=function(t,e,i){var o=n.subscriptions[t];if(o){var a,s=Kt(o[i]);try{for(s.s();!(a=s.n()).done;)(0,a.value)(e),r++}catch(t){s.e(t)}finally{s.f()}}},a=Kt(this.queuedEvents);try{for(a.s();!(e=a.n()).done;){var s=e.value;i(s.topic,s.data,"queued")}}catch(t){a.e(t)}finally{a.f()}this.queuedEvents.length=0;var c,u=Kt(this.perFrameEvents);try{for(u.s();!(c=u.n()).done;){var l=o(c.value,2);i(l[0],l[1],"oncePerFrame")}}catch(t){u.e(t)}finally{u.f()}if(this.perFrameEvents.clear(),t){var h,d=Kt(this.perSyncedFrameEvents);try{for(d.s();!(h=d.n()).done;){var f=o(h.value,2);i(f[0],f[1],"oncePerFrameWhileSynced")}}catch(t){d.e(t)}finally{d.f()}this.perSyncedFrameEvents.clear()}var p,v=Kt(this.queuedEvents);try{for(v.s();!(p=v.n()).done;){var y=p.value;i(y.topic,y.data,"queued")}}catch(t){v.e(t)}finally{v.f()}return this.queuedEvents.length=0,r}}]),t}()),Xt={get subscribe(){return(Xt={subscribe:I.has("debug","subscribe",!1)}).subscribe}},te=function(){function t(e){d(this,t),this.island=e}return f(t,[{key:"register",value:function(t){return this.island.registerModel(t)}},{key:"deregister",value:function(t){this.island.deregisterModel(t.id)}},{key:"publish",value:function(t,e,n){this.island.publishFromModel(n,t,e)}},{key:"subscribe",value:function(t,e,n,r){return Xt.subscribe&&console.log('Model.subscribe("'.concat(e,":").concat(n,'", ').concat(t," ").concat((""+r).replace(/\([\s\S]*/,""),")")),this.island.addSubscription(t,e,n,r)}},{key:"unsubscribe",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";Xt.subscribe&&console.log("Model.unsubscribe(".concat(e,":").concat(n,'", ').concat(t," ").concat((""+r).replace(/\([\s\S]*/,""),")")),this.island.removeSubscription(t,e,n,r)}},{key:"unsubscribeAll",value:function(t){Xt.subscribe&&console.log("Model.unsubscribeAll(".concat(t," ").concat(t.id,")")),this.island.removeAllSubscriptionsFor(t)}},{key:"future",value:function(t,e,n,r){if(ne&&ne.equal(this))return this.island.future(t,e,n,r);if(e)throw Error("tOffset not supported from cross-realm future send yet.");var i=this.island;return new Proxy(t,{get:function(e,n){if("function"==typeof t[n])return new Proxy(t[n],{apply:function(e,r,o){i.callModelMethod(t.id,n,o)}});throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}},{key:"random",value:function(){return this.island.random()}},{key:"now",value:function(){return this.island.time}},{key:"equal",value:function(e){return e instanceof t&&e.island===this.island}}]),t}(),ee=function(){function t(e){d(this,t),this.island=e}return f(t,[{key:"register",value:function(t){return Qt.register(t)}},{key:"deregister",value:function(t){Qt.deregister(t)}},{key:"publish",value:function(t,e,n){this.island.publishFromView(n,t,e)}},{key:"subscribe",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"queued";Xt.subscribe&&console.log('View.subscribe("'.concat(r,":").concat(t,'", ').concat(e," ").concat(n.name||(""+n).replace(/\([\s\S]*/,"")," [").concat(i,"])")),Qt.addSubscription(r,t,e,n,i)}},{key:"unsubscribe",value:function(t,e,n,r){Xt.subscribe&&console.log('View.unsubscribe("'.concat(r,":").concat(t,'", ').concat(e," ").concat(n.name||(""+n).replace(/\([\s\S]*/,""),")")),Qt.removeSubscription(r,t,e,n)}},{key:"unsubscribeAll",value:function(t){Xt.subscribe&&console.log("View.unsubscribeAll(".concat(t,")")),Qt.removeAllSubscriptionsFor(t)}},{key:"future",value:function(t,e){return e?new Proxy(t,{get:function(n,r){if("function"==typeof t[r])return new Proxy(t[r],{apply:function(n,i,o){setTimeout(function(){t.id&&t[r].apply(t,a(o))},e)}});throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}}):t}},{key:"random",value:function(){return Math.random()}},{key:"now",value:function(){return this.island.time}},{key:"externalNow",value:function(){return this.island.controller.time}},{key:"isSynced",value:function(){return!!this.island.controller.synced}},{key:"equal",value:function(e){return e instanceof t&&e.island===this.island}}]),t}(),ne=null;function re(){if(!ne)throw Error("Tried to execute code that requires realm outside of realm.");return ne}function ie(t,e){if(null!==ne)throw Error("Can't switch realms from inside realm");try{return ne=new te(t),e()}finally{ne=null}}function oe(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==ne&&!n)throw Error("Can't switch realms from inside realm");var r=ne;try{return ne=new ee(t),e()}finally{ne=r}}function ae(t){return function(){var e,n=g(t);if(se()){var r=g(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return m(this,e)}}function se(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function ce(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(){var t,e=function(t){return t!=t},n=Math.sqrt,r=.7853981633974483,i=function(t){var i,o,a,s,c;if(e(t))return NaN;if(t>0?a=t:(i=!0,a=-t),a>1)return NaN;if(a>.625)s=(o=1-a)*function(t){var e,n;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),n=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),n=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/n)}(o),o=n(o+o),c=r-o,c-=o=o*s-6.123233995736766e-17,c+=r;else{if(a<1e-8)return t;c=a*(c=(o=a*a)*function(t){var e,n;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,n=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),n=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/n)}(o))+a}return i?-c:c},o="function"==typeof Symbol&&"symbol"==s(Symbol("foo")),a=Object.prototype.toString,c=Object.prototype.hasOwnProperty,u="function"==typeof Symbol?Symbol.toStringTag:"",l={};t=o&&"symbol"==s(Symbol.toStringTag)?function(t){var e,n,r;if(null==t)return a.call(t);n=t[u],e=function(t,e){return null!=t&&c.call(t,e)}(t,u);try{t[u]=void 0}catch(e){return a.call(t)}return r=a.call(t),e?t[u]=n:delete t[u],r}:function(t){return a.call(t)},l=t;var h="function"==typeof Uint32Array,d="function"==typeof Uint32Array?Uint32Array:null,f="function"==typeof Uint32Array?Uint32Array:null,p={};p=function(){var t,e;if("function"!=typeof d)return!1;try{t=function(t){return h&&t instanceof Uint32Array||"[object Uint32Array]"===l(t)}(e=new d(e=[1,3.14,-3.14,4294967296,4294967297]))&&1===e[0]&&3===e[1]&&4294967293===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?f:function(){throw new Error("not implemented")};var v="function"==typeof Float64Array,y="function"==typeof Float64Array?Float64Array:null,m="function"==typeof Float64Array?Float64Array:null,g={};g=function(){var t,e;if("function"!=typeof y)return!1;try{t=function(t){return v&&t instanceof Float64Array||"[object Float64Array]"===l(t)}(e=new y([1,3.14,-3.14,NaN]))&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t}()?m:function(){throw new Error("not implemented")};var b,w="function"==typeof Uint8Array,_="function"==typeof Uint8Array?Uint8Array:null,k="function"==typeof Uint8Array?Uint8Array:null;b=function(){var t,e;if("function"!=typeof _)return!1;try{t=function(t){return w&&t instanceof Uint8Array||"[object Uint8Array]"===l(t)}(e=new _(e=[1,3.14,-3.14,256,257]))&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?k:function(){throw new Error("not implemented")};var S,x="function"==typeof Uint16Array,C="function"==typeof Uint16Array?Uint16Array:null,E="function"==typeof Uint16Array?Uint16Array:null,O={uint16:function(){var t,e;if("function"!=typeof C)return!1;try{t=function(t){return x&&t instanceof Uint16Array||"[object Uint16Array]"===l(t)}(e=new C(e=[1,3.14,-3.14,65536,65537]))&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?E:function(){throw new Error("not implemented")},uint8:b};(S=new O.uint16(1))[0]=4660;var M,A=52===new O.uint8(S.buffer)[0];M=!0===A?1:0;var T,P=new g(1),I=new p(P.buffer),j=function(t){return P[0]=t,I[M]};T=!0===A?1:0;var N,D,R,q=new g(1),L=new p(q.buffer),z=function(t,e){return q[0]=t,L[T]=e>>>0,q[0]},B=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,F=.6931471803691238,H=1.9082149292705877e-10,V=function(t){var n,r,i,o,a,s,c,u,l,h;if(t<-1||e(t))return NaN;if(-1===t)return U;if(t===B)return t;if(0===t)return t;if(h=1,(i=t<0?-t:t)<.41421356237309503){if(i<1.862645149230957e-9)return i<5.551115123125783e-17?t:t-t*t*.5;t>-.2928932188134525&&(h=0,o=t,r=1)}return 0!==h&&(i<9007199254740992?(a=(h=((r=j(l=1+t))>>20)-1023)>0?1-(l-t):t-(l-1),a/=l):(h=((r=j(l=t))>>20)-1023,a=0),(r&=1048575)<434334?l=z(l,1072693248|r):(h+=1,l=z(l,1071644672|r),r=1048576-r>>2),o=l-1),n=.5*o*o,0===r?0===o?h*F+(a+=h*H):h*F-((u=n*(1-.6666666666666666*o))-(h*H+a)-o):(u=(c=(s=o/(2+o))*s)*(0===c?.6666666666666735:.6666666666666735+c*(.3999999999940942+c*(.2857142874366239+c*(.22222198432149784+c*(.1818357216161805+c*(.15313837699209373+.14798198605116586*c)))))),0===h?o-(n-s*(n+u)):h*F-(n-(s*(n+u)+(h*H+a))-o))},J=.6931471805599453,W=1.9082149292705877e-10,$=function(t){var n,r,i,o,a,s,c,u,l,h;return 0===t?U:e(t)||t<0?NaN:(o=0,(r=j(t))<1048576&&(o-=54,r=j(t*=0x40000000000000)),r>=2146435072?t+t:(o+=(r>>20)-1023|0,o+=(c=614244+(r&=1048575)&1048576|0)>>20|0,s=(t=z(t,r|1072693248^c))-1,(1048575&2+r)<3?0===s?0===o?0:.6931471803691238*o+o*W:(a=s*s*(.5-.3333333333333333*s),0===o?s-a:.6931471803691238*o-(a-o*W-s)):(c=r-398458|0,i=(l=(h=(u=s/(2+s))*u)*h)*(0===l?.3999999999940942:.3999999999940942+l*(.22222198432149784+.15313837699209373*l)),a=h*(0===l?.6666666666666735:.6666666666666735+l*(.2857142874366239+l*(.1818357216161805+.14798198605116586*l)))+i,(c|=440401-r|0)>0?(n=.5*s*s,0===o?s-(n-u*(n+a)):.6931471803691238*o-(n-(u*(n+a)+o*W)-s)):0===o?s-u*(s-a):.6931471803691238*o-(u*(s-a)-o*W-s))))},G=function(t){return t===B||t===U},K=1.5707963267948966,Z=function(t){var n,i,o,a;return e(t)||0===t?t:t===B?K:t===U?-K:(t<0&&(i=!0,t=-t),n=0,t>2.414213562373095?(o=K,n=1,t=-1/t):t<=.66?o=0:(o=r,n=2,t=(t-1)/(t+1)),a=t*(a=(a=t*t)*(0===a?-64.85021904942025:a*(a*(a*(-.8750608600031904*a-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025)/(0===a?194.5506571482614:194.5506571482614+a*(485.3903996359137+a*(432.88106049129027+a*(165.02700983169885+a*(24.858464901423062+1*a))))))+t,2===n?a+=3.061616997868383e-17:1===n&&(a+=6.123233995736766e-17),o+=a,i?-o:o)};!0===A?(D=1,R=0):(D=0,R=1),N={HIGH:D,LOW:R};var Y,Q,X,tt=new g(1),et=new p(tt.buffer),nt=N.HIGH,rt=N.LOW,it=function(t,e){return tt[0]=e,t[0]=et[nt],t[1]=et[rt],t},ot=function(t,e){return 1===arguments.length?it([0,0],t):it(t,e)};!0===A?(Q=1,X=0):(Q=0,X=1),Y={HIGH:Q,LOW:X};var at,st=new g(1),ct=new p(st.buffer),ut=Y.HIGH,lt=Y.LOW,ht=function(t,e){return ct[ut]=t,ct[lt]=e,st[0]},dt=[0,0],ft=function(t,e){var n,r;return ot(dt,t),n=dt[0],n&=2147483647,r=j(e),ht(n|=r&=2147483648,dt[1])},pt=3.141592653589793,vt=function(t,e){var n,r,i,o;return i=(o=t*t)*o,r=o*(0===o?.0416666666666666:.0416666666666666+o*(2480158728947673e-20*o-.001388888888887411)),r+=i*i*(0===o?-2.7557314351390663e-7:o*(2.087572321298175e-9+-1.1359647557788195e-11*o)-2.7557314351390663e-7),(i=1-(n=.5*o))+(1-i-n+(o*r-t*e))},yt=-.16666666666666632,mt=function(t,e){var n,r,i;return n=.00833333333332249+(i=t*t)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),r=i*t,0===e?t+r*(yt+i*n):t-(i*(.5*e-r*n)-e-r*yt)};at=!0===A?0:1;var gt=new g(1),bt=new p(gt.buffer),wt=Math.floor,_t=function(t){return t<0?-t:0===t?0:t},kt=function(t,n){return e(n)||G(n)?(t[0]=n,t[1]=0,t):0!==n&&_t(n)<2.2250738585072014e-308?(t[0]=4503599627370496*n,t[1]=-52,t):(t[0]=n,t[1]=0,t)},St=[0,0],xt=[0,0],Ct=function(t,n){var r,i;return 0===t||e(t)||G(t)?t:(function(t,e){1===arguments.length?kt([0,0],t):kt(t,e)}(St,t),n+=St[1],(n+=function(t){var e=j(t);return(e=(2146435072&e)>>>20)-1023|0}(t=St[0]))<-1074?ft(0,t):n>1023?t<0?U:B:(n<=-1023?(n+=52,i=2.220446049250313e-16):i=1,ot(xt,t),r=xt[0],r&=2148532223,i*ht(r|=n+1023<<20,xt[1])))},Et=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Ot=[1.570796251296997,7.549789415861596e-8,5.390302529957765e-15,3.282003415807913e-22,1.270655753080676e-29,1.2293330898111133e-36,2.7337005381646456e-44,2.1674168387780482e-51],Mt=5.960464477539063e-8,At=jt(new Array(20)),Tt=jt(new Array(20)),Pt=jt(new Array(20)),It=jt(new Array(20));function jt(t){var e,n=t.length;for(e=0;e<n;e++)t[e]=0;return t}var Nt,Dt=Math.round,Rt=function(t,e,n){var r,i,o,a,s;return o=t-1.5707963267341256*(r=Dt(.6366197723675814*t)),a=6.077100506506192e-11*r,s=e>>20|0,n[0]=o-a,s-(j(n[0])>>20&2047)>16&&(a=2.0222662487959506e-21*r-((i=o)-(o=i-(a=6.077100506303966e-11*r))-a),n[0]=o-a,s-(j(n[0])>>20&2047)>49&&(a=8.4784276603689e-32*r-((i=o)-(o=i-(a=2.0222662487111665e-21*r))-a),n[0]=o-a)),n[1]=o-n[0]-a,r},qt=1.5707963267341256,Lt=6.077100506506192e-11,zt=2*Lt,Bt=4*Lt,Ut=new Array(3),Ft=new Array(2),Ht=function(t,e){var n,r,i,o,a,s,c;if((i=2147483647&j(t)|0)<=1072243195)return e[0]=t,e[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?Rt(t,i,e):i<=1073928572?t>0?(c=t-qt,e[0]=c-Lt,e[1]=c-e[0]-Lt,1):(c=t+qt,e[0]=c+Lt,e[1]=c-e[0]+Lt,-1):t>0?(c=t-2*qt,e[0]=c-zt,e[1]=c-e[0]-zt,2):(c=t+2*qt,e[0]=c+zt,e[1]=c-e[0]+zt,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?Rt(t,i,e):t>0?(c=t-3*qt,e[0]=c-1.8231301519518578e-10,e[1]=c-e[0]-1.8231301519518578e-10,3):(c=t+3*qt,e[0]=c+1.8231301519518578e-10,e[1]=c-e[0]+1.8231301519518578e-10,-3):1075388923===i?Rt(t,i,e):t>0?(c=t-4*qt,e[0]=c-Bt,e[1]=c-e[0]-Bt,4):(c=t+4*qt,e[0]=c+Bt,e[1]=c-e[0]+Bt,-4);if(i<1094263291)return Rt(t,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(n=function(t){return gt[0]=t,bt[at]}(t),c=ht(i-((r=(i>>20)-1046)<<20|0),n),a=0;a<2;a++)Ut[a]=0|c,c=16777216*(c-Ut[a]);for(Ut[2]=c,o=3;0===Ut[o-1];)o-=1;return s=function(t,e,n,r){var i,o,a,s,c,u,l;for((o=(n-3)/24|0)<0&&(o=0),s=n-24*(o+1),u=o-(a=r-1),l=a+4,c=0;c<=l;c++)At[c]=u<0?0:Et[u],u+=1;for(c=0;c<=4;c++){for(i=0,u=0;u<=a;u++)i+=t[u]*At[a+(c-u)];Tt[c]=i}return function t(e,n,r,i,o,a,s,c,u){var l,h,d,f,p,v,y,m,g;for(f=a,g=i[r],m=r,p=0;m>0;p++)h=Mt*g|0,It[p]=g-16777216*h|0,g=i[m-1]+h,m-=1;if(g=Ct(g,o),g-=8*wt(.125*g),g-=y=0|g,d=0,o>0?(y+=p=It[r-1]>>24-o,It[r-1]-=p<<24-o,d=It[r-1]>>23-o):0===o?d=It[r-1]>>23:g>=.5&&(d=2),d>0){for(y+=1,l=0,p=0;p<r;p++)m=It[p],0===l?0!==m&&(l=1,It[p]=16777216-m):It[p]=16777215-m;if(o>0)switch(o){case 1:It[r-1]&=8388607;break;case 2:It[r-1]&=4194303}2===d&&(g=1-g,0!==l&&(g-=Ct(1,o)))}if(0===g){for(m=0,p=r-1;p>=a;p--)m|=It[p];if(0===m){for(v=1;0===It[a-v];v++);for(p=r+1;p<=r+v;p++){for(u[c+p]=Et[s+p],h=0,m=0;m<=c;m++)h+=e[m]*u[c+(p-m)];i[p]=h}return t(e,n,r+=v,i,o,a,s,c,u)}}if(0===g)for(r-=1,o-=24;0===It[r];)r-=1,o-=24;else(g=Ct(g,-o))>=16777216?(h=Mt*g|0,It[r]=g-16777216*h|0,o+=24,It[r+=1]=h):It[r]=0|g;for(h=Ct(1,o),p=r;p>=0;p--)i[p]=h*It[p],h*=Mt;for(p=r;p>=0;p--){for(h=0,v=0;v<=f&&v<=r-p;v++)h+=Ot[v]*i[p+v];Pt[r-p]=h}for(h=0,p=r;p>=0;p--)h+=Pt[p];for(n[0]=0===d?h:-h,h=Pt[0]-h,p=1;p<=r;p++)h+=Pt[p];return n[1]=0===d?h:-h,7&y}(t,e,4,Tt,s,4,o,a,At)}(Ut,Ft,r,o),t<0?(e[0]=-Ft[0],e[1]=-Ft[1],-s):(e[0]=Ft[0],e[1]=Ft[1],s)},Vt=[0,0],Jt=Math.ceil,Wt=function(t){var n;return e(t)||t===B?t:t===U?0:t>709.782712893384?B:t<-745.1332191019411?0:t>-1/(1<<28)&&t<1/(1<<28)?1+t:function(t,e,n){var r,i,o,a;return o=(r=t-e)-(i=r*r)*(0===(a=i)?.16666666666666602:.16666666666666602+a*(a*(6613756321437934e-20+a*(4.1381367970572385e-8*a-16533902205465252e-22))-.0027777777777015593)),Ct(1-(e-r*o/(2-o)-t),n)}(t-.6931471803691238*(n=function(t){return t<0?Jt(t):wt(t)}(t<0?1.4426950408889634*t-.5:1.4426950408889634*t+.5)),1.9082149292705877e-10*n,n)};Nt=!0===A?0:1;var $t=new g(1),Gt=new p($t.buffer),Kt=function(t,e){return $t[0]=t,Gt[Nt]=e>>>0,$t[0]},Zt=[0,0],Yt=[0,0],Qt=function(t,e,n){var r,i,o,a,s,c,u,l,h;return(i=2147483647&(r=j(t))|0)>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(l=3.061616997868383e-17-e),e=0),a=e+(h=t*t)*((s=h*t)*((a=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))}(l=h*h))+(u=h*(0===l?.05396825397622605:.05396825397622605+l*(.0088632398235993+l*(.0014562094543252903+l*(.0002464631348184699+l*(7140724913826082e-20+2590730518636337e-20*l)))))))+e),l=t+(a+=.3333333333333341*s),i>=1072010280?(1-(r>>30&2))*((u=n)-2*(t-(l*l/(l+u)-a))):1===n?l:(Kt(h=l,0),u=a-(h-t),Kt(c=o=-1/l,0),c+o*((s=1+c*h)+c*u))},Xt=[0,0];void 0===window.CroquetMath&&(window.CroquetMath={}),window.CroquetMath.acos=function(t){var o;return e(t)||t<-1||t>1?NaN:t>.5?2*i(n(.5-.5*t)):(o=r-i(t),o+=6.123233995736766e-17,o+=r)},window.CroquetMath.acosh=function(t){var r;return e(t)||t<1?NaN:1===t?0:t>=1<<28?$(t)+J:t>2?$(2*t-1/(t+n(t*t-1))):V((r=t-1)+n(2*r+r*r))},window.CroquetMath.asin=i,window.CroquetMath.asinh=function(t){var r,i,o;return e(t)||G(t)?t:(t<0&&(t=-t,r=!0),o=t<1/(1<<28)?t:t>1<<28?$(t)+J:t>2?$(2*t+1/(n(t*t+1)+t)):V(t+(i=t*t)/(1+n(1+i))),r?-o:o)},window.CroquetMath.atan=Z,window.CroquetMath.atanh=function(t){var n,r;return e(t)||t<-1||t>1?NaN:1===t?B:-1===t?U:(t<0&&(n=!0,t=-t),t<1/(1<<28)?n?-t:t:(r=t<.5?.5*V((r=t+t)+r*t/(1-t)):.5*V((t+t)/(1-t)),n?-r:r))},window.CroquetMath.atan2=function(t,n){var r;return e(n)||e(t)?NaN:G(n)?n===B?G(t)?ft(pt/4,t):ft(0,t):G(t)?ft(3*pt/4,t):ft(pt,t):G(t)?ft(pt/2,t):0===t?n>=0&&!(j(n)>>>31)?ft(0,t):ft(pt,t):0===n?ft(pt/2,t):(r=Z(t/n),n<0?r<=0?r+pt:r-pt:r)},window.CroquetMath.cbrt=function(t){var n,r,i,o,a;return e(t)||G(t)||0===t?t:(r=-2147483648&(i=j(t)),i&=2147483647,a=0,t<2.2250738585072014e-308?(a=0x40000000000000,n=j(a*=t),a=ht(r|(n=(2147483647&n)/3+696219795),0)):a=z(a,r|(n=i/3+715094163)),a*=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)}(o=a*a*(a/t)),n=j(a),a=ht(n+1,0),a+=a*(o=((o=t/(a*a))-a)/(a+a+o)))},window.CroquetMath.cos=function(t){var e;if(e=j(t),(e&=2147483647)<=1072243195)return e<1044381696?1:vt(t,0);if(e>=2146435072)return NaN;switch(3&Ht(t,Vt)){case 0:return vt(Vt[0],Vt[1]);case 1:return-mt(Vt[0],Vt[1]);case 2:return-vt(Vt[0],Vt[1]);default:return mt(Vt[0],Vt[1])}},window.CroquetMath.cosh=function(t){return e(t)?t:(t<0&&(t=-t),t>21?Wt(t)/2:(Wt(t)+Wt(-t))/2)},window.CroquetMath.exp=Wt,window.CroquetMath.expm1=function(t){var n,r,i,o,a,s,c,u,l,h,d,f;if(t===B||e(t))return t;if(t===U)return-1;if(0===t)return t;if(t<0?(r=!0,c=-t):(r=!1,c=t),c>=38.816242111356935){if(r)return-1;if(c>=709.782712893384)return B}if(a=0|j(c),c>.34657359027997264)c<1.0397207708399179?r?(i=t+.6931471803691238,o=-1.9082149292705877e-10,f=-1):(i=t-.6931471803691238,o=1.9082149292705877e-10,f=1):(f=r?1.4426950408889634*t-.5:1.4426950408889634*t+.5,i=t-.6931471803691238*(h=f|=0),o=1.9082149292705877e-10*h),l=i-(t=i-o)-o;else{if(a<1016070144)return t;f=0}return d=(u=t*(n=.5*t))*(((s=1+u*(0===u?-.03333333333333313:u*(.0015873015872548146+u*(u*(4008217827329362e-21+-2.0109921818362437e-7*u)-793650757867488e-19))-.03333333333333313))-(h=3-s*n))/(6-t*h)),0===f?t-(t*d-u):(d=t*(d-l)-l,d-=u,-1===f?.5*(t-d)-.5:1===f?t<-.25?-2*(d-(t+.5)):1+2*(t-d):f<=-2||f>56?(i=j(c=1-(d-t))+(f<<20)|0,(c=z(c,i))-1):(h=1,f<20?c=(h=z(h,i=1072693248-(2097152>>f)|0))-(d-t):(c=t-(d+(h=z(h,i=1023-f<<20|0))),c+=1),i=j(c)+(f<<20)|0,z(c,i)))},window.CroquetMath.log=$,window.CroquetMath.log1p=V,window.CroquetMath.log10=function(t){var n,r,i,o,a,s,c;return e(t)||t<0?NaN:0===t?U:(a=0,(r=j(t))<1048576&&(a-=54,r=j(t*=0x40000000000000)),r>=2146435072?t+t:(a+=(r>>20)-1023|0,t=z(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),s=a+=o>>20|0,i=function(t){var e,n,r,i,o,a,s,c,u;return i=t-1,(1048575&2+(r=j(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(u=(r&=1048575)-398458|0,n=(c=(a=(o=i/(2+i))*o)*a)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),s=a*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(u|=440401-r|0)>0?o*((e=.5*i*i)+s)-e:o*(s-i))}(t),n=Kt(t-=1,0),c=3.694239077158931e-13*s+2.5082946711645275e-11*(t+i),(c+=.4342944818781689*(t-n+i)+.4342944818781689*n)+.30102999566361177*s))},window.CroquetMath.log2=function(t){var n,r,i,o,a;if(e(t)||t<0)return NaN;if(ot(Zt,t),a=0,(r=Zt[0])<1048576){if(0==(2147483647&r|Zt[1]))return U;a-=54,r=j(t*=0x40000000000000)}return r>=2146435072?t+t:(a+=(r>>20)-1023|0,t=z(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),a+=o>>20|0,i=function(t){var e,n,r,i,o,a,s,c,u;return i=t-1,(1048575&2+(r=j(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(u=(r&=1048575)-398458|0,n=(c=(a=(o=i/(2+i))*o)*a)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),s=a*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(u|=440401-r|0)>0?o*((e=.5*i*i)+s)-e:o*(s-i))}(t),n=Kt(t-=1,0),1.6751713164886512e-10*(t+i)+1.4426950407214463*(t-n+i)+1.4426950407214463*n+a)},window.CroquetMath.sin=function(t){var e;if(e=j(t),(e&=2147483647)<=1072243195)return e<1045430272?t:mt(t,0);if(e>=2146435072)return NaN;switch(3&Ht(t,Yt)){case 0:return mt(Yt[0],Yt[1]);case 1:return vt(Yt[0],Yt[1]);case 2:return-mt(Yt[0],Yt[1]);default:return-vt(Yt[0],Yt[1])}},window.CroquetMath.sinh=function(t){var e;return 0===t?t:(e=_t(t),t>710.4758600739439||t<-709.089565712824?t>0?B:U:e>1?e>=709.0895657128241?(e=Wt(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=Wt(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*function(t){var e,n;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,n=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,n=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/n)}(e))},window.CroquetMath.tan=function(t){var e,n;return e=j(t),(e&=2147483647)<=1072243195?e<1044381696?t:Qt(t,0,1):e>=2146435072?NaN:(n=Ht(t,Xt),Qt(Xt[0],Xt[1],1-((1&n)<<1)))},window.CroquetMath.tanh=function(t){var e,n;if((n=_t(t))>44.014845965556525)return t<0?-1:1;if(n>=.625)n=1-2/((e=Wt(2*n))+1),t<0&&(n=-n);else{if(0===t)return t;n=t+t*(e=t*t)*function(t){var e,n;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,n=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),n=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/n)}(e)}return n};var te=Math.pow;function ee(t){return t===1/0||t===-1/0}window.CroquetMath.pow=function(t,e){if(isNaN(t)||isNaN(e))return NaN;if(ee(t)||ee(e))return te(t,e);if(0===t||0===e)return te(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;var n=1;return t<0&&(t*=-1,n=te(-1,e)),window.CroquetMath.exp(window.CroquetMath.log(t)*e)*n}}();var le=null,he={};function de(t,e){var n=JSON.parse(atob(t.slice(1,-1))),r=n.qPara,i=n.qArgs,o=n.qFn,s=JSON.stringify(r),c=he[s]||(he[s]=_(Function,a(r)));return"number"==typeof o&&(i[o]=c),c.call.apply(c,[e].concat(a(i))).bind(e)}function fe(t,e){if(le)throw Error("Island confusion");if(!(t instanceof pe))throw Error("not an island: "+t);var n=le;try{le=t,window.ISLAND=t,e()}finally{le=n}}var pe=function(){function t(e,n){var r=this;d(this,t),t.installCustomMath(),fe(this,function(){ie(r,function(){if(r.modelsById={},r.modelsByName={},r.messages=new Gt(function(t,e){return t.before(e)}),r.subscriptions={},r.users={},r._random=function(){throw Error("You must not use random when applying state!")},r.id=e.id,r.time=0,r.seq=4294967280,r.externalTime=0,r.externalSeq=r.seq,r.futureSeq=0,r.tuttiSeq=0,r.lastSnapshotPoll=0,r.modelsId=0,e.modelsById)for(var t=Se.newOrRecycled(r).readIsland(e,"$"),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];if(a in r||"meta"===a)if("messages"===a){var s,c=ce(t.messages);try{for(c.s();!(s=c.n()).done;){var u=s.value;r.messages.add(u)}}catch(t){c.e(t)}finally{c.f()}}else r[a]=t[a];else console.warn("Ignoring property snapshot.".concat(a))}else{r._random=new h(null,{state:!0});var l=n(r)||{};Object.assign(r.modelsByName,l),r.addSubscription(r,r.id,"__users__",r.generateJoinExit)}})})}return f(t,null,[{key:"current",value:function(){return le||console.warn("No CurrentIsland!"),le}},{key:"installCustomMath",value:function(){if(!window.BrowserMath){window.CroquetMath.random=function(){return le.random()},window.BrowserMath={};for(var t=function(){var t=o(n[e],2),r=t[0],i=t[1],a=window.Math[r];window.BrowserMath[r]=a,window.Math[r]=["pow","atan2"].includes(r)?function(t,e){return le?i(t,e):a(t,e)}:function(t){return le?i(t):a(t)}},e=0,n=Object.entries(window.CroquetMath);e<n.length;e++)t()}}}]),f(t,[{key:"registerModel",value:function(t,e){if(le!==this)throw Error("Island Error");return e||(e=this.id+"/M"+ ++this.modelsId),this.modelsById[e]=t,e}},{key:"deregisterModel",value:function(t){if(le!==this)throw Error("Island Error");var e=this.modelsById;delete this.modelsById[t];for(var n=0,r=Object.entries(this.modelsByName);n<r.length;n++){var i=o(r[n],2),a=i[0];e===i[1]&&delete this.modelsByName[a]}this.messages.removeMany(function(e){return e.hasReceiver(t)})}},{key:"lookUpModel",value:function(t){if(t===this.id)return this;var e=this.modelsById[t];if(e)return e;var n=t.match(/^([^#]+)#(.*)$/),r=o(n,3),i=(r[0],r[1]),a=r[2];return this.modelsById[i].lookUp(a)}},{key:"get",value:function(t){return this.modelsByName[t]}},{key:"set",value:function(t,e){if(le!==this)throw Error("Island Error");this.modelsByName[t]=e}},{key:"getNextTuttiSeq",value:function(){return this.tuttiSeq=this.tuttiSeq+1>>>0,this.tuttiSeq}},{key:"callModelMethod",value:function(t,e,n){if(le)throw Error("Island Error");var r=this.lookUpModel(t);if(r){var i=new be(this.time,0,r.id,e,n);this.controller.sendMessage(i)}else console.error(Error("Model not found: ".concat(t)))}},{key:"noop",value:function(){}},{key:"generateJoinExit",value:function(t){var e,n=t.entered,r=t.exited,i=t.count,a=ce(r=n.length===i?Object.keys(this.users):r.map(function(t){return t[0]}));try{for(a.s();!(e=a.n()).done;){var s=e.value;this.users[s]&&(delete this.users[s],this.publishFromModel(this.id,"view-exit",s))}}catch(t){a.e(t)}finally{a.f()}var c,u=ce(n);try{for(u.s();!(c=u.n()).done;){var l=o(c.value,3),h=l[0],d=l[1],f=l[2];this.users[h]||(this.users[h]={name:d},f&&(this.users[h].location=f),this.publishFromModel(this.id,"view-join",h))}}catch(t){u.e(t)}finally{u.f()}}},{key:"scheduleExternalMessage",value:function(t){var e=be.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);var n=this.externalSeq+1>>>0;if(e.seq!==n)throw Error("External message error. Expected message #".concat(n," got #").concat(e.seq));return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.messages.add(e),e}},{key:"futureSend",value:function(t,e,n,r){if(t.every)return this.futureRepeat(t.every,e,n,r);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;var i=new be(this.time+t,2*this.futureSeq,e,n,r);return this.messages.add(i),i}},{key:"futureRepeat",value:function(t,e,n,r){this.futureSend(t,this.id,"futureExecAndRepeat",[t,e,n,r])}},{key:"futureExecAndRepeat",value:function(t,e,n,r){var i=this.lookUpModel(e);if("function"==typeof i[n])try{i[n].apply(i,a(r))}catch(t){ct("future message ".concat(i,".").concat(n),t)}else{var o=de(n,i);try{o.apply(void 0,a(r))}catch(t){ct("future message ".concat(i," ").concat(o),t)}}this.futureRepeat(t,e,n,r)}},{key:"future",value:function(t,e,n,r){var i=this.asQFunc(t,n);if("string"==typeof i)return this.futureSend(e,t.id,i,r);var o=this;return new Proxy(t,{get:function(n,r){if("function"==typeof t[r])return function(){if(o.lookUpModel(t.id)!==t)throw Error("future send to unregistered model");for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return o.futureSend(e,t.id,r,i)};throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}},{key:"advanceTo",value:function(t,e){if(le)throw Error("Island Error");for(var n,r=0;(n=this.messages.peek())&&n.time<=t;){var i=n,o=i.time,a=i.seq;if(o<this.time)throw Error("past message encountered: "+n);if(1&a&&(this.seq=this.seq+1>>>0,a/2>>>0!==this.seq))throw Error("Sequence error: expected ".concat(this.seq," got ").concat(a/2>>>0," in ").concat(n));if(this.messages.poll(),this.time=n.time,n.executeOn(this),++r>100&&(r=0,Date.now()>e))return!1}return this.time=t,!0}},{key:"asQFunc",value:function(t,e){if("string"==typeof e)return e;if("function"==typeof e){if(t[e.name]===e)return e.name;for(var n=t;null!==n;){for(var r=0,i=Object.entries(Object.getOwnPropertyDescriptors(n));r<i.length;r++){var a=o(i[r],2),s=a[0];if(a[1].value===e)return s}n=Object.getPrototypeOf(n)}var c=e.toString().match(/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i);return!c||c[3]&&c[3]!==c[1]?function(t,e){"function"==typeof t&&(e=t,t={});var n=Object.keys(t).concat(["return "+e]),r=Object.values(t),i={qPara:n,qArgs:r},o=r.indexOf(e);return o>=0&&(r[o]=n[o],i.qFn=o),"{".concat(btoa(JSON.stringify(i)),"}")}(e):c[2]}return null}},{key:"addSubscription",value:function(t,e,n,r){if(le!==this)throw Error("Island Error");var i=this.asQFunc(t,r);if("string"!=typeof i)throw Error('Subscription handler for "'.concat(n,'" must be a method name'));if("function"!=typeof t[i]&&"{"!==i[0])throw Error('Subscriber method for "'.concat(n,'" not found: ').concat(t,".").concat(i,"()"));var o=e+":"+n,a=t.id+"."+i;if(this.subscriptions[o]){if(-1!==this.subscriptions[o].indexOf(a))throw Error("".concat(t,".").concat(i," already subscribed to ").concat(n))}else this.subscriptions[o]=[];this.subscriptions[o].push(a)}},{key:"removeSubscription",value:function(t,e,n,r){if(le!==this)throw Error("Island Error");var i=e+":"+n,o=t.id+"."+r,a=this.subscriptions[i];if(a){var s=a.indexOf(o);a.splice(s,1),0===a.length&&delete this.subscriptions[i]}}},{key:"removeAllSubscriptionsFor",value:function(t){for(var e="".concat(t.id,":"),n="".concat(t.id,"."),r=0,i=Object.entries(this.subscriptions);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1];if(s.startsWith(e))delete this.subscriptions[s];else{for(var u=c.length-1;u>=0;u--)c[u].startsWith(n)&&c.splice(u,1);0===c.size&&delete this.subscriptions[s]}}}},{key:"publishFromModel",value:function(t,e,n){if(le!==this)throw Error("Island Error");var r=e.endsWith("#reflected");r&&(e=e.slice(0,e.length-"#reflected".length));var i=t+":"+e;this.handleModelEventInModel(i,n,r),this.handleModelEventInView(i,n)}},{key:"publishFromView",value:function(t,e,n){if(le)throw Error("Island Error");var r=t+":"+e;this.handleViewEventInModel(r,n),this.handleViewEventInView(r,n)}},{key:"handleModelEventInModel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(le!==this)throw Error("Island Error");if(n){var r=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;var i=t+"#__vote",o=t+"#divergence",a=!!Qt.subscriptions[i],s=!!this.subscriptions[t],c=!!this.subscriptions[o];a&&c&&console.log("divergence subscription for ".concat(t," overridden by vote subscription"));var u,l=s?new be(this.time,0,this.id,"handleModelEventInModel",[t,e]):null;u=a?[this.id,"handleModelEventInView",i]:[this.id,"handleTuttiDivergence",o],this.controller.sendTutti(this.time,r,e,l,a,u)}else if(this.subscriptions[t]){var h,d=ce(this.subscriptions[t]);try{for(d.s();!(h=d.n()).done;){var f=h.value,p=f.split("."),v=w(p),y=v[0],m=v.slice(1),g=m.join("."),b=this.lookUpModel(y);if(b){if("{"===g[0]){var _=de(g,b);try{_(e)}catch(e){ct("event ".concat(t," ").concat(b," ").concat(_),e)}continue}"function"!=typeof b[g]&&at("event ".concat(t," ").concat(b,".").concat(g,"(): method not found"))}else at("event ".concat(t," .").concat(g,"(): subscriber not found"));try{b[g](e)}catch(e){ct("event ".concat(t," ").concat(b,".").concat(g,"()"),e)}}}catch(t){d.e(t)}finally{d.f()}}}},{key:"handleViewEventInModel",value:function(t,e){if(this.subscriptions[t]){var n=new be(this.time,0,this.id,"handleModelEventInModel",[t,e]);this.controller.sendMessage(n)}}},{key:"handleModelEventInView",value:function(t,e){var n=this;Qt.handleEvent(t,e,function(t){return function(t){if(!le)throw Error("Island confusion");var e=le;try{le=null,t()}finally{le=e}}(function(){return oe(n,t,!0)})})}},{key:"handleViewEventInView",value:function(t,e){Qt.handleEvent(t,e)}},{key:"handleTuttiDivergence",value:function(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{var n=t.split(":").slice(-1)[0];console.warn("uncaptured divergence in ".concat(n,":"),e)}}},{key:"processModelViewEvents",value:function(){var t=this;if(le)throw Error("Island Error");return oe(this,function(){return Qt.processFrameEvents(!!t.controller.synced)})}},{key:"pollToCheckSync",value:function(){var t=this.getNextTuttiSeq();if(!0===this.controller.synced){var e=Date.now(),n={date_island:this.time,hash:this.getSummaryHash()},r=Date.now()-e;this.controller.cpuTime-=r;var i=[this.id,"handleSyncCheckVote","syncCheckVote"];this.controller.sendTutti(this.time,t,n,null,!0,i)}}},{key:"handleSyncCheckVote",value:function(t,e){this.controller.handleSyncCheckVote(e)}},{key:"pollForSnapshot",value:function(){var t=this,e=this.getNextTuttiSeq(),n=this.time,r=n-this.lastSnapshotPoll;if(r<5e3)console.log("rejecting snapshot poll ".concat(r,"ms after previous"));else{this.lastSnapshotPoll=n;var i=this.controller.preparePollForSnapshot();if(i){var o=Date.now();i.hash=this.getSummaryHash();var a=Date.now()-o;this.controller.cpuTime-=a,Promise.resolve().then(function(){return t.controller.pollForSnapshot(n,e,i)})}}}},{key:"handleSnapshotVote",value:function(t,e){this.controller.handleSnapshotVote(e)}},{key:"snapshot",value:function(){return ke.newOrRecycled(this).snapshot(this,"$")}},{key:"getSummaryHash",value:function(){return(new _e).getHash(this)}},{key:"random",value:function(){if(le!==this)throw Error("Island Error");return this._random()}},{key:"randomID",value:function(){if(le!==this)throw Error("Island Error");for(var t="",e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}}]),t}();function ve(t,e){var n=t.match(/^([^[]+)(\[.*)?$/i),r=o(n,3),i=(r[0],r[1]),a=r[2],s=i.split(">"),c=o(s,2),u=c[0],l=c[1],h=[];return a&&(h=Ce.newOrRecycled(e).decode(JSON.parse(a))),{receiver:u,selector:l,args:h}}function ye(t,e){return(e-t|0)>=0}var me,ge,be=function(){function t(e,n,r,i,o){d(this,t),this.time=e,this.seq=n,this.payload=function(t,e,n){return n.length>0&&(n=xe.newOrRecycled().encode(n)),"".concat(t,">").concat(e).concat(n.length>0?JSON.stringify(n):"")}(r,i,o)}return f(t,[{key:"before",value:function(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?ye(this.externalSeq,t.externalSeq):ye(this.internalSeq,t.internalSeq)}},{key:"hasReceiver",value:function(t){return function(t,e){return t.startsWith("".concat(e,">"))}(this.payload,t)}},{key:"isExternal",value:function(){return 1&this.seq}},{key:"asState",value:function(){return[this.time,this.seq,this.payload]}},{key:"executeOn",value:function(t){var e=this,n=ve(this.payload,t),r=n.receiver,i=n.selector,o=n.args,s=t.lookUpModel(r);if(s)if("{"===i[0]){var c=de(i,s);fe(t,function(){ie(t,function(){try{c.apply(void 0,a(o))}catch(t){ct("".concat(e.shortString()," ").concat(c),t)}})})}else"function"!=typeof s[i]?at("".concat(this.shortString()," ").concat(s,".").concat(i,"(): method not found")):fe(t,function(){ie(t,function(){try{s[i].apply(s,a(o))}catch(t){ct("".concat(e.shortString()," ").concat(s,".").concat(i,"()"),t)}})});else at("".concat(this.shortString()," ").concat(i,"(): receiver not found"))}},{key:"shortString",value:function(){return"".concat(this.isExternal()?"External":"Future","Message")}},{key:"toString",value:function(){var t=ve(this.payload),e=t.receiver,n=t.selector,r=t.args,i=this.isExternal(),o=i?this.externalSeq:this.internalSeq;return"".concat(i?"External":"Future","Message[").concat(this.time).concat(":#"[+i]).concat(o," ").concat(e,".").concat(n,"(").concat(r.map(JSON.stringify).join(", "),")]")}},{key:Symbol.toPrimitive,value:function(){return this.toString()}},{key:"externalSeq",get:function(){return this.seq/2>>>0},set:function(t){this.seq=2*t+1}},{key:"internalSeq",get:function(){return this.seq/2>>>0},set:function(t){this.seq=2*t}}],[{key:"fromState",value:function(e,n){var r=o(e,3),i=r[0],a=r[1],s=ve(r[2],n);return new t(i,a,s.receiver,s.selector,s.args)}}]),t}(),we=(me=new ArrayBuffer(8),ge=new DataView(me),function(t){return ge.setFloat64(0,t,!0),ge.getInt32(0,!0)+ge.getInt32(4,!0)}),_e=function(){function t(){d(this,t),this.refs=new Map,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",be);var e,n=ce(Pe.allClassTypes());try{for(n.s();!(e=n.n()).done;){var r=o(e.value,2),i=r[0],a=r[1];this.addHasher(i,a)}}catch(t){n.e(t)}finally{n.f()}}return f(t,[{key:"addHasher",value:function(t,e){var n=this,r=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:function(t){return Object.assign({},t)}},i=r.cls,o=r.write;this.hashers.set(i,function(t){return n.hashStructure(t,o(t))})}},{key:"getHash",value:function(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(var e=0,n=Object.entries(t);e<n.length;e++){var r=o(n[e],2),i=r[0],a=r[1];if("controller"!==i&&"meta"!==i)if("_random"===i)this.hash(a.state(),!1);else if("messages"===i){var s=a.asArray();(this.hashState.fC=s.length)&&this.hash(s,!1)}else this.hashEntry(i,a)}return this.hashDeferred(),this.hashState}},{key:"hashDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.key,n=t.value;this.hashEntry(e,n,!1)}}},{key:"hash",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(s(t)){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=we(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;default:var n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return void this.hashArray(t,e);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return void this.hashStructure(t,a(t));case"Object":if(t instanceof Pe)this.hashModel(t);else if(t.constructor===Object)this.hashObject(t,e);else{var r=this.hashers.get(t.constructor);if(!r)throw Error("Don't know how to hash ".concat(t.constructor.name));r(t)}return;case"Null":return;default:throw Error("Don't know how to hash ".concat(n))}}}},{key:"hashModel",value:function(t){if(!this.refs.has(t)){this.hashState.mC++,this.refs.set(t,!0);for(var e=0,n=Object.entries(t);e<n.length;e++){var r=o(n[e],2),i=r[0],a=r[1];"__realm"!==i&&void 0!==a&&this.hashEntry(i,a)}}}},{key:"hashObject",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.refs.has(t)){this.hashState.oC++,this.refs.set(t,!0);for(var n=0,r=Object.entries(t);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];void 0!==s&&this.hashEntry(a,s,e)}}}},{key:"hashArray",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.refs.has(t)){this.refs.set(t,!0);for(var n=0;n<t.length;n++)this.hashEntry(n,t[n],e)}}},{key:"hashStructure",value:function(t,e){void 0!==e&&(this.refs.has(t)||(this.refs.set(t,!0),this.hash(e,!1)))}},{key:"hashEntry",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"$"!==t[0]?n&&"object"===s(e)?this.todo.push({key:t,value:e}):this.hash(e):at("snapshot: ignoring property ".concat(t),{only:"once"})}}]),t}(),ke=function(){function t(e){d(this,t),this.island=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",be);var n,r=ce(Pe.allClassTypes());try{for(r.s();!(n=r.n()).done;){var i=o(n.value,2),a=i[0],s=i[1];this.addWriter(a,s)}}catch(t){r.e(t)}finally{r.f()}}return f(t,null,[{key:"newOrRecycled",value:function(t){var e=this.reusableInstance;return e?(e.island=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}},{key:"resetInstance",value:function(){this.reusableInstance=null}},{key:"reusableInstance",get:function(){return this[this.name+"-instance"]},set:function(t){this[this.name+"-instance"]=t}}]),f(t,[{key:"addWriter",value:function(t,e){var n=this,r=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:function(t){return Object.assign({},t)}},i=r.cls,o=r.write;this.writers.set(i,function(e,r){return n.writeAs(t,e,o(e),r)})}},{key:"snapshot",value:function(t){for(var e={_random:t._random.state(),messages:this.write(t.messages.asArray())},n=0,r=Object.entries(t);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];"controller"!==a&&(e[a]||this.writeInto(e,a,s,"$"))}return this.writeDeferred(),e}},{key:"writeDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.state,n=t.key,r=t.value,i=t.path;this.writeInto(e,n,r,i,!1)}}},{key:"write",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(s(t)){case"number":return Number.isSafeInteger(t)?t:Number.isNaN(t)?{$class:"NaN"}:Number.isFinite(t)?this.writeFloat(t):{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":case"undefined":return t;default:var r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.writeArray(t,e,n);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return this.writeAs(r,t,a(t),e);case"Object":if(t instanceof Pe)return this.writeModel(t,e);if(t.constructor===Object)return this.writeObject(t,e,n);var i=this.writers.get(t.constructor);if(i)return i(t,e);throw Error("Don't know how to write ".concat(t.constructor.name," at ").concat(e));case"Null":return t;default:throw Error("Don't know how to write ".concat(r," at ").concat(e))}}}},{key:"writeModel",value:function(t,e){if(this.refs.has(t))return this.writeRef(t);var n={$model:Pe.classToID(t.constructor)};this.refs.set(t,n);var r,i=ce(Object.keys(t).sort());try{for(i.s();!(r=i.n()).done;){var o=r.value;if("__realm"!==o){var a=t[o];void 0!==a&&this.writeInto(n,o,a,e)}}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"writeObject",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.refs.has(t))return this.writeRef(t);var r={};this.refs.set(t,r);var i,o=ce(Object.keys(t).sort());try{for(o.s();!(i=o.n()).done;){var a=i.value,s=t[a];void 0!==s&&this.writeInto(r,a,s,e,n)}}catch(t){o.e(t)}finally{o.f()}return r}},{key:"writeArray",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.refs.has(t))return this.writeRef(t);var r=[];this.refs.set(t,r);for(var i=0;i<t.length;i++)this.writeInto(r,i,t[i],e,n);return r}},{key:"writeFloat",value:function(t){return t}},{key:"writeAs",value:function(t,e,n,r){if(void 0===n)return n;if(this.refs.has(e))return this.writeRef(e);var i={$class:t};this.refs.set(e,i);var o=this.write(n,r,!1);return"object"!==s(o)||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}},{key:"writeRef",value:function(t){var e=this.refs.get(t);if("object"!==s(e))throw Error("Non-object in refs: "+t);return Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:a(this)}}),{$ref:e.$id||(e.$id=this.nextRef++)}}},{key:"writeInto",value:function(t,e,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("$"!==e[0])if(i&&"object"===s(n))this.todo.push({state:t,key:e,value:n,path:r});else{var o="string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i),a=r+(o?".".concat(e):"[".concat(JSON.stringify(e),"]")),c=this.write(n,a);void 0!==c&&(t[e]=c)}else at("snapshot: ignoring property ".concat(e),{only:"once"})}}]),t}(),Se=function(){function t(e){d(this,t),this.island=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.readers=new Map,this.addReader("Teatime:Message",be);var n,r=ce(Pe.allClassTypes());try{for(r.s();!(n=r.n()).done;){var i=o(n.value,2),a=i[0],s=i[1];this.addReader(a,s)}}catch(t){r.e(t)}finally{r.f()}this.readers.set("NaN",function(){return NaN}),this.readers.set("Infinity",function(t){return t*(1/0)}),this.readers.set("Set",function(t){return new Set(t)}),this.readers.set("Map",function(t){return new Map(t)}),this.readers.set("Array",function(t){return t.slice(0)}),this.readers.set("Uint8Array",function(t){return new Uint8Array(t)}),this.readers.set("Uint16Array",function(t){return new Uint16Array(t)}),this.readers.set("Float32Array",function(t){return new Float32Array(t)})}return f(t,null,[{key:"newOrRecycled",value:function(t){var e=this.reusableInstance;return e?(e.island=t,e.refs=new Map,e.todo=[],e.unresolved=[]):e=this.reusableInstance=new this(t),e}},{key:"resetInstance",value:function(){this.reusableInstance=null}},{key:"reusableInstance",get:function(){return this[this.name+"-instance"]},set:function(t){this[this.name+"-instance"]=t}}]),f(t,[{key:"addReader",value:function(t,e){var n="object"===s(e)?e.read:function(t){return Object.assign(Object.create(e.prototype),t)};this.readers.set(t,n)}},{key:"readIsland",value:function(t,e){if("$"!==e)throw Error("Island must be root object");for(var n={_random:new h(null,{state:t._random})},r=0,i=Object.entries(t);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1];n[s]||this.readInto(n,s,c,e)}return this.readDeferred(),this.resolveRefs(),n}},{key:"readDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.object,n=t.key,r=t.value,i=t.path;this.readInto(e,n,r,i,1)}}},{key:"resolveRefs",value:function(){var t,e=ce(this.unresolved);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.object,i=n.key,o=n.ref,a=n.path;if(!this.refs.has(o))throw Error("Unresolved ref: ".concat(o," at ").concat(a,"[").concat(JSON.stringify(i),"]"));r[i]=this.refs.get(o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"read",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(s(t)){case"number":case"string":case"boolean":return t;default:var r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.readArray(t,e,n);case"Null":return null;case"Object":var i=t.$class,o=t.$model,a=t.$ref;if(a)throw Error("refs should have been handled in readInto()");return o?this.readModel(t,e):i?this.readAs(i,t,e):this.readObject(Object,t,e,n);default:throw Error("Don't know how to read ".concat(r," at ").concat(e))}}}},{key:"readModel",value:function(t,e){var n=Pe.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,n);for(var r=0,i=Object.entries(t);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1];"id"!==s&&"$"!==s[0]&&this.readInto(n,s,c,e)}return n}},{key:"readObject",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new t;e.$id&&this.refs.set(e.$id,i);for(var a=0,s=Object.entries(e);a<s.length;a++){var c=o(s[a],2),u=c[0],l=c[1];"$"!==u[0]&&this.readInto(i,u,l,n,r)}return i}},{key:"readArray",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];t.$id&&this.refs.set(t.$id,r);for(var i=0;i<t.length;i++)void 0!==t[i]&&this.readInto(r,i,t[i],e,n);return r}},{key:"readAs",value:function(t,e,n){var r={},i=new Map;if("$value"in e)r=this.read(e.$value,n,2);else for(var a=0,s=Object.entries(e);a<s.length;a++){var c=o(s[a],2),u=c[0],l=c[1];if("$"!==u[0]){var h=l&&l.$ref;h?this.refs.has(h)?r[u]=this.refs.get(h):(r[u]="<unresolved>",i.set(h,u)):this.readInto(r,u,l,n,1)}}var d=this.readers.get(t)(r,n);d||"NaN"===t||console.warn('Reading "'.concat(t,'" returned ').concat(d," at ").concat(n)),e.$id&&this.refs.set(e.$id,d);var f,p=ce(i.entries());try{for(p.s();!(f=p.n()).done;){var v=o(f.value,2),y=v[0],m=v[1];this.unresolved.push({object:d,key:m,ref:y,path:n})}}catch(t){p.e(t)}finally{p.f()}return d}},{key:"readRef",value:function(t,e,n,r){if(!n||!n.$ref)return!1;var i=n.$ref;return this.refs.has(i)?t[e]=this.refs.get(i):(t[e]="<unresolved>",this.unresolved.push({object:t,key:e,ref:i,path:r})),!0}},{key:"readInto",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!this.readRef(t,e,n,r))if(0!==i||"object"!==s(n)){var o="string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i),a=r+(o?".".concat(e):"[".concat(JSON.stringify(e),"]"));t[e]=this.read(n,a,i>0?i-1:0)}else this.todo.push({object:t,key:e,value:n,path:r})}}]),t}(),xe=function(t){y(n,ke);var e=ae(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"encode",value:function(t){var e=this.writeArray(t,"$");return this.writeDeferred(),e}},{key:"writeModel",value:function(t){return{$ref:t.id}}}]),n}(),Ce=function(t){y(n,Se);var e=ae(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"decode",value:function(t){var e=this.readArray(t,"$");return this.readDeferred(),this.resolveRefs(),e}},{key:"resolveRefs",value:function(){var t,e=ce(this.unresolved);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.object,i=n.key,o=n.ref,a=n.path;if(this.refs.has(o))r[i]=this.refs.get(o);else{var s=this.island.lookUpModel(o);if(!s)throw Error("Unresolved ref: ".concat(o," at ").concat(a,"[").concat(JSON.stringify(i),"]"));r[i]=s}}}catch(t){e.e(t)}finally{e.f()}}}]),n}();function Ee(){Se.resetInstance(),ke.resetInstance(),xe.resetInstance(),Ce.resetInstance()}function Oe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Me=I.has("debug","classes",!1),Ae=Symbol("SECRET"),Te=new WeakSet,Pe=function(){function t(e){if(d(this,t),e!==Ae)throw Error("You must create ".concat(this,' using create() not "new"!'))}return f(t,null,[{key:"__isTeatimeModelClass__",value:function(){return!0}},{key:"create",value:function(e,n){var r=re(),i=new this(Ae);return Object.defineProperty(i,"__realm",{value:r}),Object.defineProperty(i,"id",{value:r.register(i),enumerable:!0}),Te.add(i),n&&i.beWellKnownAs(n),i.init(e),Te.has(i)&&(Te.delete(i),Object.getPrototypeOf(this)!==t&&console.warn("".concat(i," did not call super.init(options)"))),i}},{key:"createNoInit",value:function(t){var e=re(),n=new this(Ae);return Object.defineProperty(n,"__realm",{value:e}),Object.defineProperty(n,"id",{value:t,enumerable:!0}),n}},{key:"allowConstructors",value:function(){Ae=void 0,console.warn("disabling error reporting for Model constructors")}},{key:"register",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown-file";return Ee(),Ft(this),Le(t,this.name,this),this}},{key:"registerIfNeeded",value:function(){Re(this)||this.register()}},{key:"types",value:function(){return{}}},{key:"classToID",value:function(t){return function(t){if(Re(t))return t[je];if(Ne(),Re(t))return t[je];throw Error('Class "'.concat(t.name,'" not found, did you call ').concat(t.name,".register()?"))}(t)}},{key:"classFromID",value:function(t){return qe(t)}},{key:"allClasses",value:function(){return De()}},{key:"allClassTypes",value:function(){return function(){var t,e={},n=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Oe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oe(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(De());try{for(n.s();!(t=n.n()).done;){var r=t.value;Object.prototype.hasOwnProperty.call(r,"types")&&Object.assign(e,r.types())}}catch(t){n.e(t)}finally{n.f()}return Object.entries(e)}()}},{key:"instantiateClassID",value:function(t,e){return qe(t).createNoInit(e)}}]),f(t,[{key:"init",value:function(t){Te.delete(this)}},{key:"destroy",value:function(){re().unsubscribeAll(this),re().deregister(this)}},{key:"publish",value:function(t,e,n){this.__realm||this.__realmError(),this.__realm.publish(e,n,t)}},{key:"subscribe",value:function(t,e,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,n)}},{key:"unsubscribe",value:function(t,e){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e)}},{key:"unsubscribeAll",value:function(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}},{key:"__realmError",value:function(){if(!this.id)throw Error("".concat(this," has no ID, did you call super.init(options)?"))}},{key:"future",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;this.__realm||this.__realmError();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this.__realm.future(this,t,e,r)}},{key:"random",value:function(){return re().random()}},{key:"now",value:function(){return re().now()}},{key:"beWellKnownAs",value:function(t){re().island.set(t,this)}},{key:"wellKnownModel",value:function(t){return this.__realm.island.get(t)}},{key:"modelOnly",value:function(t){var e="none";try{e=re()}catch(t){}if(e===this.__realm)return!0;var n=Error(t||"".concat(this,".modelOnly() called from outside a model!"));throw ct("view code",n),n}},{key:Symbol.toPrimitive,value:function(){var t=this.constructor.name;return t.includes("Model")?t:"".concat(t,"[Model]")}},{key:"sessionId",get:function(){return this.__realm.island.id}}]),t}(),Ie={},je=Symbol("CLASS_ID");function Ne(){if(e.bundle)for(var t=0,n=Object.entries(e.bundle.cache);t<n.length;t++)for(var r=o(n[t],2),i=r[0],a=r[1],s=0,c=Object.entries(a.exports);s<c.length;s++){var u=o(c[s],2),l=u[0],h=u[1];h&&h.__isTeatimeModelClass__&&Le(i,"default"===l?h.name:l,h)}}function De(){return 0===Object.keys(Ie).length&&Ne(),Object.values(Ie).map(function(t){return t.cls})}function Re(t){return Object.prototype.hasOwnProperty.call(t,je)}function qe(t){if(Ie[t])return Ie[t].cls;if(Ne(),Ie[t])return Ie[t].cls;throw Error('Class "'.concat(t,'" in snapshot, but not found in current source?'))}function Le(t,e,n){var r="".concat(t,":").concat(e),i=Ie[r];if(i&&i.cls!==n)throw Error("Duplicate class ".concat(e," in ").concat(t));return Re(n)?Me&&!i&&console.warn("ignoring re-exported class ".concat(e," from ").concat(t)):(Me&&console.log("registering class ".concat(e," from ").concat(t)),n[je]=r),Ie[r]={cls:n,file:t},n}var ze=function(){function t(e){d(this,t),Object.defineProperty(this,"realm",{value:re()}),Object.defineProperty(this,"id",{value:this.realm.register(this),configurable:!0})}return f(t,null,[{key:"displayStatus",value:function(t,e){return st(t,e)}},{key:"displayWarning",value:function(t,e){return at(t,e)}},{key:"displayError",value:function(t,e){return ot(t,e)}}]),f(t,[{key:"detach",value:function(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}},{key:"reattach",value:function(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}},{key:"publish",value:function(t,e,n){this.realm.publish(e,n,t)}},{key:"subscribe",value:function(t,e,n){n=n.bind(this);var r=e.event?e:{event:e},i=r.event,o=r.handling;this.realm.subscribe(i,this.id,n,t,o)}},{key:"unsubscribe",value:function(t,e){this.realm.unsubscribe(e,this.id,null,t)}},{key:"unsubscribeAll",value:function(){this.realm.unsubscribeAll(this.id)}},{key:"future",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.realm.future(this,t)}},{key:"random",value:function(){return re().random()}},{key:"now",value:function(){return this.realm.now()}},{key:"externalNow",value:function(){return this.realm.externalNow()}},{key:"update",value:function(t){}},{key:"wellKnownModel",value:function(t){return this.realm.island.get(t)}},{key:"inSameViewRealm",value:function(t){return oe(this.realm.island,t,!0)}},{key:Symbol.toPrimitive,value:function(){var t=this.constructor.name;return t.includes("View")?t:"".concat(t,"[View]")}},{key:"sessionId",get:function(){return this.realm.island.id}},{key:"viewId",get:function(){return this.realm.island.controller.viewId}}]),t}();function Be(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function Ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function He(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fe(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Ve=t("pako"),Je="0.2.7";console.log("Croquet SDK "+Je);var We=window.location.hostname.endsWith("croquet.io")?"".concat(window.location.host,"/reflector"):"croquet.io/reflector",$e="wss://".concat(We,"/v").concat(1),Ge=null,Ke=I.nocheat,Ze=["tps"];function Ye(){return Math.floor(Math.random()*Math.pow(2,53)).toString(36)}var Qe=new Set,Xe=function(){function t(){d(this,t),this.reset()}var e,n,r,u,l,h,v,y;return f(t,[{key:"reset",value:function(){this.island=null,this.connection=this.connection||new tn(this),this.networkQueue=new Wt,this.time=0,this.fastForwardTo=-1,this.session="",this.viewId=this.viewId||Ye(),this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(window.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(window.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],Qt.removeAllSubscriptionsFor(this.viewId),Qt.addSubscription(this.viewId,"__users__",this.viewId,function(t){return st("users now ".concat(t.count))},"oncePerFrameWhileSynced"),gt.showSyncWait(!0)}},{key:"checkForConnection",value:function(t){this.connection.checkForConnection(t)}},{key:"dormantDisconnect",value:function(){this.connected&&this.connection.dormantDisconnect()}},{key:"establishSession",value:(y=c(i.mark(function t(e,n){var r,c,u,l,h,d,f,v,y,m,g,b,w,_,k,S,x,C,E;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(Ge={messages:I.has("debug","messages",!1),sends:I.has("debug","sends",!1),ticks:I.has("debug","ticks",!1),pong:I.has("debug","pong",!1),snapshot:I.has("debug","snapshot",!1),session:I.has("debug","session",!1),initsnapshot:I.has("debug","initsnapshot","localhost"),reflector:I.has("debug","reflector",I.dev||"localhost")},r=n.optionsFromUrl,c=n.multiRoom,u=n.autoSession,l=n.login,h=He({},n.options),d=0,f=[].concat(Ze,a(r||[]));d<f.length;d++)(v=f[d])in I&&(h[v]=I[v]);if(!l){t.next=7;break}return t.next=7,wt();case 7:return u&&(y=e,m=I.getSession().split("/"),g=c?m[1]:m[0],b=c?m[2]:m[1],(w=!g||!b)&&(u.user&&(g=u.user),u.random&&(b=u.random),g||(g=bt("name","").toLowerCase()||"GUEST"),b||(b=Ye())),this.session=c?"".concat(y,"/").concat(g,"/").concat(b):"".concat(g,"/").concat(b),c||(I.setSession(this.session,w),gt.sessionURL=window.location.href),e="".concat(y,"/").concat(g,"/").concat(b)),_=function(t){return"object"===s(t)?p(t):t},k=Object.keys(h).length?e+"?"+Object.entries(h).map(function(t){var e=o(t,2),n=e[0],r=e[1];return"".concat(n,"=").concat(_(r))}).sort().join("&"):e,t.next=12,Ht(k,Je);case 12:return S=t.sent,x=S.hash,C=S.codeHash,console.log('Session ID for "'.concat(e,'": ').concat(x)),this.islandCreator=He({},n,{options:h,name:e,codeHash:C}),E=!1,this.islandCreator.snapshot?this.islandCreator.snapshot.id!==x&&(console.warn("Existing snapshot was for different code base!"),E=!0):E=!0,E&&(this.islandCreator.snapshot={id:x,time:0,meta:{id:x,codeHash:C,created:(new Date).toISOString()}}),t.next=22,this.join();case 22:return t.next=24,this.startedOrSynced();case 24:return t.abrupt("return",this.island.modelsByName);case 25:case"end":return t.stop()}},t,this)})),function(t,e){return y.apply(this,arguments)})},{key:"lastKnownTime",value:function(t){return Math.max(t.time,t.externalTime)}},{key:"handleSyncCheckVote",value:function(t){if(!0===this.synced){var e=t._local,n=t.tally,r=Object.keys(n);e&&r.includes(e)?r.length>1?console.log(r):console.log("ok"):console.log(this.id,"Sync: local vote not found",e,n)}}},{key:"takeSnapshot",value:function(){var t=this.island.snapshot(),e=this.lastKnownTime(t),n=t.externalSeq;return t.meta=He({},this.islandCreator.snapshot.meta,{options:this.islandCreator.options,time:e,seq:n,date:(new Date).toISOString(),host:window.location.hostname,sdk:Je}),delete t.meta.hash,t}},{key:"scheduleSnapshot",value:function(){if(this.island){var t=this.island.time,e=t-this.island.lastSnapshotPoll;if(e<5e3)Ge.snapshot&&console.log("not requesting snapshot poll (".concat(e,"ms since poll scheduled)"));else{var n=new be(t,0,this.island.id,"pollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),Ge.snapshot&&console.log(this.id,"Controller scheduling snapshot via reflector")}}}},{key:"preparePollForSnapshot",value:function(){var t=this.triggeringCpuTime||this.cpuTime;return this.triggeringCpuTime=null,this.cpuTime=0,!0===this.synced?{cpuTime:t}:null}},{key:"pollForSnapshot",value:function(t,e,n){n.cpuTime+=Math.random();var r=[this.id,"handleSnapshotVote","snapshotVote"];this.sendTutti(t,e,n,null,!0,r)}},{key:"handleSnapshotVote",value:function(t){var e=this;if(!0===this.synced){var n=t._local,r=t.tally,i=Object.keys(r);if(!n||!i.includes(n))return Ge.snapshot&&console.log(this.id,"Snapshot: local vote not found"),void(this.cpuTime=0);var o=i.map(function(t){return JSON.parse(t)}),a={};o.forEach(function(t,e){var n=t.hash;a[n]||(a[n]=[]),a[n].push(e)});var s=Object.keys(a),c=s[0];s.length>1&&(Ge.snapshot&&console.log(this.id,"Snapshots fall into ".concat(s.length," groups")),s.sort(function(t,e){return a[e].length-a[t].length}),a[s[0]].length===a[s[1]].length&&(Ge.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),c=s[0]<s[1]?s[0]:s[1])),s.forEach(function(t){return function(t,r){var s=a[t];s.length>1&&s.sort(function(t,e){return o[t].cpuTime-o[e].cpuTime});var c=s[0];i[c]===n&&e.serveSnapshot(r)}(t,t===c)})}else Ge.snapshot&&console.log("Ignoring snapshot vote during sync")}},{key:"serveSnapshot",value:function(t){var e=K.begin("snapshot"),n=this.takeSnapshot(),r=K.end("snapshot")-e;this.cpuTime-=r,Ge.snapshot&&console.log(this.id,"Snapshotting took ".concat(Math.ceil(r)," ms")),this.uploadSnapshot(n,t)}},{key:"snapshotUrl",value:function(t,e,n,r,i){var o,a="".concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"code",e=I.has("dev","host","localhost"),n=e?"dev/".concat(bt("name","GUEST"),"/"):"";return"".concat(Ct(),"/").concat(n).concat(t,"/")}("snapshots")).concat(this.id),s=".json".concat(i?"."+i:""),c="".concat((o=Math.round(e),(""+o).padStart(10,"0")),"_").concat(n,"-").concat(t,"-").concat(r).concat(s);return"".concat(a,"/").concat(c)}},{key:"hashSnapshot",value:function(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise(function(e){var n=He({},t);delete n.meta,Lt(JSON.stringify(n)).then(function(n){t.meta.hash=n,delete t.meta.hashPromise,e(n)})})),t.meta.hashPromise)}},{key:"uploadSnapshot",value:(v=c(i.mark(function t(e){var n,r,o,a,s,c,u,l,h,d,f,p=arguments;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=!(p.length>1&&void 0!==p[1])||p[1],t.next=3,this.hashSnapshot(e);case 3:return r=Date.now(),o=JSON.stringify(e),a=Date.now()-r,s=e.meta,c=s.time,u=s.seq,l=s.hash,h=this.snapshotUrl("snap",c,u,l,"gz"),Ge.snapshot&&console.log(this.id,"Controller uploading snapshot (".concat(o.length," bytes, ").concat(a,"ms) to ").concat(h)),d=this.connection.socket,t.next=12,this.uploadGzipped(h,o);case 12:if(f=t.sent,this.connection.socket===d){t.next=16;break}return console.error("Controller was reset while trying to upload snapshot"),t.abrupt("return",!1);case 16:if(f){t.next=19;break}return console.error("Failed to upload snapshot"),t.abrupt("return",!1);case 19:return n&&this.announceSnapshotUrl(c,u,l,h),t.abrupt("return",!0);case 21:case"end":return t.stop()}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"announceSnapshotUrl",value:function(t,e,n,r){Ge.snapshot&&console.log(this.id,"Controller sending snapshot url to reflector (time: ".concat(t,", seq: ").concat(e,", hash: ").concat(n,"): ").concat(r));try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:n,url:r}}))}catch(t){console.error("ERROR while sending",t)}}},{key:"fetchJSON",value:(h=c(i.mark(function t(e,n){var r,o,a;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{mode:"cors"});case 3:if(r=t.sent,!e.endsWith(".gz")){t.next=10;break}return t.next=7,r.arrayBuffer();case 7:return o=t.sent,a=Ve.inflate(new Uint8Array(o),{to:"string"}),t.abrupt("return",JSON.parse(a));case 10:return t.next=12,r.json();case 12:return t.abrupt("return",t.sent);case 15:t.prev=15,t.t0=t.catch(0);case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}},t,null,[[0,15]])})),function(t,e){return h.apply(this,arguments)})},{key:"uploadJSON",value:(l=c(i.mark(function t(e,n){var r,o;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:n});case 3:return r=t.sent,o=r.ok,t.abrupt("return",o);case 8:t.prev=8,t.t0=t.catch(0);case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}},t,null,[[0,8]])})),function(t,e){return l.apply(this,arguments)})},{key:"uploadGzipped",value:(u=c(i.mark(function t(e,n){var r,o,a,s,c;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),o=(new TextEncoder).encode(n),a=Ve.gzip(o,{level:1}),Ge.snapshot&&console.log("Snapshot gzipping took ".concat(Date.now()-r,"ms")),t.prev=4,t.next=7,fetch(e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/octet-stream"},body:a});case 7:return s=t.sent,c=s.ok,t.abrupt("return",c);case 12:t.prev=12,t.t0=t.catch(4);case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}},t,null,[[4,12]])})),function(t,e){return u.apply(this,arguments)})},{key:"convertReflectorMessage",value:function(t){var e=this.id,n="noop",r=[];switch(t[2].what){case"users":var i=t[2],a=i.joined,s=i.left,c=i.active,u=i.total;this.users=c,this.usersTotal=u;var l,h=this.id,d={entered:a||[],exited:s||[],count:c},f=Be(d.entered);try{for(f.s();!(l=f.n()).done;){var p=l.value;p.length>2&&(p.length=2)}}catch(t){f.e(t)}finally{f.f()}e=this.id,n="publishFromModel",r=[h,"__users__",d],Qt.handleEvent(this.viewId+":__users__",d);break;case"tally":var v=t[2],y=v.tuttiSeq,m=v.tally,g=v.tallyTarget,b={tuttiSeq:y,tally:m},w=this.tuttiHistory.find(function(t){return t.tuttiSeq===y});w&&(b._local=w.payload);var _=o(g,3);e=_[0],n=_[1],r=[_[2],b]}var k=new be(0,0,e,n,r);t[2]=k.asState()[2]}},{key:"receive",value:(r=c(i.mark(function t(e,n){var r,o,a,s,c,u,l,h,d,f,p,v,y=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.lastReceived=this.connection.lastReceived,t.t0=e,t.next="START"===t.t0?4:"SYNC"===t.t0?13:"RECV"===t.t0?33:"TICK"===t.t0?41:"LEAVE"===t.t0?48:51;break;case 4:return Ge.session&&console.log(this.id,"Controller received START"),this.install(),r=this.takeSnapshot(),t.next=9,this.uploadSnapshot(r,!0);case 9:return o=t.sent,this.islandCreator.startedOrSynced.resolve(this.island),o?this.requestTicks():this.connection.closeConnectionWithError("start","failed to establish session"),t.abrupt("return");case 13:a=n.messages,s=n.url,c=n.time,Ge.session&&console.log(this.id,"Controller received SYNC: time ".concat(c,", ").concat(a.length," messages, ").concat(s)),u=Be(a);try{for(u.s();!(l=u.n()).done;)h=l.value,Ge.messages&&console.log(this.id,"Controller received message in SYNC "+JSON.stringify(h)),h[1]>>>=0,"string"!=typeof h[2]&&this.convertReflectorMessage(h),this.networkQueue.put(h),this.timeFromReflector(h[0])}catch(t){u.e(t)}finally{u.f()}return this.timeFromReflector(c),Ge.session&&console.log("".concat(this.id," fetching snapshot ").concat(s)),t.next=21,this.fetchJSON(s);case 21:if(d=t.sent,this.islandCreator.snapshot=d,this.connected){t.next=26;break}return console.log(this.id,"socket went away during SYNC"),t.abrupt("return");case 26:return this.install(),this.fastForwardTo=c,Ge.session&&console.log("".concat(this.id," fast forwarding from ").concat(Math.round(this.island.time)," to ").concat(this.fastForwardTo)),this.getTickAndMultiplier(),f=function t(){y.simulate(Date.now()+200)?(Ge.session&&console.log("".concat(y.id," fast forwarded to ").concat(Math.round(y.island.time))),y.fastForwardTo=-1,y.islandCreator.startedOrSynced.resolve(y.island)):setTimeout(t,0)},setTimeout(f,0),t.abrupt("return");case 33:return Ge.messages&&console.log(this.id,"Controller received RECV "+JSON.stringify(n)),"string"!=typeof(p=n)[2]&&this.convertReflectorMessage(p),p[1]>>>=0,p[3]===this.viewId&&this.addToStatistics(p[4],this.lastReceived),this.networkQueue.put(p),this.timeFromReflector(p[0]),t.abrupt("return");case 41:if(this.island){t.next=43;break}return t.abrupt("return");case 43:return v="number"==typeof n?n:n.time,Ge.ticks&&console.log(this.id,"Controller received TICK "+v),this.timeFromReflector(v),this.tickMultiplier&&this.multiplyTick(v),t.abrupt("return");case 48:return console.log(this.id,"Controller received LEAVE"),this.leave(),t.abrupt("return");case 51:console.warn("Unknown action:",e,n);case 52:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"install",value:function(){Ge.session&&console.log("".concat(this.id," installing island"));var t=this.islandCreator,e=t.snapshot,n=t.init,r=t.options,i=new pe(e,function(){try{return n(r)}catch(t){throw ct("init",t),t}});if(Ge.initsnapshot&&!e.modelsById){var o=JSON.stringify(i.snapshot());i=new pe(JSON.parse(o),function(){return n(r)})}var a=this.lastKnownTime(i);this.time=Math.max(this.time,a),this.setIsland(i)}},{key:"setIsland",value:function(t){this.island=t,this.island.controller=this}},{key:"createCleanIsland",value:function(){var t=this.islandCreator,e=t.options,n=t.init,r={id:this.id};return new pe(r,function(){return n(e)})}},{key:"join",value:(n=c(i.mark(function t(){var e,n,r,o;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkForConnection(!1),t.next=3,this.connection.connectionPromise;case 3:Qe.add(this),Ge.session&&console.log(this.id,"Controller sending JOIN"),e=this.user,n=e.name,r=e.id,o={name:this.islandCreator.name,options:this.islandCreator.options,version:1,user:[r,n],url:gt.sessionURL,codeHash:this.islandCreator.codeHash,sdk:Je},this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:o}));case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"startedOrSynced",value:(e=c(i.mark(function t(){var e=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){return e.islandCreator.startedOrSynced={resolve:t,reject:n}}));case 1:case"end":return t.stop()}},t)})),function(){return e.apply(this,arguments)})},{key:"leave",value:function(){this.connected&&(console.log(this.id,"Controller LEAVING session for ".concat(this.islandCreator.name)),this.connection.send(JSON.stringify({id:this.id,action:"LEAVING"}))),Qe.delete(this);var t=this.islandCreator.destroyerFn;if(this.reset(),!this.islandCreator)throw Error("do not discard islandCreator!");t&&t()}},{key:"sendMessage",value:function(t){this.connected&&(this.viewOnly||(Ge.sends&&console.log(this.id,"Controller sending SEND ".concat(t.asState())),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[].concat(a(t.asState()),[this.viewId,this.lastSent,this.latency])}))))}},{key:"sendTagged",value:function(t,e){this.connected&&(this.viewOnly||(Ge.sends&&console.log(this.id,"Controller sending tagged SEND ".concat(t.asState()," with tags ").concat(JSON.stringify(e))),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[].concat(a(t.asState()),[this.viewId,this.lastSent]),tags:e}))))}},{key:"sendTutti",value:function(t,e,n,r,i,o){if(this.connected&&!this.viewOnly){var a=p(n);Ge.sends&&console.log(this.id,"Controller sending TUTTI ".concat(a," ").concat(r&&r.asState()," ").concat(o)),this.tuttiHistory.push({tuttiSeq:e,payload:a}),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,e,a,r&&r.asState(),i,o]}))}}},{key:"sendVote",value:function(t,e,n){var r=[this.island.id,"handleModelEventInView",this.island.id+":"+e];this.sendTutti(this.island.time,t,n,null,!0,r)}},{key:"addToStatistics",value:function(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}},{key:"getTickAndMultiplier",value:function(){var t=this.islandCreator.options,e=((t.tps?t.tps:this.islandCreator.tps?this.islandCreator.tps:20)+"x").split("x").map(function(t){return Number.parseInt("0"+t,10)}),n=o(e,2),r=n[0],i=n[1],a=1e3/Math.max(1,Math.min(60,r)),s=Math.max(1,i);return s>1&&!Ke&&(this.tickMultiplier={tick:a,multiplier:s}),{tick:a,multiplier:s}}},{key:"requestTicks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.connected&&this.island){var e=this.getTickAndMultiplier(),n=e.tick,r=e.multiplier;t.tick=n,t.delay=n*(r-1)/r,Ge.session&&console.log(this.id,"Controller requesting TICKS",t);try{this.connection.send(JSON.stringify({id:this.id,action:"TICKS",args:t}))}catch(t){console.error("ERROR while sending",t)}}}},{key:"simulate",value:function(t){var e=this;if(!this.island)return!0;try{for(var n=K.begin("simulate"),r=!0;r;){var i=this.networkQueue.peek();if(!i)break;if(!(r=this.island.advanceTo(i[0],t)))break;if(this.fastForwardTo>=0&&i[0]>=this.fastForwardTo)return!0;this.networkQueue.nextNonBlocking();var o=this.island.scheduleExternalMessage(i);r=this.island.advanceTo(o.time,t),this.cpuTime+=5}if(this.fastForwardTo>=0)return!!r&&this.island.advanceTo(this.fastForwardTo,t);r&&(r=this.island.advanceTo(this.time,t)),this.cpuTime+=Math.max(.01,K.end("simulate")-n);var a=this.backlog;return K.backlog(a),"boolean"==typeof this.synced&&(this.synced&&a>1e3||!this.synced&&a<100)&&(this.synced?this.applySyncChange(!1):this.syncTimer||(this.syncTimer=setTimeout(function(){delete e.syncTimer,e.backlog<100&&e.applySyncChange(!0)},200))),r&&this.cpuTime>5e3&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,setTimeout(function(){return e.scheduleSnapshot()},Math.floor(2e3*Math.random()))),r}catch(t){return ct("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}},{key:"applySyncChange",value:function(t){this.synced=t,gt.showSyncWait(!t),this.island.publishFromView(this.viewId,"synced",t)}},{key:"inViewRealm",value:function(t){var e=this;return oe(this.island,function(){return t(e.island)})}},{key:"processModelViewEvents",value:function(){return this.island?this.island.processModelViewEvents():0}},{key:"timeFromReflector",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reflector";t<this.time?("controller"!==e||Ge.ticks)&&console.warn("time is ".concat(this.time,", ignoring time ").concat(t," from ").concat(e)):("boolean"!=typeof this.synced&&(this.synced=!1),this.time=t,this.island&&K.backlog(this.backlog),this.tickHook&&this.tickHook())}},{key:"multiplyTick",value:function(t){var e=this;this.localTicker&&window.clearInterval(this.localTicker);var n=this.tickMultiplier,r=n.tick,i=n.multiplier,o=r/i,a=1;this.localTicker=window.setInterval(function(){e.timeFromReflector(t+a*o,"controller"),Ge.ticks&&console.log(e.id,"Controller generate TICK "+e.time,a),++a>=i&&(window.clearInterval(e.localTicker),e.localTicker=0)},o)}},{key:"id",get:function(){return this.island?this.island.id:this.islandCreator.snapshot.id}},{key:"user",get:function(){return{id:this.viewId,name:bt("name","GUEST")}}},{key:"viewOnly",get:function(){return this.islandCreator.viewOnly}},{key:"backlog",get:function(){return this.island?this.time-this.island.time:0}},{key:"starvation",get:function(){return Date.now()-this.lastReceived}},{key:"activity",get:function(){return Date.now()-this.lastSent}},{key:"connected",get:function(){return this.connection.connected}},{key:"latencies",get:function(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}}]),t}(),tn=function(){function t(e){d(this,t),this.controller=e,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.setUpConnectionPromise()}var e;return f(t,[{key:"setUpConnectionPromise",value:function(){var t=this;this.connectionPromise=new Promise(function(e){return t.resolveConnection=e})}},{key:"checkForConnection",value:function(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}},{key:"connectToReflector",value:(e=c(i.mark(function t(){var e,n=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1,(e=I.reflector||(Ge.reflector?"wss://croquet.io/reflector-dev/dev":$e)).match(/^wss?:/)){t.next=6;break}throw Error("Cannot interpret reflector address "+e);case 6:return e.endsWith("/")||(e+="/"),t.abrupt("return",new Promise(function(t){var r=Object.assign(new WebSocket("".concat(e).concat(n.controller.id)),{onopen:function(e){n.socket=r,(Ge.session||Ge.reflector)&&console.log(n.socket.constructor.name,"connected to",n.socket.url),K.connected(!0),n.resolveConnection(null),t()},onmessage:function(t){n.receive(t.data)},onerror:function(t){ot("Connection error"),console.log(r.constructor.name,"error")},onclose:function(t){var e=1e3!==t.code&&t.code<4100,i=4110===t.code;i||ot("Connection closed: ".concat(t.code," ").concat(t.reason),{duration:e?void 0:36e5}),Ge.session&&console.log(r.constructor.name,"closed:",t.code,t.reason),K.connected(!1),i?n.connectRestricted=!0:n.connectBlocked=!0,n.disconnected(),e&&(at("Reconnecting ..."),window.setTimeout(function(){return n.connectToReflector()},2e3))}})}));case 8:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"disconnected",value:function(){this.socket&&(this.socket=null,this.lastReceived=0,this.lastSent=0,this.connectHasBeenCalled=!1,this.setUpConnectionPromise(),this.controller.leave())}},{key:"send",value:function(t){this.lastSent=Date.now(),this.socket.send(t)}},{key:"receive",value:function(t){this.lastReceived=Date.now();var e=JSON.parse(t),n=e.id,r=e.action,i=e.args;if(n)try{this.controller.receive(r,i)}catch(t){this.closeConnectionWithError("receive",t)}else switch(r){case"PONG":Ge.pong&&console.log("PONG after",Date.now()-i,"ms");break;default:console.warn("Unknown action",r)}}},{key:"dormantDisconnect",value:function(){this.connected&&(console.log("dormant; disconnecting from reflector"),this.socket.close(4110,"Going dormant"))}},{key:"closeConnectionWithError",value:function(t,e){console.error(e),console.warn("closing socket"),this.socket.close(4e3,"Error in "+t)}},{key:"PING",value:function(){this.connected&&(this.socket.bufferedAmount?console.log("Reflector connection stalled: ".concat(this.socket.bufferedAmount," bytes unsent")):this.send(JSON.stringify({action:"PING",args:Date.now()})))}},{key:"PULSE",value:function(){this.connected&&(this.socket.bufferedAmount&&console.log("Reflector connection stalled: ".concat(this.socket.bufferedAmount," bytes unsent")),this.send(JSON.stringify({action:"PULSE"})))}},{key:"keepAlive",value:function(){0!==this.lastReceived&&(Date.now()-this.lastReceived>100?this.PING():Date.now()-this.lastSent>2e4&&this.PULSE())}},{key:"connected",get:function(){return this.socket&&this.socket.readyState===WebSocket.OPEN}}]),t}();function en(){return(en=c(i.mark(function t(e){var n,r,s,u,l,h,d,f,p,v,y,m,g,b,w,_,k,S,x,C,E,O,M,A=arguments;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(M=function(){setInterval(function(){if("hidden"===document.visibilityState)if(!1===I.autoSleep)an(performance.now(),v,k.view);else{var t=Date.now();d?t-d>1e4&&v.dormantDisconnect():d=t}else d=null},1e3)},O=function(t){return{modelRoot:n.create(t,"modelRoot")}},E=function(){k.model=null,k.view&&(I.has("debug","session",!1)&&console.log(k.id,"Detaching root view"),k.view.detach(),""!==k.view.id&&console.warn("".concat(k.view," did not call super.detach()")),k.view=null),gt.clearSessionMoniker()},C=function(){return(C=c(i.mark(function t(n){var a,c,u,l,h,d;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(E(),a={snapshot:n,init:O,destroyerFn:x,options:y},c=0,u=Object.entries(s);c<u.length;c++)l=o(u[c],2),h=l[0],d=l[1],p.includes(h)&&(a[h]=d);return t.next=5,v.establishSession(e,a);case 5:k.model=t.sent.modelRoot,k.id=v.id,gt.makeSessionWidgets(k.id),v.inViewRealm(function(){I.has("debug","session",!1)&&console.log(k.id,"Creating root view"),k.view=new r(k.model)});case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)},x=function(t){return C.apply(this,arguments)},u=function(t,e){return t===e||t.prototype instanceof e},n=A.length>1&&void 0!==A[1]?A[1]:Pe,r=A.length>2&&void 0!==A[2]?A[2]:ze,s=A.length>3?A[3]:void 0,"string"!=typeof e?e=JSON.stringify(e)||"undefined":e||(e="unnamed"),u(n,Pe)){t.next=12;break}throw Error("ModelRoot must inherit from Croquet.Model");case 12:if(u(r,ze)){t.next=19;break}if(!r||Object.getPrototypeOf(r)!==Object.prototype||void 0!==s){t.next=18;break}s=r,r=ze,t.next=19;break;case 18:throw Error("ViewRoot must inherit from Croquet.View");case 19:s||(s={}),(l=I.reflector||s.reflector)&&(l.includes("://")?I.reflector=l:console.warn('Not a valid websocket url, ignoring reflector "'.concat(l,'"'))),s.debug&&(h=function(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]},I.debug=[].concat(a(h(s.debug)),a(h(I.debug))).join(",")),d=null,"autoSleep"in s&&(I.autoSleep=s.autoSleep),M(),"expectedSimFPS"in s&&(on=Math.min(s.expectedSimFPS,rn)),f=["tps"],p=["optionsFromUrl","login","autoSession"],cn(),v=new Xe,y={},s.options&&Object.assign(y,JSON.parse(JSON.stringify(s.options)));for(m=0,g=Object.entries(s);m<g.length;m++)b=o(g[m],2),w=b[0],_=b[1],f.includes(w)&&(y[w]=_);return t.t0=function(t){"hidden"!==document.visibilityState&&(d=null,an(t,v,k.view))},k={id:"",model:null,view:null,step:t.t0,get latency(){return v.latency},get latencies(){return v.latencies}},t.next=38,x();case 38:return"manual"!==s.step&&(S=function t(e){k.step(e),window.requestAnimationFrame(t)},window.requestAnimationFrame(S)),t.abrupt("return",k);case 40:case"end":return t.stop()}},t)}))).apply(this,arguments)}window.setInterval(function(){var t,e=Be(Qe);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.connected&&n.connection.keepAlive()}}catch(t){e.e(t)}finally{e.f()}},100);var nn=[0],rn=120,on=60;function an(t,e,n){e.checkForConnection(!0);var r=e.backlog,i=e.latency,o=e.starvation,a=e.activity;if(K.animationFrame(t,{backlog:r,starvation:o,latency:i,activity:a,users:e.users}),e.island){var s=Date.now(),c=nn.reduce(function(t,e){return t+e},0)/nn.length;e.simulate(s+Math.min(c,200));var u=0===on?0:1e3/on*4;e.backlog>u&&e.simulate(s+200-c),nn.push(Date.now()-s),nn.length>4&&nn.shift(),K.begin("update"),e.processModelViewEvents(),K.end("update"),n&&(K.begin("render"),e.inViewRealm(function(){return n.update(t)}),K.end("render"))}}var sn={};function cn(){Object.isFrozen(sn)||(function t(e){if(!Object.isFrozen(e)){Object.freeze(e);for(var n=0,r=Object.values(e);n<r.length;n++){var i=r[n];!i||"object"!==s(i)&&"function"!=typeof i||t(i)}}}(sn),function(t){var e=JSON.stringify(t,function(t,e){return"function"==typeof e?""+e:e});if("{}"!==e){var n=JSON.parse(e),r=Lt(p(n));r.then(function(t){console.log("hashing Croquet.Constants(".concat(Object.keys(n).join(", "),"): ").concat(t)),jt()&&(Nt[t].name="Croquet Constants")}),Ut.push(r)}}(sn))}n.App=gt,n.Constants=sn,n.Model=Pe,n.View=ze,n.addClassHash=Ft,n.gatherInternalClassTypes=function(t,e){var n={};return function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set,a=Object.values(e).filter(function(t){var e=Object.prototype.toString.call(t).slice(8,-1);return("Object"===e||"Array"===e)&&!o.has(t)}),s=ce(a);try{for(s.s();!(n=s.n()).done;){var c=n.value;o.add(c);var u=r+"."+c.constructor.name;if(i[u]){if(i[u]!==c.constructor)throw new Error("Class with name "+u+" already gathered, but new one has different identity")}else i[u]=c.constructor}}catch(t){s.e(t)}finally{s.f()}var l,h=ce(a);try{for(h.s();!(l=h.n()).done;){var d=l.value;t(d,r,i,o)}}catch(t){h.e(t)}finally{h.f()}}({root:t},e,n,new Set),n},n.startSession=function(t){return en.apply(this,arguments)}},{"@babel/runtime/regenerator":"wCDd","@babel/runtime/helpers/slicedToArray":"qmoa","@babel/runtime/helpers/toConsumableArray":"wyMK","@babel/runtime/helpers/typeof":"RTfL","@babel/runtime/helpers/asyncToGenerator":"zdnk","@babel/runtime/helpers/defineProperty":"PLl6","toastify-js":"D2QR","seedrandom/seedrandom":"u80Q","@babel/runtime/helpers/classCallCheck":"rsNN","@babel/runtime/helpers/createClass":"rYje","fast-json-stable-stringify":"vwDV","@babel/runtime/helpers/get":"V9yb","@babel/runtime/helpers/inherits":"NdUb","@babel/runtime/helpers/possibleConstructorReturn":"Guyn","@babel/runtime/helpers/getPrototypeOf":"Mrsy",fastpriorityqueue:"wmWq","@babel/runtime/helpers/toArray":"AhBs","@babel/runtime/helpers/construct":"lHWF",pako:"JWfd"}],NhZj:[function(t,e,n){e.exports=t("regenerator-runtime")},{"regenerator-runtime":"KA2S"}],O1c4:[function(t,e,n){var r=t("./arrayLikeToArray");e.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},{"./arrayLikeToArray":"h39S"}],v240:[function(t,e,n){var r=t("./arrayWithHoles"),i=t("./iterableToArrayLimit"),o=t("./unsupportedIterableToArray"),a=t("./nonIterableRest");e.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||a()}},{"./arrayWithHoles":"gS1u","./iterableToArrayLimit":"xf9w","./unsupportedIterableToArray":"O1c4","./nonIterableRest":"XxeS"}],L1Ui:[function(t,e,n){var r=t("./arrayLikeToArray");e.exports=function(t){if(Array.isArray(t))return r(t)}},{"./arrayLikeToArray":"h39S"}],tHSN:[function(t,e,n){var r=t("./arrayWithoutHoles"),i=t("./iterableToArray"),o=t("./unsupportedIterableToArray"),a=t("./nonIterableSpread");e.exports=function(t){return r(t)||i(t)||o(t)||a()}},{"./arrayWithoutHoles":"L1Ui","./iterableToArray":"dzIy","./unsupportedIterableToArray":"O1c4","./nonIterableSpread":"qtGd"}],wAkn:[function(t,e,n){var r=t("./getPrototypeOf");e.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}},{"./getPrototypeOf":"Mrsy"}],gZGI:[function(t,e,n){var r=t("./superPropBase");function i(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(t,e,n){var i=r(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},i(t,n,o||t)}e.exports=i},{"./superPropBase":"wAkn"}],RaoC:[function(t,e,n){var r=t("./setPrototypeOf");e.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},{"./setPrototypeOf":"fHK5"}],GH4F:[function(t,e,n){var r=t("../helpers/typeof"),i=t("./assertThisInitialized");e.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e}},{"../helpers/typeof":"RTfL","./assertThisInitialized":"KZS0"}],vLZV:[function(t,e,n){var r=t("./arrayWithHoles"),i=t("./iterableToArray"),o=t("./unsupportedIterableToArray"),a=t("./nonIterableRest");e.exports=function(t){return r(t)||i(t)||o(t)||a()}},{"./arrayWithHoles":"gS1u","./iterableToArray":"dzIy","./unsupportedIterableToArray":"O1c4","./nonIterableRest":"XxeS"}],E5TV:[function(t,e,n){var r=t("./setPrototypeOf"),i=t("./isNativeReflectConstruct");function o(t,n,a){return i()?e.exports=o=Reflect.construct:e.exports=o=function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}e.exports=o},{"./setPrototypeOf":"fHK5","./isNativeReflectConstruct":"Euax"}],vi5T:[function(t,e,n){"use strict";var r=t("../utils/common"),i=4,o=0,a=1,s=2;function c(t){for(var e=t.length;--e>=0;)t[e]=0}var u=0,l=1,h=2,d=29,f=256,p=f+1+d,v=30,y=19,m=2*p+1,g=15,b=16,w=7,_=256,k=16,S=17,x=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=new Array(2*(p+2));c(A);var T=new Array(2*v);c(T);var P=new Array(512);c(P);var I=new Array(256);c(I);var j=new Array(d);c(j);var N,D,R,q=new Array(v);function L(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function B(t){return t<256?P[t]:P[256+(t>>>7)]}function U(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function F(t,e,n){t.bi_valid>b-n?(t.bi_buf|=e<<t.bi_valid&65535,U(t,t.bi_buf),t.bi_buf=e>>b-t.bi_valid,t.bi_valid+=n-b):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function H(t,e,n){F(t,n[2*e],n[2*e+1])}function V(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function J(t,e,n){var r,i,o=new Array(g+1),a=0;for(r=1;r<=g;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=V(o[s]++,s))}}function W(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<v;e++)t.dyn_dtree[2*e]=0;for(e=0;e<y;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*_]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function $(t){t.bi_valid>8?U(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function G(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function K(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&G(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!G(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function Z(t,e,n){var r,i,o,a,s=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0===r?H(t,i,e):(H(t,(o=I[i])+f+1,e),0!==(a=C[o])&&F(t,i-=j[o],a),H(t,o=B(--r),n),0!==(a=E[o])&&F(t,r-=q[o],a))}while(s<t.last_lit);H(t,_,e)}function Y(t,e){var n,r,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,c=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=m,n=0;n<c;n++)0!==o[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)K(t,o,n);i=c;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],K(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,K(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,o,a,s,c=e.dyn_tree,u=e.max_code,l=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,v=0;for(o=0;o<=g;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<m;n++)(o=c[2*c[2*(r=t.heap[n])+1]+1]+1)>p&&(o=p,v++),c[2*r+1]=o,r>u||(t.bl_count[o]++,a=0,r>=f&&(a=d[r-f]),s=c[2*r],t.opt_len+=s*(o+a),h&&(t.static_len+=s*(l[2*r+1]+a)));if(0!==v){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,v-=2}while(v>0);for(o=p;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>u||(c[2*i+1]!==o&&(t.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),r--)}}(t,e),J(o,u,t.bl_count)}function Q(t,e,n){var r,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=e[2*(r+1)+1],++s<c&&i===a||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*k]++):s<=10?t.bl_tree[2*S]++:t.bl_tree[2*x]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function X(t,e,n){var r,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),r=0;r<=n;r++)if(i=a,a=e[2*(r+1)+1],!(++s<c&&i===a)){if(s<u)do{H(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(H(t,i,t.bl_tree),s--),H(t,k,t.bl_tree),F(t,s-3,2)):s<=10?(H(t,S,t.bl_tree),F(t,s-3,3)):(H(t,x,t.bl_tree),F(t,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}c(q);var tt=!1;function et(t,e,n,i){F(t,(u<<1)+(i?1:0),3),function(t,e,n,i){$(t),i&&(U(t,n),U(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}n._tr_init=function(t){tt||(function(){var t,e,n,r,i,o=new Array(g+1);for(n=0,r=0;r<d-1;r++)for(j[r]=n,t=0;t<1<<C[r];t++)I[n++]=r;for(I[n-1]=r,i=0,r=0;r<16;r++)for(q[r]=i,t=0;t<1<<E[r];t++)P[i++]=r;for(i>>=7;r<v;r++)for(q[r]=i<<7,t=0;t<1<<E[r]-7;t++)P[256+i++]=r;for(e=0;e<=g;e++)o[e]=0;for(t=0;t<=143;)A[2*t+1]=8,t++,o[8]++;for(;t<=255;)A[2*t+1]=9,t++,o[9]++;for(;t<=279;)A[2*t+1]=7,t++,o[7]++;for(;t<=287;)A[2*t+1]=8,t++,o[8]++;for(J(A,p+1,o),t=0;t<v;t++)T[2*t+1]=5,T[2*t]=V(t,5);N=new L(A,C,f+1,p,g),D=new L(T,E,0,v,g),R=new L(new Array(0),O,0,y,w)}(),tt=!0),t.l_desc=new z(t.dyn_ltree,N),t.d_desc=new z(t.dyn_dtree,D),t.bl_desc=new z(t.bl_tree,R),t.bi_buf=0,t.bi_valid=0,W(t)},n._tr_stored_block=et,n._tr_flush_block=function(t,e,n,r){var c,u,d=0;t.level>0?(t.strm.data_type===s&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return a;return o}(t)),Y(t,t.l_desc),Y(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),e=y-1;e>=3&&0===t.bl_tree[2*M[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),c=t.opt_len+3+7>>>3,(u=t.static_len+3+7>>>3)<=c&&(c=u)):c=u=n+5,n+4<=c&&-1!==e?et(t,e,n,r):t.strategy===i||u===c?(F(t,(l<<1)+(r?1:0),3),Z(t,A,T)):(F(t,(h<<1)+(r?1:0),3),function(t,e,n,r){var i;for(F(t,e-257,5),F(t,n-1,5),F(t,r-4,4),i=0;i<r;i++)F(t,t.bl_tree[2*M[i]+1],3);X(t,t.dyn_ltree,e-1),X(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),Z(t,t.dyn_ltree,t.dyn_dtree)),W(t),r&&$(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(I[n]+f+1)]++,t.dyn_dtree[2*B(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){F(t,l<<1,3),H(t,_,A),function(t){16===t.bi_valid?(U(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":"JNpU"}],sdbT:[function(t,e,n){"use strict";var r,i=t("../utils/common"),o=t("./trees"),a=t("./adler32"),s=t("./crc32"),c=t("./messages"),u=0,l=1,h=3,d=4,f=5,p=0,v=1,y=-2,m=-3,g=-5,b=-1,w=1,_=2,k=3,S=4,x=0,C=2,E=8,O=9,M=15,A=8,T=286,P=30,I=19,j=2*T+1,N=15,D=3,R=258,q=R+D+1,L=32,z=42,B=69,U=73,F=91,H=103,V=113,J=666,W=1,$=2,G=3,K=4,Z=3;function Y(t,e){return t.msg=c[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function X(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function et(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function nt(t,e){t.pending_buf[t.pending++]=e}function rt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var n,r,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,c=t.strstart>t.w_size-q?t.strstart-(t.w_size-q):0,u=t.window,l=t.w_mask,h=t.prev,d=t.strstart+R,f=u[o+a-1],p=u[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(n=e)+a]===p&&u[n+a-1]===f&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<d);if(r=R-(d-o),o=d-R,r>a){if(t.match_start=e,a=r,r>=s)break;f=u[o+a-1],p=u[o+a]}}}while((e=h[e&l])>c&&0!=--i);return a<=t.lookahead?a:t.lookahead}function ot(t){var e,n,r,o,c,u,l,h,d,f,p=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-q)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=p?r-p:0}while(--n);e=n=p;do{r=t.prev[--e],t.prev[e]=r>=p?r-p:0}while(--n);o+=p}if(0===t.strm.avail_in)break;if(u=t.strm,l=t.window,h=t.strstart+t.lookahead,d=o,f=void 0,(f=u.avail_in)>d&&(f=d),n=0===f?0:(u.avail_in-=f,i.arraySet(l,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=a(u.adler,l,f,h):2===u.state.wrap&&(u.adler=s(u.adler,l,f,h)),u.next_in+=f,u.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=D)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+D-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<D)););}while(t.lookahead<q&&0!==t.strm.avail_in)}function at(t,e){for(var n,r;;){if(t.lookahead<q){if(ot(t),t.lookahead<q&&e===u)return W;if(0===t.lookahead)break}if(n=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-q&&(t.match_length=it(t,n)),t.match_length>=D)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-D),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=D){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=t.strstart<D-1?t.strstart:D-1,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}function st(t,e){for(var n,r,i;;){if(t.lookahead<q){if(ot(t),t.lookahead<q&&e===u)return W;if(0===t.lookahead)break}if(n=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=D-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-q&&(t.match_length=it(t,n),t.match_length<=5&&(t.strategy===w||t.match_length===D&&t.strstart-t.match_start>4096)&&(t.match_length=D-1)),t.prev_length>=D&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-D,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-D),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=D-1,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return W}else if(t.match_available){if((r=o._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return W}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<D-1?t.strstart:D-1,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}function ct(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function ut(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*j),this.dyn_dtree=new i.Buf16(2*(2*P+1)),this.bl_tree=new i.Buf16(2*(2*I+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(N+1),this.heap=new i.Buf16(2*T+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*T+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function lt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=C,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?z:V,t.adler=2===e.wrap?0:1,e.last_flush=u,o._tr_init(e),p):Y(t,y)}function ht(t){var e,n=lt(t);return n===p&&((e=t.state).window_size=2*e.w_size,X(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=D-1,e.match_available=0,e.ins_h=0),n}function dt(t,e,n,r,o,a){if(!t)return y;var s=1;if(e===b&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>O||n!==E||r<8||r>15||e<0||e>9||a<0||a>S)return Y(t,y);8===r&&(r=9);var c=new ut;return t.state=c,c.strm=t,c.wrap=s,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+D-1)/D),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=a,c.method=n,ht(t)}r=[new ct(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ot(t),0===t.lookahead&&e===u)return W;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,et(t,!1),0===t.strm.avail_out))return W;if(t.strstart-t.block_start>=t.w_size-q&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:K):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),W)}),new ct(4,4,8,4,at),new ct(4,5,16,8,at),new ct(4,6,32,32,at),new ct(4,4,16,16,st),new ct(8,16,32,32,st),new ct(8,16,128,128,st),new ct(8,32,128,256,st),new ct(32,128,258,1024,st),new ct(32,258,258,4096,st)],n.deflateInit=function(t,e){return dt(t,e,E,M,A,x)},n.deflateInit2=dt,n.deflateReset=ht,n.deflateResetKeep=lt,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?y:(t.state.gzhead=e,p):y},n.deflate=function(t,e){var n,i,a,c;if(!t||!t.state||e>f||e<0)return t?Y(t,y):y;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===J&&e!==d)return Y(t,0===t.avail_out?g:y);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===z)if(2===i.wrap)t.adler=0,nt(i,31),nt(i,139),nt(i,8),i.gzhead?(nt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),nt(i,255&i.gzhead.time),nt(i,i.gzhead.time>>8&255),nt(i,i.gzhead.time>>16&255),nt(i,i.gzhead.time>>24&255),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(nt(i,255&i.gzhead.extra.length),nt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=B):(nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,Z),i.status=V);else{var m=E+(i.w_bits-8<<4)<<8;m|=(i.strategy>=_||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=L),m+=31-m%31,i.status=V,rt(i,m),0!==i.strstart&&(rt(i,t.adler>>>16),rt(i,65535&t.adler)),t.adler=1}if(i.status===B)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending!==i.pending_buf_size));)nt(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=F)}else i.status=F;if(i.status===F)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=H)}else i.status=H;if(i.status===H&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(nt(i,255&t.adler),nt(i,t.adler>>8&255),t.adler=0,i.status=V)):i.status=V),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(n)&&e!==d)return Y(t,g);if(i.status===J&&0!==t.avail_in)return Y(t,g);if(0!==t.avail_in||0!==i.lookahead||e!==u&&i.status!==J){var b=i.strategy===_?function(t,e){for(var n;;){if(0===t.lookahead&&(ot(t),0===t.lookahead)){if(e===u)return W;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}(i,e):i.strategy===k?function(t,e){for(var n,r,i,a,s=t.window;;){if(t.lookahead<=R){if(ot(t),t.lookahead<=R&&e===u)return W;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=D&&t.strstart>0&&(r=s[i=t.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){a=t.strstart+R;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);t.match_length=R-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=D?(n=o._tr_tally(t,1,t.match_length-D),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:K):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:$}(i,e):r[i.level].func(i,e);if(b!==G&&b!==K||(i.status=J),b===W||b===G)return 0===t.avail_out&&(i.last_flush=-1),p;if(b===$&&(e===l?o._tr_align(i):e!==f&&(o._tr_stored_block(i,0,0,!1),e===h&&(X(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,p}return e!==d?p:i.wrap<=0?v:(2===i.wrap?(nt(i,255&t.adler),nt(i,t.adler>>8&255),nt(i,t.adler>>16&255),nt(i,t.adler>>24&255),nt(i,255&t.total_in),nt(i,t.total_in>>8&255),nt(i,t.total_in>>16&255),nt(i,t.total_in>>24&255)):(rt(i,t.adler>>>16),rt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:v)},n.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==z&&e!==B&&e!==U&&e!==F&&e!==H&&e!==V&&e!==J?Y(t,y):(t.state=null,e===V?Y(t,m):p):y},n.deflateSetDictionary=function(t,e){var n,r,o,s,c,u,l,h,d=e.length;if(!t||!t.state)return y;if(2===(s=(n=t.state).wrap)||1===s&&n.status!==z||n.lookahead)return y;for(1===s&&(t.adler=a(t.adler,e,d,0)),n.wrap=0,d>=n.w_size&&(0===s&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,e,d-n.w_size,n.w_size,0),e=h,d=n.w_size),c=t.avail_in,u=t.next_in,l=t.input,t.avail_in=d,t.next_in=0,t.input=e,ot(n);n.lookahead>=D;){r=n.strstart,o=n.lookahead-(D-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+D-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=D-1,ot(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=D-1,n.match_available=0,t.next_in=u,t.input=l,t.avail_in=c,n.wrap=s,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":"JNpU","./trees":"vi5T","./adler32":"PDe7","./crc32":"Nls6","./messages":"NGcu"}],LBZa:[function(t,e,n){"use strict";var r=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,n.string2buf=function(t){var e,n,i,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},n.buf2binstring=function(t){return c(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,i,o,s=e||t.length,u=new Array(2*s);for(r=0,n=0;n<s;)if((i=t[n++])<128)u[r++]=i;else if((o=a[i])>4)u[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&t[n++],o--;o>1?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return c(u,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+a[t[n]]>e?n:e}},{"./common":"JNpU"}],JASc:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),s=t("./zlib/zstream"),c=Object.prototype.toString,u=0,l=-1,h=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({level:l,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==u)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==u)throw new Error(a[n]);this._dict_set=!0}}function p(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}f.prototype.push=function(t,e){var n,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=r.deflate(s,a))&&n!==u)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u):2!==a||(this.onEnd(u),s.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=f,n.deflate=p,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./zlib/deflate":"sdbT","./utils/common":"JNpU","./utils/strings":"LBZa","./zlib/messages":"NGcu","./zlib/zstream":"w28B"}],Jrhw:[function(t,e,n){"use strict";var r=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,c,u,l,h,d){var f,p,v,y,m,g,b,w,_,k=d.bits,S=0,x=0,C=0,E=0,O=0,M=0,A=0,T=0,P=0,I=0,j=null,N=0,D=new r.Buf16(16),R=new r.Buf16(16),q=null,L=0;for(S=0;S<=15;S++)D[S]=0;for(x=0;x<c;x++)D[e[n+x]]++;for(O=k,E=15;E>=1&&0===D[E];E--);if(O>E&&(O=E),0===E)return u[l++]=20971520,u[l++]=20971520,d.bits=1,0;for(C=1;C<E&&0===D[C];C++);for(O<C&&(O=C),T=1,S=1;S<=15;S++)if(T<<=1,(T-=D[S])<0)return-1;if(T>0&&(0===t||1!==E))return-1;for(R[1]=0,S=1;S<15;S++)R[S+1]=R[S]+D[S];for(x=0;x<c;x++)0!==e[n+x]&&(h[R[e[n+x]]++]=x);if(0===t?(j=q=h,g=19):1===t?(j=i,N-=257,q=o,L-=257,g=256):(j=a,q=s,g=-1),I=0,x=0,S=C,m=l,M=O,A=0,v=-1,y=(P=1<<O)-1,1===t&&P>852||2===t&&P>592)return 1;for(;;){b=S-A,h[x]<g?(w=0,_=h[x]):h[x]>g?(w=q[L+h[x]],_=j[N+h[x]]):(w=96,_=0),f=1<<S-A,C=p=1<<M;do{u[m+(I>>A)+(p-=f)]=b<<24|w<<16|_|0}while(0!==p);for(f=1<<S-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,x++,0==--D[S]){if(S===E)break;S=e[n+h[x]]}if(S>O&&(I&y)!==v){for(0===A&&(A=O),m+=C,T=1<<(M=S-A);M+A<E&&!((T-=D[M+A])<=0);)M++,T<<=1;if(P+=1<<M,1===t&&P>852||2===t&&P>592)return 1;u[v=I&y]=O<<24|M<<16|m-l|0}}return 0!==I&&(u[m+I]=S-A<<24|64<<16|0),d.bits=O,0}},{"../utils/common":"JNpU"}],P1IH:[function(t,e,n){"use strict";var r=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),c=0,u=1,l=2,h=4,d=5,f=6,p=0,v=1,y=2,m=-2,g=-3,b=-4,w=-5,_=8,k=1,S=2,x=3,C=4,E=5,O=6,M=7,A=8,T=9,P=10,I=11,j=12,N=13,D=14,R=15,q=16,L=17,z=18,B=19,U=20,F=21,H=22,V=23,J=24,W=25,$=26,G=27,K=28,Z=29,Y=30,Q=31,X=32,tt=852,et=592,nt=15;function rt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,p):m}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,ot(t)):m}function st(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?m:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,at(t))):m}function ct(t,e){var n,r;return t?(r=new it,t.state=r,r.window=null,(n=st(t,e))!==p&&(t.state=null),n):m}var ut,lt,ht=!0;function dt(t){if(ht){var e;for(ut=new r.Buf32(512),lt=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(u,t.lens,0,288,ut,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(l,t.lens,0,32,lt,0,t.work,{bits:5}),ht=!1}t.lencode=ut,t.lenbits=9,t.distcode=lt,t.distbits=5}function ft(t,e,n,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,e,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,e,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}n.inflateReset=at,n.inflateReset2=st,n.inflateResetKeep=ot,n.inflateInit=function(t){return ct(t,nt)},n.inflateInit2=ct,n.inflate=function(t,e){var n,tt,et,nt,it,ot,at,st,ct,ut,lt,ht,pt,vt,yt,mt,gt,bt,wt,_t,kt,St,xt,Ct,Et=0,Ot=new r.Buf8(4),Mt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return m;(n=t.state).mode===j&&(n.mode=N),it=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,st=n.hold,ct=n.bits,ut=ot,lt=at,St=p;t:for(;;)switch(n.mode){case k:if(0===n.wrap){n.mode=N;break}for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(2&n.wrap&&35615===st){n.check=0,Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0),st=0,ct=0,n.mode=S;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&st)<<8)+(st>>8))%31){t.msg="incorrect header check",n.mode=Y;break}if((15&st)!==_){t.msg="unknown compression method",n.mode=Y;break}if(ct-=4,kt=8+(15&(st>>>=4)),0===n.wbits)n.wbits=kt;else if(kt>n.wbits){t.msg="invalid window size",n.mode=Y;break}n.dmax=1<<kt,t.adler=n.check=1,n.mode=512&st?P:j,st=0,ct=0;break;case S:for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(n.flags=st,(255&n.flags)!==_){t.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=st>>8&1),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0)),st=0,ct=0,n.mode=x;case x:for(;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.time=st),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,Ot[2]=st>>>16&255,Ot[3]=st>>>24&255,n.check=o(n.check,Ot,4,0)),st=0,ct=0,n.mode=C;case C:for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.xflags=255&st,n.head.os=st>>8),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0)),st=0,ct=0,n.mode=E;case E:if(1024&n.flags){for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.length=st,n.head&&(n.head.extra_len=st),512&n.flags&&(Ot[0]=255&st,Ot[1]=st>>>8&255,n.check=o(n.check,Ot,2,0)),st=0,ct=0}else n.head&&(n.head.extra=null);n.mode=O;case O:if(1024&n.flags&&((ht=n.length)>ot&&(ht=ot),ht&&(n.head&&(kt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,ht,kt)),512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,n.length-=ht),n.length))break t;n.length=0,n.mode=M;case M:if(2048&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.name+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(4096&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.comment+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.comment=null);n.mode=T;case T:if(512&n.flags){for(;ct<16;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(st!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Y;break}st=0,ct=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=j;break;case P:for(;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}t.adler=n.check=rt(st),st=0,ct=0,n.mode=I;case I:if(0===n.havedict)return t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ct,y;t.adler=n.check=1,n.mode=j;case j:if(e===d||e===f)break t;case N:if(n.last){st>>>=7&ct,ct-=7&ct,n.mode=G;break}for(;ct<3;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}switch(n.last=1&st,ct-=1,3&(st>>>=1)){case 0:n.mode=D;break;case 1:if(dt(n),n.mode=U,e===f){st>>>=2,ct-=2;break t}break;case 2:n.mode=L;break;case 3:t.msg="invalid block type",n.mode=Y}st>>>=2,ct-=2;break;case D:for(st>>>=7&ct,ct-=7&ct;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if((65535&st)!=(st>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&st,st=0,ct=0,n.mode=R,e===f)break t;case R:n.mode=q;case q:if(ht=n.length){if(ht>ot&&(ht=ot),ht>at&&(ht=at),0===ht)break t;r.arraySet(et,tt,nt,ht,it),ot-=ht,nt+=ht,at-=ht,it+=ht,n.length-=ht;break}n.mode=j;break;case L:for(;ct<14;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(n.nlen=257+(31&st),st>>>=5,ct-=5,n.ndist=1+(31&st),st>>>=5,ct-=5,n.ncode=4+(15&st),st>>>=4,ct-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=z;case z:for(;n.have<n.ncode;){for(;ct<3;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.lens[Mt[n.have++]]=7&st,st>>>=3,ct-=3}for(;n.have<19;)n.lens[Mt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,xt={bits:n.lenbits},St=s(c,n.lens,0,19,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=B;case B:for(;n.have<n.nlen+n.ndist;){for(;mt=(Et=n.lencode[st&(1<<n.lenbits)-1])>>>16&255,gt=65535&Et,!((yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(gt<16)st>>>=yt,ct-=yt,n.lens[n.have++]=gt;else{if(16===gt){for(Ct=yt+2;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(st>>>=yt,ct-=yt,0===n.have){t.msg="invalid bit length repeat",n.mode=Y;break}kt=n.lens[n.have-1],ht=3+(3&st),st>>>=2,ct-=2}else if(17===gt){for(Ct=yt+3;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}ct-=yt,kt=0,ht=3+(7&(st>>>=yt)),st>>>=3,ct-=3}else{for(Ct=yt+7;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}ct-=yt,kt=0,ht=11+(127&(st>>>=yt)),st>>>=7,ct-=7}if(n.have+ht>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Y;break}for(;ht--;)n.lens[n.have++]=kt}}if(n.mode===Y)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,xt={bits:n.lenbits},St=s(u,n.lens,0,n.nlen,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,xt={bits:n.distbits},St=s(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,xt),n.distbits=xt.bits,St){t.msg="invalid distances set",n.mode=Y;break}if(n.mode=U,e===f)break t;case U:n.mode=F;case F:if(ot>=6&&at>=258){t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ct,a(t,lt),it=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,st=n.hold,ct=n.bits,n.mode===j&&(n.back=-1);break}for(n.back=0;mt=(Et=n.lencode[st&(1<<n.lenbits)-1])>>>16&255,gt=65535&Et,!((yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(mt&&0==(240&mt)){for(bt=yt,wt=mt,_t=gt;mt=(Et=n.lencode[_t+((st&(1<<bt+wt)-1)>>bt)])>>>16&255,gt=65535&Et,!(bt+(yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}st>>>=bt,ct-=bt,n.back+=bt}if(st>>>=yt,ct-=yt,n.back+=yt,n.length=gt,0===mt){n.mode=$;break}if(32&mt){n.back=-1,n.mode=j;break}if(64&mt){t.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&mt,n.mode=H;case H:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.length+=st&(1<<n.extra)-1,st>>>=n.extra,ct-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=V;case V:for(;mt=(Et=n.distcode[st&(1<<n.distbits)-1])>>>16&255,gt=65535&Et,!((yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(0==(240&mt)){for(bt=yt,wt=mt,_t=gt;mt=(Et=n.distcode[_t+((st&(1<<bt+wt)-1)>>bt)])>>>16&255,gt=65535&Et,!(bt+(yt=Et>>>24)<=ct);){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}st>>>=bt,ct-=bt,n.back+=bt}if(st>>>=yt,ct-=yt,n.back+=yt,64&mt){t.msg="invalid distance code",n.mode=Y;break}n.offset=gt,n.extra=15&mt,n.mode=J;case J:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}n.offset+=st&(1<<n.extra)-1,st>>>=n.extra,ct-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Y;break}n.mode=W;case W:if(0===at)break t;if(ht=lt-at,n.offset>ht){if((ht=n.offset-ht)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Y;break}ht>n.wnext?(ht-=n.wnext,pt=n.wsize-ht):pt=n.wnext-ht,ht>n.length&&(ht=n.length),vt=n.window}else vt=et,pt=it-n.offset,ht=n.length;ht>at&&(ht=at),at-=ht,n.length-=ht;do{et[it++]=vt[pt++]}while(--ht);0===n.length&&(n.mode=F);break;case $:if(0===at)break t;et[it++]=n.length,at--,n.mode=F;break;case G:if(n.wrap){for(;ct<32;){if(0===ot)break t;ot--,st|=tt[nt++]<<ct,ct+=8}if(lt-=at,t.total_out+=lt,n.total+=lt,lt&&(t.adler=n.check=n.flags?o(n.check,et,lt,it-lt):i(n.check,et,lt,it-lt)),lt=at,(n.flags?st:rt(st))!==n.check){t.msg="incorrect data check",n.mode=Y;break}st=0,ct=0}n.mode=K;case K:if(n.wrap&&n.flags){for(;ct<32;){if(0===ot)break t;ot--,st+=tt[nt++]<<ct,ct+=8}if(st!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Y;break}st=0,ct=0}n.mode=Z;case Z:St=v;break t;case Y:St=g;break t;case Q:return b;case X:default:return m}return t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ct,(n.wsize||lt!==t.avail_out&&n.mode<Y&&(n.mode<G||e!==h))&&ft(t,t.output,t.next_out,lt-t.avail_out)?(n.mode=Q,b):(ut-=t.avail_in,lt-=t.avail_out,t.total_in+=ut,t.total_out+=lt,n.total+=lt,n.wrap&&lt&&(t.adler=n.check=n.flags?o(n.check,et,lt,t.next_out-lt):i(n.check,et,lt,t.next_out-lt)),t.data_type=n.bits+(n.last?64:0)+(n.mode===j?128:0)+(n.mode===U||n.mode===R?256:0),(0===ut&&0===lt||e===h)&&St===p&&(St=w),St)},n.inflateEnd=function(t){if(!t||!t.state)return m;var e=t.state;return e.window&&(e.window=null),t.state=null,p},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?m:(n.head=e,e.done=!1,p):m},n.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&n.mode!==I?m:n.mode===I&&i(1,e,r,0)!==n.check?g:ft(t,e,r,r)?(n.mode=Q,b):(n.havedict=1,p):m},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":"JNpU","./adler32":"PDe7","./crc32":"Nls6","./inffast":"odtK","./inftrees":"Jrhw"}],WRT7:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),c=t("./zlib/zstream"),u=t("./zlib/gzheader"),l=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[n])}function d(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(t,e){var n,s,c,u,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,v=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?d.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===v&&(n=a.Z_OK,v=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(d.output,d.next_out),u=d.next_out-c,h=o.buf2string(d.output,c),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,c,u,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(v=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./zlib/inflate":"P1IH","./utils/common":"JNpU","./utils/strings":"LBZa","./zlib/constants":"NNt1","./zlib/messages":"NGcu","./zlib/zstream":"w28B","./zlib/gzheader":"bEbX"}],f0Ji:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/utils/common":"JNpU","./lib/deflate":"JASc","./lib/inflate":"WRT7","./lib/zlib/constants":"NNt1"}],jiaI:[function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("@babel/runtime/regenerator")),o=r(t("@babel/runtime/helpers/slicedToArray")),a=r(t("@babel/runtime/helpers/toConsumableArray")),s=r(t("@babel/runtime/helpers/typeof")),c=r(t("@babel/runtime/helpers/asyncToGenerator")),u=r(t("@babel/runtime/helpers/defineProperty")),l=r(t("toastify-js")),h=r(t("seedrandom/seedrandom")),d=r(t("@babel/runtime/helpers/classCallCheck")),f=r(t("@babel/runtime/helpers/createClass")),p=r(t("fast-json-stable-stringify")),v=r(t("@babel/runtime/helpers/get")),y=r(t("@babel/runtime/helpers/inherits")),m=r(t("@babel/runtime/helpers/possibleConstructorReturn")),g=r(t("@babel/runtime/helpers/getPrototypeOf")),b=r(t("fastpriorityqueue")),w=r(t("@babel/runtime/helpers/toArray")),_=r(t("@babel/runtime/helpers/construct"));const k="production";if(void 0===window.TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(t){for(var e=t.length,n=-1,r="undefined"==typeof Uint8Array?new Array(1.5*e):new Uint8Array(3*e),i=0,o=0,a=0;a!==e;){if(i=t.charCodeAt(a),a+=1,i>=55296&&i<=56319){if(a===e){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;break}if(!((o=t.charCodeAt(a))>=56320&&o<=57343)){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;continue}if(a+=1,(i=1024*(i-55296)+o-56320+65536)>65535){r[n+=1]=240|i>>>18,r[n+=1]=128|i>>>12&63,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i;continue}}i<=127?r[n+=1]=0|i:i<=2047?(r[n+=1]=192|i>>>6,r[n+=1]=128|63&i):(r[n+=1]=224|i>>>12,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?r.subarray(0,n+1):(r.length=n+1,r)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(r){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}var S;!function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;e<r;e++){var i=[],o=this.data.charCodeAt(e);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;e<n;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+n][e+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=i.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e},createMovieClip:function(t,e,n){var r=t.createEmptyMovieClip(e,n);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,a=0;a<this.modules[i].length;a++){var s=1*a;this.modules[i][a]&&(r.beginFill(0,100),r.moveTo(s,o),r.lineTo(s+1,o),r.lineTo(s+1,o+1),r.lineTo(s,o+1),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=i.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=t[e],o=t[n];if(null==this.modules[r][o])for(var a=-2;a<=2;a++)for(var s=-2;s<=2;s++)this.modules[r+a][o+s]=-2==a||2==a||-2==s||2==s||0==a&&0==s}},setupTypeNumber:function(t){for(var e=i.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++)r=!t&&1==(e>>n&1),this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,r=i.getBCHTypeInfo(n),o=0;o<15;o++){var a=!t&&1==(r>>o&1);o<6?this.modules[o][8]=a:o<8?this.modules[o+1][8]=a:this.modules[this.moduleCount-15+o][8]=a}for(o=0;o<15;o++)a=!t&&1==(r>>o&1),o<8?this.modules[8][this.moduleCount-o-1]=a:o<9?this.modules[8][15-o-1+1]=a:this.modules[8][15-o-1]=a;this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,r=this.moduleCount-1,o=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var c=0;c<2;c++)if(null==this.modules[r][s-c]){var u=!1;a<t.length&&(u=1==(t[a]>>>o&1)),i.getMask(e,r,s-c)&&(u=!u),this.modules[r][s-c]=u,-1==--o&&(a++,o=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,r){for(var o=c.getRSBlocks(t,n),a=new u,s=0;s<r.length;s++){var l=r[s];a.put(l.mode,4),a.put(l.getLength(),i.getLengthInBits(l.mode,t)),l.write(a)}var h=0;for(s=0;s<o.length;s++)h+=o[s].dataCount;if(a.getLengthInBits()>8*h)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*h+")");for(a.getLengthInBits()+4<=8*h&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*h||(a.put(e.PAD0,8),a.getLengthInBits()>=8*h));)a.put(e.PAD1,8);return e.createBytes(a,o)},e.createBytes=function(t,e){for(var n=0,r=0,o=0,a=new Array(e.length),c=new Array(e.length),u=0;u<e.length;u++){var l=e[u].dataCount,h=e[u].totalCount-l;r=Math.max(r,l),o=Math.max(o,h),a[u]=new Array(l);for(var d=0;d<a[u].length;d++)a[u][d]=255&t.buffer[d+n];n+=l;var f=i.getErrorCorrectPolynomial(h),p=new s(a[u],f.getLength()-1).mod(f);for(c[u]=new Array(f.getLength()-1),d=0;d<c[u].length;d++){var v=d+p.getLength()-c[u].length;c[u][d]=v>=0?p.get(v):0}}var y=0;for(d=0;d<e.length;d++)y+=e[d].totalCount;var m=new Array(y),g=0;for(d=0;d<r;d++)for(u=0;u<e.length;u++)d<a[u].length&&(m[g++]=a[u][d]);for(d=0;d<o;d++)for(u=0;u<e.length;u++)d<c[u].length&&(m[g++]=c[u][d]);return m};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},i={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;i.getBCHDigit(e)-i.getBCHDigit(i.G15)>=0;)e^=i.G15<<i.getBCHDigit(e)-i.getBCHDigit(i.G15);return(t<<10|e)^i.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;i.getBCHDigit(e)-i.getBCHDigit(i.G18)>=0;)e^=i.G18<<i.getBCHDigit(e)-i.getBCHDigit(i.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return i.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case 0:return(e+n)%2==0;case 1:return e%2==0;case 2:return n%3==0;case 3:return(e+n)%3==0;case 4:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case 5:return e*n%2+e*n%3==0;case 6:return(e*n%2+e*n%3)%2==0;case 7:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new s([1],0),n=0;n<t;n++)e=e.multiply(new s([1,o.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,r=0;r<e;r++)for(var i=0;i<e;i++){for(var o=0,a=t.isDark(r,i),s=-1;s<=1;s++)if(!(r+s<0||e<=r+s))for(var c=-1;c<=1;c++)i+c<0||e<=i+c||0==s&&0==c||a==t.isDark(r+s,i+c)&&o++;o>5&&(n+=3+o-5)}for(r=0;r<e-1;r++)for(i=0;i<e-1;i++){var u=0;t.isDark(r,i)&&u++,t.isDark(r+1,i)&&u++,t.isDark(r,i+1)&&u++,t.isDark(r+1,i+1)&&u++,0!=u&&4!=u||(n+=3)}for(r=0;r<e;r++)for(i=0;i<e-6;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(n+=40);for(i=0;i<e;i++)for(r=0;r<e-6;r++)t.isDark(r,i)&&!t.isDark(r+1,i)&&t.isDark(r+2,i)&&t.isDark(r+3,i)&&t.isDark(r+4,i)&&!t.isDark(r+5,i)&&t.isDark(r+6,i)&&(n+=40);var l=0;for(i=0;i<e;i++)for(r=0;r<e;r++)t.isDark(r,i)&&l++;return n+Math.abs(100*l/e/e-50)/5*10}},o={glog:function(t){if(t<1)throw new Error("glog("+t+")");return o.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return o.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},a=0;a<8;a++)o.EXP_TABLE[a]=1<<a;for(a=8;a<256;a++)o.EXP_TABLE[a]=o.EXP_TABLE[a-4]^o.EXP_TABLE[a-5]^o.EXP_TABLE[a-6]^o.EXP_TABLE[a-8];for(a=0;a<255;a++)o.LOG_TABLE[o.EXP_TABLE[a]]=a;function s(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var r=0;r<t.length-n;r++)this.num[r]=t[r+n]}function c(t,e){this.totalCount=t,this.dataCount=e}function u(){this.buffer=[],this.length=0}s.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<t.getLength();r++)e[n+r]^=o.gexp(o.glog(this.get(n))+o.glog(t.get(r)));return new s(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=o.glog(this.get(0))-o.glog(t.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<t.getLength();r++)n[r]^=o.gexp(o.glog(t.get(r))+e);return new s(n,0).mod(t)}},c.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],c.getRSBlocks=function(t,e){var n=c.getRsBlockTable(t,e);if(null==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=n.length/3,i=[],o=0;o<r;o++)for(var a=n[3*o+0],s=n[3*o+1],u=n[3*o+2],l=0;l<a;l++)i.push(new c(s,u));return i},c.getRsBlockTable=function(t,e){switch(e){case r.L:return c.RS_BLOCK_TABLE[4*(t-1)+0];case r.M:return c.RS_BLOCK_TABLE[4*(t-1)+1];case r.Q:return c.RS_BLOCK_TABLE[4*(t-1)+2];case r.H:return c.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},u.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],h=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,n=this._htOption,r=t.getModuleCount(),i=n.width/r,o=n.height/r,a=Math.round(i),s=Math.round(o);this.clear();for(var c=0;c<r;c++)for(var u=0;u<r;u++){var l=t.isDark(c,u),h=u*i,d=c*o;e.strokeStyle=l?n.colorDark:n.colorLight,e.lineWidth=1,e.fillStyle=l?n.colorDark:n.colorLight,e.fillRect(h,d,i,o),e.strokeRect(Math.floor(h)+.5,Math.floor(d)+.5,a,s),e.strokeRect(Math.ceil(h)-.5,Math.ceil(d)-.5,a,s)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();(S=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:r.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(h=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new h(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(function(t,e){for(var n=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),o=0,a=l.length;o<=a;o++){var s=0;switch(e){case r.L:s=l[o][0];break;case r.M:s=l[o][1];break;case r.Q:s=l[o][2];break;case r.H:s=l[o][3]}if(i<=s)break;n++}if(n>l.length)throw new Error("Too long data");return n}(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},S.prototype.clear=function(){this._oDrawing.clear()},S.prototype.getCanvas=function(){for(var t=0;t<this._el.children.length;t++){var e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},S.CorrectLevel=r}();var x=S;function C(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}"object"===(void 0===e?"undefined":s(e))&&e.bundle&&e.bundle.modules&&e.bundle.cache&&function(){for(var t=e.bundle,n={},r={},i={},s=0,c=Object.entries(t.modules);s<c.length;s++){var u=o(c[s],2),l=u[0],h=u[1],d=""+t.modules[l][0],f=r[d];f?i[l]=f:r[d]=l;for(var p=0,v=Object.entries(h[1]);p<v.length;p++){var y=o(v[p],2),m=y[0],g=y[1];(n[g]||(n[g]=new Set)).add(m)}}for(var b=function(t){return n[t]?"".concat(a(n[t]).sort().join('" and "')):"top-level"},w={},_=[],k=0,S=Object.entries(t.modules);k<S.length;k++)for(var x=o(S[k],2),E=x[0],O=x[1],M=0,A=Object.entries(O[1]);M<A.length;M++){var T=o(A[M],2),P=T[0],I=T[1],j=i[I];j&&(t.cache[I]?w[j]=I:(O[1][P]=j,delete t.modules[I],_.push('"'.concat(P,'" in "').concat(b(E),'" (').concat(E,")"))))}for(var N=0,D=Object.entries(t.modules);N<D.length;N++)for(var R=o(D[N],2),q=R[0],L=R[1],z=0,B=Object.entries(L[1]);z<B.length;z++){var U=o(B[z],2),F=U[0],H=U[1],V=w[H];V&&(t.cache[H]?console.warn('Could not deduplicate import "'.concat(F,'" in "').concat(b(q),'" (to fix, import "').concat(b(e.id),'" earlier)')):(L[1][F]=V,delete t.modules[H],_.push('"'.concat(F,'" in "').concat(b(q),'" (').concat(q,")"))))}var J,W=C(_.sort());try{for(W.s();!(J=W.n()).done;){var $=J.value;console.log("Deduplicated import",$)}}catch(t){W.e(t)}finally{W.f()}}();var M=window.location.hostname.endsWith("croquet.studio"),A="",T="";function P(t,e){if(e){var n,r=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(e.split("&"));try{for(r.s();!(n=r.n()).done;){var i=n.value.split("="),o=i[0],a=!0;if(i.length>1&&(a=decodeURIComponent(i.slice(1).join("="))).match(/^(true|false|null|[0-9.]*|["[{].*)$/))try{a=JSON.parse(a)}catch(t){"["===a[0]&&(a=a.slice(1,-1).split(","))}t[o]=a}}catch(t){r.e(t)}finally{r.f()}}}var I=new(function(){function t(){d(this,t),this.getSession(),P(this,window.location.search.slice(1)),P(this,M?window.location.hash.slice(1):T),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}return f(t,[{key:"has",value:function(t,e,n){"boolean"!=typeof n&&(n=this.isHost(n));var r=this[t];if("string"!=typeof r)return n;var i=r.split(",");return!0===n&&(e="no".concat(e)),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes("".concat(e,"s"))?!n:n}},{key:"getSession",value:function(){if(M){var t=window.location.pathname.match(/^\/([^/]+)\/(.*)$/);if(t)return A=t[1],t[2]}else{var e=window.location.hash.match(/^#([^&]+)&?(.*)$/);if(e)return e[1].includes("=")?(T="".concat(e[1],"&").concat(e[2]),""):(T=e[2],e[1])}return"string"==typeof this.session?(T=window.location.hash.slice(1),this.session):""}},{key:"setSession",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==M&&this.getSession();var n=window.location,r=n.search,i=n.hash,o=M?"/".concat(A,"/").concat(t).concat(r).concat(i):"#".concat(t).concat(T?"&"+T:"");e?window.history.replaceState({},"",o):window.history.pushState({},"",o)}},{key:"isHost",value:function(t){var e=window.location.hostname;return e===t||"localhost"===t&&(!!e.endsWith(".ngrok.io")||["127.0.0.1","::1"].includes(e))}},{key:"isLocalhost",value:function(){return this.isHost("localhost")}}]),t}());function j(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var D=Date.now();"undefined"==typeof performance&&(window.performance={now:function(){return Date.now()-D}});var R=["simulate","update","render","snapshot"],q={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"},L=null,z=null,B=null,U=null;var F=[],H=0,V=!1,J=W(0);function W(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:V}}function $(t){for(J.total=t-J.start,F.push(J);F.length>Math.min(120,window.innerWidth);)F.shift();if(L&&"none"!==window.getComputedStyle(L).display){var e=F.slice(1).filter(function(t){return t.total}),n=e.map(function(t){return t.total}).reduce(function(t,e){return t+e},0)/e.length;Math.max.apply(Math,a(e.map(function(t){return Math.max(t.backlog,t.network)}))),H=1e3,z.parentElement||(console.warn("who broke the stats div and canvas?"),L.appendChild(z),L.appendChild(B)),z.innerText="".concat(J.users," users, ").concat(Math.round(1e3/n)," fps, ")+(J.backlog<100&&J.activity<1e3?"latency: ".concat(J.latency," ms"):"backlog: ".concat(J.backlog<100?"0.0":(J.backlog/1e3).toFixed(1)," s")),U.clearRect(0,0,B.width,B.height);for(var r=function(t){return 20*(1-t/(1e3/60))+60},i=function(t){return r(t/H*-2*(1e3/60))+5},o=0;o<F.length;o++){var s=F[o],c=o+.5,u=r(0);U.beginPath(),U.moveTo(c,u),U.lineTo(c,r(s.total)),U.strokeStyle=q[s.connected?"total":"network"],U.stroke(),U.beginPath(),U.moveTo(c,u),u=r(s.total);var l,h=0,d=j(R);try{for(d.s();!(l=d.n()).done;){var f=l.value;s.items[f]&&(h+=s.items[f],u=r(h),U.lineTo(c,u),U.strokeStyle=q[f],U.stroke(),U.beginPath(),U.moveTo(c,u))}}catch(t){d.e(t)}finally{d.f()}s.network&&(U.beginPath(),U.moveTo(c,i(0)),U.lineTo(c,i(s.network)),U.strokeStyle=q.network,U.stroke())}U.strokeStyle="rgba(255, 255, 255, 0.2)";for(var p=0;p<60;p+=1e3/60)U.moveTo(0,r(p)),U.lineTo(120,r(p)),U.stroke()}}var G=[],K={animationFrame:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(t),J=W(t);for(var n=0,r=Object.entries(e);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];this[a](s)}},begin:function(t){var e=performance.now();J.items[t]=(J.items[t]||0)-e;var n=G[G.length-1];return n&&(J.items[n]+=e),G.push(t),e},end:function(t){var e=performance.now();if(J.items[t]+=e,G.pop()!==t)throw Error("Unmatched stats calls for "+t);var n=G[G.length-1];return n&&(J.items[n]-=e),e},backlog:function(t){J.backlog=Math.max(t,J.backlog)},network:function(t){J.network=t},starvation:function(t){J.network=t},latency:function(t){J.latency=t},activity:function(t){J.activity=t},users:function(t){J.users=t},connected:function(t){J.connected=V=t}};function Z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Q,X,tt,et="ontouchstart"in document.documentElement,nt=et?20:12,rt=et?0:15;Q="\n        #croquet_dock { position: absolute; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 84px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all ".concat(.3,"s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n\n        .croquet_dock_button { position: absolute; width: ").concat(nt,"%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ").concat(2+rt+nt+2,"% }\n        #croquet_dock_right { right: ").concat(2+rt,"%; }\n        #croquet_dock_pin { right: ").concat(2,"%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: ").concat(2,"px; top: ").concat(2,"px; right: ").concat(2,"px; bottom: ").concat(2,"px; background: white; }\n        #croquet_dock:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; border: 6px solid white; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader:before,\n        #croquet_loader:after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader:before,\n        #croquet_loader:after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader:before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader:after { left: 3.5em; }\n"),(X=document.createElement("style")).innerHTML=Q,document.head.insertBefore(X,document.head.getElementsByTagName("style")[0]),(tt=document.createElement("style")).innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n",document.head.insertBefore(tt,document.head.getElementsByTagName("style")[0]);var it=new Set;function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&gt.showMessage(t,Y({},e,{level:"error"}))}function at(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&gt.showMessage(t,Y({},e,{level:"warning"}))}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&gt.showMessage(t,Y({},e,{level:"status"}))}function ct(t,e){console.error("Error during ".concat(t),e);var n=(e.stack||"").split("\n").filter(function(t){return!t.match(/croquet-.*\.min.js/)}).join("\n");gt.showMessage("<b>Error during ".concat(t,": ").concat(e.message,"</b>\n\n").concat(n).replace(/\n/g,"<br>"),{level:"error",duration:1e4,stopOnFocus:!0})}function ut(t,e){var n=gt.root;if(!1===n)return null;var r,i=Y({text:t,duration:3e3,gravity:"bottom",position:"left",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)",stopOnFocus:!0},e);return n instanceof Element&&n!==document.body?(r=n.id)||(n.id=r="_croquetToastParent"):"string"==typeof n&&(r=n),r&&(i.selector=r),l(i).showToast()}var lt,ht,dt=!1,ft=null;function pt(t,e,n){var r=document.createElement("canvas"),i=r.width=40*nt/12,o=r.height=60,a=r.getContext("2d");a.font="36px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(t,i/2,.55*o);var s=document.createElement("button");s.id=e,s.className="croquet_dock_button";var c=function(t){t.preventDefault(),t.stopPropagation(),n()};return et?s.ontouchstart=c:s.onclick=c,s.appendChild(r),s}function vt(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.firstChild;)t.removeChild(t.firstChild);return new x(t,Y({text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:x.CorrectLevel.L},n))}var yt=0;function mt(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){var n=document.getElementById(t);if(n)return n}return e?e():null}var gt={sessionURL:window.location.href,root:document.body,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!I.nodock){var e=document.getElementById("croquet_dock");e&&e.parentElement.removeChild(e);var n=mt(gt.root);if(n){var r=document.createElement("div");r.id="croquet_dock",n.appendChild(r);var i,o=document.createElement("div");o.id="croquet_dock_bar",r.appendChild(o),!1!==t.badge&&((i=document.createElement("div")).id="croquet_badge",o.appendChild(i),gt.badge=i);var a=document.createElement("div");a.id="croquet_dock_content",r.appendChild(a);var s,c,u=[];if(!1!==t.qrcode){var l=gt.sessionURL;l&&((s=document.createElement("div")).id="croquet_qrcode",a.appendChild(s),u.push(s.id),gt.qrcode=s)}if(!1!==t.stats&&((c=document.createElement("div")).id="croquet_stats",a.appendChild(c),u.push(c.id),gt.stats=c),u.length){var h=function(t){var e,n=u.length,r=0;if(ft){var i=u.indexOf(ft);i>=0?(r=i,e=document.getElementById(ft)):ft=null}var o,a=u[(r+n+t)%n];a===ft?o=e:(e&&e.classList.remove("active"),o=document.getElementById(a)),o&&o.classList.add("active"),ft=a};u.length>1&&(o.appendChild(pt("<","croquet_dock_left",function(){return h(-1)})),o.appendChild(pt(">","croquet_dock_right",function(){return h(1)}))),h(0)}if(!et){var d=pt("","croquet_dock_pin",function(){dt=!dt,f()}),f=function(){dt?d.classList.add("pinned"):d.classList.remove("pinned")};f(),o.appendChild(d)}var p=200,v=166,y=8,m=function(t){r.style.width="".concat(t,"px"),r.style.height="".concat(1.18*t,"px");var e=18*t/100;o.style.height="".concat(e,"px"),a.style.top="".concat(e+2,"px"),i&&(i.style.height="".concat(.9*e,"px"),i.style.width="".concat(.9*e*3,"px")),s&&(s.style.border="".concat(y*t/p,"px solid white"))},g=function(){r.style.width=r.style.height="",o.style.height="",a.style.top="",i&&(i.style.height=i.style.width=""),s&&(s.style.border="")},b=p,w=function(){return r.classList.contains("active")},_=function(){r.classList.add("active"),m(b),setTimeout(function(){return r.style.transition="none"},300)},k=function(){r.style.transition="",r.classList.remove("active"),g()};if(et)k(),r.ontouchstart=function(t){t.preventDefault(),t.stopPropagation(),w()?k():_()};else{dt?_():k();var S=0;r.onwheel=function(t){t.preventDefault(),t.stopPropagation();var e=Date.now();if(!(e-S<100)){S=e;var n=t.deltaY;n=Math.sign(n)*Math.min(5,Math.abs(n));var i=.8*Math.min(window.innerWidth,window.innerHeight);b=Math.max(v,Math.min(i,r.offsetWidth*Math.pow(1.05,n))),m(b)}},r.onmouseenter=_,r.onmouseleave=function(){dt||k()}}}}},makeSessionWidgets:function(t){!function(t){if(t&&!1!==gt.root){var e=mt(gt.badge);e&&function(t,e){if(!1!==gt.badge){var n=function(t){for(var e=new h(t),n=["bcdfghjklmnpqrstvwxyz","aeiou"],r="",i=0;i<5;i++)r+=n[i%2][e.quick()*n[i%2].length|0];return r}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+n;t.firstChild;)t.removeChild(t.firstChild);var r=document.createElement("canvas"),i=r.width=120,o=r.height=40;r.style.width="100%",t.appendChild(r);var a=r.getContext("2d"),s=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new h(t),r=[],i=0;i<e;i++)r.push("hsl(".concat(360*n.quick(),", 50%, 70%)"));return r}(e,2);a.fillStyle=s[0],a.beginPath(),a.moveTo(0,0),a.lineTo(0,o),a.lineTo(i,0),a.closePath(),a.fill(),a.fillStyle=s[1],a.beginPath(),a.moveTo(i,o),a.lineTo(i,0),a.lineTo(0,o),a.closePath(),a.fill(),a.font="30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(n,i/2,o/2)}}(e,t)}}(t),function(){if(!1!==gt.root&&!1!==gt.qrcode&&!I.noqr){var t=gt.sessionURL;if(t){var e=mt(gt.qrcode);e&&(et||(e.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.open(t)}),vt(e,t).getCanvas().style.width="100%")}else console.warn("App.sessionURL is not set")}}(),function(){if(!1!==gt.root&&!I.nostats){var t=mt(gt.stats);t&&function(t){for(L=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",(z=document.createElement("div")).id="text_stats",z.style.padding=5,z.style.background="rgba(255,255,255,0.2)",z.style.fontFamily="sans-serif",t.appendChild(z),t.title=Object.entries(q).map(function(t){var e=o(t,2),n=e[0],r=e[1];return"".concat(r,": ").concat(n)}).join("\n"),(B=document.createElement("canvas")).width=Math.min(125,window.innerWidth)*window.devicePixelRatio,B.height=125*window.devicePixelRatio,B.style.width="100%",t.appendChild(B),(U=B.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio)}(t)}}()},makeQRCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!gt.sessionURL)return null;var e=document.createElement("div"),n=vt(e,gt.sessionURL,t);return n&&n.getCanvas()},clearSessionMoniker:function(){!1!==gt.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait:function(t){!1===gt.root&&(t=!1),function(t){if(ht!==t)if(!1===gt.sync&&(t=!1),t&&!lt&&(lt=function(){var t=document.createElement("div");t.id="croquet_spinnerOverlay";var e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}()),ht=t,t)clearTimeout(yt),yt=setTimeout(function(){ht&&(mt(gt.root,function(){return document.body}).appendChild(lt),lt.style.opacity=.9)},500);else{if(!lt)return;clearTimeout(yt),lt.style.opacity=0,yt=setTimeout(function(){ht||lt.parentElement&&lt.parentElement.removeChild(lt)},500)}}(t)},messageFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("once"===e.only){if(it.has(t))return null;it.add(t)}var n,r=e.level;return"error"===r?(n="red",console.error(t)):"warning"===r?(n="gold",console.warn(t)):n="#aaa",ut(t,Y({backgroundColor:n},e))},showMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return I.nomessages||!1===gt.root||!1===gt.messages||!gt.messageFunction?null:gt.messageFunction(t,e)}};function bt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={};try{r=JSON.parse(localStorage.croquetUser||"{}")}catch(t){}return t in r?r[t]:n?(r[t]=n(),r[t]!==e&&(localStorage.croquetUser=JSON.stringify(r)),r[t]):e}function wt(){return function(){return c(i.mark(function t(){return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!I.nologin){t.next=2;break}return t.abrupt("return",!1);case 2:if(!bt("name")||I.user){t.next=4;break}return t.abrupt("return",!0);case 4:return t.abrupt("return",new Promise(function(t){var e=document.createElement("style");e.innerHTML='\n            .overlay {\n                z-index: 1010;\n                position: fixed;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                background-color:#333;\n                opacity:0.9;\n                display:flex;\n                align-items:center;\n                justify-content:center\n            }\n            form {\n                background-color: #fff;\n                color: #666;\n                border-radius: 10px;\n                padding: 16px;\n                font-size: 14px;\n            }\n            form dt { margin: 4px 0 }\n            form dd { margin-left: 0 }\n            form input {\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                min-height: 46px;\n                padding: 10px;\n                font-size: 16px;\n                width: 100%;\n                box-shadow: inset 0 1px 2px #666;\n            }\n            form input:invalid { border: 1px solid red; }\n            form input:valid   { border: 1px solid #ccc; }\n            form button {\n                padding: 20px 32px;\n                background-color: #3b5;\n                color: #fff;\n                border-radius: 50px;\n                border-width:0;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n            }\n            .error {\n                visibility: hidden;\n                width: 250px;\n                background-color: #fcc;\n                color: #900;\n                padding: 5px;\n                border-radius: 6px;\n                border: 1px solid #c99;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n            .error::after {\n                content: " ";\n                position: absolute;\n                bottom: 100%;  /* At the top of message */\n                left: 10px;\n                border-width: 5px;\n                border-style: solid;\n                border-color: transparent transparent #c99 transparent;\n            }\n            .notice {\n                visibility: hidden;\n                width: 270px;\n                height: 70px;\n                background-color: #fff;\n                padding: 5px;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n        ',document.head.appendChild(e);var n=document.createElement("form");n.innerHTML='\n            <dl>\n                <dt><label for="user[name]">Username</label></dt>\n                <dd>\n                    <input type="text" required pattern="^[a-zA-Z0-9_]*$" minlength="2" maxlength="15" name="user[name]" id="user[name]" placeholder="Enter a username" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n                <dd class="notice"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[email]">Email</label></dt>\n                <dd>\n                    <input type="email" required id="user[email]" placeholder="you@example.com" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[password]">Password</label></dt>\n                <dd>\n                    <input type="password" required minlength="8" id="user[password]" placeholder="Create a password" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <button id="user[create]">Sign up / Log in</button>\n            <div style="margin:16px auto;text-align: center"> OR </div>\n            <button id="user[guest]" style="background-color: #999">Continue as Croquet Guest</button>\n            <div style="max-width:280px;text-align: center;font-size:11px;margin:4px auto">\n                Continuing from this screen to our website indicates that you agree to our\n                <a href="/terms.html" target="_blank" style="color:#36c;text-decoration:none">terms of service</a>\n                and\n                <a href="/privacy.html" target="_blank" style="color:#36c;text-decoration:none">privacy statement</a>.\n            </div>\n        ';var r=document.createElement("div");r.classList.add("overlay"),r.appendChild(n),document.body.appendChild(r);var a=n.getElementsByTagName("input"),s=o(a,3),u=s[0],l=s[1],h=s[2],d=n.getElementsByClassName("error"),f=o(d,3),p=f[0],v=f[1],y=f[2],m=n.getElementsByClassName("notice"),g=o(m,1)[0],b=n.getElementsByTagName("button"),w=o(b,2),_=w[0],k=w[1];"string"==typeof I.user?u.value=I.user:bt("name")&&(u.value=bt("name"));var S=0;u.oninput=function(){clearTimeout(S),S=setTimeout(function(){return M()},300)},P(!0),u.oninput();var x=0;l.oninput=function(){clearTimeout(x),x=setTimeout(function(){return A()},300)};var C=0;function E(){n.reset(),document.head.removeChild(e),document.body.removeChild(r)}function O(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".json";return"".concat(Ct(),"/user/").concat(t.toLowerCase(),"/").concat(e).concat(n)}function M(){return function(){return c(i.mark(function t(){var e,n,r,o,a,s=arguments;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]&&s[0],p.style.visibility="hidden",e||P(!0),(n=u.value.trim())||e){t.next=6;break}return t.abrupt("return",!1);case 6:if(!u.validity.tooShort&&!u.validity.tooLong){t.next=10;break}return p.innerHTML="Your username must be between ".concat(u.minLength," and ").concat(u.maxLength," characters long."),p.style.visibility="visible",t.abrupt("return",!1);case 10:if(!u.validity.patternMismatch){t.next=14;break}return p.innerHTML="Your username can only contain alphanumeric characters (letters A-Z, numbers 0-9) and underscores.",p.style.visibility="visible",t.abrupt("return",!1);case 14:return t.prev=14,r=S,t.next=18,fetch(O(n,"salt"),{mode:"cors"});case 18:if(o=t.sent,r===S||e){t.next=21;break}return t.abrupt("return",!1);case 21:if(!o.ok){t.next=27;break}return e||P(!1),t.next=25,o.json();case 25:return a=t.sent,t.abrupt("return",{name:n,salt:Tt(a.salt)});case 27:t.next=31;break;case 29:t.prev=29,t.t0=t.catch(14);case 31:return t.abrupt("return",{name:n});case 32:case"end":return t.stop()}},t,null,[[14,29]])})).apply(this,arguments)}.apply(this,arguments)}function A(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v.style.visibility="hidden";var e=l.value.trim();return!(!e&&!t)&&(l.validity.valid?e:(v.innerHTML="Please enter a valid email address.",v.style.visibility="visible",!1))}function T(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.style.visibility="hidden";var e=h.value;return!(!e&&!t)&&(h.validity.tooShort?(y.innerHTML="Your password must be at least ".concat(h.minLength," characters long."),y.style.visibility="visible",!1):e)}function P(t){var e=u.value.trim();g.innerHTML="".concat(e," is already registered as a user.<br><br>\n                If this is you, please enter your password below to continue.\n                Otherwise, please pick a different name."),g.style.visibility=t?"hidden":"visible",l.disabled=!t,h.placeholder=e?t?"Create a password for ".concat(e,""):"Enter password for ".concat(e,""):"Enter a password",_.innerHTML=e?t?"Sign up as ".concat(e,""):"Log in as ".concat(e,""):"Sign up / Log in"}h.oninput=function(){clearTimeout(C),C=setTimeout(function(){return T()},300)},_.onclick=function(){var e=c(i.mark(function e(n){var r,o,a,s,c,u,l,h,d,f,p,v,m;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,M(!0);case 3:if(r=e.sent,o=r.name,a=r.salt,s=!!a||A(!0),c=T(!0),o&&s&&c){e.next=10;break}return e.abrupt("return");case 10:return(u=a)||(u=crypto.getRandomValues(new Uint8Array(8)),fetch(O(o,"salt"),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({salt:Pt(u)})})),e.next=14,window.crypto.subtle.importKey("raw",(new TextEncoder).encode(c),{name:"PBKDF2"},!1,["deriveBits"]);case 14:return l=e.sent,e.next=17,window.crypto.subtle.deriveBits({name:"PBKDF2",salt:u,iterations:5e5,hash:"SHA-256"},l,256);case 17:if(h=e.sent,d=Pt(h),!a){e.next=40;break}return e.prev=20,e.next=23,fetch(O(o,d),{mode:"cors"});case 23:if((f=e.sent).ok){e.next=26;break}throw Error("wrong password");case 26:return e.next=28,f.json();case 28:p=e.sent,console.log("Logged in as ".concat(p.name," <").concat(p.email,">")),localStorage.croquetUser=JSON.stringify(p),e.next=38;break;case 33:return e.prev=33,e.t0=e.catch(20),y.innerHTML="Wrong password for ".concat(o,""),y.style.visibility="visible",e.abrupt("return");case 38:e.next=45;break;case 40:v=crypto.getRandomValues(new Uint8Array(16)),m={name:o,email:s,salt:Pt(u),secret:Pt(v)},localStorage.croquetUser=JSON.stringify(m),fetch(O(o,d),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),console.log("Signed up as ".concat(m.name," <").concat(m.email,">"));case 45:E(),t(!0);case 47:case"end":return e.stop()}},e,null,[[20,33]])}));return function(t){return e.apply(this,arguments)}}(),k.onclick=function(e){e.preventDefault(),delete localStorage.croquetUser,E(),t(!1)}}));case 5:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}function _t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xt=window.location.hostname.endsWith("croquet.io")?window.location.host:"croquet.io";function Ct(){var t="string"==typeof I.files?I.files:"https://".concat(xt,"/files/v1");return t.endsWith("/")?t.slice(0,-1):t}function Et(){return e.bundle?e.bundle.modules:[]}function Ot(){return Object.keys(Et()).filter(function(t){return!t.endsWith("hmr-runtime.js")})}function Mt(t){return Et()[t]}function At(t){var e,n,r;return n=(e=""+Mt(t)[0]).indexOf("{"),r=e.lastIndexOf("}"),e.slice(n+1,r).trim()}function Tt(t){return new Uint8Array(atob(t.padEnd(t.length+3&-4,"=").replace(/-/g,"+").replace(/_/g,"/")).split("").map(function(t){return t.charCodeAt(0)}))}function Pt(t){return btoa(String.fromCharCode.apply(String,a(new Uint8Array(t)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function It(t){return function(){return c(i.mark(function t(e){var n;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return","47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU");case 2:return t.next=4,window.crypto.subtle.digest("SHA-256",e);case 4:return n=t.sent,t.abrupt("return",Pt(n));case 6:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}function jt(){return I.has("debug","hashing",!1)}window.crypto&&window.crypto.subtle&&"function"==typeof window.crypto.subtle.digest||console.error("ERROR: crypto.subtle.digest() browser API not available. Please access this page via https or localhost.");var Nt={},Dt={was_initialized:!1};function Rt(t){return Dt.was_initialized||function(){var t,e=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return St(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?St(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(Ot());try{for(e.s();!(t=e.n()).done;)for(var n=t.value,r=0,i=Object.entries(Mt(n)[1]);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1],u=Dt[c]||"",l=s.replace(/^[./]*/,"");l.length>u.length&&(Dt[c]=l)}}catch(t){e.e(t)}finally{e.f()}Dt.was_initialized=!0}(),Dt[t]||t}var qt=new TextEncoder;function Lt(t){return function(){return c(i.mark(function t(e){var n,r;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=qt.encode(e),t.next=3,It(n);case 3:return r=t.sent,jt()&&(Nt[r]={string:e,buffer:n}),t.abrupt("return",r);case 6:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}var zt={};function Bt(t){return function(){return c(i.mark(function t(e){var n,r;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!zt[e]){t.next=2;break}return t.abrupt("return",zt[e]);case 2:return n=At(e).replace(/\s+/g," "),t.next=5,Lt(n);case 5:return r=t.sent,jt()&&(Nt[r].name="Module ".concat(Rt(e))),t.abrupt("return",zt[e]=r);case 8:case"end":return t.stop()}},t)})).apply(this,arguments)}.apply(this,arguments)}var Ut=[];function Ft(t){var e=Lt(function(t){var e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}"),i=e.slice(0,n).replace(/\s+/g," ").trim(),o=e.slice(n+1,r).trim();return"".concat(i," {\n").concat(o,"}")}(t));e.then(function(e){console.log("hashing class ".concat(t.name,": ").concat(e)),jt()&&(Nt[e].name="Class ".concat(t.name))}),Ut.push(e)}function Ht(t,e){return Vt.apply(this,arguments)}function Vt(){return(Vt=c(i.mark(function t(e,n){var r,o,s,c,u;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="production"===k?[]:Ot().filter(function(t){var e=t.endsWith("/package.json")||t.endsWith("/ar.js");return e&&console.warn("excluding ".concat(t," from code hash")),!e}).sort(),t.next=4,Promise.all([].concat(a(r.map(Bt)),Ut));case 4:return o=t.sent,t.next=7,Lt([n].concat(a(o)).join("|"));case 7:return s=t.sent,t.next=10,Lt([e,s].join("|"));case 10:return c=t.sent,jt()&&(Nt[s].name="All code",Nt[c].name="Session name and code",u=[].concat(a(o),[s,c]).map(function(t){return kt({hash:t},Nt[t])}),console.log("Debug Hashing for session ".concat(c),u)),t.abrupt("return",{hash:c,codeHash:s});case 13:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Wt=function(){function t(){d(this,t),this.values=[],this.resolves=[]}var e;return f(t,[{key:"next",value:(e=c(i.mark(function t(){var e=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.values.length>0)){t.next=2;break}return t.abrupt("return",this.values.shift());case 2:return t.abrupt("return",new Promise(function(t){return e.resolves.push(t)}));case 3:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"put",value:function(t){var e=this.resolves.shift();e?e(t):this.values.push(t)}},{key:"putAll",value:function(t){var e,n=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jt(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.put(r)}}catch(t){n.e(t)}finally{n.f()}}},{key:"peek",value:function(){return this.values[0]}},{key:"nextNonBlocking",value:function(){return this.values.shift()}},{key:"allNonBlocking",value:function(){if(0===this.values.length)return[];var t=this.values;return this.values=[],t}},{key:"size",get:function(){return this.values.length-this.resolves.length}}]),t}();function $t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}var Gt=function(t){y(r,b);var e,n=(e=r,function(){var t,n=g(e);if($t()){var r=g(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return m(this,t)});function r(){return d(this,r),n.apply(this,arguments)}return f(r,[{key:"poll",value:function(){var t=v(g(r.prototype),"poll",this).call(this);return this.array[this.size]=null,t}},{key:"asArray",value:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t}},{key:"asUnsortedArray",value:function(){return this.array.slice(0,this.size)}}]),r}();function Kt(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zt(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yt(t,e){function n(t){var n,r=Kt(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.for===e&&t.delete(i)}}catch(t){r.e(t)}finally{r.f()}}return n(t.immediate),n(t.oncePerFrame),n(t.oncePerFrameWhileSynced),n(t.queued),t.immediate.size+t.queued.size+t.oncePerFrame.size+t.oncePerFrameWhileSynced.size}var Qt=new(function(){function t(){d(this,t),this.subscriptions={},this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.id=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}),this.lastId=0}return f(t,[{key:"register",value:function(t){return this.id+"/V"+ ++this.lastId}},{key:"deregister",value:function(t){}},{key:"addSubscription",value:function(t,e,n,r,i){if("vote"!==i){var o=t+":"+e,a=r;a.for=n;var s=this.subscriptions[o];if(s||(s=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!s[i])throw Error('Unknown subscribe() option: handling="'.concat(i,'"'));s[i].add(a)}else this.addSubscription(t,e+"#__vote",n,r,"immediate")}},{key:"removeSubscription",value:function(t,e,n){var r=t+":"+e,i=this.subscriptions[r];i&&0===Yt(i,n)&&delete this.subscriptions[r],e.endsWith("#__vote")||this.removeSubscription(t,e+"#__vote",n)}},{key:"removeAllSubscriptionsFor",value:function(t){for(var e="".concat(t,":"),n=0,r=Object.entries(this.subscriptions);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];a.startsWith(e)?delete this.subscriptions[a]:0===Yt(s,t)&&delete this.subscriptions[a]}}},{key:"handleEvent",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t()},r=this.subscriptions[t];r&&(r.queued.size>0&&this.queuedEvents.push({topic:t,data:e}),r.oncePerFrame.size>0&&this.perFrameEvents.set(t,e),r.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(t,e),r.immediate.size>0&&n(function(){var t,n=Kt(r.immediate);try{for(n.s();!(t=n.n()).done;)(0,t.value)(e)}catch(t){n.e(t)}finally{n.f()}}))}},{key:"processFrameEvents",value:function(t){var e,n=this,r=0,i=function(t,e,i){var o=n.subscriptions[t];if(o){var a,s=Kt(o[i]);try{for(s.s();!(a=s.n()).done;)(0,a.value)(e),r++}catch(t){s.e(t)}finally{s.f()}}},a=Kt(this.queuedEvents);try{for(a.s();!(e=a.n()).done;){var s=e.value;i(s.topic,s.data,"queued")}}catch(t){a.e(t)}finally{a.f()}this.queuedEvents.length=0;var c,u=Kt(this.perFrameEvents);try{for(u.s();!(c=u.n()).done;){var l=o(c.value,2);i(l[0],l[1],"oncePerFrame")}}catch(t){u.e(t)}finally{u.f()}if(this.perFrameEvents.clear(),t){var h,d=Kt(this.perSyncedFrameEvents);try{for(d.s();!(h=d.n()).done;){var f=o(h.value,2);i(f[0],f[1],"oncePerFrameWhileSynced")}}catch(t){d.e(t)}finally{d.f()}this.perSyncedFrameEvents.clear()}var p,v=Kt(this.queuedEvents);try{for(v.s();!(p=v.n()).done;){var y=p.value;i(y.topic,y.data,"queued")}}catch(t){v.e(t)}finally{v.f()}return this.queuedEvents.length=0,r}}]),t}()),Xt={get subscribe(){return(Xt={subscribe:I.has("debug","subscribe",!1)}).subscribe}},te=function(){function t(e){d(this,t),this.island=e}return f(t,[{key:"register",value:function(t){return this.island.registerModel(t)}},{key:"deregister",value:function(t){this.island.deregisterModel(t.id)}},{key:"publish",value:function(t,e,n){this.island.publishFromModel(n,t,e)}},{key:"subscribe",value:function(t,e,n,r){return Xt.subscribe&&console.log('Model.subscribe("'.concat(e,":").concat(n,'", ').concat(t," ").concat((""+r).replace(/\([\s\S]*/,""),")")),this.island.addSubscription(t,e,n,r)}},{key:"unsubscribe",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";Xt.subscribe&&console.log("Model.unsubscribe(".concat(e,":").concat(n,'", ').concat(t," ").concat((""+r).replace(/\([\s\S]*/,""),")")),this.island.removeSubscription(t,e,n,r)}},{key:"unsubscribeAll",value:function(t){Xt.subscribe&&console.log("Model.unsubscribeAll(".concat(t," ").concat(t.id,")")),this.island.removeAllSubscriptionsFor(t)}},{key:"future",value:function(t,e,n,r){if(ne&&ne.equal(this))return this.island.future(t,e,n,r);if(e)throw Error("tOffset not supported from cross-realm future send yet.");var i=this.island;return new Proxy(t,{get:function(e,n){if("function"==typeof t[n])return new Proxy(t[n],{apply:function(e,r,o){i.callModelMethod(t.id,n,o)}});throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}},{key:"random",value:function(){return this.island.random()}},{key:"now",value:function(){return this.island.time}},{key:"equal",value:function(e){return e instanceof t&&e.island===this.island}}]),t}(),ee=function(){function t(e){d(this,t),this.island=e}return f(t,[{key:"register",value:function(t){return Qt.register(t)}},{key:"deregister",value:function(t){Qt.deregister(t)}},{key:"publish",value:function(t,e,n){this.island.publishFromView(n,t,e)}},{key:"subscribe",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"queued";Xt.subscribe&&console.log('View.subscribe("'.concat(r,":").concat(t,'", ').concat(e," ").concat(n.name||(""+n).replace(/\([\s\S]*/,"")," [").concat(i,"])")),Qt.addSubscription(r,t,e,n,i)}},{key:"unsubscribe",value:function(t,e,n,r){Xt.subscribe&&console.log('View.unsubscribe("'.concat(r,":").concat(t,'", ').concat(e," ").concat(n.name||(""+n).replace(/\([\s\S]*/,""),")")),Qt.removeSubscription(r,t,e,n)}},{key:"unsubscribeAll",value:function(t){Xt.subscribe&&console.log("View.unsubscribeAll(".concat(t,")")),Qt.removeAllSubscriptionsFor(t)}},{key:"future",value:function(t,e){return e?new Proxy(t,{get:function(n,r){if("function"==typeof t[r])return new Proxy(t[r],{apply:function(n,i,o){setTimeout(function(){t.id&&t[r].apply(t,a(o))},e)}});throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}}):t}},{key:"random",value:function(){return Math.random()}},{key:"now",value:function(){return this.island.time}},{key:"externalNow",value:function(){return this.island.controller.time}},{key:"isSynced",value:function(){return!!this.island.controller.synced}},{key:"equal",value:function(e){return e instanceof t&&e.island===this.island}}]),t}(),ne=null;function re(){if(!ne)throw Error("Tried to execute code that requires realm outside of realm.");return ne}function ie(t,e){if(null!==ne)throw Error("Can't switch realms from inside realm");try{return ne=new te(t),e()}finally{ne=null}}function oe(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==ne&&!n)throw Error("Can't switch realms from inside realm");var r=ne;try{return ne=new ee(t),e()}finally{ne=r}}function ae(t){return function(){var e,n=g(t);if(se()){var r=g(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return m(this,e)}}function se(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function ce(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(){var t,e=function(t){return t!=t},n=Math.sqrt,r=.7853981633974483,i=function(t){var i,o,a,s,c;if(e(t))return NaN;if(t>0?a=t:(i=!0,a=-t),a>1)return NaN;if(a>.625)s=(o=1-a)*function(t){var e,n;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),n=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),n=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/n)}(o),o=n(o+o),c=r-o,c-=o=o*s-6.123233995736766e-17,c+=r;else{if(a<1e-8)return t;c=a*(c=(o=a*a)*function(t){var e,n;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,n=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),n=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/n)}(o))+a}return i?-c:c},o="function"==typeof Symbol&&"symbol"==s(Symbol("foo")),a=Object.prototype.toString,c=Object.prototype.hasOwnProperty,u="function"==typeof Symbol?Symbol.toStringTag:"",l={};t=o&&"symbol"==s(Symbol.toStringTag)?function(t){var e,n,r;if(null==t)return a.call(t);n=t[u],e=function(t,e){return null!=t&&c.call(t,e)}(t,u);try{t[u]=void 0}catch(e){return a.call(t)}return r=a.call(t),e?t[u]=n:delete t[u],r}:function(t){return a.call(t)},l=t;var h="function"==typeof Uint32Array,d="function"==typeof Uint32Array?Uint32Array:null,f="function"==typeof Uint32Array?Uint32Array:null,p={};p=function(){var t,e;if("function"!=typeof d)return!1;try{t=function(t){return h&&t instanceof Uint32Array||"[object Uint32Array]"===l(t)}(e=new d(e=[1,3.14,-3.14,4294967296,4294967297]))&&1===e[0]&&3===e[1]&&4294967293===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?f:function(){throw new Error("not implemented")};var v="function"==typeof Float64Array,y="function"==typeof Float64Array?Float64Array:null,m="function"==typeof Float64Array?Float64Array:null,g={};g=function(){var t,e;if("function"!=typeof y)return!1;try{t=function(t){return v&&t instanceof Float64Array||"[object Float64Array]"===l(t)}(e=new y([1,3.14,-3.14,NaN]))&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t}()?m:function(){throw new Error("not implemented")};var b,w="function"==typeof Uint8Array,_="function"==typeof Uint8Array?Uint8Array:null,k="function"==typeof Uint8Array?Uint8Array:null;b=function(){var t,e;if("function"!=typeof _)return!1;try{t=function(t){return w&&t instanceof Uint8Array||"[object Uint8Array]"===l(t)}(e=new _(e=[1,3.14,-3.14,256,257]))&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?k:function(){throw new Error("not implemented")};var S,x="function"==typeof Uint16Array,C="function"==typeof Uint16Array?Uint16Array:null,E="function"==typeof Uint16Array?Uint16Array:null,O={uint16:function(){var t,e;if("function"!=typeof C)return!1;try{t=function(t){return x&&t instanceof Uint16Array||"[object Uint16Array]"===l(t)}(e=new C(e=[1,3.14,-3.14,65536,65537]))&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?E:function(){throw new Error("not implemented")},uint8:b};(S=new O.uint16(1))[0]=4660;var M,A=52===new O.uint8(S.buffer)[0];M=!0===A?1:0;var T,P=new g(1),I=new p(P.buffer),j=function(t){return P[0]=t,I[M]};T=!0===A?1:0;var N,D,R,q=new g(1),L=new p(q.buffer),z=function(t,e){return q[0]=t,L[T]=e>>>0,q[0]},B=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,F=.6931471803691238,H=1.9082149292705877e-10,V=function(t){var n,r,i,o,a,s,c,u,l,h;if(t<-1||e(t))return NaN;if(-1===t)return U;if(t===B)return t;if(0===t)return t;if(h=1,(i=t<0?-t:t)<.41421356237309503){if(i<1.862645149230957e-9)return i<5.551115123125783e-17?t:t-t*t*.5;t>-.2928932188134525&&(h=0,o=t,r=1)}return 0!==h&&(i<9007199254740992?(a=(h=((r=j(l=1+t))>>20)-1023)>0?1-(l-t):t-(l-1),a/=l):(h=((r=j(l=t))>>20)-1023,a=0),(r&=1048575)<434334?l=z(l,1072693248|r):(h+=1,l=z(l,1071644672|r),r=1048576-r>>2),o=l-1),n=.5*o*o,0===r?0===o?h*F+(a+=h*H):h*F-((u=n*(1-.6666666666666666*o))-(h*H+a)-o):(u=(c=(s=o/(2+o))*s)*(0===c?.6666666666666735:.6666666666666735+c*(.3999999999940942+c*(.2857142874366239+c*(.22222198432149784+c*(.1818357216161805+c*(.15313837699209373+.14798198605116586*c)))))),0===h?o-(n-s*(n+u)):h*F-(n-(s*(n+u)+(h*H+a))-o))},J=.6931471805599453,W=1.9082149292705877e-10,$=function(t){var n,r,i,o,a,s,c,u,l,h;return 0===t?U:e(t)||t<0?NaN:(o=0,(r=j(t))<1048576&&(o-=54,r=j(t*=0x40000000000000)),r>=2146435072?t+t:(o+=(r>>20)-1023|0,o+=(c=614244+(r&=1048575)&1048576|0)>>20|0,s=(t=z(t,r|1072693248^c))-1,(1048575&2+r)<3?0===s?0===o?0:.6931471803691238*o+o*W:(a=s*s*(.5-.3333333333333333*s),0===o?s-a:.6931471803691238*o-(a-o*W-s)):(c=r-398458|0,i=(l=(h=(u=s/(2+s))*u)*h)*(0===l?.3999999999940942:.3999999999940942+l*(.22222198432149784+.15313837699209373*l)),a=h*(0===l?.6666666666666735:.6666666666666735+l*(.2857142874366239+l*(.1818357216161805+.14798198605116586*l)))+i,(c|=440401-r|0)>0?(n=.5*s*s,0===o?s-(n-u*(n+a)):.6931471803691238*o-(n-(u*(n+a)+o*W)-s)):0===o?s-u*(s-a):.6931471803691238*o-(u*(s-a)-o*W-s))))},G=function(t){return t===B||t===U},K=1.5707963267948966,Z=function(t){var n,i,o,a;return e(t)||0===t?t:t===B?K:t===U?-K:(t<0&&(i=!0,t=-t),n=0,t>2.414213562373095?(o=K,n=1,t=-1/t):t<=.66?o=0:(o=r,n=2,t=(t-1)/(t+1)),a=t*(a=(a=t*t)*(0===a?-64.85021904942025:a*(a*(a*(-.8750608600031904*a-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025)/(0===a?194.5506571482614:194.5506571482614+a*(485.3903996359137+a*(432.88106049129027+a*(165.02700983169885+a*(24.858464901423062+1*a))))))+t,2===n?a+=3.061616997868383e-17:1===n&&(a+=6.123233995736766e-17),o+=a,i?-o:o)};!0===A?(D=1,R=0):(D=0,R=1),N={HIGH:D,LOW:R};var Y,Q,X,tt=new g(1),et=new p(tt.buffer),nt=N.HIGH,rt=N.LOW,it=function(t,e){return tt[0]=e,t[0]=et[nt],t[1]=et[rt],t},ot=function(t,e){return 1===arguments.length?it([0,0],t):it(t,e)};!0===A?(Q=1,X=0):(Q=0,X=1),Y={HIGH:Q,LOW:X};var at,st=new g(1),ct=new p(st.buffer),ut=Y.HIGH,lt=Y.LOW,ht=function(t,e){return ct[ut]=t,ct[lt]=e,st[0]},dt=[0,0],ft=function(t,e){var n,r;return ot(dt,t),n=dt[0],n&=2147483647,r=j(e),ht(n|=r&=2147483648,dt[1])},pt=3.141592653589793,vt=function(t,e){var n,r,i,o;return i=(o=t*t)*o,r=o*(0===o?.0416666666666666:.0416666666666666+o*(2480158728947673e-20*o-.001388888888887411)),r+=i*i*(0===o?-2.7557314351390663e-7:o*(2.087572321298175e-9+-1.1359647557788195e-11*o)-2.7557314351390663e-7),(i=1-(n=.5*o))+(1-i-n+(o*r-t*e))},yt=-.16666666666666632,mt=function(t,e){var n,r,i;return n=.00833333333332249+(i=t*t)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),r=i*t,0===e?t+r*(yt+i*n):t-(i*(.5*e-r*n)-e-r*yt)};at=!0===A?0:1;var gt=new g(1),bt=new p(gt.buffer),wt=Math.floor,_t=function(t){return t<0?-t:0===t?0:t},kt=function(t,n){return e(n)||G(n)?(t[0]=n,t[1]=0,t):0!==n&&_t(n)<2.2250738585072014e-308?(t[0]=4503599627370496*n,t[1]=-52,t):(t[0]=n,t[1]=0,t)},St=[0,0],xt=[0,0],Ct=function(t,n){var r,i;return 0===t||e(t)||G(t)?t:(function(t,e){1===arguments.length?kt([0,0],t):kt(t,e)}(St,t),n+=St[1],(n+=function(t){var e=j(t);return(e=(2146435072&e)>>>20)-1023|0}(t=St[0]))<-1074?ft(0,t):n>1023?t<0?U:B:(n<=-1023?(n+=52,i=2.220446049250313e-16):i=1,ot(xt,t),r=xt[0],r&=2148532223,i*ht(r|=n+1023<<20,xt[1])))},Et=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Ot=[1.570796251296997,7.549789415861596e-8,5.390302529957765e-15,3.282003415807913e-22,1.270655753080676e-29,1.2293330898111133e-36,2.7337005381646456e-44,2.1674168387780482e-51],Mt=5.960464477539063e-8,At=jt(new Array(20)),Tt=jt(new Array(20)),Pt=jt(new Array(20)),It=jt(new Array(20));function jt(t){var e,n=t.length;for(e=0;e<n;e++)t[e]=0;return t}var Nt,Dt=Math.round,Rt=function(t,e,n){var r,i,o,a,s;return o=t-1.5707963267341256*(r=Dt(.6366197723675814*t)),a=6.077100506506192e-11*r,s=e>>20|0,n[0]=o-a,s-(j(n[0])>>20&2047)>16&&(a=2.0222662487959506e-21*r-((i=o)-(o=i-(a=6.077100506303966e-11*r))-a),n[0]=o-a,s-(j(n[0])>>20&2047)>49&&(a=8.4784276603689e-32*r-((i=o)-(o=i-(a=2.0222662487111665e-21*r))-a),n[0]=o-a)),n[1]=o-n[0]-a,r},qt=1.5707963267341256,Lt=6.077100506506192e-11,zt=2*Lt,Bt=4*Lt,Ut=new Array(3),Ft=new Array(2),Ht=function(t,e){var n,r,i,o,a,s,c;if((i=2147483647&j(t)|0)<=1072243195)return e[0]=t,e[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?Rt(t,i,e):i<=1073928572?t>0?(c=t-qt,e[0]=c-Lt,e[1]=c-e[0]-Lt,1):(c=t+qt,e[0]=c+Lt,e[1]=c-e[0]+Lt,-1):t>0?(c=t-2*qt,e[0]=c-zt,e[1]=c-e[0]-zt,2):(c=t+2*qt,e[0]=c+zt,e[1]=c-e[0]+zt,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?Rt(t,i,e):t>0?(c=t-3*qt,e[0]=c-1.8231301519518578e-10,e[1]=c-e[0]-1.8231301519518578e-10,3):(c=t+3*qt,e[0]=c+1.8231301519518578e-10,e[1]=c-e[0]+1.8231301519518578e-10,-3):1075388923===i?Rt(t,i,e):t>0?(c=t-4*qt,e[0]=c-Bt,e[1]=c-e[0]-Bt,4):(c=t+4*qt,e[0]=c+Bt,e[1]=c-e[0]+Bt,-4);if(i<1094263291)return Rt(t,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(n=function(t){return gt[0]=t,bt[at]}(t),c=ht(i-((r=(i>>20)-1046)<<20|0),n),a=0;a<2;a++)Ut[a]=0|c,c=16777216*(c-Ut[a]);for(Ut[2]=c,o=3;0===Ut[o-1];)o-=1;return s=function(t,e,n,r){var i,o,a,s,c,u,l;for((o=(n-3)/24|0)<0&&(o=0),s=n-24*(o+1),u=o-(a=r-1),l=a+4,c=0;c<=l;c++)At[c]=u<0?0:Et[u],u+=1;for(c=0;c<=4;c++){for(i=0,u=0;u<=a;u++)i+=t[u]*At[a+(c-u)];Tt[c]=i}return function t(e,n,r,i,o,a,s,c,u){var l,h,d,f,p,v,y,m,g;for(f=a,g=i[r],m=r,p=0;m>0;p++)h=Mt*g|0,It[p]=g-16777216*h|0,g=i[m-1]+h,m-=1;if(g=Ct(g,o),g-=8*wt(.125*g),g-=y=0|g,d=0,o>0?(y+=p=It[r-1]>>24-o,It[r-1]-=p<<24-o,d=It[r-1]>>23-o):0===o?d=It[r-1]>>23:g>=.5&&(d=2),d>0){for(y+=1,l=0,p=0;p<r;p++)m=It[p],0===l?0!==m&&(l=1,It[p]=16777216-m):It[p]=16777215-m;if(o>0)switch(o){case 1:It[r-1]&=8388607;break;case 2:It[r-1]&=4194303}2===d&&(g=1-g,0!==l&&(g-=Ct(1,o)))}if(0===g){for(m=0,p=r-1;p>=a;p--)m|=It[p];if(0===m){for(v=1;0===It[a-v];v++);for(p=r+1;p<=r+v;p++){for(u[c+p]=Et[s+p],h=0,m=0;m<=c;m++)h+=e[m]*u[c+(p-m)];i[p]=h}return t(e,n,r+=v,i,o,a,s,c,u)}}if(0===g)for(r-=1,o-=24;0===It[r];)r-=1,o-=24;else(g=Ct(g,-o))>=16777216?(h=Mt*g|0,It[r]=g-16777216*h|0,o+=24,It[r+=1]=h):It[r]=0|g;for(h=Ct(1,o),p=r;p>=0;p--)i[p]=h*It[p],h*=Mt;for(p=r;p>=0;p--){for(h=0,v=0;v<=f&&v<=r-p;v++)h+=Ot[v]*i[p+v];Pt[r-p]=h}for(h=0,p=r;p>=0;p--)h+=Pt[p];for(n[0]=0===d?h:-h,h=Pt[0]-h,p=1;p<=r;p++)h+=Pt[p];return n[1]=0===d?h:-h,7&y}(t,e,4,Tt,s,4,o,a,At)}(Ut,Ft,r,o),t<0?(e[0]=-Ft[0],e[1]=-Ft[1],-s):(e[0]=Ft[0],e[1]=Ft[1],s)},Vt=[0,0],Jt=Math.ceil,Wt=function(t){var n;return e(t)||t===B?t:t===U?0:t>709.782712893384?B:t<-745.1332191019411?0:t>-1/(1<<28)&&t<1/(1<<28)?1+t:function(t,e,n){var r,i,o,a;return o=(r=t-e)-(i=r*r)*(0===(a=i)?.16666666666666602:.16666666666666602+a*(a*(6613756321437934e-20+a*(4.1381367970572385e-8*a-16533902205465252e-22))-.0027777777777015593)),Ct(1-(e-r*o/(2-o)-t),n)}(t-.6931471803691238*(n=function(t){return t<0?Jt(t):wt(t)}(t<0?1.4426950408889634*t-.5:1.4426950408889634*t+.5)),1.9082149292705877e-10*n,n)};Nt=!0===A?0:1;var $t=new g(1),Gt=new p($t.buffer),Kt=function(t,e){return $t[0]=t,Gt[Nt]=e>>>0,$t[0]},Zt=[0,0],Yt=[0,0],Qt=function(t,e,n){var r,i,o,a,s,c,u,l,h;return(i=2147483647&(r=j(t))|0)>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(l=3.061616997868383e-17-e),e=0),a=e+(h=t*t)*((s=h*t)*((a=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))}(l=h*h))+(u=h*(0===l?.05396825397622605:.05396825397622605+l*(.0088632398235993+l*(.0014562094543252903+l*(.0002464631348184699+l*(7140724913826082e-20+2590730518636337e-20*l)))))))+e),l=t+(a+=.3333333333333341*s),i>=1072010280?(1-(r>>30&2))*((u=n)-2*(t-(l*l/(l+u)-a))):1===n?l:(Kt(h=l,0),u=a-(h-t),Kt(c=o=-1/l,0),c+o*((s=1+c*h)+c*u))},Xt=[0,0];void 0===window.CroquetMath&&(window.CroquetMath={}),window.CroquetMath.acos=function(t){var o;return e(t)||t<-1||t>1?NaN:t>.5?2*i(n(.5-.5*t)):(o=r-i(t),o+=6.123233995736766e-17,o+=r)},window.CroquetMath.acosh=function(t){var r;return e(t)||t<1?NaN:1===t?0:t>=1<<28?$(t)+J:t>2?$(2*t-1/(t+n(t*t-1))):V((r=t-1)+n(2*r+r*r))},window.CroquetMath.asin=i,window.CroquetMath.asinh=function(t){var r,i,o;return e(t)||G(t)?t:(t<0&&(t=-t,r=!0),o=t<1/(1<<28)?t:t>1<<28?$(t)+J:t>2?$(2*t+1/(n(t*t+1)+t)):V(t+(i=t*t)/(1+n(1+i))),r?-o:o)},window.CroquetMath.atan=Z,window.CroquetMath.atanh=function(t){var n,r;return e(t)||t<-1||t>1?NaN:1===t?B:-1===t?U:(t<0&&(n=!0,t=-t),t<1/(1<<28)?n?-t:t:(r=t<.5?.5*V((r=t+t)+r*t/(1-t)):.5*V((t+t)/(1-t)),n?-r:r))},window.CroquetMath.atan2=function(t,n){var r;return e(n)||e(t)?NaN:G(n)?n===B?G(t)?ft(pt/4,t):ft(0,t):G(t)?ft(3*pt/4,t):ft(pt,t):G(t)?ft(pt/2,t):0===t?n>=0&&!(j(n)>>>31)?ft(0,t):ft(pt,t):0===n?ft(pt/2,t):(r=Z(t/n),n<0?r<=0?r+pt:r-pt:r)},window.CroquetMath.cbrt=function(t){var n,r,i,o,a;return e(t)||G(t)||0===t?t:(r=-2147483648&(i=j(t)),i&=2147483647,a=0,t<2.2250738585072014e-308?(a=0x40000000000000,n=j(a*=t),a=ht(r|(n=(2147483647&n)/3+696219795),0)):a=z(a,r|(n=i/3+715094163)),a*=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)}(o=a*a*(a/t)),n=j(a),a=ht(n+1,0),a+=a*(o=((o=t/(a*a))-a)/(a+a+o)))},window.CroquetMath.cos=function(t){var e;if(e=j(t),(e&=2147483647)<=1072243195)return e<1044381696?1:vt(t,0);if(e>=2146435072)return NaN;switch(3&Ht(t,Vt)){case 0:return vt(Vt[0],Vt[1]);case 1:return-mt(Vt[0],Vt[1]);case 2:return-vt(Vt[0],Vt[1]);default:return mt(Vt[0],Vt[1])}},window.CroquetMath.cosh=function(t){return e(t)?t:(t<0&&(t=-t),t>21?Wt(t)/2:(Wt(t)+Wt(-t))/2)},window.CroquetMath.exp=Wt,window.CroquetMath.expm1=function(t){var n,r,i,o,a,s,c,u,l,h,d,f;if(t===B||e(t))return t;if(t===U)return-1;if(0===t)return t;if(t<0?(r=!0,c=-t):(r=!1,c=t),c>=38.816242111356935){if(r)return-1;if(c>=709.782712893384)return B}if(a=0|j(c),c>.34657359027997264)c<1.0397207708399179?r?(i=t+.6931471803691238,o=-1.9082149292705877e-10,f=-1):(i=t-.6931471803691238,o=1.9082149292705877e-10,f=1):(f=r?1.4426950408889634*t-.5:1.4426950408889634*t+.5,i=t-.6931471803691238*(h=f|=0),o=1.9082149292705877e-10*h),l=i-(t=i-o)-o;else{if(a<1016070144)return t;f=0}return d=(u=t*(n=.5*t))*(((s=1+u*(0===u?-.03333333333333313:u*(.0015873015872548146+u*(u*(4008217827329362e-21+-2.0109921818362437e-7*u)-793650757867488e-19))-.03333333333333313))-(h=3-s*n))/(6-t*h)),0===f?t-(t*d-u):(d=t*(d-l)-l,d-=u,-1===f?.5*(t-d)-.5:1===f?t<-.25?-2*(d-(t+.5)):1+2*(t-d):f<=-2||f>56?(i=j(c=1-(d-t))+(f<<20)|0,(c=z(c,i))-1):(h=1,f<20?c=(h=z(h,i=1072693248-(2097152>>f)|0))-(d-t):(c=t-(d+(h=z(h,i=1023-f<<20|0))),c+=1),i=j(c)+(f<<20)|0,z(c,i)))},window.CroquetMath.log=$,window.CroquetMath.log1p=V,window.CroquetMath.log10=function(t){var n,r,i,o,a,s,c;return e(t)||t<0?NaN:0===t?U:(a=0,(r=j(t))<1048576&&(a-=54,r=j(t*=0x40000000000000)),r>=2146435072?t+t:(a+=(r>>20)-1023|0,t=z(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),s=a+=o>>20|0,i=function(t){var e,n,r,i,o,a,s,c,u;return i=t-1,(1048575&2+(r=j(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(u=(r&=1048575)-398458|0,n=(c=(a=(o=i/(2+i))*o)*a)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),s=a*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(u|=440401-r|0)>0?o*((e=.5*i*i)+s)-e:o*(s-i))}(t),n=Kt(t-=1,0),c=3.694239077158931e-13*s+2.5082946711645275e-11*(t+i),(c+=.4342944818781689*(t-n+i)+.4342944818781689*n)+.30102999566361177*s))},window.CroquetMath.log2=function(t){var n,r,i,o,a;if(e(t)||t<0)return NaN;if(ot(Zt,t),a=0,(r=Zt[0])<1048576){if(0==(2147483647&r|Zt[1]))return U;a-=54,r=j(t*=0x40000000000000)}return r>=2146435072?t+t:(a+=(r>>20)-1023|0,t=z(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),a+=o>>20|0,i=function(t){var e,n,r,i,o,a,s,c,u;return i=t-1,(1048575&2+(r=j(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(u=(r&=1048575)-398458|0,n=(c=(a=(o=i/(2+i))*o)*a)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),s=a*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(u|=440401-r|0)>0?o*((e=.5*i*i)+s)-e:o*(s-i))}(t),n=Kt(t-=1,0),1.6751713164886512e-10*(t+i)+1.4426950407214463*(t-n+i)+1.4426950407214463*n+a)},window.CroquetMath.sin=function(t){var e;if(e=j(t),(e&=2147483647)<=1072243195)return e<1045430272?t:mt(t,0);if(e>=2146435072)return NaN;switch(3&Ht(t,Yt)){case 0:return mt(Yt[0],Yt[1]);case 1:return vt(Yt[0],Yt[1]);case 2:return-mt(Yt[0],Yt[1]);default:return-vt(Yt[0],Yt[1])}},window.CroquetMath.sinh=function(t){var e;return 0===t?t:(e=_t(t),t>710.4758600739439||t<-709.089565712824?t>0?B:U:e>1?e>=709.0895657128241?(e=Wt(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=Wt(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*function(t){var e,n;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,n=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,n=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/n)}(e))},window.CroquetMath.tan=function(t){var e,n;return e=j(t),(e&=2147483647)<=1072243195?e<1044381696?t:Qt(t,0,1):e>=2146435072?NaN:(n=Ht(t,Xt),Qt(Xt[0],Xt[1],1-((1&n)<<1)))},window.CroquetMath.tanh=function(t){var e,n;if((n=_t(t))>44.014845965556525)return t<0?-1:1;if(n>=.625)n=1-2/((e=Wt(2*n))+1),t<0&&(n=-n);else{if(0===t)return t;n=t+t*(e=t*t)*function(t){var e,n;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,n=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),n=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/n)}(e)}return n};var te=Math.pow;function ee(t){return t===1/0||t===-1/0}window.CroquetMath.pow=function(t,e){if(isNaN(t)||isNaN(e))return NaN;if(ee(t)||ee(e))return te(t,e);if(0===t||0===e)return te(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;var n=1;return t<0&&(t*=-1,n=te(-1,e)),window.CroquetMath.exp(window.CroquetMath.log(t)*e)*n}}();var le=null,he={};function de(t,e){var n=JSON.parse(atob(t.slice(1,-1))),r=n.qPara,i=n.qArgs,o=n.qFn,s=JSON.stringify(r),c=he[s]||(he[s]=_(Function,a(r)));return"number"==typeof o&&(i[o]=c),c.call.apply(c,[e].concat(a(i))).bind(e)}function fe(t,e){if(le)throw Error("Island confusion");if(!(t instanceof pe))throw Error("not an island: "+t);var n=le;try{le=t,window.ISLAND=t,e()}finally{le=n}}var pe=function(){function t(e,n){var r=this;d(this,t),t.installCustomMath(),fe(this,function(){ie(r,function(){if(r.modelsById={},r.modelsByName={},r.messages=new Gt(function(t,e){return t.before(e)}),r.subscriptions={},r.users={},r._random=function(){throw Error("You must not use random when applying state!")},r.id=e.id,r.time=0,r.seq=4294967280,r.externalTime=0,r.externalSeq=r.seq,r.futureSeq=0,r.tuttiSeq=0,r.lastSnapshotPoll=0,r.modelsId=0,e.modelsById)for(var t=Se.newOrRecycled(r).readIsland(e,"$"),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];if(a in r||"meta"===a)if("messages"===a){var s,c=ce(t.messages);try{for(c.s();!(s=c.n()).done;){var u=s.value;r.messages.add(u)}}catch(t){c.e(t)}finally{c.f()}}else r[a]=t[a];else console.warn("Ignoring property snapshot.".concat(a))}else{r._random=new h(null,{state:!0});var l=n(r)||{};Object.assign(r.modelsByName,l),r.addSubscription(r,r.id,"__users__",r.generateJoinExit)}})})}return f(t,null,[{key:"current",value:function(){return le||console.warn("No CurrentIsland!"),le}},{key:"installCustomMath",value:function(){if(!window.BrowserMath){window.CroquetMath.random=function(){return le.random()},window.BrowserMath={};for(var t=function(){var t=o(n[e],2),r=t[0],i=t[1],a=window.Math[r];window.BrowserMath[r]=a,window.Math[r]=["pow","atan2"].includes(r)?function(t,e){return le?i(t,e):a(t,e)}:function(t){return le?i(t):a(t)}},e=0,n=Object.entries(window.CroquetMath);e<n.length;e++)t()}}}]),f(t,[{key:"registerModel",value:function(t,e){if(le!==this)throw Error("Island Error");return e||(e=this.id+"/M"+ ++this.modelsId),this.modelsById[e]=t,e}},{key:"deregisterModel",value:function(t){if(le!==this)throw Error("Island Error");var e=this.modelsById;delete this.modelsById[t];for(var n=0,r=Object.entries(this.modelsByName);n<r.length;n++){var i=o(r[n],2),a=i[0];e===i[1]&&delete this.modelsByName[a]}this.messages.removeMany(function(e){return e.hasReceiver(t)})}},{key:"lookUpModel",value:function(t){if(t===this.id)return this;var e=this.modelsById[t];if(e)return e;var n=t.match(/^([^#]+)#(.*)$/),r=o(n,3),i=(r[0],r[1]),a=r[2];return this.modelsById[i].lookUp(a)}},{key:"get",value:function(t){return this.modelsByName[t]}},{key:"set",value:function(t,e){if(le!==this)throw Error("Island Error");this.modelsByName[t]=e}},{key:"getNextTuttiSeq",value:function(){return this.tuttiSeq=this.tuttiSeq+1>>>0,this.tuttiSeq}},{key:"callModelMethod",value:function(t,e,n){if(le)throw Error("Island Error");var r=this.lookUpModel(t);if(r){var i=new be(this.time,0,r.id,e,n);this.controller.sendMessage(i)}else console.error(Error("Model not found: ".concat(t)))}},{key:"noop",value:function(){}},{key:"generateJoinExit",value:function(t){var e,n=t.entered,r=t.exited,i=t.count,a=ce(r=n.length===i?Object.keys(this.users):r.map(function(t){return t[0]}));try{for(a.s();!(e=a.n()).done;){var s=e.value;this.users[s]&&(delete this.users[s],this.publishFromModel(this.id,"view-exit",s))}}catch(t){a.e(t)}finally{a.f()}var c,u=ce(n);try{for(u.s();!(c=u.n()).done;){var l=o(c.value,3),h=l[0],d=l[1],f=l[2];this.users[h]||(this.users[h]={name:d},f&&(this.users[h].location=f),this.publishFromModel(this.id,"view-join",h))}}catch(t){u.e(t)}finally{u.f()}}},{key:"scheduleExternalMessage",value:function(t){var e=be.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);var n=this.externalSeq+1>>>0;if(e.seq!==n)throw Error("External message error. Expected message #".concat(n," got #").concat(e.seq));return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.messages.add(e),e}},{key:"futureSend",value:function(t,e,n,r){if(t.every)return this.futureRepeat(t.every,e,n,r);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;var i=new be(this.time+t,2*this.futureSeq,e,n,r);return this.messages.add(i),i}},{key:"futureRepeat",value:function(t,e,n,r){this.futureSend(t,this.id,"futureExecAndRepeat",[t,e,n,r])}},{key:"futureExecAndRepeat",value:function(t,e,n,r){var i=this.lookUpModel(e);if("function"==typeof i[n])try{i[n].apply(i,a(r))}catch(t){ct("future message ".concat(i,".").concat(n),t)}else{var o=de(n,i);try{o.apply(void 0,a(r))}catch(t){ct("future message ".concat(i," ").concat(o),t)}}this.futureRepeat(t,e,n,r)}},{key:"future",value:function(t,e,n,r){var i=this.asQFunc(t,n);if("string"==typeof i)return this.futureSend(e,t.id,i,r);var o=this;return new Proxy(t,{get:function(n,r){if("function"==typeof t[r])return function(){if(o.lookUpModel(t.id)!==t)throw Error("future send to unregistered model");for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return o.futureSend(e,t.id,r,i)};throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}},{key:"advanceTo",value:function(t,e){if(le)throw Error("Island Error");for(var n,r=0;(n=this.messages.peek())&&n.time<=t;){var i=n,o=i.time,a=i.seq;if(o<this.time)throw Error("past message encountered: "+n);if(1&a&&(this.seq=this.seq+1>>>0,a/2>>>0!==this.seq))throw Error("Sequence error: expected ".concat(this.seq," got ").concat(a/2>>>0," in ").concat(n));if(this.messages.poll(),this.time=n.time,n.executeOn(this),++r>100&&(r=0,Date.now()>e))return!1}return this.time=t,!0}},{key:"asQFunc",value:function(t,e){if("string"==typeof e)return e;if("function"==typeof e){if(t[e.name]===e)return e.name;for(var n=t;null!==n;){for(var r=0,i=Object.entries(Object.getOwnPropertyDescriptors(n));r<i.length;r++){var a=o(i[r],2),s=a[0];if(a[1].value===e)return s}n=Object.getPrototypeOf(n)}var c=e.toString().match(/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i);return!c||c[3]&&c[3]!==c[1]?function(t,e){"function"==typeof t&&(e=t,t={});var n=Object.keys(t).concat(["return "+e]),r=Object.values(t),i={qPara:n,qArgs:r},o=r.indexOf(e);return o>=0&&(r[o]=n[o],i.qFn=o),"{".concat(btoa(JSON.stringify(i)),"}")}(e):c[2]}return null}},{key:"addSubscription",value:function(t,e,n,r){if(le!==this)throw Error("Island Error");var i=this.asQFunc(t,r);if("string"!=typeof i)throw Error('Subscription handler for "'.concat(n,'" must be a method name'));if("function"!=typeof t[i]&&"{"!==i[0])throw Error('Subscriber method for "'.concat(n,'" not found: ').concat(t,".").concat(i,"()"));var o=e+":"+n,a=t.id+"."+i;if(this.subscriptions[o]){if(-1!==this.subscriptions[o].indexOf(a))throw Error("".concat(t,".").concat(i," already subscribed to ").concat(n))}else this.subscriptions[o]=[];this.subscriptions[o].push(a)}},{key:"removeSubscription",value:function(t,e,n,r){if(le!==this)throw Error("Island Error");var i=e+":"+n,o=t.id+"."+r,a=this.subscriptions[i];if(a){var s=a.indexOf(o);a.splice(s,1),0===a.length&&delete this.subscriptions[i]}}},{key:"removeAllSubscriptionsFor",value:function(t){for(var e="".concat(t.id,":"),n="".concat(t.id,"."),r=0,i=Object.entries(this.subscriptions);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1];if(s.startsWith(e))delete this.subscriptions[s];else{for(var u=c.length-1;u>=0;u--)c[u].startsWith(n)&&c.splice(u,1);0===c.size&&delete this.subscriptions[s]}}}},{key:"publishFromModel",value:function(t,e,n){if(le!==this)throw Error("Island Error");var r=e.endsWith("#reflected");r&&(e=e.slice(0,e.length-"#reflected".length));var i=t+":"+e;this.handleModelEventInModel(i,n,r),this.handleModelEventInView(i,n)}},{key:"publishFromView",value:function(t,e,n){if(le)throw Error("Island Error");var r=t+":"+e;this.handleViewEventInModel(r,n),this.handleViewEventInView(r,n)}},{key:"handleModelEventInModel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(le!==this)throw Error("Island Error");if(n){var r=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;var i=t+"#__vote",o=t+"#divergence",a=!!Qt.subscriptions[i],s=!!this.subscriptions[t],c=!!this.subscriptions[o];a&&c&&console.log("divergence subscription for ".concat(t," overridden by vote subscription"));var u,l=s?new be(this.time,0,this.id,"handleModelEventInModel",[t,e]):null;u=a?[this.id,"handleModelEventInView",i]:[this.id,"handleTuttiDivergence",o],this.controller.sendTutti(this.time,r,e,l,a,u)}else if(this.subscriptions[t]){var h,d=ce(this.subscriptions[t]);try{for(d.s();!(h=d.n()).done;){var f=h.value,p=f.split("."),v=w(p),y=v[0],m=v.slice(1),g=m.join("."),b=this.lookUpModel(y);if(b){if("{"===g[0]){var _=de(g,b);try{_(e)}catch(e){ct("event ".concat(t," ").concat(b," ").concat(_),e)}continue}"function"!=typeof b[g]&&at("event ".concat(t," ").concat(b,".").concat(g,"(): method not found"))}else at("event ".concat(t," .").concat(g,"(): subscriber not found"));try{b[g](e)}catch(e){ct("event ".concat(t," ").concat(b,".").concat(g,"()"),e)}}}catch(t){d.e(t)}finally{d.f()}}}},{key:"handleViewEventInModel",value:function(t,e){if(this.subscriptions[t]){var n=new be(this.time,0,this.id,"handleModelEventInModel",[t,e]);this.controller.sendMessage(n)}}},{key:"handleModelEventInView",value:function(t,e){var n=this;Qt.handleEvent(t,e,function(t){return function(t){if(!le)throw Error("Island confusion");var e=le;try{le=null,t()}finally{le=e}}(function(){return oe(n,t,!0)})})}},{key:"handleViewEventInView",value:function(t,e){Qt.handleEvent(t,e)}},{key:"handleTuttiDivergence",value:function(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{var n=t.split(":").slice(-1)[0];console.warn("uncaptured divergence in ".concat(n,":"),e)}}},{key:"processModelViewEvents",value:function(){var t=this;if(le)throw Error("Island Error");return oe(this,function(){return Qt.processFrameEvents(!!t.controller.synced)})}},{key:"pollToCheckSync",value:function(){var t=this.getNextTuttiSeq();if(!0===this.controller.synced){var e=Date.now(),n={date_island:this.time,hash:this.getSummaryHash()},r=Date.now()-e;this.controller.cpuTime-=r;var i=[this.id,"handleSyncCheckVote","syncCheckVote"];this.controller.sendTutti(this.time,t,n,null,!0,i)}}},{key:"handleSyncCheckVote",value:function(t,e){this.controller.handleSyncCheckVote(e)}},{key:"pollForSnapshot",value:function(){var t=this,e=this.getNextTuttiSeq(),n=this.time,r=n-this.lastSnapshotPoll;if(r<5e3)console.log("rejecting snapshot poll ".concat(r,"ms after previous"));else{this.lastSnapshotPoll=n;var i=this.controller.preparePollForSnapshot();if(i){var o=Date.now();i.hash=this.getSummaryHash();var a=Date.now()-o;this.controller.cpuTime-=a,Promise.resolve().then(function(){return t.controller.pollForSnapshot(n,e,i)})}}}},{key:"handleSnapshotVote",value:function(t,e){this.controller.handleSnapshotVote(e)}},{key:"snapshot",value:function(){return ke.newOrRecycled(this).snapshot(this,"$")}},{key:"getSummaryHash",value:function(){return(new _e).getHash(this)}},{key:"random",value:function(){if(le!==this)throw Error("Island Error");return this._random()}},{key:"randomID",value:function(){if(le!==this)throw Error("Island Error");for(var t="",e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}}]),t}();function ve(t,e){var n=t.match(/^([^[]+)(\[.*)?$/i),r=o(n,3),i=(r[0],r[1]),a=r[2],s=i.split(">"),c=o(s,2),u=c[0],l=c[1],h=[];return a&&(h=Ce.newOrRecycled(e).decode(JSON.parse(a))),{receiver:u,selector:l,args:h}}function ye(t,e){return(e-t|0)>=0}var me,ge,be=function(){function t(e,n,r,i,o){d(this,t),this.time=e,this.seq=n,this.payload=function(t,e,n){return n.length>0&&(n=xe.newOrRecycled().encode(n)),"".concat(t,">").concat(e).concat(n.length>0?JSON.stringify(n):"")}(r,i,o)}return f(t,[{key:"before",value:function(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?ye(this.externalSeq,t.externalSeq):ye(this.internalSeq,t.internalSeq)}},{key:"hasReceiver",value:function(t){return function(t,e){return t.startsWith("".concat(e,">"))}(this.payload,t)}},{key:"isExternal",value:function(){return 1&this.seq}},{key:"asState",value:function(){return[this.time,this.seq,this.payload]}},{key:"executeOn",value:function(t){var e=this,n=ve(this.payload,t),r=n.receiver,i=n.selector,o=n.args,s=t.lookUpModel(r);if(s)if("{"===i[0]){var c=de(i,s);fe(t,function(){ie(t,function(){try{c.apply(void 0,a(o))}catch(t){ct("".concat(e.shortString()," ").concat(c),t)}})})}else"function"!=typeof s[i]?at("".concat(this.shortString()," ").concat(s,".").concat(i,"(): method not found")):fe(t,function(){ie(t,function(){try{s[i].apply(s,a(o))}catch(t){ct("".concat(e.shortString()," ").concat(s,".").concat(i,"()"),t)}})});else at("".concat(this.shortString()," ").concat(i,"(): receiver not found"))}},{key:"shortString",value:function(){return"".concat(this.isExternal()?"External":"Future","Message")}},{key:"toString",value:function(){var t=ve(this.payload),e=t.receiver,n=t.selector,r=t.args,i=this.isExternal(),o=i?this.externalSeq:this.internalSeq;return"".concat(i?"External":"Future","Message[").concat(this.time).concat(":#"[+i]).concat(o," ").concat(e,".").concat(n,"(").concat(r.map(JSON.stringify).join(", "),")]")}},{key:Symbol.toPrimitive,value:function(){return this.toString()}},{key:"externalSeq",get:function(){return this.seq/2>>>0},set:function(t){this.seq=2*t+1}},{key:"internalSeq",get:function(){return this.seq/2>>>0},set:function(t){this.seq=2*t}}],[{key:"fromState",value:function(e,n){var r=o(e,3),i=r[0],a=r[1],s=ve(r[2],n);return new t(i,a,s.receiver,s.selector,s.args)}}]),t}(),we=(me=new ArrayBuffer(8),ge=new DataView(me),function(t){return ge.setFloat64(0,t,!0),ge.getInt32(0,!0)+ge.getInt32(4,!0)}),_e=function(){function t(){d(this,t),this.refs=new Map,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",be);var e,n=ce(Pe.allClassTypes());try{for(n.s();!(e=n.n()).done;){var r=o(e.value,2),i=r[0],a=r[1];this.addHasher(i,a)}}catch(t){n.e(t)}finally{n.f()}}return f(t,[{key:"addHasher",value:function(t,e){var n=this,r=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:function(t){return Object.assign({},t)}},i=r.cls,o=r.write;this.hashers.set(i,function(t){return n.hashStructure(t,o(t))})}},{key:"getHash",value:function(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(var e=0,n=Object.entries(t);e<n.length;e++){var r=o(n[e],2),i=r[0],a=r[1];if("controller"!==i&&"meta"!==i)if("_random"===i)this.hash(a.state(),!1);else if("messages"===i){var s=a.asArray();(this.hashState.fC=s.length)&&this.hash(s,!1)}else this.hashEntry(i,a)}return this.hashDeferred(),this.hashState}},{key:"hashDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.key,n=t.value;this.hashEntry(e,n,!1)}}},{key:"hash",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(s(t)){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=we(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;default:var n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return void this.hashArray(t,e);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return void this.hashStructure(t,a(t));case"Object":if(t instanceof Pe)this.hashModel(t);else if(t.constructor===Object)this.hashObject(t,e);else{var r=this.hashers.get(t.constructor);if(!r)throw Error("Don't know how to hash ".concat(t.constructor.name));r(t)}return;case"Null":return;default:throw Error("Don't know how to hash ".concat(n))}}}},{key:"hashModel",value:function(t){if(!this.refs.has(t)){this.hashState.mC++,this.refs.set(t,!0);for(var e=0,n=Object.entries(t);e<n.length;e++){var r=o(n[e],2),i=r[0],a=r[1];"__realm"!==i&&void 0!==a&&this.hashEntry(i,a)}}}},{key:"hashObject",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.refs.has(t)){this.hashState.oC++,this.refs.set(t,!0);for(var n=0,r=Object.entries(t);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];void 0!==s&&this.hashEntry(a,s,e)}}}},{key:"hashArray",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.refs.has(t)){this.refs.set(t,!0);for(var n=0;n<t.length;n++)this.hashEntry(n,t[n],e)}}},{key:"hashStructure",value:function(t,e){void 0!==e&&(this.refs.has(t)||(this.refs.set(t,!0),this.hash(e,!1)))}},{key:"hashEntry",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"$"!==t[0]?n&&"object"===s(e)?this.todo.push({key:t,value:e}):this.hash(e):at("snapshot: ignoring property ".concat(t),{only:"once"})}}]),t}(),ke=function(){function t(e){d(this,t),this.island=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",be);var n,r=ce(Pe.allClassTypes());try{for(r.s();!(n=r.n()).done;){var i=o(n.value,2),a=i[0],s=i[1];this.addWriter(a,s)}}catch(t){r.e(t)}finally{r.f()}}return f(t,null,[{key:"newOrRecycled",value:function(t){var e=this.reusableInstance;return e?(e.island=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}},{key:"resetInstance",value:function(){this.reusableInstance=null}},{key:"reusableInstance",get:function(){return this[this.name+"-instance"]},set:function(t){this[this.name+"-instance"]=t}}]),f(t,[{key:"addWriter",value:function(t,e){var n=this,r=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:function(t){return Object.assign({},t)}},i=r.cls,o=r.write;this.writers.set(i,function(e,r){return n.writeAs(t,e,o(e),r)})}},{key:"snapshot",value:function(t){for(var e={_random:t._random.state(),messages:this.write(t.messages.asArray())},n=0,r=Object.entries(t);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1];"controller"!==a&&(e[a]||this.writeInto(e,a,s,"$"))}return this.writeDeferred(),e}},{key:"writeDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.state,n=t.key,r=t.value,i=t.path;this.writeInto(e,n,r,i,!1)}}},{key:"write",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(s(t)){case"number":return Number.isSafeInteger(t)?t:Number.isNaN(t)?{$class:"NaN"}:Number.isFinite(t)?this.writeFloat(t):{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":case"undefined":return t;default:var r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.writeArray(t,e,n);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return this.writeAs(r,t,a(t),e);case"Object":if(t instanceof Pe)return this.writeModel(t,e);if(t.constructor===Object)return this.writeObject(t,e,n);var i=this.writers.get(t.constructor);if(i)return i(t,e);throw Error("Don't know how to write ".concat(t.constructor.name," at ").concat(e));case"Null":return t;default:throw Error("Don't know how to write ".concat(r," at ").concat(e))}}}},{key:"writeModel",value:function(t,e){if(this.refs.has(t))return this.writeRef(t);var n={$model:Pe.classToID(t.constructor)};this.refs.set(t,n);var r,i=ce(Object.keys(t).sort());try{for(i.s();!(r=i.n()).done;){var o=r.value;if("__realm"!==o){var a=t[o];void 0!==a&&this.writeInto(n,o,a,e)}}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"writeObject",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.refs.has(t))return this.writeRef(t);var r={};this.refs.set(t,r);var i,o=ce(Object.keys(t).sort());try{for(o.s();!(i=o.n()).done;){var a=i.value,s=t[a];void 0!==s&&this.writeInto(r,a,s,e,n)}}catch(t){o.e(t)}finally{o.f()}return r}},{key:"writeArray",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.refs.has(t))return this.writeRef(t);var r=[];this.refs.set(t,r);for(var i=0;i<t.length;i++)this.writeInto(r,i,t[i],e,n);return r}},{key:"writeFloat",value:function(t){return t}},{key:"writeAs",value:function(t,e,n,r){if(void 0===n)return n;if(this.refs.has(e))return this.writeRef(e);var i={$class:t};this.refs.set(e,i);var o=this.write(n,r,!1);return"object"!==s(o)||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}},{key:"writeRef",value:function(t){var e=this.refs.get(t);if("object"!==s(e))throw Error("Non-object in refs: "+t);return Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:a(this)}}),{$ref:e.$id||(e.$id=this.nextRef++)}}},{key:"writeInto",value:function(t,e,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("$"!==e[0])if(i&&"object"===s(n))this.todo.push({state:t,key:e,value:n,path:r});else{var o="string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i),a=r+(o?".".concat(e):"[".concat(JSON.stringify(e),"]")),c=this.write(n,a);void 0!==c&&(t[e]=c)}else at("snapshot: ignoring property ".concat(e),{only:"once"})}}]),t}(),Se=function(){function t(e){d(this,t),this.island=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.readers=new Map,this.addReader("Teatime:Message",be);var n,r=ce(Pe.allClassTypes());try{for(r.s();!(n=r.n()).done;){var i=o(n.value,2),a=i[0],s=i[1];this.addReader(a,s)}}catch(t){r.e(t)}finally{r.f()}this.readers.set("NaN",function(){return NaN}),this.readers.set("Infinity",function(t){return t*(1/0)}),this.readers.set("Set",function(t){return new Set(t)}),this.readers.set("Map",function(t){return new Map(t)}),this.readers.set("Array",function(t){return t.slice(0)}),this.readers.set("Uint8Array",function(t){return new Uint8Array(t)}),this.readers.set("Uint16Array",function(t){return new Uint16Array(t)}),this.readers.set("Float32Array",function(t){return new Float32Array(t)})}return f(t,null,[{key:"newOrRecycled",value:function(t){var e=this.reusableInstance;return e?(e.island=t,e.refs=new Map,e.todo=[],e.unresolved=[]):e=this.reusableInstance=new this(t),e}},{key:"resetInstance",value:function(){this.reusableInstance=null}},{key:"reusableInstance",get:function(){return this[this.name+"-instance"]},set:function(t){this[this.name+"-instance"]=t}}]),f(t,[{key:"addReader",value:function(t,e){var n="object"===s(e)?e.read:function(t){return Object.assign(Object.create(e.prototype),t)};this.readers.set(t,n)}},{key:"readIsland",value:function(t,e){if("$"!==e)throw Error("Island must be root object");for(var n={_random:new h(null,{state:t._random})},r=0,i=Object.entries(t);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1];n[s]||this.readInto(n,s,c,e)}return this.readDeferred(),this.resolveRefs(),n}},{key:"readDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.object,n=t.key,r=t.value,i=t.path;this.readInto(e,n,r,i,1)}}},{key:"resolveRefs",value:function(){var t,e=ce(this.unresolved);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.object,i=n.key,o=n.ref,a=n.path;if(!this.refs.has(o))throw Error("Unresolved ref: ".concat(o," at ").concat(a,"[").concat(JSON.stringify(i),"]"));r[i]=this.refs.get(o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"read",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(s(t)){case"number":case"string":case"boolean":return t;default:var r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.readArray(t,e,n);case"Null":return null;case"Object":var i=t.$class,o=t.$model,a=t.$ref;if(a)throw Error("refs should have been handled in readInto()");return o?this.readModel(t,e):i?this.readAs(i,t,e):this.readObject(Object,t,e,n);default:throw Error("Don't know how to read ".concat(r," at ").concat(e))}}}},{key:"readModel",value:function(t,e){var n=Pe.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,n);for(var r=0,i=Object.entries(t);r<i.length;r++){var a=o(i[r],2),s=a[0],c=a[1];"id"!==s&&"$"!==s[0]&&this.readInto(n,s,c,e)}return n}},{key:"readObject",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new t;e.$id&&this.refs.set(e.$id,i);for(var a=0,s=Object.entries(e);a<s.length;a++){var c=o(s[a],2),u=c[0],l=c[1];"$"!==u[0]&&this.readInto(i,u,l,n,r)}return i}},{key:"readArray",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];t.$id&&this.refs.set(t.$id,r);for(var i=0;i<t.length;i++)void 0!==t[i]&&this.readInto(r,i,t[i],e,n);return r}},{key:"readAs",value:function(t,e,n){var r={},i=new Map;if("$value"in e)r=this.read(e.$value,n,2);else for(var a=0,s=Object.entries(e);a<s.length;a++){var c=o(s[a],2),u=c[0],l=c[1];if("$"!==u[0]){var h=l&&l.$ref;h?this.refs.has(h)?r[u]=this.refs.get(h):(r[u]="<unresolved>",i.set(h,u)):this.readInto(r,u,l,n,1)}}var d=this.readers.get(t)(r,n);d||"NaN"===t||console.warn('Reading "'.concat(t,'" returned ').concat(d," at ").concat(n)),e.$id&&this.refs.set(e.$id,d);var f,p=ce(i.entries());try{for(p.s();!(f=p.n()).done;){var v=o(f.value,2),y=v[0],m=v[1];this.unresolved.push({object:d,key:m,ref:y,path:n})}}catch(t){p.e(t)}finally{p.f()}return d}},{key:"readRef",value:function(t,e,n,r){if(!n||!n.$ref)return!1;var i=n.$ref;return this.refs.has(i)?t[e]=this.refs.get(i):(t[e]="<unresolved>",this.unresolved.push({object:t,key:e,ref:i,path:r})),!0}},{key:"readInto",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!this.readRef(t,e,n,r))if(0!==i||"object"!==s(n)){var o="string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i),a=r+(o?".".concat(e):"[".concat(JSON.stringify(e),"]"));t[e]=this.read(n,a,i>0?i-1:0)}else this.todo.push({object:t,key:e,value:n,path:r})}}]),t}(),xe=function(t){y(n,ke);var e=ae(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"encode",value:function(t){var e=this.writeArray(t,"$");return this.writeDeferred(),e}},{key:"writeModel",value:function(t){return{$ref:t.id}}}]),n}(),Ce=function(t){y(n,Se);var e=ae(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"decode",value:function(t){var e=this.readArray(t,"$");return this.readDeferred(),this.resolveRefs(),e}},{key:"resolveRefs",value:function(){var t,e=ce(this.unresolved);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.object,i=n.key,o=n.ref,a=n.path;if(this.refs.has(o))r[i]=this.refs.get(o);else{var s=this.island.lookUpModel(o);if(!s)throw Error("Unresolved ref: ".concat(o," at ").concat(a,"[").concat(JSON.stringify(i),"]"));r[i]=s}}}catch(t){e.e(t)}finally{e.f()}}}]),n}();function Ee(){Se.resetInstance(),ke.resetInstance(),xe.resetInstance(),Ce.resetInstance()}function Oe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Me=I.has("debug","classes",!1),Ae=Symbol("SECRET"),Te=new WeakSet,Pe=function(){function t(e){if(d(this,t),e!==Ae)throw Error("You must create ".concat(this,' using create() not "new"!'))}return f(t,null,[{key:"__isTeatimeModelClass__",value:function(){return!0}},{key:"create",value:function(e,n){var r=re(),i=new this(Ae);return Object.defineProperty(i,"__realm",{value:r}),Object.defineProperty(i,"id",{value:r.register(i),enumerable:!0}),Te.add(i),n&&i.beWellKnownAs(n),i.init(e),Te.has(i)&&(Te.delete(i),Object.getPrototypeOf(this)!==t&&console.warn("".concat(i," did not call super.init(options)"))),i}},{key:"createNoInit",value:function(t){var e=re(),n=new this(Ae);return Object.defineProperty(n,"__realm",{value:e}),Object.defineProperty(n,"id",{value:t,enumerable:!0}),n}},{key:"allowConstructors",value:function(){Ae=void 0,console.warn("disabling error reporting for Model constructors")}},{key:"register",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown-file";return Ee(),Ft(this),Le(t,this.name,this),this}},{key:"registerIfNeeded",value:function(){Re(this)||this.register()}},{key:"types",value:function(){return{}}},{key:"classToID",value:function(t){return function(t){if(Re(t))return t[je];if(Ne(),Re(t))return t[je];throw Error('Class "'.concat(t.name,'" not found, did you call ').concat(t.name,".register()?"))}(t)}},{key:"classFromID",value:function(t){return qe(t)}},{key:"allClasses",value:function(){return De()}},{key:"allClassTypes",value:function(){return function(){var t,e={},n=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Oe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oe(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(De());try{for(n.s();!(t=n.n()).done;){var r=t.value;Object.prototype.hasOwnProperty.call(r,"types")&&Object.assign(e,r.types())}}catch(t){n.e(t)}finally{n.f()}return Object.entries(e)}()}},{key:"instantiateClassID",value:function(t,e){return qe(t).createNoInit(e)}}]),f(t,[{key:"init",value:function(t){Te.delete(this)}},{key:"destroy",value:function(){re().unsubscribeAll(this),re().deregister(this)}},{key:"publish",value:function(t,e,n){this.__realm||this.__realmError(),this.__realm.publish(e,n,t)}},{key:"subscribe",value:function(t,e,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,n)}},{key:"unsubscribe",value:function(t,e){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e)}},{key:"unsubscribeAll",value:function(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}},{key:"__realmError",value:function(){if(!this.id)throw Error("".concat(this," has no ID, did you call super.init(options)?"))}},{key:"future",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;this.__realm||this.__realmError();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this.__realm.future(this,t,e,r)}},{key:"random",value:function(){return re().random()}},{key:"now",value:function(){return re().now()}},{key:"beWellKnownAs",value:function(t){re().island.set(t,this)}},{key:"wellKnownModel",value:function(t){return this.__realm.island.get(t)}},{key:"modelOnly",value:function(t){var e="none";try{e=re()}catch(t){}if(e===this.__realm)return!0;var n=Error(t||"".concat(this,".modelOnly() called from outside a model!"));throw ct("view code",n),n}},{key:Symbol.toPrimitive,value:function(){var t=this.constructor.name;return t.includes("Model")?t:"".concat(t,"[Model]")}},{key:"sessionId",get:function(){return this.__realm.island.id}}]),t}(),Ie={},je=Symbol("CLASS_ID");function Ne(){if(e.bundle)for(var t=0,n=Object.entries(e.bundle.cache);t<n.length;t++)for(var r=o(n[t],2),i=r[0],a=r[1],s=0,c=Object.entries(a.exports);s<c.length;s++){var u=o(c[s],2),l=u[0],h=u[1];h&&h.__isTeatimeModelClass__&&Le(i,"default"===l?h.name:l,h)}}function De(){return 0===Object.keys(Ie).length&&Ne(),Object.values(Ie).map(function(t){return t.cls})}function Re(t){return Object.prototype.hasOwnProperty.call(t,je)}function qe(t){if(Ie[t])return Ie[t].cls;if(Ne(),Ie[t])return Ie[t].cls;throw Error('Class "'.concat(t,'" in snapshot, but not found in current source?'))}function Le(t,e,n){var r="".concat(t,":").concat(e),i=Ie[r];if(i&&i.cls!==n)throw Error("Duplicate class ".concat(e," in ").concat(t));return Re(n)?Me&&!i&&console.warn("ignoring re-exported class ".concat(e," from ").concat(t)):(Me&&console.log("registering class ".concat(e," from ").concat(t)),n[je]=r),Ie[r]={cls:n,file:t},n}var ze=function(){function t(e){d(this,t),Object.defineProperty(this,"realm",{value:re()}),Object.defineProperty(this,"id",{value:this.realm.register(this),configurable:!0})}return f(t,null,[{key:"displayStatus",value:function(t,e){return st(t,e)}},{key:"displayWarning",value:function(t,e){return at(t,e)}},{key:"displayError",value:function(t,e){return ot(t,e)}}]),f(t,[{key:"detach",value:function(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}},{key:"reattach",value:function(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}},{key:"publish",value:function(t,e,n){this.realm.publish(e,n,t)}},{key:"subscribe",value:function(t,e,n){n=n.bind(this);var r=e.event?e:{event:e},i=r.event,o=r.handling;this.realm.subscribe(i,this.id,n,t,o)}},{key:"unsubscribe",value:function(t,e){this.realm.unsubscribe(e,this.id,null,t)}},{key:"unsubscribeAll",value:function(){this.realm.unsubscribeAll(this.id)}},{key:"future",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.realm.future(this,t)}},{key:"random",value:function(){return re().random()}},{key:"now",value:function(){return this.realm.now()}},{key:"externalNow",value:function(){return this.realm.externalNow()}},{key:"update",value:function(t){}},{key:"wellKnownModel",value:function(t){return this.realm.island.get(t)}},{key:"inSameViewRealm",value:function(t){return oe(this.realm.island,t,!0)}},{key:Symbol.toPrimitive,value:function(){var t=this.constructor.name;return t.includes("View")?t:"".concat(t,"[View]")}},{key:"sessionId",get:function(){return this.realm.island.id}},{key:"viewId",get:function(){return this.realm.island.controller.viewId}}]),t}();function Be(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function Ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function He(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fe(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Ve=t("pako"),Je="0.2.7";console.log("Croquet SDK "+Je);var We=window.location.hostname.endsWith("croquet.io")?"".concat(window.location.host,"/reflector"):"croquet.io/reflector",$e="wss://".concat(We,"/v").concat(1),Ge=null,Ke=I.nocheat,Ze=["tps"];function Ye(){return Math.floor(Math.random()*Math.pow(2,53)).toString(36)}var Qe=new Set,Xe=function(){function t(){d(this,t),this.reset()}var e,n,r,u,l,h,v,y;return f(t,[{key:"reset",value:function(){this.island=null,this.connection=this.connection||new tn(this),this.networkQueue=new Wt,this.time=0,this.fastForwardTo=-1,this.session="",this.viewId=this.viewId||Ye(),this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(window.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(window.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],Qt.removeAllSubscriptionsFor(this.viewId),Qt.addSubscription(this.viewId,"__users__",this.viewId,function(t){return st("users now ".concat(t.count))},"oncePerFrameWhileSynced"),gt.showSyncWait(!0)}},{key:"checkForConnection",value:function(t){this.connection.checkForConnection(t)}},{key:"dormantDisconnect",value:function(){this.connected&&this.connection.dormantDisconnect()}},{key:"establishSession",value:(y=c(i.mark(function t(e,n){var r,c,u,l,h,d,f,v,y,m,g,b,w,_,k,S,x,C,E;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(Ge={messages:I.has("debug","messages",!1),sends:I.has("debug","sends",!1),ticks:I.has("debug","ticks",!1),pong:I.has("debug","pong",!1),snapshot:I.has("debug","snapshot",!1),session:I.has("debug","session",!1),initsnapshot:I.has("debug","initsnapshot","localhost"),reflector:I.has("debug","reflector",I.dev||"localhost")},r=n.optionsFromUrl,c=n.multiRoom,u=n.autoSession,l=n.login,h=He({},n.options),d=0,f=[].concat(Ze,a(r||[]));d<f.length;d++)(v=f[d])in I&&(h[v]=I[v]);if(!l){t.next=7;break}return t.next=7,wt();case 7:return u&&(y=e,m=I.getSession().split("/"),g=c?m[1]:m[0],b=c?m[2]:m[1],(w=!g||!b)&&(u.user&&(g=u.user),u.random&&(b=u.random),g||(g=bt("name","").toLowerCase()||"GUEST"),b||(b=Ye())),this.session=c?"".concat(y,"/").concat(g,"/").concat(b):"".concat(g,"/").concat(b),c||(I.setSession(this.session,w),gt.sessionURL=window.location.href),e="".concat(y,"/").concat(g,"/").concat(b)),_=function(t){return"object"===s(t)?p(t):t},k=Object.keys(h).length?e+"?"+Object.entries(h).map(function(t){var e=o(t,2),n=e[0],r=e[1];return"".concat(n,"=").concat(_(r))}).sort().join("&"):e,t.next=12,Ht(k,Je);case 12:return S=t.sent,x=S.hash,C=S.codeHash,console.log('Session ID for "'.concat(e,'": ').concat(x)),this.islandCreator=He({},n,{options:h,name:e,codeHash:C}),E=!1,this.islandCreator.snapshot?this.islandCreator.snapshot.id!==x&&(console.warn("Existing snapshot was for different code base!"),E=!0):E=!0,E&&(this.islandCreator.snapshot={id:x,time:0,meta:{id:x,codeHash:C,created:(new Date).toISOString()}}),t.next=22,this.join();case 22:return t.next=24,this.startedOrSynced();case 24:return t.abrupt("return",this.island.modelsByName);case 25:case"end":return t.stop()}},t,this)})),function(t,e){return y.apply(this,arguments)})},{key:"lastKnownTime",value:function(t){return Math.max(t.time,t.externalTime)}},{key:"handleSyncCheckVote",value:function(t){if(!0===this.synced){var e=t._local,n=t.tally,r=Object.keys(n);e&&r.includes(e)?r.length>1?console.log(r):console.log("ok"):console.log(this.id,"Sync: local vote not found",e,n)}}},{key:"takeSnapshot",value:function(){var t=this.island.snapshot(),e=this.lastKnownTime(t),n=t.externalSeq;return t.meta=He({},this.islandCreator.snapshot.meta,{options:this.islandCreator.options,time:e,seq:n,date:(new Date).toISOString(),host:window.location.hostname,sdk:Je}),delete t.meta.hash,t}},{key:"scheduleSnapshot",value:function(){if(this.island){var t=this.island.time,e=t-this.island.lastSnapshotPoll;if(e<5e3)Ge.snapshot&&console.log("not requesting snapshot poll (".concat(e,"ms since poll scheduled)"));else{var n=new be(t,0,this.island.id,"pollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),Ge.snapshot&&console.log(this.id,"Controller scheduling snapshot via reflector")}}}},{key:"preparePollForSnapshot",value:function(){var t=this.triggeringCpuTime||this.cpuTime;return this.triggeringCpuTime=null,this.cpuTime=0,!0===this.synced?{cpuTime:t}:null}},{key:"pollForSnapshot",value:function(t,e,n){n.cpuTime+=Math.random();var r=[this.id,"handleSnapshotVote","snapshotVote"];this.sendTutti(t,e,n,null,!0,r)}},{key:"handleSnapshotVote",value:function(t){var e=this;if(!0===this.synced){var n=t._local,r=t.tally,i=Object.keys(r);if(!n||!i.includes(n))return Ge.snapshot&&console.log(this.id,"Snapshot: local vote not found"),void(this.cpuTime=0);var o=i.map(function(t){return JSON.parse(t)}),a={};o.forEach(function(t,e){var n=t.hash;a[n]||(a[n]=[]),a[n].push(e)});var s=Object.keys(a),c=s[0];s.length>1&&(Ge.snapshot&&console.log(this.id,"Snapshots fall into ".concat(s.length," groups")),s.sort(function(t,e){return a[e].length-a[t].length}),a[s[0]].length===a[s[1]].length&&(Ge.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),c=s[0]<s[1]?s[0]:s[1])),s.forEach(function(t){return function(t,r){var s=a[t];s.length>1&&s.sort(function(t,e){return o[t].cpuTime-o[e].cpuTime});var c=s[0];i[c]===n&&e.serveSnapshot(r)}(t,t===c)})}else Ge.snapshot&&console.log("Ignoring snapshot vote during sync")}},{key:"serveSnapshot",value:function(t){var e=K.begin("snapshot"),n=this.takeSnapshot(),r=K.end("snapshot")-e;this.cpuTime-=r,Ge.snapshot&&console.log(this.id,"Snapshotting took ".concat(Math.ceil(r)," ms")),this.uploadSnapshot(n,t)}},{key:"snapshotUrl",value:function(t,e,n,r,i){var o,a="".concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"code",e=I.has("dev","host","localhost"),n=e?"dev/".concat(bt("name","GUEST"),"/"):"";return"".concat(Ct(),"/").concat(n).concat(t,"/")}("snapshots")).concat(this.id),s=".json".concat(i?"."+i:""),c="".concat((o=Math.round(e),(""+o).padStart(10,"0")),"_").concat(n,"-").concat(t,"-").concat(r).concat(s);return"".concat(a,"/").concat(c)}},{key:"hashSnapshot",value:function(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise(function(e){var n=He({},t);delete n.meta,Lt(JSON.stringify(n)).then(function(n){t.meta.hash=n,delete t.meta.hashPromise,e(n)})})),t.meta.hashPromise)}},{key:"uploadSnapshot",value:(v=c(i.mark(function t(e){var n,r,o,a,s,c,u,l,h,d,f,p=arguments;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=!(p.length>1&&void 0!==p[1])||p[1],t.next=3,this.hashSnapshot(e);case 3:return r=Date.now(),o=JSON.stringify(e),a=Date.now()-r,s=e.meta,c=s.time,u=s.seq,l=s.hash,h=this.snapshotUrl("snap",c,u,l,"gz"),Ge.snapshot&&console.log(this.id,"Controller uploading snapshot (".concat(o.length," bytes, ").concat(a,"ms) to ").concat(h)),d=this.connection.socket,t.next=12,this.uploadGzipped(h,o);case 12:if(f=t.sent,this.connection.socket===d){t.next=16;break}return console.error("Controller was reset while trying to upload snapshot"),t.abrupt("return",!1);case 16:if(f){t.next=19;break}return console.error("Failed to upload snapshot"),t.abrupt("return",!1);case 19:return n&&this.announceSnapshotUrl(c,u,l,h),t.abrupt("return",!0);case 21:case"end":return t.stop()}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"announceSnapshotUrl",value:function(t,e,n,r){Ge.snapshot&&console.log(this.id,"Controller sending snapshot url to reflector (time: ".concat(t,", seq: ").concat(e,", hash: ").concat(n,"): ").concat(r));try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:n,url:r}}))}catch(t){console.error("ERROR while sending",t)}}},{key:"fetchJSON",value:(h=c(i.mark(function t(e,n){var r,o,a;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{mode:"cors"});case 3:if(r=t.sent,!e.endsWith(".gz")){t.next=10;break}return t.next=7,r.arrayBuffer();case 7:return o=t.sent,a=Ve.inflate(new Uint8Array(o),{to:"string"}),t.abrupt("return",JSON.parse(a));case 10:return t.next=12,r.json();case 12:return t.abrupt("return",t.sent);case 15:t.prev=15,t.t0=t.catch(0);case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}},t,null,[[0,15]])})),function(t,e){return h.apply(this,arguments)})},{key:"uploadJSON",value:(l=c(i.mark(function t(e,n){var r,o;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:n});case 3:return r=t.sent,o=r.ok,t.abrupt("return",o);case 8:t.prev=8,t.t0=t.catch(0);case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}},t,null,[[0,8]])})),function(t,e){return l.apply(this,arguments)})},{key:"uploadGzipped",value:(u=c(i.mark(function t(e,n){var r,o,a,s,c;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),o=(new TextEncoder).encode(n),a=Ve.gzip(o,{level:1}),Ge.snapshot&&console.log("Snapshot gzipping took ".concat(Date.now()-r,"ms")),t.prev=4,t.next=7,fetch(e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/octet-stream"},body:a});case 7:return s=t.sent,c=s.ok,t.abrupt("return",c);case 12:t.prev=12,t.t0=t.catch(4);case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}},t,null,[[4,12]])})),function(t,e){return u.apply(this,arguments)})},{key:"convertReflectorMessage",value:function(t){var e=this.id,n="noop",r=[];switch(t[2].what){case"users":var i=t[2],a=i.joined,s=i.left,c=i.active,u=i.total;this.users=c,this.usersTotal=u;var l,h=this.id,d={entered:a||[],exited:s||[],count:c},f=Be(d.entered);try{for(f.s();!(l=f.n()).done;){var p=l.value;p.length>2&&(p.length=2)}}catch(t){f.e(t)}finally{f.f()}e=this.id,n="publishFromModel",r=[h,"__users__",d],Qt.handleEvent(this.viewId+":__users__",d);break;case"tally":var v=t[2],y=v.tuttiSeq,m=v.tally,g=v.tallyTarget,b={tuttiSeq:y,tally:m},w=this.tuttiHistory.find(function(t){return t.tuttiSeq===y});w&&(b._local=w.payload);var _=o(g,3);e=_[0],n=_[1],r=[_[2],b]}var k=new be(0,0,e,n,r);t[2]=k.asState()[2]}},{key:"receive",value:(r=c(i.mark(function t(e,n){var r,o,a,s,c,u,l,h,d,f,p,v,y=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.lastReceived=this.connection.lastReceived,t.t0=e,t.next="START"===t.t0?4:"SYNC"===t.t0?13:"RECV"===t.t0?33:"TICK"===t.t0?41:"LEAVE"===t.t0?48:51;break;case 4:return Ge.session&&console.log(this.id,"Controller received START"),this.install(),r=this.takeSnapshot(),t.next=9,this.uploadSnapshot(r,!0);case 9:return o=t.sent,this.islandCreator.startedOrSynced.resolve(this.island),o?this.requestTicks():this.connection.closeConnectionWithError("start","failed to establish session"),t.abrupt("return");case 13:a=n.messages,s=n.url,c=n.time,Ge.session&&console.log(this.id,"Controller received SYNC: time ".concat(c,", ").concat(a.length," messages, ").concat(s)),u=Be(a);try{for(u.s();!(l=u.n()).done;)h=l.value,Ge.messages&&console.log(this.id,"Controller received message in SYNC "+JSON.stringify(h)),h[1]>>>=0,"string"!=typeof h[2]&&this.convertReflectorMessage(h),this.networkQueue.put(h),this.timeFromReflector(h[0])}catch(t){u.e(t)}finally{u.f()}return this.timeFromReflector(c),Ge.session&&console.log("".concat(this.id," fetching snapshot ").concat(s)),t.next=21,this.fetchJSON(s);case 21:if(d=t.sent,this.islandCreator.snapshot=d,this.connected){t.next=26;break}return console.log(this.id,"socket went away during SYNC"),t.abrupt("return");case 26:return this.install(),this.fastForwardTo=c,Ge.session&&console.log("".concat(this.id," fast forwarding from ").concat(Math.round(this.island.time)," to ").concat(this.fastForwardTo)),this.getTickAndMultiplier(),f=function t(){y.simulate(Date.now()+200)?(Ge.session&&console.log("".concat(y.id," fast forwarded to ").concat(Math.round(y.island.time))),y.fastForwardTo=-1,y.islandCreator.startedOrSynced.resolve(y.island)):setTimeout(t,0)},setTimeout(f,0),t.abrupt("return");case 33:return Ge.messages&&console.log(this.id,"Controller received RECV "+JSON.stringify(n)),"string"!=typeof(p=n)[2]&&this.convertReflectorMessage(p),p[1]>>>=0,p[3]===this.viewId&&this.addToStatistics(p[4],this.lastReceived),this.networkQueue.put(p),this.timeFromReflector(p[0]),t.abrupt("return");case 41:if(this.island){t.next=43;break}return t.abrupt("return");case 43:return v="number"==typeof n?n:n.time,Ge.ticks&&console.log(this.id,"Controller received TICK "+v),this.timeFromReflector(v),this.tickMultiplier&&this.multiplyTick(v),t.abrupt("return");case 48:return console.log(this.id,"Controller received LEAVE"),this.leave(),t.abrupt("return");case 51:console.warn("Unknown action:",e,n);case 52:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"install",value:function(){Ge.session&&console.log("".concat(this.id," installing island"));var t=this.islandCreator,e=t.snapshot,n=t.init,r=t.options,i=new pe(e,function(){try{return n(r)}catch(t){throw ct("init",t),t}});if(Ge.initsnapshot&&!e.modelsById){var o=JSON.stringify(i.snapshot());i=new pe(JSON.parse(o),function(){return n(r)})}var a=this.lastKnownTime(i);this.time=Math.max(this.time,a),this.setIsland(i)}},{key:"setIsland",value:function(t){this.island=t,this.island.controller=this}},{key:"createCleanIsland",value:function(){var t=this.islandCreator,e=t.options,n=t.init,r={id:this.id};return new pe(r,function(){return n(e)})}},{key:"join",value:(n=c(i.mark(function t(){var e,n,r,o;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkForConnection(!1),t.next=3,this.connection.connectionPromise;case 3:Qe.add(this),Ge.session&&console.log(this.id,"Controller sending JOIN"),e=this.user,n=e.name,r=e.id,o={name:this.islandCreator.name,options:this.islandCreator.options,version:1,user:[r,n],url:gt.sessionURL,codeHash:this.islandCreator.codeHash,sdk:Je},this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:o}));case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"startedOrSynced",value:(e=c(i.mark(function t(){var e=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){return e.islandCreator.startedOrSynced={resolve:t,reject:n}}));case 1:case"end":return t.stop()}},t)})),function(){return e.apply(this,arguments)})},{key:"leave",value:function(){this.connected&&(console.log(this.id,"Controller LEAVING session for ".concat(this.islandCreator.name)),this.connection.send(JSON.stringify({id:this.id,action:"LEAVING"}))),Qe.delete(this);var t=this.islandCreator.destroyerFn;if(this.reset(),!this.islandCreator)throw Error("do not discard islandCreator!");t&&t()}},{key:"sendMessage",value:function(t){this.connected&&(this.viewOnly||(Ge.sends&&console.log(this.id,"Controller sending SEND ".concat(t.asState())),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[].concat(a(t.asState()),[this.viewId,this.lastSent,this.latency])}))))}},{key:"sendTagged",value:function(t,e){this.connected&&(this.viewOnly||(Ge.sends&&console.log(this.id,"Controller sending tagged SEND ".concat(t.asState()," with tags ").concat(JSON.stringify(e))),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[].concat(a(t.asState()),[this.viewId,this.lastSent]),tags:e}))))}},{key:"sendTutti",value:function(t,e,n,r,i,o){if(this.connected&&!this.viewOnly){var a=p(n);Ge.sends&&console.log(this.id,"Controller sending TUTTI ".concat(a," ").concat(r&&r.asState()," ").concat(o)),this.tuttiHistory.push({tuttiSeq:e,payload:a}),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,e,a,r&&r.asState(),i,o]}))}}},{key:"sendVote",value:function(t,e,n){var r=[this.island.id,"handleModelEventInView",this.island.id+":"+e];this.sendTutti(this.island.time,t,n,null,!0,r)}},{key:"addToStatistics",value:function(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}},{key:"getTickAndMultiplier",value:function(){var t=this.islandCreator.options,e=((t.tps?t.tps:this.islandCreator.tps?this.islandCreator.tps:20)+"x").split("x").map(function(t){return Number.parseInt("0"+t,10)}),n=o(e,2),r=n[0],i=n[1],a=1e3/Math.max(1,Math.min(60,r)),s=Math.max(1,i);return s>1&&!Ke&&(this.tickMultiplier={tick:a,multiplier:s}),{tick:a,multiplier:s}}},{key:"requestTicks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.connected&&this.island){var e=this.getTickAndMultiplier(),n=e.tick,r=e.multiplier;t.tick=n,t.delay=n*(r-1)/r,Ge.session&&console.log(this.id,"Controller requesting TICKS",t);try{this.connection.send(JSON.stringify({id:this.id,action:"TICKS",args:t}))}catch(t){console.error("ERROR while sending",t)}}}},{key:"simulate",value:function(t){var e=this;if(!this.island)return!0;try{for(var n=K.begin("simulate"),r=!0;r;){var i=this.networkQueue.peek();if(!i)break;if(!(r=this.island.advanceTo(i[0],t)))break;if(this.fastForwardTo>=0&&i[0]>=this.fastForwardTo)return!0;this.networkQueue.nextNonBlocking();var o=this.island.scheduleExternalMessage(i);r=this.island.advanceTo(o.time,t),this.cpuTime+=5}if(this.fastForwardTo>=0)return!!r&&this.island.advanceTo(this.fastForwardTo,t);r&&(r=this.island.advanceTo(this.time,t)),this.cpuTime+=Math.max(.01,K.end("simulate")-n);var a=this.backlog;return K.backlog(a),"boolean"==typeof this.synced&&(this.synced&&a>1e3||!this.synced&&a<100)&&(this.synced?this.applySyncChange(!1):this.syncTimer||(this.syncTimer=setTimeout(function(){delete e.syncTimer,e.backlog<100&&e.applySyncChange(!0)},200))),r&&this.cpuTime>5e3&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,setTimeout(function(){return e.scheduleSnapshot()},Math.floor(2e3*Math.random()))),r}catch(t){return ct("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}},{key:"applySyncChange",value:function(t){this.synced=t,gt.showSyncWait(!t),this.island.publishFromView(this.viewId,"synced",t)}},{key:"inViewRealm",value:function(t){var e=this;return oe(this.island,function(){return t(e.island)})}},{key:"processModelViewEvents",value:function(){return this.island?this.island.processModelViewEvents():0}},{key:"timeFromReflector",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reflector";t<this.time?("controller"!==e||Ge.ticks)&&console.warn("time is ".concat(this.time,", ignoring time ").concat(t," from ").concat(e)):("boolean"!=typeof this.synced&&(this.synced=!1),this.time=t,this.island&&K.backlog(this.backlog),this.tickHook&&this.tickHook())}},{key:"multiplyTick",value:function(t){var e=this;this.localTicker&&window.clearInterval(this.localTicker);var n=this.tickMultiplier,r=n.tick,i=n.multiplier,o=r/i,a=1;this.localTicker=window.setInterval(function(){e.timeFromReflector(t+a*o,"controller"),Ge.ticks&&console.log(e.id,"Controller generate TICK "+e.time,a),++a>=i&&(window.clearInterval(e.localTicker),e.localTicker=0)},o)}},{key:"id",get:function(){return this.island?this.island.id:this.islandCreator.snapshot.id}},{key:"user",get:function(){return{id:this.viewId,name:bt("name","GUEST")}}},{key:"viewOnly",get:function(){return this.islandCreator.viewOnly}},{key:"backlog",get:function(){return this.island?this.time-this.island.time:0}},{key:"starvation",get:function(){return Date.now()-this.lastReceived}},{key:"activity",get:function(){return Date.now()-this.lastSent}},{key:"connected",get:function(){return this.connection.connected}},{key:"latencies",get:function(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}}]),t}(),tn=function(){function t(e){d(this,t),this.controller=e,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.setUpConnectionPromise()}var e;return f(t,[{key:"setUpConnectionPromise",value:function(){var t=this;this.connectionPromise=new Promise(function(e){return t.resolveConnection=e})}},{key:"checkForConnection",value:function(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}},{key:"connectToReflector",value:(e=c(i.mark(function t(){var e,n=this;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1,(e=I.reflector||(Ge.reflector?"wss://croquet.io/reflector-dev/dev":$e)).match(/^wss?:/)){t.next=6;break}throw Error("Cannot interpret reflector address "+e);case 6:return e.endsWith("/")||(e+="/"),t.abrupt("return",new Promise(function(t){var r=Object.assign(new WebSocket("".concat(e).concat(n.controller.id)),{onopen:function(e){n.socket=r,(Ge.session||Ge.reflector)&&console.log(n.socket.constructor.name,"connected to",n.socket.url),K.connected(!0),n.resolveConnection(null),t()},onmessage:function(t){n.receive(t.data)},onerror:function(t){ot("Connection error"),console.log(r.constructor.name,"error")},onclose:function(t){var e=1e3!==t.code&&t.code<4100,i=4110===t.code;i||ot("Connection closed: ".concat(t.code," ").concat(t.reason),{duration:e?void 0:36e5}),Ge.session&&console.log(r.constructor.name,"closed:",t.code,t.reason),K.connected(!1),i?n.connectRestricted=!0:n.connectBlocked=!0,n.disconnected(),e&&(at("Reconnecting ..."),window.setTimeout(function(){return n.connectToReflector()},2e3))}})}));case 8:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"disconnected",value:function(){this.socket&&(this.socket=null,this.lastReceived=0,this.lastSent=0,this.connectHasBeenCalled=!1,this.setUpConnectionPromise(),this.controller.leave())}},{key:"send",value:function(t){this.lastSent=Date.now(),this.socket.send(t)}},{key:"receive",value:function(t){this.lastReceived=Date.now();var e=JSON.parse(t),n=e.id,r=e.action,i=e.args;if(n)try{this.controller.receive(r,i)}catch(t){this.closeConnectionWithError("receive",t)}else switch(r){case"PONG":Ge.pong&&console.log("PONG after",Date.now()-i,"ms");break;default:console.warn("Unknown action",r)}}},{key:"dormantDisconnect",value:function(){this.connected&&(console.log("dormant; disconnecting from reflector"),this.socket.close(4110,"Going dormant"))}},{key:"closeConnectionWithError",value:function(t,e){console.error(e),console.warn("closing socket"),this.socket.close(4e3,"Error in "+t)}},{key:"PING",value:function(){this.connected&&(this.socket.bufferedAmount?console.log("Reflector connection stalled: ".concat(this.socket.bufferedAmount," bytes unsent")):this.send(JSON.stringify({action:"PING",args:Date.now()})))}},{key:"PULSE",value:function(){this.connected&&(this.socket.bufferedAmount&&console.log("Reflector connection stalled: ".concat(this.socket.bufferedAmount," bytes unsent")),this.send(JSON.stringify({action:"PULSE"})))}},{key:"keepAlive",value:function(){0!==this.lastReceived&&(Date.now()-this.lastReceived>100?this.PING():Date.now()-this.lastSent>2e4&&this.PULSE())}},{key:"connected",get:function(){return this.socket&&this.socket.readyState===WebSocket.OPEN}}]),t}();function en(){return(en=c(i.mark(function t(e){var n,r,s,u,l,h,d,f,p,v,y,m,g,b,w,_,k,S,x,C,E,O,M,A=arguments;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(M=function(){setInterval(function(){if("hidden"===document.visibilityState)if(!1===I.autoSleep)an(performance.now(),v,k.view);else{var t=Date.now();d?t-d>1e4&&v.dormantDisconnect():d=t}else d=null},1e3)},O=function(t){return{modelRoot:n.create(t,"modelRoot")}},E=function(){k.model=null,k.view&&(I.has("debug","session",!1)&&console.log(k.id,"Detaching root view"),k.view.detach(),""!==k.view.id&&console.warn("".concat(k.view," did not call super.detach()")),k.view=null),gt.clearSessionMoniker()},C=function(){return(C=c(i.mark(function t(n){var a,c,u,l,h,d;return i.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(E(),a={snapshot:n,init:O,destroyerFn:x,options:y},c=0,u=Object.entries(s);c<u.length;c++)l=o(u[c],2),h=l[0],d=l[1],p.includes(h)&&(a[h]=d);return t.next=5,v.establishSession(e,a);case 5:k.model=t.sent.modelRoot,k.id=v.id,gt.makeSessionWidgets(k.id),v.inViewRealm(function(){I.has("debug","session",!1)&&console.log(k.id,"Creating root view"),k.view=new r(k.model)});case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)},x=function(t){return C.apply(this,arguments)},u=function(t,e){return t===e||t.prototype instanceof e},n=A.length>1&&void 0!==A[1]?A[1]:Pe,r=A.length>2&&void 0!==A[2]?A[2]:ze,s=A.length>3?A[3]:void 0,"string"!=typeof e?e=JSON.stringify(e)||"undefined":e||(e="unnamed"),u(n,Pe)){t.next=12;break}throw Error("ModelRoot must inherit from Croquet.Model");case 12:if(u(r,ze)){t.next=19;break}if(!r||Object.getPrototypeOf(r)!==Object.prototype||void 0!==s){t.next=18;break}s=r,r=ze,t.next=19;break;case 18:throw Error("ViewRoot must inherit from Croquet.View");case 19:s||(s={}),(l=I.reflector||s.reflector)&&(l.includes("://")?I.reflector=l:console.warn('Not a valid websocket url, ignoring reflector "'.concat(l,'"'))),s.debug&&(h=function(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]},I.debug=[].concat(a(h(s.debug)),a(h(I.debug))).join(",")),d=null,"autoSleep"in s&&(I.autoSleep=s.autoSleep),M(),"expectedSimFPS"in s&&(on=Math.min(s.expectedSimFPS,rn)),f=["tps"],p=["optionsFromUrl","login","autoSession"],cn(),v=new Xe,y={},s.options&&Object.assign(y,JSON.parse(JSON.stringify(s.options)));for(m=0,g=Object.entries(s);m<g.length;m++)b=o(g[m],2),w=b[0],_=b[1],f.includes(w)&&(y[w]=_);return t.t0=function(t){"hidden"!==document.visibilityState&&(d=null,an(t,v,k.view))},k={id:"",model:null,view:null,step:t.t0,get latency(){return v.latency},get latencies(){return v.latencies}},t.next=38,x();case 38:return"manual"!==s.step&&(S=function t(e){k.step(e),window.requestAnimationFrame(t)},window.requestAnimationFrame(S)),t.abrupt("return",k);case 40:case"end":return t.stop()}},t)}))).apply(this,arguments)}window.setInterval(function(){var t,e=Be(Qe);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.connected&&n.connection.keepAlive()}}catch(t){e.e(t)}finally{e.f()}},100);var nn=[0],rn=120,on=60;function an(t,e,n){e.checkForConnection(!0);var r=e.backlog,i=e.latency,o=e.starvation,a=e.activity;if(K.animationFrame(t,{backlog:r,starvation:o,latency:i,activity:a,users:e.users}),e.island){var s=Date.now(),c=nn.reduce(function(t,e){return t+e},0)/nn.length;e.simulate(s+Math.min(c,200));var u=0===on?0:1e3/on*4;e.backlog>u&&e.simulate(s+200-c),nn.push(Date.now()-s),nn.length>4&&nn.shift(),K.begin("update"),e.processModelViewEvents(),K.end("update"),n&&(K.begin("render"),e.inViewRealm(function(){return n.update(t)}),K.end("render"))}}var sn={};function cn(){Object.isFrozen(sn)||(function t(e){if(!Object.isFrozen(e)){Object.freeze(e);for(var n=0,r=Object.values(e);n<r.length;n++){var i=r[n];!i||"object"!==s(i)&&"function"!=typeof i||t(i)}}}(sn),function(t){var e=JSON.stringify(t,function(t,e){return"function"==typeof e?""+e:e});if("{}"!==e){var n=JSON.parse(e),r=Lt(p(n));r.then(function(t){console.log("hashing Croquet.Constants(".concat(Object.keys(n).join(", "),"): ").concat(t)),jt()&&(Nt[t].name="Croquet Constants")}),Ut.push(r)}}(sn))}n.App=gt,n.Constants=sn,n.Model=Pe,n.View=ze,n.addClassHash=Ft,n.gatherInternalClassTypes=function(t,e){var n={};return function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set,a=Object.values(e).filter(function(t){var e=Object.prototype.toString.call(t).slice(8,-1);return("Object"===e||"Array"===e)&&!o.has(t)}),s=ce(a);try{for(s.s();!(n=s.n()).done;){var c=n.value;o.add(c);var u=r+"."+c.constructor.name;if(i[u]){if(i[u]!==c.constructor)throw new Error("Class with name "+u+" already gathered, but new one has different identity")}else i[u]=c.constructor}}catch(t){s.e(t)}finally{s.f()}var l,h=ce(a);try{for(h.s();!(l=h.n()).done;){var d=l.value;t(d,r,i,o)}}catch(t){h.e(t)}finally{h.f()}}({root:t},e,n,new Set),n},n.startSession=function(t){return en.apply(this,arguments)}},{"@babel/runtime/regenerator":"NhZj","@babel/runtime/helpers/slicedToArray":"v240","@babel/runtime/helpers/toConsumableArray":"tHSN","@babel/runtime/helpers/typeof":"RTfL","@babel/runtime/helpers/asyncToGenerator":"zdnk","@babel/runtime/helpers/defineProperty":"PLl6","toastify-js":"D2QR","seedrandom/seedrandom":"u80Q","@babel/runtime/helpers/classCallCheck":"rsNN","@babel/runtime/helpers/createClass":"rYje","fast-json-stable-stringify":"vwDV","@babel/runtime/helpers/get":"gZGI","@babel/runtime/helpers/inherits":"RaoC","@babel/runtime/helpers/possibleConstructorReturn":"GH4F","@babel/runtime/helpers/getPrototypeOf":"Mrsy",fastpriorityqueue:"wmWq","@babel/runtime/helpers/toArray":"vLZV","@babel/runtime/helpers/construct":"E5TV",pako:"f0Ji"}],CgTP:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Actor=n.ActorManager=void 0;var r=t("@croquet/croquet");class i extends r.Model{init(){super.init(),this.beWellKnownAs("ActorManager"),this.actors=new Map}add(t){this.actors.set(t.id,t)}has(t){return this.actors.has(t)}get(t){return this.actors.get(t)}delete(t){this.actors.delete(t.id)}destroyAll(){new Map(this.actors).forEach(t=>t.destroy())}}n.ActorManager=i,i.register("ActorManager");class o extends r.Model{init(t="Pawn"){super.init(),this.pawnType=t,this.wellKnownModel("ActorManager").add(this),this.publish("actor","createActor",this)}destroy(){this.doomed=!0,this.say("destroyActor"),this.wellKnownModel("ActorManager").delete(this),super.destroy()}say(t,e){this.publish(this.id,t,e)}listen(t,e){this.subscribe(this.id,t,e)}}n.Actor=o,o.register("Actor")},{"@croquet/croquet":"jiaI"}],y6VD:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ClearNamedViews=function(){i.clear()},n.GetNamedView=o,n.GetNamedModel=function(t){return o("ViewRoot").model.wellKnownModel(t)},n.NamedView=void 0;var r=t("@croquet/croquet");const i=new Map;function o(t){return i.get(t)}n.NamedView=class extends r.View{constructor(t){super(),this.name=t,t?this.registerName():console.error("All named views must have public names!")}registerName(){i.set(this.name,this)}reattach(){super.reattach(),this.registerName()}detach(){super.detach(),i.delete(this.name)}}},{"@croquet/croquet":"jiaI"}],HzQ1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PM_Dynamic=n.Pawn=n.PawnManager=void 0;var r=t("@croquet/croquet"),i=t("./NamedView");const o=new Map;n.PawnManager=class extends i.NamedView{constructor(){super("PawnManager"),this.pawns=new Map,this.dynamic=new Set,this.rebuild(),this.subscribe("actor",{event:"createActor",handling:"immediate"},this.spawnPawn)}destroy(){new Map(this.pawns).forEach(t=>t.destroy()),this.detach()}rebuild(){(0,i.GetNamedView)("ViewRoot").model.wellKnownModel("ActorManager").actors.forEach(t=>this.rebuildPawn(t)),this.pawns.forEach(t=>t.link())}rebuildPawn(t){this.spawnPawn(t)}spawnPawn(t){const e=o.get(t.pawnType);e?new e(t):console.log("Unknown pawn type!")}add(t){this.pawns.set(t.actor.id,t)}has(t){return this.pawns.has(t)}get(t){return this.pawns.get(t)}delete(t){this.pawns.delete(t.actor.id)}addDynamic(t){this.dynamic.add(t)}deleteDynamic(t){this.dynamic.delete(t)}update(t){this.dynamic.forEach(e=>e.update(t))}};class a extends r.View{static register(t){o.set(t,this)}constructor(t){super(),this.actor=t,(0,i.GetNamedView)("PawnManager").add(this),this.listen("destroyActor",this.destroy)}link(){}refresh(){}destroy(){(0,i.GetNamedView)("PawnManager").delete(this),this.detach()}say(t,e){this.publish(this.actor.id,t,e)}listen(t,e){this.subscribe(this.actor.id,t,e)}listenOnce(t,e){this.subscribe(this.actor.id,{event:t,handling:"oncePerFrame"},e)}}n.Pawn=a,a.register("Pawn");n.PM_Dynamic=t=>(class extends t{constructor(...t){super(...t),(0,i.GetNamedView)("PawnManager").addDynamic(this)}destroy(){(0,i.GetNamedView)("PawnManager").deleteDynamic(this),super.destroy()}update(t){}})},{"@croquet/croquet":"jiaI","./NamedView":"y6VD"}],E82y:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GetViewTime=function(){return a},n.GetViewDelta=function(){return s},n.ViewRoot=void 0;var r=t("./NamedView"),i=t("./Pawn");n.ViewRoot=class extends r.NamedView{constructor(t){(0,r.ClearNamedViews)(),super("ViewRoot"),console.log("Starting view ..."),this.model=t,this.managers=new Set,this.createManagers()}createManagers(){this.pawnManager=this.addManager(new i.PawnManager)}detach(){this.managers.forEach(t=>t.destroy()),(0,r.ClearNamedViews)(),super.detach()}addManager(t){return this.managers.add(t),t}update(t){o=a,s=(a=t)-o,this.managers.forEach(e=>{e.update&&e.update(t)})}};let o=0,a=0,s=0},{"./NamedView":"y6VD","./Pawn":"HzQ1"}],k6uK:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.toRad=function(t){return t*r},n.toDeg=function(t){return t*i},n.gaussian=function(t,e=1,n=1){const r=2*n*n,i=1/Math.sqrt(Math.PI*r),o=1/r,a=[i];for(let n=1;n<t;n++){const t=e*n;a.push(i*Math.E**(-o*t*t))}return a},n.rayTriangleIntersect=function(t,e,n){const r=n[0],i=n[1],o=n[2],a=g(i,r),s=g(o,r),c=w(e,s),u=b(a,c);if(u>-1e-5&&u<1e-5)return null;const l=1/u,h=g(t,r),d=l*b(h,c);if(d<0||d>1)return null;const f=w(h,a),v=l*b(e,f);if(v<0||d+v>1)return null;const y=l*b(s,f);return y<1e-5||y>1/1e-5?null:m(t,p(e,y))},n.sphericalRandom=function(){const t=Math.random(),e=Math.random(),n=2*Math.sqrt(t-t*t),r=o*e;return[n*Math.cos(r),n*Math.sin(r),1-2*t]},n.v2_zero=function(){return[0,0]},n.v2_unit=function(){return[1,0]},n.v2_random=function(){const t=2*Math.random()*Math.PI;return[Math.cos(t),Math.sin(t)]},n.v2_magnitude=a,n.v2_sqrMag=function(t){return t[0]*t[0]+t[1]*t[1]},n.v2_normalize=s,n.v2_ceil=function(t){return[Math.ceil(t[0]),Math.v3_ceil(t[1])]},n.v2_floor=function(t){return[Math.floor(t[0]),Math.floor(t[1])]},n.v2_inverse=function(t){return[1/t[0],1/t[1]]},n.v2_scale=function(t,e){return[t[0]*e,t[1]*e]},n.v2_multiply=function(t,e){return[t[0]*e[0],t[1]*e[1]]},n.v2_rotate=function(t,e,n){const r=Math.sin(e),i=Math.cos(e);if(n){const e=u(t,n);return c(n,[i*e[0]-r*e[1],r*e[0]+i*e[1]])}return[i*t[0]-r*t[1],r*t[0]+i*t[1]]},n.v2_add=c,n.v2_sub=u,n.v2_dot=l,n.v2_min=function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1])]},n.v2_max=function(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1])]},n.v2_angle=function(t,e){return Math.acos(Math.min(1,Math.max(-1,l(s(t),s(e)))))},n.v2_lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]},n.v2_equals=function(t,e,n=0){return n?n>Math.abs(t[0]-e[0])&&n>Math.abs(t[1]-e[1]):t[0]===e[0]&&t[1]===e[1]},n.v2_transform=function(t,e){const n=t[0],r=t[1];return[e[0]*n+e[2]*r,e[1]*n+e[3]*r]},n.v3_zero=function(){return[0,0,0]},n.v3_unit=h,n.v3_random=function(){const t=2*Math.random()*Math.PI,e=Math.acos(2*Math.random()-1);return y(v([1,1,1],e),t)},n.v3_magnitude=d,n.v3_sqrMag=function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},n.v3_normalize=f,n.v3_inverse=function(t){return[1/t[0],1/t[1],1/t[2]]},n.v3_ceil=function(t){return[Math.ceil(t[0]),Math.v3_ceil(t[1]),Math.v3_ceil(t[2])]},n.v3_floor=function(t){return[Math.floor(t[0]),Math.floor(t[1]),Math.floor(t[2])]},n.v3_scale=p,n.v3_opposite=function(t){return[-1*t[0],-1*t[1],-1*t[2]]},n.v3_multiply=function(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2]]},n.v3_divide=function(t,e){return[t[0]/e[0],t[1]/e[1],t[2]/e[2]]},n.v3_rotateX=function(t,e){const n=Math.sin(e),r=Math.cos(e);return[t[0],r*t[1]-n*t[2],n*t[1]+r*t[2]]},n.v3_rotateY=v,n.v3_rotateZ=y,n.v3_add=m,n.v3_sub=g,n.v3_dot=b,n.v3_cross=w,n.v3_min=function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.min(t[2],e[2])]},n.v3_max=function(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1]),Math.max(t[2],e[2])]},n.v3_manhattan=function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])+Math.abs(t[2]-e[2])},n.v3_angle=function(t,e){return Math.acos(Math.min(1,Math.max(-1,b(f(t),f(e)))))},n.v3_lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n,t[2]+(e[2]-t[2])*n]},n.v3_transform=function(t,e){const n=t[0],r=t[1],i=t[2],o=e[3]*n+e[7]*r+e[11]*i+e[15];return[(e[0]*n+e[4]*r+e[8]*i+e[12])/o,(e[1]*n+e[5]*r+e[9]*i+e[13])/o,(e[2]*n+e[6]*r+e[10]*i+e[14])/o]},n.v3_equals=function(t,e,n=0){return n?n>Math.abs(t[0]-e[0])&&n>Math.abs(t[1]-e[1])&&n>Math.abs(t[2]-e[2]):t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},n.v3_isZero=function(t){return!(t[0]||t[1]||t[2])},n.v4_zero=function(){return[0,0,0,0]},n.v4_unit=function(){return[1,0,0,0]},n.v4_magnitude=_,n.v4_sqrMag=function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},n.v4_normalize=function(t){const e=1/_(t);return[t[0]*e,t[1]*e,t[2]*e,t[3]*e]},n.v4_inverse=function(t){return[1/t[0],1/t[1],1/t[2],1/t[3]]},n.v4_ceil=function(t){return[Math.ceil(t[0]),Math.v3_ceil(t[1]),Math.v3_ceil(t[2]),Math.v3_ceil(t[3])]},n.v4_floor=function(t){return[Math.floor(t[0]),Math.floor(t[1]),Math.floor(t[2]),Math.floor(t[3])]},n.v4_scale=function(t,e){return[t[0]*e,t[1]*e,t[2]*e,t[3]*e]},n.v4_multiply=function(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3]]},n.v4_add=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3]]},n.v4_sub=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3]]},n.v4_dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.v4_min=function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.min(t[2],e[2]),Math.min(t[3],e[3])]},n.v4_max=function(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1]),Math.max(t[2],e[2]),Math.max(t[3],e[3])]},n.v4_transform=function(t,e){const n=t[0],r=t[1],i=t[2],o=t[3];return[e[0]*n+e[4]*r+e[8]*i+e[12]*o,e[1]*n+e[5]*r+e[9]*i+e[13]*o,e[2]*n+e[6]*r+e[10]*i+e[14]*o,e[3]*n+e[7]*r+e[11]*i+e[15]*o]},n.v4_equals=function(t,e,n=0){return n?n>Math.abs(t[0]-e[0])&&n>Math.abs(t[1]-e[1])&&n>Math.abs(t[2]-e[2])&&n>Math.abs(t[3]-e[3]):t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.m2_zero=function(){return[0,0,0,0]},n.m2_identity=function(){return[1,0,0,1]},n.m2_rotation=function(t){const e=Math.sin(t),n=Math.cos(t);return[n,-e,e,n]},n.m3_zero=function(){return[0,0,0,0,0,0,0,0,0]},n.m3_identity=function(){return[1,0,0,0,1,0,0,0,1]},n.m3_transpose=function(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]},n.m3_invert=function(t){const e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=o*u-c*a,h=i*u-s*a,d=i*c-s*o,f=e*l+n*-h+r*d;return[l/f,-(n*u-c*r)/f,(n*a-o*r)/f,-h/f,(e*u-s*r)/f,-(e*a-i*r)/f,d/f,-(e*c-s*n)/f,(e*o-i*n)/f]},n.m3_multiply=function(t,e){const n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],l=t[8],h=e[0],d=e[1],f=e[2],p=e[3],v=e[4],y=e[5],m=e[6],g=e[7],b=e[8];return[h*n+d*o+f*c,h*r+d*a+f*u,h*i+d*s+f*l,p*n+v*o+y*c,p*r+v*a+y*u,p*i+v*s+y*l,m*n+g*o+b*c,m*r+g*a+b*u,m*i+g*s+b*l]},n.m4_zero=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},n.m4_identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},n.m4_translation=function(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1]},n.m4_getTranslation=function(t){return[t[12],t[13],t[14]]},n.m4_scaling=function(t){if(t instanceof Array)return[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1];return[t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1]},n.m4_rotation=function(t,e){const n=f(t),r=Math.sin(e),i=Math.cos(e),o=1-i;return[n[0]*n[0]*o+i,n[1]*n[0]*o+n[2]*r,n[2]*n[0]*o-n[1]*r,0,n[0]*n[1]*o-n[2]*r,n[1]*n[1]*o+i,n[2]*n[1]*o+n[0]*r,0,n[0]*n[2]*o+n[1]*r,n[1]*n[2]*o-n[0]*r,n[2]*n[2]*o+i,0,0,0,0,1]},n.m4_rotationX=function(t){const e=Math.sin(t),n=Math.cos(t);return[1,0,0,0,0,n,e,0,0,-e,n,0,0,0,0,1]},n.m4_rotationY=function(t){const e=Math.sin(t),n=Math.cos(t);return[n,0,-e,0,0,1,0,0,e,0,n,0,0,0,0,1]},n.m4_rotationZ=function(t){const e=Math.sin(t),n=Math.cos(t);return[n,e,0,0,-e,n,0,0,0,0,1,0,0,0,0,1]},n.m4_rotationQ=function(t){const e=t[0],n=t[1],r=t[2],i=t[3],o=e+e,a=n+n,s=r+r,c=e*o,u=n*o,l=n*a,h=r*o,d=r*a,f=r*s,p=i*o,v=i*a,y=i*s;return[1-l-f,u+y,h-v,0,u-y,1-c-f,d+p,0,h+v,d-p,1-c-l,0,0,0,0,1]},n.m4_scalingRotationTranslation=function(t,e,n){const r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,c=i+i,u=o+o,l=r*s,h=r*c,d=r*u,f=i*c,p=i*u,v=o*u,y=a*s,m=a*c,g=a*u;let b=1,w=1,_=1;t instanceof Array?(b=t[0],w=t[1],_=t[2]):(b=t,w=t,_=t);return[(1-(f+v))*b,(h+g)*b,(d-m)*b,0,(h-g)*w,(1-(l+v))*w,(p+y)*w,0,(d+m)*_,(p-y)*_,(1-(l+f))*_,0,n[0],n[1],n[2],1]},n.m4_perspective=function(t,e,n,r){const i=1/Math.tan(t/2),o=1/(n-r);return[i/e,0,0,0,0,i,0,0,0,0,(r+n)*o,-1,0,0,2*r*n*o,0]},n.m4_transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},n.m4_determinant=function(t){const e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=t[9],h=t[10],d=t[11],f=t[12],p=t[13],v=t[14],y=t[15];return(e*a-n*o)*(h*y-d*v)-(e*s-r*o)*(l*y-d*p)+(e*c-i*o)*(l*v-h*p)+(n*s-r*a)*(u*y-d*f)-(n*c-i*a)*(u*v-h*f)+(r*c-i*s)*(u*p-l*f)},n.m4_invert=function(t){const e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=t[9],h=t[10],d=t[11],f=t[12],p=t[13],v=t[14],y=t[15],m=e*a-n*o,g=e*s-r*o,b=e*c-i*o,w=n*s-r*a,_=n*c-i*a,k=r*c-i*s,S=u*p-l*f,x=u*v-h*f,C=u*y-d*f,E=l*v-h*p,O=l*y-d*p,M=h*y-d*v,A=m*M-g*O+b*E+w*C-_*x+k*S;return[(a*M-s*O+c*E)/A,(r*O-n*M-i*E)/A,(p*k-v*_+y*w)/A,(h*_-l*k-d*w)/A,(s*C-o*M-c*x)/A,(e*M-r*C+i*x)/A,(v*b-f*k-y*g)/A,(u*k-h*b+d*g)/A,(o*O-a*C+c*S)/A,(n*C-e*O-i*S)/A,(f*_-p*b+y*m)/A,(l*b-u*_-d*m)/A,(a*x-o*E-s*S)/A,(e*E-n*x+r*S)/A,(p*g-f*w-v*m)/A,(u*w-l*g+h*m)/A]},n.m4_multiply=function(t,e){const n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],l=t[8],h=t[9],d=t[10],f=t[11],p=t[12],v=t[13],y=t[14],m=t[15],g=e[0],b=e[1],w=e[2],_=e[3],k=e[4],S=e[5],x=e[6],C=e[7],E=e[8],O=e[9],M=e[10],A=e[11],T=e[12],P=e[13],I=e[14],j=e[15];return[n*g+r*k+i*E+o*T,n*b+r*S+i*O+o*P,n*w+r*x+i*M+o*I,n*_+r*C+i*A+o*j,a*g+s*k+c*E+u*T,a*b+s*S+c*O+u*P,a*w+s*x+c*M+u*I,a*_+s*C+c*A+u*j,l*g+h*k+d*E+f*T,l*b+h*S+d*O+f*P,l*w+h*x+d*M+f*I,l*_+h*C+d*A+f*j,p*g+v*k+y*E+m*T,p*b+v*S+y*O+m*P,p*w+v*x+y*M+m*I,p*_+v*C+y*A+m*j]},n.m4_toNormal4=function(t){const e=t[0],n=t[1],r=t[2],i=t[4],o=t[5],a=t[6],s=t[8],c=t[9],u=t[10],l=o*u-c*a,h=i*u-s*a,d=i*c-s*o,f=e*l+n*-h+r*d;return[l/f,-h/f,d/f,0,-(n*u-c*r)/f,(e*u-s*r)/f,-(e*c-s*n)/f,0,(n*a-o*r)/f,-(e*a-i*r)/f,(e*o-i*n)/f,0,0,0,0,1]},n.m4_toNormal3=function(t){const e=t[0],n=t[1],r=t[2],i=t[4],o=t[5],a=t[6],s=t[8],c=t[9],u=t[10],l=o*u-c*a,h=i*u-s*a,d=i*c-s*o,f=e*l+n*-h+r*d;return[l/f,-h/f,d/f,-(n*u-c*r)/f,(e*u-s*r)/f,-(e*c-s*n)/f,(n*a-o*r)/f,-(e*a-i*r)/f,(e*o-i*n)/f]},n.m4_grounded=function(t){const e=[0,1,0];var n=[t[0],t[1],t[2]],r=w(n,e);return r[1]=0,r=f(r),(n=w(e,r))[1]=0,[(n=f(n))[0],n[1],n[2],0,0,1,0,0,r[0],r[1],r[2],0,0,0,0,1]},n.m4_fastGrounded=function(t){var e=f([t[0],0,t[2]]),n=f([t[8],0,t[10]]);return[e[0],e[1],e[2],0,0,1,0,0,n[0],n[1],n[2],0,0,0,0,1]},n.q_identity=function(){return[0,0,0,1]},n.q_magnitude=k,n.q_normalize=function(t){const e=1/k(t);return[t[0]*e,t[1]*e,t[2]*e,t[3]*e]},n.q_conjugate=function(t){return[-t[0],-t[1],-t[2],t[3]]},n.q_axisAngle=S,n.q_scale=function(t,e){return[t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*e]},n.q_add=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3]]},n.q_dot=x,n.q_multiply=function(t,e){const n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],c=e[2],u=e[3];return[a*o+s*i-c*r+u*n,s*o-a*i+u*r+c*n,c*o+u*i+a*r-s*n,u*o-c*i-s*r-a*n]},n.q_slerp=function(t,e,n){const r=t[0],i=t[1],o=t[2],a=t[3];let s,c,u,l,h,d=e[0],f=e[1],p=e[2],v=e[3];(c=r*d+i*f+o*p+a*v)<0&&(c=-c,d=-d,f=-f,p=-p,v=-v);1-c>1e-5?(s=Math.acos(c),u=Math.sin(s),l=Math.sin((1-n)*s)/u,h=Math.sin(n*s)/u):(l=1-n,h=n);return[l*r+h*d,l*i+h*f,l*o+h*p,l*a+h*v]},n.q_equals=function(t,e,n=1e-4){return Math.abs(x(t,e))+n>=1},n.q_isZero=function(t){return!(t[0]||t[1]||t[2])},n.q2_identity=function(){return[0,0,0,1,0,0,0,0]},n.q2_magnitude=C,n.q2_rotation=E,n.q2_translation=function(t){return[0,0,0,1,...p(t,.5),0]},n.q2_axisAngle=function(t,e){return E(S(t,e))},n.q2_rotationTranslation=O,n.q2_axisAngleTranslation=function(t,e,n){return O(S(t,e),n)},n.q2_normalize=function(t){const e=1/C(t),n=t[0]*e,r=t[1]*e,i=t[2]*e,o=t[3]*e,a=t[4],s=t[5],c=t[6],u=t[7],l=n*a+r*s+i*c+o*u;return[n,r,i,o,(a-n*l)*e,(s-r*l)*e,(c-i*l)*e,(u-o*l)*e]},n.q2_multiply=function(t,e){const n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],l=e[0],h=e[1],d=e[2],f=e[3],p=e[4],v=e[5],y=e[6],m=e[7];return[l*o+f*n+h*i-d*r,h*o+f*r+d*n-l*i,d*o+f*i+l*r-h*n,f*o-l*n-h*r-d*i,l*u+f*a+h*c-d*s+p*o+m*n+v*i-y*r,h*u+f*s+d*a-l*c+v*o+m*r+y*n-p*i,d*u+f*c+l*s-h*a+y*o+m*i+p*r-v*n,f*u-l*a-h*s-d*c+m*o-p*n-v*r-y*i]},n.TAU=n.TO_DEG=n.TO_RAD=void 0;const r=Math.PI/180;n.TO_RAD=r;const i=1/r;n.TO_DEG=i;const o=2*Math.PI;function a(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function s(t){const e=1/a(t);return[t[0]*e,t[1]*e]}function c(t,e){return[t[0]+e[0],t[1]+e[1]]}function u(t,e){return[t[0]-e[0],t[1]-e[1]]}function l(t,e){return t[0]*e[0]+t[1]*e[1]}function h(){return[1,1,1]}function d(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function f(t){const e=1/d(t);return[t[0]*e,t[1]*e,t[2]*e]}function p(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function v(t,e){const n=Math.sin(e),r=Math.cos(e);return[n*t[2]+r*t[0],t[1],r*t[2]-n*t[0]]}function y(t,e){const n=Math.sin(e),r=Math.cos(e);return[r*t[0]-n*t[1],n*t[0]+r*t[1],t[2]]}function m(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}function g(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function b(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function w(t,e){const n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return[r*s-i*a,i*o-n*s,n*a-r*o]}function _(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function k(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function S(t,e){const n=.5*e,r=Math.sin(n),i=Math.cos(n);return[r*t[0],r*t[1],r*t[2],i]}function x(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function C(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function E(t){return[...t,0,0,0,0]}function O(t,e){const n=.5*e[0],r=.5*e[1],i=.5*e[2],o=t[0],a=t[1],s=t[2],c=t[3];return[o,a,s,c,n*c+r*s-i*a,r*c+i*o-n*s,i*c+n*a-r*o,-n*o-r*a-i*s]}n.TAU=o},{}],abLO:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PM_MouseLook=n.AM_MouseLook=n.PM_Avatar=n.AM_Avatar=n.PM_Smoothed=n.AM_Smoothed=n.PM_Spatial=n.AM_Spatial=n.PM_Tree=n.AM_Tree=n.RegisterMixin=n.mix=void 0;var r=t("@croquet/croquet"),i=t("./NamedView"),o=t("./Pawn"),a=t("./ViewRoot"),s=t("./Vector");n.mix=t=>new u(t);const c=t=>(0,r.addClassHash)(t);n.RegisterMixin=c;class u{constructor(t){this.superclass=t}with(...t){return(0,r.addClassHash)(t),t.reduce((t,e)=>e(t),this.superclass)}}const l=t=>(class extends t{destroy(){this.parent&&this.parent.removeChild(this),this.children&&this.children.forEach(t=>t.destroy()),super.destroy()}addChild(t){t.parent&&t.parent.removeChild(t),this.children||(this.children=new Set),this.children.add(t),t.parent=this,this.say("tree_addChild",t.id)}removeChild(t){this.children&&this.children.delete(t),t.parent=null,this.say("tree_removeChild",t.id)}});n.AM_Tree=l,c(l);const h=t=>(class extends t{constructor(...t){super(...t),this.listen("tree_addChild",this.onAddChild),this.listen("tree_removeChild",this.onRemoveChild)}link(){super.link(),this.actor.children&&this.actor.children.forEach(t=>this.onAddChild(t.id))}onAddChild(t){const e=(0,i.GetNamedView)("PawnManager").get(t);e&&(this.children||(this.children=new Set),this.children.add(e),e.parent=this)}onRemoveChild(t){const e=(0,i.GetNamedView)("PawnManager").get(t);e&&(this.children&&this.children.delete(e),e.parent=null)}});n.PM_Tree=h;const d=t=>(class extends(l(t)){init(...t){this.scale=(0,s.v3_unit)(),this.rotation=(0,s.q_identity)(),this.location=(0,s.v3_zero)(),super.init(...t)}localChanged(){this.$local=null,this.say("spatial_localChanged"),this.globalChanged()}globalChanged(){this.$global=null,this.say("spatial_globalChanged"),this.children&&this.children.forEach(t=>t.globalChanged())}setScale(t){this.scale=t,this.say("spatial_setScale",t),this.localChanged()}setRotation(t){this.rotation=t,this.say("spatial_setRotation",t),this.localChanged()}setLocation(t){this.location=t,this.say("spatial_setLocation",t),this.localChanged()}get local(){return this.$local||(this.$local=(0,s.m4_scalingRotationTranslation)(this.scale,this.rotation,this.location)),this.$local}get global(){return this.$global?this.$global:(this.parent?this.$global=(0,s.m4_multiply)(this.local,this.parent.global):this.$global=this.local,this.$global)}});n.AM_Spatial=d,c(d);const f=t=>(class extends(h(t)){constructor(...t){super(...t),this.listenOnce("spatial_localChanged",()=>this.localChanged()),this.listenOnce("spatial_globalChanged",()=>this.globalChanged())}localChanged(){}globalChanged(){this.refresh()}get scale(){return this.actor.scale}get location(){return this.actor.location}get rotation(){return this.actor.rotation}get local(){return this.actor.local}get global(){return this.actor.global}});n.PM_Spatial=f;const p=t=>(class extends(d(t)){moveTo(t){this.location=t,this.say("smoothed_moveTo",t)}rotateTo(t){this.rotation=t,this.say("smoothed_rotateTo",t)}scaleTo(t){this.scale=t,this.say("smoothed_scaleTo",t)}});n.AM_Smoothed=p,c(p);const v=t=>(class extends((t=>(0,o.PM_Dynamic)(f(t)))(t)){constructor(...t){super(...t),this._scale=this.actor.scale,this._rotation=this.actor.rotation,this._location=this.actor.location,this.tug=.2,this.scaleEpsilon=1e-4,this.rotationEpsilon=1e-6,this.locationEpsilon=1e-4,this.listenOnce("spatial_setScale",t=>this._scale=t),this.listenOnce("spatial_setRotation",t=>this._rotation=t),this.listenOnce("spatial_setLocation",t=>this._location=t),this.listenOnce("smoothed_moveTo",()=>this.isMoving=!0),this.listenOnce("smoothed_rotateTo",()=>this.isRotating=!0),this.listenOnce("smoothed_scaleTo",()=>this.isScaling=!0)}localChanged(){this._local=null,this.globalChanged()}globalChanged(){this._global=null,this.needRefresh=!0,this.children&&this.children.forEach(t=>t.globalChanged())}get scale(){return this._scale}get location(){return this._location}get rotation(){return this._rotation}get local(){return this._local||(this._local=(0,s.m4_scalingRotationTranslation)(this._scale,this._rotation,this._location)),this._local}get global(){return this._global?this._global:(this.parent?this._global=(0,s.m4_multiply)(this.local,this.parent.global):this._global=this.local,this._global)}update(t){super.update(t);let e=this.tug;this.delta&&(e=Math.min(1,e*this.delta/15));const n=this.isMoving||this.isRotating||this.isScaling;this.isScaling&&(this._scale=(0,s.v3_lerp)(this._scale,this.actor.scale,e),this.isScaling=!(0,s.v3_equals)(this._scale,this.actor.scale,this.scaleEpsilon)),this.isRotating&&(this._rotation=(0,s.q_slerp)(this._rotation,this.actor.rotation,e),this.isRotating=!(0,s.q_equals)(this._rotation,this.actor.rotation,this.rotationEpsilon)),this.isMoving&&(this._location=(0,s.v3_lerp)(this._location,this.actor.location,e),this.isMoving=!(0,s.v3_equals)(this._location,this.actor.location,this.locationEpsilon)),n&&this.localChanged(),this.needRefresh&&this.refresh(),this.needRefresh=!1}});n.PM_Smoothed=v;const y=t=>(class extends(p(t)){init(...t){super.init(...t),this.avatar_tickStep=15,this.velocity=(0,s.v3_zero)(),this.spin=(0,s.q_identity)(),this.listen("avatar_moveTo",this.onMoveTo),this.listen("avatar_rotateTo",this.onRotateTo),this.listen("avatar_setVelocity",this.onSetVelocity),this.listen("avatar_setSpin",this.onSetSpin),this.future(0).tick(0)}onMoveTo(t){this.moveTo(t)}onRotateTo(t){this.rotateTo(t)}onSetVelocity(t){this.velocity=t,this.isMoving=!(0,s.v3_isZero)(this.velocity)}onSetSpin(t){this.spin=t,this.isRotating=!(0,s.q_isZero)(this.spin)}tick(t){if(this.isRotating&&this.rotateTo((0,s.q_normalize)((0,s.q_slerp)(this.rotation,(0,s.q_multiply)(this.rotation,this.spin),t))),this.isMoving){let e=this.location;this.moveTo(this.verify((0,s.v3_add)(this.location,(0,s.v3_scale)(this.velocity,t)),e))}this.future(this.avatar_tickStep).tick(this.avatar_tickStep)}verify(t,e){return t}});n.AM_Avatar=y,c(y);n.PM_Avatar=t=>(class extends(v(t)){constructor(...t){super(...t),this.tug=.05,this.velocity=(0,s.v3_zero)(),this.spin=(0,s.q_identity)()}moveTo(t){this._location=t,this.say("avatar_moveTo",t)}rotateTo(t){this._rotation=t,this.say("avatar_rotateTo",t)}setVelocity(t){this.velocity=t,this.isMoving=this.isMoving||!(0,s.v3_isZero)(this.velocity),this.say("avatar_setVelocity",this.velocity)}setSpin(t){this.spin=t,this.isRotating=this.isRotating||!(0,s.q_isZero)(this.spin),this.say("avatar_setSpin",this.spin)}update(t){if(this.isRotating&&(this._rotation=(0,s.q_normalize)((0,s.q_slerp)(this._rotation,(0,s.q_multiply)(this._rotation,this.spin),(0,a.GetViewDelta)()))),this.isMoving){let t=this._location;this._location=this.verify((0,s.v3_add)(this._location,(0,s.v3_scale)(this.velocity,(0,a.GetViewDelta)())),t)}super.update(t)}verify(t,e){return t}});const m=t=>(class extends(p(t)){init(...t){super.init(...t),this.mouseLook_tickStep=15,this.speed=0,this.strafeSpeed=0,this.multiplySpeed=1,this.spin=(0,s.q_identity)(),this.grounded=!0,this.listen("mouseLook_moveTo",this.onMoveTo),this.listen("mouseLook_rotateTo",this.onRotateTo),this.listen("mouseLook_setSpeed",this.onSetSpeed),this.listen("mouseLook_setStrafeSpeed",this.onSetStrafeSpeed),this.listen("mouseLook_setMultiplySpeed",this.onSetMultiplySpeed),this.listen("mouseLook_setSpin",this.onSetSpin),this.listen("mouseLook_showState",this.onShowState),this.tickCounter=0,this.movingCounter=0,this.checkSum=0,this.future(0).tick(0)}onMoveTo(t){this.moveTo(t)}onRotateTo(t){this.rotateTo(t)}onSetSpeed(t){this.speed=t,this.isMoving=0!==t||0!==this.strafeSpeed}onSetStrafeSpeed(t){this.strafeSpeed=t,this.isMoving=0!==t||0!==this.speed}onSetMultiplySpeed(t){this.multiplySpeed=t}onSetSpin(t){this.spin=t,this.isRotating=!(0,s.q_isZero)(this.spin)}onShowState(){console.log("--AM_MouseLook State--"),console.log("AM_MouseLook: ",this),console.log("location: ",this.location),console.log("rotation: ",this.rotation),console.log("checkSum: ",this.checkSum)}setGrounded(t){this.grounded=t}tick(t){if(this.isRotating&&this.rotateTo((0,s.q_normalize)((0,s.q_slerp)(this.rotation,(0,s.q_multiply)(this.rotation,this.spin),t))),this.isMoving){let e=(0,s.m4_rotationQ)(this.rotation);this.grounded&&(e=(0,s.m4_fastGrounded)(e));let n=this.location,r=this.location;this.speed&&(r=(0,s.v3_add)(r,(0,s.v3_scale)([e[8],e[9],e[10]],t*this.speed*this.multiplySpeed))),this.strafeSpeed&&(r=(0,s.v3_add)(r,(0,s.v3_scale)([e[0],e[1],e[2]],t*this.strafeSpeed*this.multiplySpeed))),this.moveTo(this.verify(r,n))}this.future(this.mouseLook_tickStep).tick(this.mouseLook_tickStep)}verify(t,e){return t}});n.AM_MouseLook=m,c(m);n.PM_MouseLook=t=>(class extends(v(t)){constructor(...t){super(...t),this.tug=.05,this.speed=0,this.strafeSpeed=0,this.multiplySpeed=1,this.spin=(0,s.q_identity)(),this.grounded=!0}moveTo(t){this._location=t,this.say("mouseLook_moveTo",t)}rotateTo(t){this._rotation=t,this.say("mouseLook_rotateTo",t)}setSpeed(t){this.speed=t,this.isMoving=this.isMoving||0!=t,this.say("mouseLook_setSpeed",t)}setStrafeSpeed(t){this.strafeSpeed=t,this.isMoving=this.isMoving||0!=t,this.say("mouseLook_setStrafeSpeed",t)}setMultiplySpeed(t){this.multiplySpeed=t,this.say("mouseLook_setMultiplySpeed",t)}setSpin(t){this.spin=t,this.isRotating=this.isRotating||!(0,s.q_isZero)(this.spin),this.say("mouseLook_setSpin",this.spin)}showState(){console.log("--PM_MouseLook State--"),console.log("PM_MouseLook: ",this),console.log("location: ",this._location),console.log("rotation: ",this._rotation),this.say("mouseLook_showState")}update(t){if(this.isRotating&&(this._rotation=(0,s.q_normalize)((0,s.q_slerp)(this._rotation,(0,s.q_multiply)(this._rotation,this.spin),(0,a.GetViewDelta)()))),this.isMoving){let t=this._location,e=(0,s.m4_rotationQ)(this._rotation);this.grounded&&(e=(0,s.m4_fastGrounded)(e)),this.speed&&(this._location=(0,s.v3_add)(this._location,(0,s.v3_scale)([e[8],e[9],e[10]],(0,a.GetViewDelta)()*this.speed*this.multiplySpeed))),this.strafeSpeed&&(this._location=(0,s.v3_add)(this._location,(0,s.v3_scale)([e[0],e[1],e[2]],(0,a.GetViewDelta)()*this.strafeSpeed*this.multiplySpeed))),this._location=this.verify(this._location,t)}super.update(t)}verify(t,e){return t}})},{"@croquet/croquet":"jiaI","./NamedView":"y6VD","./Pawn":"HzQ1","./ViewRoot":"E82y","./Vector":"k6uK"}],QUHU:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ModelRoot=void 0;var r=t("@croquet/croquet"),i=t("./Actor");class o extends r.Model{init(){super.init(),console.log("Starting model ..."),this.managers=new Set,this.actorManager=this.addManager(i.ActorManager.create())}destroy(){super.destroy(),this.managers.forEach(t=>t.destroy())}addManager(t){return this.managers.add(t),t}}n.ModelRoot=o,o.register("ModelRoot")},{"@croquet/croquet":"jiaI","./Actor":"CgTP"}],gImy:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.KeyDown=l,n.ChordDown=h,n.WebInputManager=void 0;var r=t("./Vector"),i=t("./NamedView");const o=300,a=10,s=300,c=50,u=new Set;function l(t){return u.has(t)}function h(t){let e=!0;return t.forEach(t=>{e&=l(t)}),e}n.WebInputManager=class extends i.NamedView{constructor(){super("Input"),this.listeners=[],this.touches=[],this.chords=new Map,this.addListener(document,"contextmenu",t=>t.preventDefault()),this.addListener(window,"resize",t=>this.onResize(t)),"ontouchstart"in document.documentElement&&(this.addListener(document,"touchstart",t=>this.onTouchStart(t)),this.addListener(document,"touchend",t=>this.onTouchEnd(t)),this.addListener(document,"touchmove",t=>this.onTouchMove(t)),this.addListener(document,"touchcancel",t=>this.onTouchCancel(t))),"onmousedown"in document.documentElement&&(this.addListener(document,"click",t=>this.onClick(t)),this.addListener(document,"mousedown",t=>this.onMouseDown(t)),this.addListener(document,"mouseup",t=>this.onMouseUp(t)),this.addListener(document,"mousemove",t=>this.onMouseMove(t)),this.addListener(document,"pointerlockchange",t=>this.onPointerLock(t)),this.addListener(document,"wheel",t=>this.onWheel(t))),"onkeydown"in document.documentElement&&(this.addListener(document,"keydown",t=>this.onKeyDown(t)),this.addListener(document,"keyup",t=>this.onKeyUp(t)))}destroy(){this.detach(),this.removeAllListeners()}addListener(t,e,n){t.addEventListener(e,n,{passive:!1}),this.listeners.push({element:t,type:e,callback:n})}removeListener(t){const e=this.listeners.filter(e=>e.type!==t);this.listeners.forEach(e=>{e.type===t&&e.element.removeEventListener(e.type,e.callback,{passive:!1})}),this.listeners=e}removeAllListeners(){this.listeners.forEach(t=>t.element.removeEventListener(t.type,t.callback,{passive:!1})),this.listeners=[]}addChord(t,e){e.forEach(n=>this.chords.set(n,{name:t,chord:e}))}get touchCount(){return this.touches.length}addTouch(t){this.getTouch(t.id)||this.touches.push(t)}removeTouch(t){this.touches=this.touches.filter(e=>e.id!==t)}getTouch(t){return this.touches.find(e=>e.id===t)}onChordDown(t){if(!this.chords.has(t))return;const e=this.chords.get(t);h(e.chord)&&this.inPointerLock&&this.publish("input",e.name+"Down")}onChordUp(t){if(!this.chords.has(t))return;const e=this.chords.get(t);h(e.chord)&&this.inPointerLock&&this.publish("input",e.name+"Up")}requestPointerLock(){return!this.inPointerLock&&(document.requestPointerLock=document.requestPointerLock||document.mozRequestPointerLock,document.documentElement.requestPointerLock(),!0)}get inPointerLock(){return document.pointerLockElement||document.mozPointerLockElement}onClick(t){}onPointerLock(t){this.inPointerLock?this.publish("input","pointerLockStart"):this.publish("input","pointerLockEnd")}onResize(t){this.publish("input","beforeResize"),this.future(500).futureResize()}futureResize(){this.publish("input","resize")}onKeyDown(t){t.stopPropagation(),t.preventDefault();const e=t.key;l(e)||(u.add(e),this.publish("input",e+"Down"),this.publish("input","keyDown",e),this.onChordDown(e))}onKeyUp(t){t.stopPropagation(),t.preventDefault();const e=t.key;l(e)&&(this.publish("input",e+"Up"),this.publish("input","keyUp",e),this.onChordUp(e),u.delete(e))}onMouseDown(t){t.stopPropagation(),t.preventDefault();let e="mouse"+t.button;l("Control")&&"mouse0"===e&&(e="mouse2"),l(e)||(u.add(e),this.publish("input",e+"Down"),this.onChordDown(e))}onMouseUp(t){t.stopPropagation(),t.preventDefault();let e="mouse"+t.button;l("Control")&&"mouse0"===e&&(e="mouse2"),l(e)&&(this.publish("input",e+"Up"),this.onChordUp(e),u.delete(e))}onWheel(t){t.stopPropagation(),t.preventDefault();const e=t.deltaY;this.publish("input","wheel",e)}onMouseMove(t){t.stopPropagation(),t.preventDefault();const e=t.clientX,n=t.clientY,r=t.movementX,i=t.movementY;this.publish("input","mouseXY",[e,n,r,i])}onTouchStart(t){t.stopPropagation(),t.preventDefault();for(const e of t.changedTouches){const n=e.identifier,r=e.clientX,i=e.clientY,o=t.timeStamp;this.addTouch({id:n,time:o,start:[r,i],current:[r,i]}),1===this.touchCount&&this.publish("input","touchDown",[r,i])}if(!this.inDouble&&this.touchCount>1){this.inDouble=!0;const t=this.touches[0],e=this.touches[1];t.doubleStart=t.current,e.doubleStart=e.current;const n=(0,r.v2_scale)((0,r.v2_add)(t.doubleStart,e.doubleStart),.5);this.publish("input","doubleStart",n)}}onTouchEnd(t){t.stopPropagation(),t.preventDefault();for(const e of t.changedTouches){const n=e.identifier,r=this.getTouch(n);if(this.removeTouch(n),!this.touchCount&&r){const n=e.clientX,i=e.clientY,u=t.timeStamp-r.time,l=n-r.start[0],h=i-r.start[1],d=Math.abs(l),f=Math.abs(h);u<o&&d<a&&f<a&&this.publish("input","touchTap",[n,i]),u<s&&d>c&&this.publish("input","touchSwipeX",l),u<s&&f>c&&this.publish("input","touchSwipeY",h),this.publish("input","touchUp",[n,i])}}if(this.inDouble)if(this.touchCount>1){const t=this.touches[0],e=this.touches[1];t.doubleStart=t.current,e.doubleStart=e.current;const n=(0,r.v2_scale)((0,r.v2_add)(t.doubleStart,e.doubleStart),.5);this.publish("input","doubleEnd"),this.publish("input","doubleStart",n)}else this.inDouble=!1,this.publish("input","doubleEnd")}onTouchMove(t){t.stopPropagation(),t.preventDefault();for(const e of t.changedTouches){const t=e.identifier,n=this.getTouch(t);if(!n)continue;const r=e.clientX,i=e.clientY;n.current=[r,i]}if(1===this.touchCount){const t=this.touches[0],e=t.current[0]-t.start[0],n=t.current[1]-t.start[1];(Math.abs(e)>a||Math.abs(n)>a)&&this.publish("input","touchXY",t.current)}else if(this.touchCount>1){const t=this.touches[0],e=this.touches[1],n=(0,r.v2_scale)((0,r.v2_add)(t.current,e.current),.5),i=(0,r.v2_sub)(e.doubleStart,t.doubleStart),o=(0,r.v2_sub)(e.current,t.current),a=(0,r.v2_magnitude)(i),s=(0,r.v2_magnitude)(o);let c=1;a>0&&(c=s/a);const u=Math.atan2(i[0],i[1]);let l=(Math.atan2(o[0],o[1])-u+r.TAU)%r.TAU;l>Math.PI&&(l-=r.TAU),this.publish("input","doubleChanged",{xy:n,zoom:c,dial:l})}}onTouchCancel(t){t.stopPropagation(),t.preventDefault(),this.touches=[]}validDouble(){return this.touch0&&this.touch1}}},{"./Vector":"k6uK","./NamedView":"y6VD"}],lJTx:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UnityViewStarter=n.UnityViewRoot=n.PM_UnityAvatar=n.PM_UnitySmoothed=n.PM_UnitySpatial=n.PM_RenderUnity=void 0;var r=t("@croquet/croquet"),i=t("./ViewRoot"),o=t("./NamedView"),a=t("./Mixins"),s=t("./Vector");let c;const u=t=>t.map(t=>String(Math.round(1e4*t))).join(","),l=t=>(class extends t{constructor(...t){super(...t);const e=this.unityRenderManager=c;this.unityHandle=e.nextHandleForPawn(this),this.publish(e.id,"unity_pawn_created",this.unityHandle)}destroy(){this.isDefunct||(this.isDefunct=!0,super.destroy(),this.deleteUnityObject())}sendToUnity(t,e){this.unityRenderManager.sendToUnity(t,e)}createUnityObject(){if(this.isDefunct)return void console.log("Pawn destroyed before unity object creation!");const t=this.unityConfig||this.actor.unityConfig||{},e={type:t.type||"empty"};this.addDefaultUnityConfig(e);const n={...e,...t};this.unityRenderManager.create(this.unityHandle,n)}addDefaultUnityConfig(t){"empty"!==t.type&&Object.assign(t,{hsv:[120,100,100],alpha:1})}deleteUnityObject(){this.unityRenderManager.delete(this.unityHandle)}});n.PM_RenderUnity=l;const h=t=>(class extends((0,a.mix)(t).with(l,a.PM_Spatial)){constructor(...t){super(...t),this.listenOnce("spatial_setLocation",t=>this.sendUnityUpdate({setP:u(t)})),this.listenOnce("spatial_setRotation",t=>this.sendUnityUpdate({setR:u(t)})),this.listenOnce("spatial_setScale",t=>this.sendUnityUpdate({setS:u(t)}))}addDefaultUnityConfig(t){super.addDefaultUnityConfig(t),Object.assign(t,{setP:u(this.location),setR:u(this.rotation),setS:u(this.scale)})}onAddChild(t){const e=(0,o.GetNamedView)("PawnManager").get(t);e&&(super.onAddChild(t),this.unityRenderManager.addChild(this.unityHandle,e.unityHandle))}sendUnityUpdate(t){this.unityRenderManager.sendUpdate(this.unityHandle,t,this.actor.lastEventTime)}});n.PM_UnitySpatial=h;const d=t=>(class extends(h(t)){constructor(...t){super(...t),this.listenOnce("smoothed_moveTo",t=>this.sendUnityUpdate({toP:u(t)})),this.listenOnce("smoothed_rotateTo",t=>this.sendUnityUpdate({toR:u(t)})),this.listenOnce("smoothed_scaleTo",t=>this.sendUnityUpdate({toS:u(t)}))}});n.PM_UnitySmoothed=d;n.PM_UnityAvatar=t=>(class extends(d(t)){addDefaultUnityConfig(t){if(super.addDefaultUnityConfig(t),"userAvatar"===t.type){const e=this.unityRenderManager.localUserRecord;e&&e.avatar===this.actor&&(t.viewId=this.viewId)}}moveTo(t){this.say("avatar_moveTo",t)}rotateTo(t){this.say("avatar_rotateTo",t)}setVelocity(t){this.say("avatar_setVelocity",t)}setSpin(t){this.say("avatar_setSpin",t)}});class f extends o.NamedView{constructor(t){super("UnityRenderManager"),console.log("Start up URM"),this.bootstrapView=t,this.nextHandle=1,this.pawnsByHandle={},this.dataChannelReady=!1,this.unityQueue=[],this.addSubscriptions(),window.unitySideChannelMessage=t=>this.handleUnityMessage(t),this.prepareUnityDataChannel()}addSubscriptions(){this.subscribe(this.id,"unity_pawn_created",this.triggerCreateUnityObject),this.subscribe(this.viewId,{event:"synced",handling:"immediate"},this.handleSyncState),this.handleSyncState(this.realm.isSynced()),this.subscribe("unity","messageForUnity",this.forwardMessageToUnity)}reattach(){super.reattach(),this.addSubscriptions()}destroy(){console.log(`shutting down URM ${this.id}`);const t=(0,o.GetNamedView)("PawnManager");t&&t.pawns.forEach(t=>{t.createUnityObject&&t.destroy()}),this.flushUnityQueue(),this.unsubscribe("unity","messageForUnity"),this.bootstrapView=null,this.nextHandle=1,this.detach()}forwardMessageToUnity(t){this.sendToUnity(t.selector,t.data)}get localUserRecord(){return this.bootstrapView.model.userRegistry[this.bootstrapView.viewId]}get localUserIndex(){const t=this.localUserRecord;return t&&t.userIndex}sendOnUnitySideChannel(t,e){const n=`uniwebview://${`croquetMessage?selector=${t}&data=${encodeURIComponent(JSON.stringify(e))}`}`;window.location.href=n}prepareUnityDataChannel(){const t=this.connection=new RTCPeerConnection(null);t.addEventListener("datachannel",t=>{console.log("datachannel",t);const e=this.dataChannel=t.channel;e.onopen=t=>console.log("data channel opened"),e.onerror=t=>console.log(`data channel error: ${t.message}`),e.onclose=t=>console.log("data channel closed"),e.addEventListener("message",t=>this.dataChannelMessage(t))}),t.addEventListener("connectionstatechange",e=>{const n=t.connectionState;switch(console.log(`connectionstatechange: ${n}`),n){case"connected":case"disconnected":break;case"failed":case"closed":console.warn("Unexpected shutdown of data channel"),this.dataChannelReady=!1,this.prepareUnityDataChannel()}}),t.addEventListener("icecandidate",t=>console.log("local ICE candidate",t))}addIceCandidate(t){const e=new RTCIceCandidate(t);this.connection.addIceCandidate(e).catch(t=>console.error("CONNECTION ADD ICE FAILED",t.name,t.message))}async receiveOffer(t){const e=t.offer.replace(/_\+_/g,"\n");console.log("receive offer",e);const n=this.connection;await n.setRemoteDescription({type:"offer",sdp:e});const r=await n.createAnswer();await n.setLocalDescription(r);const i=r.sdp.replace(/\r\n?|\n/g,"_+_");this.sendOnUnitySideChannel("rtc_setup_answer",{answer:i})}sendToUnity(t,e){this.unityQueue.push({selector:t,data:e})}flushUnityQueue(){if(!this.dataChannelReady)return;const t=this.unityQueue;if(!t.length)return;const e=[];let n=0;let r=0;for(;r<t.length&&n<6e4;){const i=t[r],o=JSON.stringify(i.data);e.push(i.selector,o),n+=i.selector.length+o.length+2,r++}r<t.length?(console.log(`reached maximum message-buffer size; holding back ${t.length-r} messages`),t.splice(0,r)):t.length=0;const i=e.join("\n");this.dataChannel.send(i)}dataChannelMessage(t){this.handleUnityMessage(t.data)}handleUnityMessage(t){if(!this.bootstrapView)return;const e=JSON.parse(t);e.data=e.data||{};const{selector:n,data:r}=e;if("rtc_setup_ice_candidate"===n)this.addIceCandidate(r);else if("rtc_setup_offer"===n)this.receiveOffer(r);else if("unity_ready"===n)this.dataChannelReady=!0,this.handleSyncState(this.realm.isSynced());else if("avatar_velocity"===n){const t=this.pawnsByHandle[r.h];if(t){const e=void 0===r.x?[0,0,0]:[r.x,r.y,r.z];t.setVelocity(e)}}else if("avatar_spin"===n){const t=this.pawnsByHandle[r.h];if(t){let e;if(void 0===r.x)e=(0,s.q_identity)();else{const t=[r.x,r.y,r.z],n=r.rate;e=(0,s.q_axisAngle)(t,n)}t.setSpin(e)}}else r.userViewId=this.bootstrapView.viewId,this.publish("unity","reflectedUnityEvent",e)}handleSyncState(t){this.waitingForIslandSync=!t,console.log(`synced: ${t}`),this.dataChannelReady&&this.sendToUnity("set_sync_state",{synced:t})}update(t){super.update(t),this.flushUnityQueue()}nextHandleForPawn(t){const e=this.nextHandle++;return this.pawnsByHandle[e]=t,e}triggerCreateUnityObject(t){const e=this.pawnsByHandle[t];e&&e.createUnityObject()}create(t,e){this.sendToUnity("create_object",{handle:t,...e})}delete(t){delete this.pawnsByHandle[t],this.sendToUnity("delete_object",{h:t})}addChild(t,e){this.sendToUnity("add_child",{h:t,childH:e})}sendUpdate(t,e){const n={h:t,...e};this.sendToUnity("update_object",n)}}class p extends i.ViewRoot{constructor(t){super(t),this.model=t}createManagers(){this.addManager(c),super.createManagers()}}n.UnityViewRoot=p;let v=p;n.UnityViewStarter=class extends r.View{static setViewRoot(t){v=t}constructor(t){console.log("starting bootstrap view"),super(t),this.model=t,this.sessionView=null;let e=c;e?(e.bootstrapView=this,e.reattach()):e=c=new f(this),e.dataChannelReady||e.sendOnUnitySideChannel("URM_ready",{viewId:this.viewId})}update(t){this.sessionView?this.sessionView.update(t):c.dataChannelReady&&v&&(this.sessionView=new v(this.model))}detach(){this.sessionView&&(this.sessionView.detach(),delete this.sessionView),super.detach()}}},{"@croquet/croquet":"jiaI","./ViewRoot":"E82y","./NamedView":"y6VD","./Mixins":"abLO","./Vector":"k6uK"}],tJ9X:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./src/Actor");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return r[t]}})});var i=t("./src/Mixins");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return i[t]}})});var o=t("./src/ModelRoot");Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return o[t]}})});var a=t("./src/NamedView");Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return a[t]}})});var s=t("./src/Pawn");Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return s[t]}})});var c=t("./src/ViewRoot");Object.keys(c).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return c[t]}})});var u=t("./src/WebInput");Object.keys(u).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return u[t]}})});var l=t("./src/UnityRender");Object.keys(l).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return l[t]}})})},{"./src/Actor":"CgTP","./src/Mixins":"abLO","./src/ModelRoot":"QUHU","./src/NamedView":"y6VD","./src/Pawn":"HzQ1","./src/ViewRoot":"E82y","./src/WebInput":"gImy","./src/UnityRender":"lJTx"}],hdhl:[function(t,e,n){"use strict";t("regenerator-runtime/runtime");var r=t("@croquet/croquet"),i=t("@croquet/worldcore"),o=t("@croquet/worldcore/src/Vector"),a=t("@croquet/worldcore/src/UnityRender");function s(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=b(t);if(e){var i=b(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}function g(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w=r.Constants;w.BALL_RADIUS=.2,w.BALL_SPEED=3,w.GRAVITY=1,w.BALL_LAUNCH_INTERVAL=250,w.BALL_STEP_MS=20;var _=function(t){v(n,(0,i.mix)(i.Actor).with(i.AM_Spatial));var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return n}();_.register("SpatialActor"),function(t){v(n,(0,i.mix)(i.Pawn).with(a.PM_UnitySpatial));var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return n}().register("UnitySpatialPawn");var k=function(t){v(n,(0,i.mix)(i.Actor).with(i.AM_Smoothed));var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return n}();k.register("SmoothedActor"),function(t){v(n,(0,i.mix)(i.Pawn).with(a.PM_UnitySmoothed));var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return n}().register("UnitySmoothedPawn");var S=function(t){v(n,(0,i.mix)(i.Actor).with(i.AM_Avatar));var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return n}();S.register("AvatarActor"),function(t){v(n,(0,i.mix)(i.Pawn).with(a.PM_UnityAvatar));var e=m(n);function n(){var t;p(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).listen("captureCamera",t.captureCamera),t}return d(n,[{key:"captureCamera",value:function(){this.sendToUnity("attach_camera",{h:this.unityHandle})}}]),n}().register("UnityAvatarPawn");var x=function(t){v(n,k);var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return d(n,[{key:"init",value:function(){var t=this;l(b(n.prototype),"init",this).call(this,"UnitySmoothedPawn");var e=function(e){return Math.floor(e*t.random())},r=[e(360),e(50)+50,75];this.unityConfig={type:"sphere",hsv:r},this.setLocation([-4,0,-4]),this.setScale([w.BALL_RADIUS,w.BALL_RADIUS,w.BALL_RADIUS]);var i=(40*Math.random()+30)*Math.PI/180;this.velocity=[w.BALL_SPEED*Math.cos(i),w.BALL_SPEED*Math.sin(i),0],this.future(w.BALL_STEP_MS).move()}},{key:"move",value:function(){var t=w.BALL_STEP_MS/1e3,e=this.location.slice();e[1]+=this.velocity[1]*t,e[1]<0?this.destroy():(e[0]+=this.velocity[0]*t,this.velocity[1]-=w.GRAVITY*t,this.moveTo(e),this.future(w.BALL_STEP_MS).move())}}]),n}();x.register("BallActor");var C=function(t){v(n,i.ModelRoot);var e=m(n);function n(){return p(this,n),e.apply(this,arguments)}return d(n,[{key:"init",value:function(){l(b(n.prototype),"init",this).call(this),console.log("starting root!"),this.userColors=[0,60,120,180,240,300,360].map(function(t){return[t,75,75]}),this.userRegistry={},this.cameraOwner=null,this.subscribe(this.sessionId,"view-join",this.addUser),this.subscribe(this.sessionId,"view-exit",this.removeUser),this.subscribe("unity","reflectedUnityEvent",this.reactToReflectedEvent),this.createSceneObjects(),this.tickSceneObjects(),this.tickBallLauncher()}},{key:"addUser",value:function(t){if(this.userRegistry[t])console.log("user ".concat(t," already registered"));else{for(var e=Object.values(this.userRegistry).map(function(t){return t.userIndex}),n=0;e.includes(n);)n++;var r=_.create("UnitySpatialPawn");r.unityConfig={type:"cube",hsv:this.userColors[n],alpha:.4},r.setScale([.5,1,.5]),r.setLocation([0,-.75,0]);var i=_.create("UnitySpatialPawn");i.unityConfig={type:"sphere",hsv:this.userColors[n],alpha:.4},i.setScale([.5,.5,.5]);var o=S.create("UnityAvatarPawn");o.unityConfig={type:"userAvatar"},o.addChild(r),o.addChild(i),o.setLocation([n-1,1.25,-7]),this.userRegistry[t]={userIndex:n,avatar:o}}console.log(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this.userRegistry))}},{key:"removeUser",value:function(t){var e=this.userRegistry[t];if(e){var n=e.avatar;if(n===this.cameraOwner){this.publish("unity","messageForUnity",{selector:"attach_camera",data:{h:null}}),this.cameraOwner=null}n.destroy(),delete this.userRegistry[t]}else console.log("user ".concat(t," not found"));console.log(this.userRegistry)}},{key:"reactToReflectedEvent",value:function(t){var e=t.selector,n=t.data.userViewId,r=this.userRegistry[n];if(r){if("test_trigger"===e){var i=r.avatar,o=i.location.slice();o[1]=3.5-o[1],i.setLocation(o)}else if("capture_camera"===e){var a=r.avatar;this.cameraOwner=a,a.say("captureCamera")}}else console.error("can't find user record for viewId ".concat(n))}},{key:"createSceneObjects",value:function(){var t=_.create("UnitySpatialPawn");t.unityConfig={type:"cube",hsv:[20,50,75]},t.setScale([100,.1,100]),this.bars=[[],[]],this.connectors=[[],[]];var e=this.minBarLength=.25;this.maxBarLength=1;for(var n=0;n<2;n++)for(var r=void 0,i=0;i<5;i++){var o=k.create("UnitySmoothedPawn");o.unityConfig={type:"cube",hsv:[1&i?120:240,75,75]};var a=.2-.02*i;if(o.setScale([a,e,a]),this.bars[n].push(o),r){var s=k.create("UnitySmoothedPawn");s.setLocation([.2*n-.1,e/2,0]),r.addChild(s),o.setLocation([0,e/2,0]),s.addChild(o),this.connectors[n].push(s)}else o.setLocation([0,e/2,-4]);r=o}this.t=0,this.stepDelta=50}},{key:"tickSceneObjects",value:function(){this.t+=this.stepDelta;for(var t=2*this.t*Math.PI/1e4,e=Math.sin(t),n=e*e,r=this.minBarLength+(this.maxBarLength-this.minBarLength)*n,i=this.bars[0].length,a=Math.PI/2/(i-1),s=0;s<2;s++)for(var c=0;c<i;c++){if(c>0){var u=this.connectors[s][c-1];u.moveTo([0,r/2,0]),u.rotateTo((0,o.q_axisAngle)([0,0,1],n*(s||-1)*a))}var l=this.bars[s][c],h=l.scale.slice();h[1]=r,l.scaleTo(h),l.moveTo([0,r/2,0===c?-4:0])}this.future(this.stepDelta).tickSceneObjects()}},{key:"tickBallLauncher",value:function(){x.create(),this.future(w.BALL_LAUNCH_INTERVAL).tickBallLauncher()}}]),n}();C.register("UnitySessionModel");var E=function(t){v(n,a.UnityViewRoot);var e=m(n);function n(t){var r;return p(this,n),console.log("starting app view root"),r=e.call(this,t),t.cameraOwner&&t.cameraOwner.say("captureCamera"),r}return n}();function O(){var t;return t=regeneratorRuntime.mark(function t(){var e,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,a.UnityViewStarter.setViewRoot(E),t.next=4,(0,r.startSession)("wc-unity14",C,a.UnityViewStarter,{step:"manual",tps:"20x5",expectedSimFPS:0});case 4:n=t.sent,i=function(){var t=Date.now();t-e>15&&(n.step(t),e=t)},n.view.realm.island.controller.tickHook=function(){return Promise.resolve().then(i)};case 8:case"end":return t.stop()}},t)}),(O=function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){s(o,r,i,a,c,"next",t)}function c(t){s(o,r,i,a,c,"throw",t)}a(void 0)})}).apply(this,arguments)}!function(){O.apply(this,arguments)}()},{"regenerator-runtime/runtime":"KA2S","@croquet/croquet":"nlD3","@croquet/worldcore":"tJ9X","@croquet/worldcore/src/Vector":"k6uK","@croquet/worldcore/src/UnityRender":"lJTx"}]},{},["hdhl"]);</script>
    </body>
</html>
