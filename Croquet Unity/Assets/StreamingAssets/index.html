<html>
    <head>
        <meta charset="utf-8">
        <title>unity-blocks</title>
        <style>body {
                overflow: hidden;
                background: rgb(54, 223, 104);
            }</style>
    </head>
    <body>
        <script>parcelRequire=function(t,e,n,r){var i,o="function"==typeof parcelRequire&&parcelRequire,s="function"==typeof require&&require;function a(n,r){if(!e[n]){if(!t[n]){var i="function"==typeof parcelRequire&&parcelRequire;if(!r&&i)return i(n,!0);if(o)return o(n,!0);if(s&&"string"==typeof n)return s(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}u.resolve=function(e){return t[n][1][e]||e},u.cache={};var l=e[n]=new a.Module(n);t[n][0].call(l.exports,u,l,l.exports,this)}return e[n].exports;function u(t){return a(u.resolve(t))}}a.isParcelRequire=!0,a.Module=function(t){this.id=t,this.bundle=a,this.exports={}},a.modules=t,a.cache=e,a.parent=o,a.register=function(e,n){t[e]=[function(t,e){e.exports=n},{}]};for(var c=0;c<n.length;c++)try{a(n[c])}catch(t){i||(i=t)}if(n.length){var l=a(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd&&define(function(){return l})}if(parcelRequire=a,i)throw i;return a}({KA2S:[function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(t,e,n,r){var i=e&&e.prototype instanceof m?e:m,o=Object.create(i.prototype),s=new M(r||[]);return o._invoke=function(t,e,n){var r=u;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw o;return T()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=x(s,n);if(a){if(a===p)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=l(t,e,n);if("normal"===c.type){if(r=n.done?f:h,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(t,n,s),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var u="suspendedStart",h="suspendedYield",d="executing",f="completed",p={};function m(){}function g(){}function y(){}var w={};w[o]=function(){return this};var v=Object.getPrototypeOf,b=v&&v(v(O([])));b&&b!==n&&r.call(b,o)&&(w=b);var _=y.prototype=m.prototype=Object.create(w);function k(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t,e){var n;this._invoke=function(i,o){function s(){return new e(function(n,s){!function n(i,o,s,a){var c=l(t[i],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then(function(t){n("next",t,s,a)},function(t){n("throw",t,s,a)}):e.resolve(h).then(function(t){u.value=t,s(u)},function(t){return n("throw",t,s,a)})}a(c.arg)}(i,o,n,s)})}return n=n?n.then(s,s):s()}}function x(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function O(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}return{next:T}}function T(){return{value:e,done:!0}}return g.prototype=_.constructor=y,y.constructor=g,y[a]=g.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},k(S.prototype),S.prototype[s]=function(){return this},t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var s=new S(c(e,n,r,i),o);return t.isGeneratorFunction(n)?s:s.next().then(function(t){return t.done?t.value:s.next()})},k(_),_[a]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),l=r.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),p}},t}("object"==typeof e?e.exports:{});try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},{}],vwDV:[function(t,e,n){"use strict";e.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var n,r="boolean"==typeof e.cycles&&e.cycles,i=e.cmp&&(n=e.cmp,function(t){return function(e,r){var i={key:e,value:t[e]},o={key:r,value:t[r]};return n(i,o)}}),o=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var n,s;if(Array.isArray(e)){for(s="[",n=0;n<e.length;n++)n&&(s+=","),s+=t(e[n])||"null";return s+"]"}if(null===e)return"null";if(-1!==o.indexOf(e)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(e)-1,c=Object.keys(e).sort(i&&i(e));for(s="",n=0;n<c.length;n++){var l=c[n],u=t(e[l]);u&&(s&&(s+=","),s+=JSON.stringify(l)+":"+u)}return o.splice(a,1),"{"+s+"}"}}(t)}},{}],D2QR:[function(t,e,n){var r,i;r=this,i=function(t){var e=function(t){return new e.lib.init(t)};function n(t,e){return!(!t||"string"!=typeof e)&&!!(t.className&&t.className.trim().split(/\s+/gi).indexOf(e)>-1)}return e.lib=e.prototype={toastify:"1.7.0",constructor:e,init:function(t){return t||(t={}),this.options={},this.toastElement=null,this.options.text=t.text||"Hi there!",this.options.duration=0===t.duration?0:t.duration||3e3,this.options.selector=t.selector,this.options.callback=t.callback||function(){},this.options.destination=t.destination,this.options.newWindow=t.newWindow||!1,this.options.close=t.close||!1,this.options.gravity="bottom"===t.gravity?"toastify-bottom":"toastify-top",this.options.positionLeft=t.positionLeft||!1,this.options.position=t.position||"",this.options.backgroundColor=t.backgroundColor,this.options.avatar=t.avatar||"",this.options.className=t.className||"",this.options.stopOnFocus=void 0===t.stopOnFocus||t.stopOnFocus,this.options.onClick=t.onClick,this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var t=document.createElement("div");if(t.className="toastify on "+this.options.className,this.options.position?t.className+=" toastify-"+this.options.position:!0===this.options.positionLeft?(t.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):t.className+=" toastify-right",t.className+=" "+this.options.gravity,this.options.backgroundColor&&(t.style.background=this.options.backgroundColor),t.innerHTML=this.options.text,""!==this.options.avatar){var e=document.createElement("img");e.src=this.options.avatar,e.className="toastify-avatar","left"==this.options.position||!0===this.options.positionLeft?t.appendChild(e):t.insertAdjacentElement("beforeend",e)}if(!0===this.options.close){var n=document.createElement("span");n.innerHTML="&#10006;",n.className="toast-close",n.addEventListener("click",function(t){t.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var r=window.innerWidth>0?window.innerWidth:screen.width;("left"==this.options.position||!0===this.options.positionLeft)&&r>360?t.insertAdjacentElement("afterbegin",n):t.appendChild(n)}if(this.options.stopOnFocus&&this.options.duration>0){const e=this;t.addEventListener("mouseover",function(e){window.clearTimeout(t.timeOutValue)}),t.addEventListener("mouseleave",function(){t.timeOutValue=window.setTimeout(function(){e.removeElement(t)},e.options.duration)})}return void 0!==this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),!0===this.options.newWindow?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),"function"==typeof this.options.onClick&&void 0===this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),this.options.onClick()}.bind(this)),t},showToast:function(){var t;if(this.toastElement=this.buildToast(),!(t=void 0===this.options.selector?document.body:document.getElementById(this.options.selector)))throw"Root element is not defined";return t.insertBefore(this.toastElement,t.firstChild),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(t){t.className=t.className.replace(" on",""),window.setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),this.options.callback.call(t),e.reposition()}.bind(this),400)}},e.reposition=function(){for(var t,e={top:15,bottom:15},r={top:15,bottom:15},i={top:15,bottom:15},o=document.getElementsByClassName("toastify"),s=0;s<o.length;s++){t=!0===n(o[s],"toastify-top")?"toastify-top":"toastify-bottom";var a=o[s].offsetHeight;t=t.substr(9,t.length-1);(window.innerWidth>0?window.innerWidth:screen.width)<=360?(o[s].style[t]=i[t]+"px",i[t]+=a+15):!0===n(o[s],"toastify-left")?(o[s].style[t]=e[t]+"px",e[t]+=a+15):(o[s].style[t]=r[t]+"px",r[t]+=a+15)}return this},e.lib.init.prototype=e.lib,e},"object"==typeof e&&e.exports?e.exports=i():r.Toastify=i()},{}],sC8V:[function(t,e,n){},{}],u80Q:[function(t,e,n){var r;arguments[3];!function(n,i){var o,s=(0,eval)("this"),a=256,c=6,l="random",u=i.pow(a,c),h=i.pow(2,52),d=2*h,f=a-1;function p(t,e,r){var f=[],p=y(function t(e,n){var r,i=[],o=typeof e;if(n&&"object"==o)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==o?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,w(n)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(s.crypto||s.msCrypto).getRandomValues(t)),w(t)}catch(t){var e=s.navigator,r=e&&e.plugins;return[+new Date,s,r,s.screen,w(n)]}}():t,3),f),v=new m(f),b=function(){for(var t=v.g(c),e=u,n=0;t<h;)t=(t+n)*a,e*=a,n=v.g(1);for(;t>=d;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,y(w(v.S),n),(e.pass||r||function(t,e,n,r){return r&&(r.S&&g(r,v),t.state=function(){return g(v,{})}),n?(i[l]=t,e):t})(b,p,"global"in e?e.global:this==i,e.state)}function m(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);i<a;)s[i]=i++;for(i=0;i<a;i++)s[i]=s[o=f&o+t[i%n]+(e=s[i])],s[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,s=r.S;t--;)e=s[i=f&i+1],n=n*a+s[f&(s[i]=s[o=f&o+e])+(s[o]=e)];return r.i=i,r.j=o,n})(a)}function g(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function y(t,e){for(var n,r=t+"",i=0;i<r.length;)e[f&i]=f&(n^=19*e[f&i])+r.charCodeAt(i++);return w(e)}function w(t){return String.fromCharCode.apply(0,t)}if(i["seed"+l]=p,y(i.random(),n),"object"==typeof e&&e.exports){e.exports=p;try{o=t("crypto")}catch(t){}}else"function"==typeof r&&r.amd&&r(function(){return p})}([],Math)},{crypto:"sC8V"}],wmWq:[function(t,e,n){"use strict";var r=function(t,e){return t<e};function i(t){if(!(this instanceof i))return new i(t);this.array=[],this.size=0,this.compare=t||r}i.prototype.clone=function(){var t=new i(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},i.prototype.add=function(t){var e,n,r=this.size;for(this.array[this.size]=t,this.size+=1;r>0&&(e=r-1>>1,n=this.array[e],this.compare(t,n));)this.array[r]=n,r=e;this.array[r]=t},i.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},i.prototype._percolateUp=function(t,e){for(var n,r,i=this.array[t];t>0&&(n=t-1>>1,r=this.array[n],e||this.compare(i,r));)this.array[t]=r,t=n;this.array[t]=i},i.prototype._percolateDown=function(t){for(var e,n,r,i=this.size,o=this.size>>>1,s=this.array[t];t<o&&(n=(e=1+(t<<1))+1,r=this.array[e],n<i&&this.compare(this.array[n],r)&&(e=n,r=this.array[n]),this.compare(r,s));)this.array[t]=r,t=e;this.array[t]=s},i.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},i.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},i.prototype._batchRemove=function(t,e){var n=new Array(e||this.size),r=0;if("function"==typeof t&&this.size)for(var i=0;i<this.size&&r<n.length;)t(this.array[i])?(n[r]=this._removeAt(i),r++,i>>=1):i++;return n.length=r,n},i.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},i.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},i.prototype.peek=function(){if(0!=this.size)return this.array[0]},i.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},i.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},i.prototype.trim=function(){this.array=this.array.slice(0,this.size)},i.prototype.isEmpty=function(){return 0===this.size},i.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,n=this.clone();!n.isEmpty();)t(n.poll(),e++)},i.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,n=this.array,r=new i(function(t,r){return e(n[t],n[r])});t=Math.min(this.size,t);var o=new Array(t),s=0;for(r.add(0);s<t;){var a=r.poll();o[s++]=this.array[a];var c=1+(a<<1),l=c+1;c<this.size&&r.add(c),l<this.size&&r.add(l)}return o};t.main===e&&function(){var t=new i(function(t,e){return t<e});for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),e.exports=i},{}],JNpU:[function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(t[r]=n[r])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,s;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(s=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],s.set(o,i),i+=o.length;return s}},s={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],ckcG:[function(t,e,n){"use strict";var r=t("../utils/common"),i=4,o=0,s=1,a=2;function c(t){for(var e=t.length;--e>=0;)t[e]=0}var l=0,u=1,h=2,d=29,f=256,p=f+1+d,m=30,g=19,y=2*p+1,w=15,v=16,b=7,_=256,k=16,S=17,x=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],T=new Array(2*(p+2));c(T);var $=new Array(2*m);c($);var A=new Array(512);c(A);var P=new Array(256);c(P);var N=new Array(d);c(N);var j,q,R,I=new Array(m);function D(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function L(t){return t<256?A[t]:A[256+(t>>>7)]}function B(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function U(t,e,n){t.bi_valid>v-n?(t.bi_buf|=e<<t.bi_valid&65535,B(t,t.bi_buf),t.bi_buf=e>>v-t.bi_valid,t.bi_valid+=n-v):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function F(t,e,n){U(t,n[2*e],n[2*e+1])}function H(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function V(t,e,n){var r,i,o=new Array(w+1),s=0;for(r=1;r<=w;r++)o[r]=s=s+n[r-1]<<1;for(i=0;i<=e;i++){var a=t[2*i+1];0!==a&&(t[2*i]=H(o[a]++,a))}}function J(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<m;e++)t.dyn_dtree[2*e]=0;for(e=0;e<g;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*_]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function W(t){t.bi_valid>8?B(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function G(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function Z(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&G(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!G(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function K(t,e,n){var r,i,o,s,a=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],i=t.pending_buf[t.l_buf+a],a++,0===r?F(t,i,e):(F(t,(o=P[i])+f+1,e),0!==(s=C[o])&&U(t,i-=N[o],s),F(t,o=L(--r),n),0!==(s=E[o])&&U(t,r-=I[o],s))}while(a<t.last_lit);F(t,_,e)}function Y(t,e){var n,r,i,o=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,c=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=y,n=0;n<c;n++)0!==o[2*n]?(t.heap[++t.heap_len]=l=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[i]=0,t.opt_len--,a&&(t.static_len-=s[2*i+1]);for(e.max_code=l,n=t.heap_len>>1;n>=1;n--)Z(t,o,n);i=c;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,Z(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,o,s,a,c=e.dyn_tree,l=e.max_code,u=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,m=0;for(o=0;o<=w;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<y;n++)(o=c[2*c[2*(r=t.heap[n])+1]+1]+1)>p&&(o=p,m++),c[2*r+1]=o,r>l||(t.bl_count[o]++,s=0,r>=f&&(s=d[r-f]),a=c[2*r],t.opt_len+=a*(o+s),h&&(t.static_len+=a*(u[2*r+1]+s)));if(0!==m){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>l||(c[2*i+1]!==o&&(t.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),r--)}}(t,e),V(o,l,t.bl_count)}function Q(t,e,n){var r,i,o=-1,s=e[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=e[2*(r+1)+1],++a<c&&i===s||(a<l?t.bl_tree[2*i]+=a:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*k]++):a<=10?t.bl_tree[2*S]++:t.bl_tree[2*x]++,a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4))}function X(t,e,n){var r,i,o=-1,s=e[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),r=0;r<=n;r++)if(i=s,s=e[2*(r+1)+1],!(++a<c&&i===s)){if(a<l)do{F(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(F(t,i,t.bl_tree),a--),F(t,k,t.bl_tree),U(t,a-3,2)):a<=10?(F(t,S,t.bl_tree),U(t,a-3,3)):(F(t,x,t.bl_tree),U(t,a-11,7));a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4)}}c(I);var tt=!1;function et(t,e,n,i){U(t,(l<<1)+(i?1:0),3),function(t,e,n,i){W(t),i&&(B(t,n),B(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}n._tr_init=function(t){tt||(function(){var t,e,n,r,i,o=new Array(w+1);for(n=0,r=0;r<d-1;r++)for(N[r]=n,t=0;t<1<<C[r];t++)P[n++]=r;for(P[n-1]=r,i=0,r=0;r<16;r++)for(I[r]=i,t=0;t<1<<E[r];t++)A[i++]=r;for(i>>=7;r<m;r++)for(I[r]=i<<7,t=0;t<1<<E[r]-7;t++)A[256+i++]=r;for(e=0;e<=w;e++)o[e]=0;for(t=0;t<=143;)T[2*t+1]=8,t++,o[8]++;for(;t<=255;)T[2*t+1]=9,t++,o[9]++;for(;t<=279;)T[2*t+1]=7,t++,o[7]++;for(;t<=287;)T[2*t+1]=8,t++,o[8]++;for(V(T,p+1,o),t=0;t<m;t++)$[2*t+1]=5,$[2*t]=H(t,5);j=new D(T,C,f+1,p,w),q=new D($,E,0,m,w),R=new D(new Array(0),M,0,g,b)}(),tt=!0),t.l_desc=new z(t.dyn_ltree,j),t.d_desc=new z(t.dyn_dtree,q),t.bl_desc=new z(t.bl_tree,R),t.bi_buf=0,t.bi_valid=0,J(t)},n._tr_stored_block=et,n._tr_flush_block=function(t,e,n,r){var c,l,d=0;t.level>0?(t.strm.data_type===a&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return s;return o}(t)),Y(t,t.l_desc),Y(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),e=g-1;e>=3&&0===t.bl_tree[2*O[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),c=t.opt_len+3+7>>>3,(l=t.static_len+3+7>>>3)<=c&&(c=l)):c=l=n+5,n+4<=c&&-1!==e?et(t,e,n,r):t.strategy===i||l===c?(U(t,(u<<1)+(r?1:0),3),K(t,T,$)):(U(t,(h<<1)+(r?1:0),3),function(t,e,n,r){var i;for(U(t,e-257,5),U(t,n-1,5),U(t,r-4,4),i=0;i<r;i++)U(t,t.bl_tree[2*O[i]+1],3);X(t,t.dyn_ltree,e-1),X(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),K(t,t.dyn_ltree,t.dyn_dtree)),J(t),r&&W(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(P[n]+f+1)]++,t.dyn_dtree[2*L(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){U(t,u<<1,3),F(t,_,T),function(t){16===t.bi_valid?(B(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":"JNpU"}],PDe7:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){for(var i=65535&t|0,o=t>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{o=o+(i=i+e[r++]|0)|0}while(--s);i%=65521,o%=65521}return i|o<<16|0}},{}],Nls6:[function(t,e,n){"use strict";var r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,i){var o=r,s=i+n;t^=-1;for(var a=i;a<s;a++)t=t>>>8^o[255&(t^e[a])];return-1^t}},{}],NGcu:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],X2fg:[function(t,e,n){"use strict";var r,i=t("../utils/common"),o=t("./trees"),s=t("./adler32"),a=t("./crc32"),c=t("./messages"),l=0,u=1,h=3,d=4,f=5,p=0,m=1,g=-2,y=-3,w=-5,v=-1,b=1,_=2,k=3,S=4,x=0,C=2,E=8,M=9,O=15,T=8,$=286,A=30,P=19,N=2*$+1,j=15,q=3,R=258,I=R+q+1,D=32,z=42,L=69,B=73,U=91,F=103,H=113,V=666,J=1,W=2,G=3,Z=4,K=3;function Y(t,e){return t.msg=c[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function X(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function et(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function nt(t,e){t.pending_buf[t.pending++]=e}function rt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var n,r,i=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match,c=t.strstart>t.w_size-I?t.strstart-(t.w_size-I):0,l=t.window,u=t.w_mask,h=t.prev,d=t.strstart+R,f=l[o+s-1],p=l[o+s];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(l[(n=e)+s]===p&&l[n+s-1]===f&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<d);if(r=R-(d-o),o=d-R,r>s){if(t.match_start=e,s=r,r>=a)break;f=l[o+s-1],p=l[o+s]}}}while((e=h[e&u])>c&&0!=--i);return s<=t.lookahead?s:t.lookahead}function ot(t){var e,n,r,o,c,l,u,h,d,f,p=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-I)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=p?r-p:0}while(--n);e=n=p;do{r=t.prev[--e],t.prev[e]=r>=p?r-p:0}while(--n);o+=p}if(0===t.strm.avail_in)break;if(l=t.strm,u=t.window,h=t.strstart+t.lookahead,d=o,f=void 0,(f=l.avail_in)>d&&(f=d),n=0===f?0:(l.avail_in-=f,i.arraySet(u,l.input,l.next_in,f,h),1===l.state.wrap?l.adler=s(l.adler,u,f,h):2===l.state.wrap&&(l.adler=a(l.adler,u,f,h)),l.next_in+=f,l.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=q)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+q-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<q)););}while(t.lookahead<I&&0!==t.strm.avail_in)}function st(t,e){for(var n,r;;){if(t.lookahead<I){if(ot(t),t.lookahead<I&&e===l)return J;if(0===t.lookahead)break}if(n=0,t.lookahead>=q&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-I&&(t.match_length=it(t,n)),t.match_length>=q)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-q),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=q){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=t.strstart<q-1?t.strstart:q-1,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}function at(t,e){for(var n,r,i;;){if(t.lookahead<I){if(ot(t),t.lookahead<I&&e===l)return J;if(0===t.lookahead)break}if(n=0,t.lookahead>=q&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=q-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-I&&(t.match_length=it(t,n),t.match_length<=5&&(t.strategy===b||t.match_length===q&&t.strstart-t.match_start>4096)&&(t.match_length=q-1)),t.prev_length>=q&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-q,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-q),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=q-1,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return J}else if(t.match_available){if((r=o._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return J}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<q-1?t.strstart:q-1,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}function ct(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function lt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*N),this.dyn_dtree=new i.Buf16(2*(2*A+1)),this.bl_tree=new i.Buf16(2*(2*P+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(j+1),this.heap=new i.Buf16(2*$+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*$+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ut(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=C,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?z:H,t.adler=2===e.wrap?0:1,e.last_flush=l,o._tr_init(e),p):Y(t,g)}function ht(t){var e,n=ut(t);return n===p&&((e=t.state).window_size=2*e.w_size,X(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=q-1,e.match_available=0,e.ins_h=0),n}function dt(t,e,n,r,o,s){if(!t)return g;var a=1;if(e===v&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),o<1||o>M||n!==E||r<8||r>15||e<0||e>9||s<0||s>S)return Y(t,g);8===r&&(r=9);var c=new lt;return t.state=c,c.strm=t,c.wrap=a,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+q-1)/q),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=s,c.method=n,ht(t)}r=[new ct(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ot(t),0===t.lookahead&&e===l)return J;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,et(t,!1),0===t.strm.avail_out))return J;if(t.strstart-t.block_start>=t.w_size-I&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),J)}),new ct(4,4,8,4,st),new ct(4,5,16,8,st),new ct(4,6,32,32,st),new ct(4,4,16,16,at),new ct(8,16,32,32,at),new ct(8,16,128,128,at),new ct(8,32,128,256,at),new ct(32,128,258,1024,at),new ct(32,258,258,4096,at)],n.deflateInit=function(t,e){return dt(t,e,E,O,T,x)},n.deflateInit2=dt,n.deflateReset=ht,n.deflateResetKeep=ut,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,p):g},n.deflate=function(t,e){var n,i,s,c;if(!t||!t.state||e>f||e<0)return t?Y(t,g):g;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===V&&e!==d)return Y(t,0===t.avail_out?w:g);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===z)if(2===i.wrap)t.adler=0,nt(i,31),nt(i,139),nt(i,8),i.gzhead?(nt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),nt(i,255&i.gzhead.time),nt(i,i.gzhead.time>>8&255),nt(i,i.gzhead.time>>16&255),nt(i,i.gzhead.time>>24&255),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(nt(i,255&i.gzhead.extra.length),nt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=a(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=L):(nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,K),i.status=H);else{var y=E+(i.w_bits-8<<4)<<8;y|=(i.strategy>=_||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=D),y+=31-y%31,i.status=H,rt(i,y),0!==i.strstart&&(rt(i,t.adler>>>16),rt(i,65535&t.adler)),t.adler=1}if(i.status===L)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending!==i.pending_buf_size));)nt(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=B)}else i.status=B;if(i.status===B)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),0===c&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),0===c&&(i.status=F)}else i.status=F;if(i.status===F&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(nt(i,255&t.adler),nt(i,t.adler>>8&255),t.adler=0,i.status=H)):i.status=H),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(n)&&e!==d)return Y(t,w);if(i.status===V&&0!==t.avail_in)return Y(t,w);if(0!==t.avail_in||0!==i.lookahead||e!==l&&i.status!==V){var v=i.strategy===_?function(t,e){for(var n;;){if(0===t.lookahead&&(ot(t),0===t.lookahead)){if(e===l)return J;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}(i,e):i.strategy===k?function(t,e){for(var n,r,i,s,a=t.window;;){if(t.lookahead<=R){if(ot(t),t.lookahead<=R&&e===l)return J;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=q&&t.strstart>0&&(r=a[i=t.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){s=t.strstart+R;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);t.match_length=R-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=q?(n=o._tr_tally(t,1,t.match_length-q),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}(i,e):r[i.level].func(i,e);if(v!==G&&v!==Z||(i.status=V),v===J||v===G)return 0===t.avail_out&&(i.last_flush=-1),p;if(v===W&&(e===u?o._tr_align(i):e!==f&&(o._tr_stored_block(i,0,0,!1),e===h&&(X(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,p}return e!==d?p:i.wrap<=0?m:(2===i.wrap?(nt(i,255&t.adler),nt(i,t.adler>>8&255),nt(i,t.adler>>16&255),nt(i,t.adler>>24&255),nt(i,255&t.total_in),nt(i,t.total_in>>8&255),nt(i,t.total_in>>16&255),nt(i,t.total_in>>24&255)):(rt(i,t.adler>>>16),rt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:m)},n.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==z&&e!==L&&e!==B&&e!==U&&e!==F&&e!==H&&e!==V?Y(t,g):(t.state=null,e===H?Y(t,y):p):g},n.deflateSetDictionary=function(t,e){var n,r,o,a,c,l,u,h,d=e.length;if(!t||!t.state)return g;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==z||n.lookahead)return g;for(1===a&&(t.adler=s(t.adler,e,d,0)),n.wrap=0,d>=n.w_size&&(0===a&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,e,d-n.w_size,n.w_size,0),e=h,d=n.w_size),c=t.avail_in,l=t.next_in,u=t.input,t.avail_in=d,t.next_in=0,t.input=e,ot(n);n.lookahead>=q;){r=n.strstart,o=n.lookahead-(q-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+q-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=q-1,ot(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=q-1,n.match_available=0,t.next_in=l,t.input=u,t.avail_in=c,n.wrap=a,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":"JNpU","./trees":"ckcG","./adler32":"PDe7","./crc32":"Nls6","./messages":"NGcu"}],JPkB:[function(t,e,n){"use strict";var r=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var s=new r.Buf8(256),a=0;a<256;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",s=0;s<e;s++)n+=String.fromCharCode(t[s]);return n}s[254]=s[254]=1,n.string2buf=function(t){var e,n,i,o,s,a=t.length,c=0;for(o=0;o<a;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(c),s=0,o=0;s<c;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},n.buf2binstring=function(t){return c(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,i,o,a=e||t.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((i=t[n++])<128)l[r++]=i;else if((o=s[i])>4)l[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<a;)i=i<<6|63&t[n++],o--;o>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return c(l,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+s[t[n]]>e?n:e}},{"./common":"JNpU"}],w28B:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],KDqm:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),i=t("./utils/common"),o=t("./utils/strings"),s=t("./zlib/messages"),a=t("./zlib/zstream"),c=Object.prototype.toString,l=0,u=-1,h=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({level:u,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==l)throw new Error(s[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==l)throw new Error(s[n]);this._dict_set=!0}}function p(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}f.prototype.push=function(t,e){var n,s,a=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(u),a.next_out=0,a.avail_out=u),1!==(n=r.deflate(a,s))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===s?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==s||(this.onEnd(l),a.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=f,n.deflate=p,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./zlib/deflate":"X2fg","./utils/common":"JNpU","./utils/strings":"JPkB","./zlib/messages":"NGcu","./zlib/zstream":"w28B"}],odtK:[function(t,e,n){"use strict";e.exports=function(t,e){var n,r,i,o,s,a,c,l,u,h,d,f,p,m,g,y,w,v,b,_,k,S,x,C,E;n=t.state,r=t.next_in,C=t.input,i=r+(t.avail_in-5),o=t.next_out,E=t.output,s=o-(e-t.avail_out),a=o+(t.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,w=(1<<n.distbits)-1;t:do{p<15&&(f+=C[r++]<<p,p+=8,f+=C[r++]<<p,p+=8),v=m[f&y];e:for(;;){if(f>>>=b=v>>>24,p-=b,0===(b=v>>>16&255))E[o++]=65535&v;else{if(!(16&b)){if(0==(64&b)){v=m[(65535&v)+(f&(1<<b)-1)];continue e}if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}_=65535&v,(b&=15)&&(p<b&&(f+=C[r++]<<p,p+=8),_+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=C[r++]<<p,p+=8,f+=C[r++]<<p,p+=8),v=g[f&w];n:for(;;){if(f>>>=b=v>>>24,p-=b,!(16&(b=v>>>16&255))){if(0==(64&b)){v=g[(65535&v)+(f&(1<<b)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(k=65535&v,p<(b&=15)&&(f+=C[r++]<<p,(p+=8)<b&&(f+=C[r++]<<p,p+=8)),(k+=f&(1<<b)-1)>c){t.msg="invalid distance too far back",n.mode=30;break t}if(f>>>=b,p-=b,k>(b=o-s)){if((b=k-b)>u&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(S=0,x=d,0===h){if(S+=l-b,b<_){_-=b;do{E[o++]=d[S++]}while(--b);S=o-k,x=E}}else if(h<b){if(S+=l+h-b,(b-=h)<_){_-=b;do{E[o++]=d[S++]}while(--b);if(S=0,h<_){_-=b=h;do{E[o++]=d[S++]}while(--b);S=o-k,x=E}}}else if(S+=h-b,b<_){_-=b;do{E[o++]=d[S++]}while(--b);S=o-k,x=E}for(;_>2;)E[o++]=x[S++],E[o++]=x[S++],E[o++]=x[S++],_-=3;_&&(E[o++]=x[S++],_>1&&(E[o++]=x[S++]))}else{S=o-k;do{E[o++]=E[S++],E[o++]=E[S++],E[o++]=E[S++],_-=3}while(_>2);_&&(E[o++]=E[S++],_>1&&(E[o++]=E[S++]))}break}}break}}while(r<i&&o<a);r-=_=p>>3,f&=(1<<(p-=_<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=o<a?a-o+257:257-(o-a),n.hold=f,n.bits=p}},{}],Zotp:[function(t,e,n){"use strict";var r=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,c,l,u,h,d){var f,p,m,g,y,w,v,b,_,k=d.bits,S=0,x=0,C=0,E=0,M=0,O=0,T=0,$=0,A=0,P=0,N=null,j=0,q=new r.Buf16(16),R=new r.Buf16(16),I=null,D=0;for(S=0;S<=15;S++)q[S]=0;for(x=0;x<c;x++)q[e[n+x]]++;for(M=k,E=15;E>=1&&0===q[E];E--);if(M>E&&(M=E),0===E)return l[u++]=20971520,l[u++]=20971520,d.bits=1,0;for(C=1;C<E&&0===q[C];C++);for(M<C&&(M=C),$=1,S=1;S<=15;S++)if($<<=1,($-=q[S])<0)return-1;if($>0&&(0===t||1!==E))return-1;for(R[1]=0,S=1;S<15;S++)R[S+1]=R[S]+q[S];for(x=0;x<c;x++)0!==e[n+x]&&(h[R[e[n+x]]++]=x);if(0===t?(N=I=h,w=19):1===t?(N=i,j-=257,I=o,D-=257,w=256):(N=s,I=a,w=-1),P=0,x=0,S=C,y=u,O=M,T=0,m=-1,g=(A=1<<M)-1,1===t&&A>852||2===t&&A>592)return 1;for(;;){v=S-T,h[x]<w?(b=0,_=h[x]):h[x]>w?(b=I[D+h[x]],_=N[j+h[x]]):(b=96,_=0),f=1<<S-T,C=p=1<<O;do{l[y+(P>>T)+(p-=f)]=v<<24|b<<16|_|0}while(0!==p);for(f=1<<S-1;P&f;)f>>=1;if(0!==f?(P&=f-1,P+=f):P=0,x++,0==--q[S]){if(S===E)break;S=e[n+h[x]]}if(S>M&&(P&g)!==m){for(0===T&&(T=M),y+=C,$=1<<(O=S-T);O+T<E&&!(($-=q[O+T])<=0);)O++,$<<=1;if(A+=1<<O,1===t&&A>852||2===t&&A>592)return 1;l[m=P&g]=M<<24|O<<16|y-u|0}}return 0!==P&&(l[y+P]=S-T<<24|64<<16|0),d.bits=M,0}},{"../utils/common":"JNpU"}],PRZ0:[function(t,e,n){"use strict";var r=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),s=t("./inffast"),a=t("./inftrees"),c=0,l=1,u=2,h=4,d=5,f=6,p=0,m=1,g=2,y=-2,w=-3,v=-4,b=-5,_=8,k=1,S=2,x=3,C=4,E=5,M=6,O=7,T=8,$=9,A=10,P=11,N=12,j=13,q=14,R=15,I=16,D=17,z=18,L=19,B=20,U=21,F=22,H=23,V=24,J=25,W=26,G=27,Z=28,K=29,Y=30,Q=31,X=32,tt=852,et=592,nt=15;function rt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,p):y}function st(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,ot(t)):y}function at(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?y:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,st(t))):y}function ct(t,e){var n,r;return t?(r=new it,t.state=r,r.window=null,(n=at(t,e))!==p&&(t.state=null),n):y}var lt,ut,ht=!0;function dt(t){if(ht){var e;for(lt=new r.Buf32(512),ut=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(l,t.lens,0,288,lt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(u,t.lens,0,32,ut,0,t.work,{bits:5}),ht=!1}t.lencode=lt,t.lenbits=9,t.distcode=ut,t.distbits=5}function ft(t,e,n,i){var o,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new r.Buf8(s.wsize)),i>=s.wsize?(r.arraySet(s.window,e,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((o=s.wsize-s.wnext)>i&&(o=i),r.arraySet(s.window,e,n-i,o,s.wnext),(i-=o)?(r.arraySet(s.window,e,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0}n.inflateReset=st,n.inflateReset2=at,n.inflateResetKeep=ot,n.inflateInit=function(t){return ct(t,nt)},n.inflateInit2=ct,n.inflate=function(t,e){var n,tt,et,nt,it,ot,st,at,ct,lt,ut,ht,pt,mt,gt,yt,wt,vt,bt,_t,kt,St,xt,Ct,Et=0,Mt=new r.Buf8(4),Ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return y;(n=t.state).mode===N&&(n.mode=j),it=t.next_out,et=t.output,st=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,at=n.hold,ct=n.bits,lt=ot,ut=st,St=p;t:for(;;)switch(n.mode){case k:if(0===n.wrap){n.mode=j;break}for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(2&n.wrap&&35615===at){n.check=0,Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0),at=0,ct=0,n.mode=S;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&at)<<8)+(at>>8))%31){t.msg="incorrect header check",n.mode=Y;break}if((15&at)!==_){t.msg="unknown compression method",n.mode=Y;break}if(ct-=4,kt=8+(15&(at>>>=4)),0===n.wbits)n.wbits=kt;else if(kt>n.wbits){t.msg="invalid window size",n.mode=Y;break}n.dmax=1<<kt,t.adler=n.check=1,n.mode=512&at?A:N,at=0,ct=0;break;case S:for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(n.flags=at,(255&n.flags)!==_){t.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=at>>8&1),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0)),at=0,ct=0,n.mode=x;case x:for(;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.time=at),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,Mt[2]=at>>>16&255,Mt[3]=at>>>24&255,n.check=o(n.check,Mt,4,0)),at=0,ct=0,n.mode=C;case C:for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.xflags=255&at,n.head.os=at>>8),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0)),at=0,ct=0,n.mode=E;case E:if(1024&n.flags){for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.length=at,n.head&&(n.head.extra_len=at),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0)),at=0,ct=0}else n.head&&(n.head.extra=null);n.mode=M;case M:if(1024&n.flags&&((ht=n.length)>ot&&(ht=ot),ht&&(n.head&&(kt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,ht,kt)),512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,n.length-=ht),n.length))break t;n.length=0,n.mode=O;case O:if(2048&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.name+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=T;case T:if(4096&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.comment+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.comment=null);n.mode=$;case $:if(512&n.flags){for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(at!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Y;break}at=0,ct=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=N;break;case A:for(;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}t.adler=n.check=rt(at),at=0,ct=0,n.mode=P;case P:if(0===n.havedict)return t.next_out=it,t.avail_out=st,t.next_in=nt,t.avail_in=ot,n.hold=at,n.bits=ct,g;t.adler=n.check=1,n.mode=N;case N:if(e===d||e===f)break t;case j:if(n.last){at>>>=7&ct,ct-=7&ct,n.mode=G;break}for(;ct<3;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}switch(n.last=1&at,ct-=1,3&(at>>>=1)){case 0:n.mode=q;break;case 1:if(dt(n),n.mode=B,e===f){at>>>=2,ct-=2;break t}break;case 2:n.mode=D;break;case 3:t.msg="invalid block type",n.mode=Y}at>>>=2,ct-=2;break;case q:for(at>>>=7&ct,ct-=7&ct;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if((65535&at)!=(at>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&at,at=0,ct=0,n.mode=R,e===f)break t;case R:n.mode=I;case I:if(ht=n.length){if(ht>ot&&(ht=ot),ht>st&&(ht=st),0===ht)break t;r.arraySet(et,tt,nt,ht,it),ot-=ht,nt+=ht,st-=ht,it+=ht,n.length-=ht;break}n.mode=N;break;case D:for(;ct<14;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(n.nlen=257+(31&at),at>>>=5,ct-=5,n.ndist=1+(31&at),at>>>=5,ct-=5,n.ncode=4+(15&at),at>>>=4,ct-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=z;case z:for(;n.have<n.ncode;){for(;ct<3;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.lens[Ot[n.have++]]=7&at,at>>>=3,ct-=3}for(;n.have<19;)n.lens[Ot[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,xt={bits:n.lenbits},St=a(c,n.lens,0,19,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=L;case L:for(;n.have<n.nlen+n.ndist;){for(;yt=(Et=n.lencode[at&(1<<n.lenbits)-1])>>>16&255,wt=65535&Et,!((gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(wt<16)at>>>=gt,ct-=gt,n.lens[n.have++]=wt;else{if(16===wt){for(Ct=gt+2;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(at>>>=gt,ct-=gt,0===n.have){t.msg="invalid bit length repeat",n.mode=Y;break}kt=n.lens[n.have-1],ht=3+(3&at),at>>>=2,ct-=2}else if(17===wt){for(Ct=gt+3;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}ct-=gt,kt=0,ht=3+(7&(at>>>=gt)),at>>>=3,ct-=3}else{for(Ct=gt+7;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}ct-=gt,kt=0,ht=11+(127&(at>>>=gt)),at>>>=7,ct-=7}if(n.have+ht>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Y;break}for(;ht--;)n.lens[n.have++]=kt}}if(n.mode===Y)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,xt={bits:n.lenbits},St=a(l,n.lens,0,n.nlen,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,xt={bits:n.distbits},St=a(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,xt),n.distbits=xt.bits,St){t.msg="invalid distances set",n.mode=Y;break}if(n.mode=B,e===f)break t;case B:n.mode=U;case U:if(ot>=6&&st>=258){t.next_out=it,t.avail_out=st,t.next_in=nt,t.avail_in=ot,n.hold=at,n.bits=ct,s(t,ut),it=t.next_out,et=t.output,st=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,at=n.hold,ct=n.bits,n.mode===N&&(n.back=-1);break}for(n.back=0;yt=(Et=n.lencode[at&(1<<n.lenbits)-1])>>>16&255,wt=65535&Et,!((gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(yt&&0==(240&yt)){for(vt=gt,bt=yt,_t=wt;yt=(Et=n.lencode[_t+((at&(1<<vt+bt)-1)>>vt)])>>>16&255,wt=65535&Et,!(vt+(gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}at>>>=vt,ct-=vt,n.back+=vt}if(at>>>=gt,ct-=gt,n.back+=gt,n.length=wt,0===yt){n.mode=W;break}if(32&yt){n.back=-1,n.mode=N;break}if(64&yt){t.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&yt,n.mode=F;case F:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.length+=at&(1<<n.extra)-1,at>>>=n.extra,ct-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=H;case H:for(;yt=(Et=n.distcode[at&(1<<n.distbits)-1])>>>16&255,wt=65535&Et,!((gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(0==(240&yt)){for(vt=gt,bt=yt,_t=wt;yt=(Et=n.distcode[_t+((at&(1<<vt+bt)-1)>>vt)])>>>16&255,wt=65535&Et,!(vt+(gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}at>>>=vt,ct-=vt,n.back+=vt}if(at>>>=gt,ct-=gt,n.back+=gt,64&yt){t.msg="invalid distance code",n.mode=Y;break}n.offset=wt,n.extra=15&yt,n.mode=V;case V:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.offset+=at&(1<<n.extra)-1,at>>>=n.extra,ct-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Y;break}n.mode=J;case J:if(0===st)break t;if(ht=ut-st,n.offset>ht){if((ht=n.offset-ht)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Y;break}ht>n.wnext?(ht-=n.wnext,pt=n.wsize-ht):pt=n.wnext-ht,ht>n.length&&(ht=n.length),mt=n.window}else mt=et,pt=it-n.offset,ht=n.length;ht>st&&(ht=st),st-=ht,n.length-=ht;do{et[it++]=mt[pt++]}while(--ht);0===n.length&&(n.mode=U);break;case W:if(0===st)break t;et[it++]=n.length,st--,n.mode=U;break;case G:if(n.wrap){for(;ct<32;){if(0===ot)break t;ot--,at|=tt[nt++]<<ct,ct+=8}if(ut-=st,t.total_out+=ut,n.total+=ut,ut&&(t.adler=n.check=n.flags?o(n.check,et,ut,it-ut):i(n.check,et,ut,it-ut)),ut=st,(n.flags?at:rt(at))!==n.check){t.msg="incorrect data check",n.mode=Y;break}at=0,ct=0}n.mode=Z;case Z:if(n.wrap&&n.flags){for(;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(at!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Y;break}at=0,ct=0}n.mode=K;case K:St=m;break t;case Y:St=w;break t;case Q:return v;case X:default:return y}return t.next_out=it,t.avail_out=st,t.next_in=nt,t.avail_in=ot,n.hold=at,n.bits=ct,(n.wsize||ut!==t.avail_out&&n.mode<Y&&(n.mode<G||e!==h))&&ft(t,t.output,t.next_out,ut-t.avail_out)?(n.mode=Q,v):(lt-=t.avail_in,ut-=t.avail_out,t.total_in+=lt,t.total_out+=ut,n.total+=ut,n.wrap&&ut&&(t.adler=n.check=n.flags?o(n.check,et,ut,t.next_out-ut):i(n.check,et,ut,t.next_out-ut)),t.data_type=n.bits+(n.last?64:0)+(n.mode===N?128:0)+(n.mode===B||n.mode===R?256:0),(0===lt&&0===ut||e===h)&&St===p&&(St=b),St)},n.inflateEnd=function(t){if(!t||!t.state)return y;var e=t.state;return e.window&&(e.window=null),t.state=null,p},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?y:(n.head=e,e.done=!1,p):y},n.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&n.mode!==P?y:n.mode===P&&i(1,e,r,0)!==n.check?w:ft(t,e,r,r)?(n.mode=Q,v):(n.havedict=1,p):y},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":"JNpU","./adler32":"PDe7","./crc32":"Nls6","./inffast":"odtK","./inftrees":"Zotp"}],NNt1:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],bEbX:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],iCYE:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),s=t("./zlib/constants"),a=t("./zlib/messages"),c=t("./zlib/zstream"),l=t("./zlib/gzheader"),u=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==s.Z_OK)throw new Error(a[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==s.Z_OK))throw new Error(a[n])}function d(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}h.prototype.push=function(t,e){var n,a,c,l,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?d.input=o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===s.Z_BUF_ERROR&&!0===m&&(n=s.Z_OK,m=!1),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==s.Z_STREAM_END&&(0!==d.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(d.output,d.next_out),l=d.next_out-c,h=o.buf2string(d.output,c),d.next_out=l,d.avail_out=f-l,l&&i.arraySet(d.output,d.output,c,l,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==s.Z_STREAM_END);return n===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./zlib/inflate":"PRZ0","./utils/common":"JNpU","./utils/strings":"JPkB","./zlib/constants":"NNt1","./zlib/messages":"NGcu","./zlib/zstream":"w28B","./zlib/gzheader":"bEbX"}],JWfd:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/utils/common":"JNpU","./lib/deflate":"KDqm","./lib/inflate":"iCYE","./lib/zlib/constants":"NNt1"}],nlD3:[function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("fast-json-stable-stringify")),o=r(t("toastify-js")),s=r(t("seedrandom/seedrandom")),a=r(t("fastpriorityqueue"));if(void 0===window.TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(t){for(var e=t.length,n=-1,r="undefined"==typeof Uint8Array?new Array(1.5*e):new Uint8Array(3*e),i=0,o=0,s=0;s!==e;){if(i=t.charCodeAt(s),s+=1,i>=55296&&i<=56319){if(s===e){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;break}if(!((o=t.charCodeAt(s))>=56320&&o<=57343)){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;continue}if(s+=1,(i=1024*(i-55296)+o-56320+65536)>65535){r[n+=1]=240|i>>>18,r[n+=1]=128|i>>>12&63,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i;continue}}i<=127?r[n+=1]=0|i:i<=2047?(r[n+=1]=192|i>>>6,r[n+=1]=128|63&i):(r[n+=1]=224|i>>>12,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?r.subarray(0,n+1):(r.length=n+1,r)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(t){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}"object"==typeof e&&e.bundle&&e.bundle.modules&&e.bundle.cache&&function(){const t=e.bundle,n={},r={},i={};for(const[e,o]of Object.entries(t.modules)){const s=""+t.modules[e][0],a=r[s];a?i[e]=a:r[s]=e;for(const[t,e]of Object.entries(o[1]))(n[e]||(n[e]=new Set)).add(t)}const o=t=>n[t]?`${[...n[t]].sort().join('" and "')}`:"top-level",s={},a=[];for(const[e,n]of Object.entries(t.modules))for(const[r,c]of Object.entries(n[1])){const l=i[c];l&&(t.cache[c]?s[l]=c:(n[1][r]=l,delete t.modules[c],a.push(`"${r}" in "${o(e)}" (${e})`)))}for(const[n,r]of Object.entries(t.modules))for(const[i,c]of Object.entries(r[1])){const l=s[c];l&&(t.cache[c]?console.warn(`Could not deduplicate import "${i}" in "${o(n)}" (to fix, import "${o(e.id)}" earlier)`):(r[1][i]=l,delete t.modules[c],a.push(`"${i}" in "${o(n)}" (${n})`)))}for(const t of a.sort())console.log("Deduplicated import",t)}();const c=window.location.hostname.endsWith("croquet.studio");let l="",u="";function h(t,e){if(e)for(const n of e.split("&")){const e=n.split("="),r=e[0];let i=!0;if(e.length>1&&(i=decodeURIComponent(e.slice(1).join("="))).match(/^(true|false|null|[0-9.]*|["[{].*)$/))try{i=JSON.parse(i)}catch(t){"["===i[0]&&(i=i.slice(1,-1).split(","))}t[r]=i}}const d=new class{constructor(){this.getSession(),h(this,window.location.search.slice(1)),h(this,c?window.location.hash.slice(1):u),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(t,e,n){"boolean"!=typeof n&&(n=this.isHost(n));const r=this[t];if("string"!=typeof r)return n;const i=r.split(",");return!0===n&&(e=`no${e}`),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes(`${e}s`)?!n:n}getSession(){if(c){const t=/^\/([^/]+)\/(.*)$/,e=window.location.pathname.match(t);if(e)return l=e[1],e[2]}else{const t=/^#([^&]+)&?(.*)$/,e=window.location.hash.match(t);if(e)return e[1].includes("=")?(u=`${e[1]}&${e[2]}`,""):(u=e[2],e[1])}return"string"==typeof this.session?(u=window.location.hash.slice(1),this.session):""}setSession(t,e=!1){null==c&&this.getSession();const{search:n,hash:r}=window.location,i=c?`/${l}/${t}${n}${r}`:`#${t}${u?"&"+u:""}`;e?window.history.replaceState({},"",i):window.history.pushState({},"",i)}isHost(t){const e=window.location.hostname;return e===t||"localhost"===t&&(!!e.endsWith(".ngrok.io")||["127.0.0.1","::1"].includes(e))}isLocalhost(){return this.isHost("localhost")}};function f(t,e,n=null){let r={};try{r=JSON.parse(localStorage.croquetUser||"{}")}catch(t){}return t in r?r[t]:n?(r[t]=n(),r[t]!==e&&(localStorage.croquetUser=JSON.stringify(r)),r[t]):e}const p=window.location.hostname.endsWith("croquet.io")?window.location.host:"croquet.io";function m(){const t="string"==typeof d.files?d.files:`https://${p}/files/v1`;return t.endsWith("/")?t.slice(0,-1):t}function g(){return e.bundle?e.bundle.modules:[]}function y(){return Object.keys(g()).filter(t=>!t.endsWith("hmr-runtime.js"))}function w(t){return g()[t]}function v(t){return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}async function b(t){if(0===t.length)return"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU";return v(await window.crypto.subtle.digest("SHA-256",t))}function _(){return d.has("debug","hashing",!1)}window.crypto&&window.crypto.subtle&&"function"==typeof window.crypto.subtle.digest||console.error("ERROR: crypto.subtle.digest() browser API not available. Please access this page via https or localhost.");const k={},S={was_initialized:!1};function x(t){return S.was_initialized||function(){for(const t of y())for(const[e,n]of Object.entries(w(t)[1])){const t=S[n]||"",r=e.replace(/^[./]*/,"");r.length>t.length&&(S[n]=r)}S.was_initialized=!0}(),S[t]||t}const C=new TextEncoder;async function E(t){const e=C.encode(t),n=await b(e);return _()&&(k[n]={string:t,buffer:e}),n}const M={};async function O(t){if(M[t])return M[t];const e=function(t){return function(t){const e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}");return e.slice(n+1,r).trim()}(w(t)[0])}(t).replace(/\s+/g," "),n=await E(e);return _()&&(k[n].name=`Module ${x(t)}`),M[t]=n}const T=[];class ${constructor(){this.values=[],this.resolves=[]}async next(){return this.values.length>0?this.values.shift():new Promise(t=>this.resolves.push(t))}put(t){const e=this.resolves.shift();e?e(t):this.values.push(t)}putAll(t){for(const e of t)this.put(e)}peek(){return this.values[0]}nextNonBlocking(){return this.values.shift()}allNonBlocking(){if(0===this.values.length)return[];const t=this.values;return this.values=[],t}get size(){return this.values.length-this.resolves.length}}var A;!function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;e<r;e++){var i=[],o=this.data.charCodeAt(e);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;e<n;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+n][e+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=d.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e},createMovieClip:function(t,e,n){var r=t.createEmptyMovieClip(e,n);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,s=0;s<this.modules[i].length;s++){var a=1*s;this.modules[i][s]&&(r.beginFill(0,100),r.moveTo(a,o),r.lineTo(a+1,o),r.lineTo(a+1,o+1),r.lineTo(a,o+1),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=d.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=t[e],i=t[n];if(null==this.modules[r][i])for(var o=-2;o<=2;o++)for(var s=-2;s<=2;s++)this.modules[r+o][i+s]=-2==o||2==o||-2==s||2==s||0==o&&0==s}},setupTypeNumber:function(t){for(var e=d.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++){r=!t&&1==(e>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,r=d.getBCHTypeInfo(n),i=0;i<15;i++){var o=!t&&1==(r>>i&1);i<6?this.modules[i][8]=o:i<8?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;i<15;i++){o=!t&&1==(r>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=o:i<9?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,r=this.moduleCount-1,i=7,o=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var a=0;a<2;a++)if(null==this.modules[r][s-a]){var c=!1;o<t.length&&(c=1==(t[o]>>>i&1)),d.getMask(e,r,s-a)&&(c=!c),this.modules[r][s-a]=c,-1==--i&&(o++,i=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,r){for(var i=g.getRSBlocks(t,n),o=new y,s=0;s<r.length;s++){var a=r[s];o.put(a.mode,4),o.put(a.getLength(),d.getLengthInBits(a.mode,t)),a.write(o)}var c=0;for(s=0;s<i.length;s++)c+=i[s].dataCount;if(o.getLengthInBits()>8*c)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*c+")");for(o.getLengthInBits()+4<=8*c&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*c||(o.put(e.PAD0,8),o.getLengthInBits()>=8*c));)o.put(e.PAD1,8);return e.createBytes(o,i)},e.createBytes=function(t,e){for(var n=0,r=0,i=0,o=new Array(e.length),s=new Array(e.length),a=0;a<e.length;a++){var c=e[a].dataCount,l=e[a].totalCount-c;r=Math.max(r,c),i=Math.max(i,l),o[a]=new Array(c);for(var u=0;u<o[a].length;u++)o[a][u]=255&t.buffer[u+n];n+=c;var h=d.getErrorCorrectPolynomial(l),f=new m(o[a],h.getLength()-1).mod(h);s[a]=new Array(h.getLength()-1);for(u=0;u<s[a].length;u++){var p=u+f.getLength()-s[a].length;s[a][u]=p>=0?f.get(p):0}}var g=0;for(u=0;u<e.length;u++)g+=e[u].totalCount;var y=new Array(g),w=0;for(u=0;u<r;u++)for(a=0;a<e.length;a++)u<o[a].length&&(y[w++]=o[a][u]);for(u=0;u<i;u++)for(a=0;a<e.length;a++)u<s[a].length&&(y[w++]=s[a][u]);return y};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},i=0,o=1,s=2,a=3,c=4,l=5,u=6,h=7,d={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;d.getBCHDigit(e)-d.getBCHDigit(d.G15)>=0;)e^=d.G15<<d.getBCHDigit(e)-d.getBCHDigit(d.G15);return(t<<10|e)^d.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;d.getBCHDigit(e)-d.getBCHDigit(d.G18)>=0;)e^=d.G18<<d.getBCHDigit(e)-d.getBCHDigit(d.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return d.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case i:return(e+n)%2==0;case o:return e%2==0;case s:return n%3==0;case a:return(e+n)%3==0;case c:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case l:return e*n%2+e*n%3==0;case u:return(e*n%2+e*n%3)%2==0;case h:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new m([1],0),n=0;n<t;n++)e=e.multiply(new m([1,f.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,r=0;r<e;r++)for(var i=0;i<e;i++){for(var o=0,s=t.isDark(r,i),a=-1;a<=1;a++)if(!(r+a<0||e<=r+a))for(var c=-1;c<=1;c++)i+c<0||e<=i+c||0==a&&0==c||s==t.isDark(r+a,i+c)&&o++;o>5&&(n+=3+o-5)}for(r=0;r<e-1;r++)for(i=0;i<e-1;i++){var l=0;t.isDark(r,i)&&l++,t.isDark(r+1,i)&&l++,t.isDark(r,i+1)&&l++,t.isDark(r+1,i+1)&&l++,0!=l&&4!=l||(n+=3)}for(r=0;r<e;r++)for(i=0;i<e-6;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(n+=40);for(i=0;i<e;i++)for(r=0;r<e-6;r++)t.isDark(r,i)&&!t.isDark(r+1,i)&&t.isDark(r+2,i)&&t.isDark(r+3,i)&&t.isDark(r+4,i)&&!t.isDark(r+5,i)&&t.isDark(r+6,i)&&(n+=40);var u=0;for(i=0;i<e;i++)for(r=0;r<e;r++)t.isDark(r,i)&&u++;return n+=10*(Math.abs(100*u/e/e-50)/5)}},f={glog:function(t){if(t<1)throw new Error("glog("+t+")");return f.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return f.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;p<8;p++)f.EXP_TABLE[p]=1<<p;for(p=8;p<256;p++)f.EXP_TABLE[p]=f.EXP_TABLE[p-4]^f.EXP_TABLE[p-5]^f.EXP_TABLE[p-6]^f.EXP_TABLE[p-8];for(p=0;p<255;p++)f.LOG_TABLE[f.EXP_TABLE[p]]=p;function m(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var r=0;r<t.length-n;r++)this.num[r]=t[r+n]}function g(t,e){this.totalCount=t,this.dataCount=e}function y(){this.buffer=[],this.length=0}m.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<t.getLength();r++)e[n+r]^=f.gexp(f.glog(this.get(n))+f.glog(t.get(r)));return new m(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=f.glog(this.get(0))-f.glog(t.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<t.getLength();r++)n[r]^=f.gexp(f.glog(t.get(r))+e);return new m(n,0).mod(t)}},g.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],g.getRSBlocks=function(t,e){var n=g.getRsBlockTable(t,e);if(null==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=n.length/3,i=[],o=0;o<r;o++)for(var s=n[3*o+0],a=n[3*o+1],c=n[3*o+2],l=0;l<s;l++)i.push(new g(a,c));return i},g.getRsBlockTable=function(t,e){switch(e){case r.L:return g.RS_BLOCK_TABLE[4*(t-1)+0];case r.M:return g.RS_BLOCK_TABLE[4*(t-1)+1];case r.Q:return g.RS_BLOCK_TABLE[4*(t-1)+2];case r.H:return g.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},y.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var w=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],v=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,n=this._htOption,r=t.getModuleCount(),i=n.width/r,o=n.height/r,s=Math.round(i),a=Math.round(o);this.clear();for(var c=0;c<r;c++)for(var l=0;l<r;l++){var u=t.isDark(c,l),h=l*i,d=c*o;e.strokeStyle=u?n.colorDark:n.colorLight,e.lineWidth=1,e.fillStyle=u?n.colorDark:n.colorLight,e.fillRect(h,d,i,o),e.strokeRect(Math.floor(h)+.5,Math.floor(d)+.5,s,a),e.strokeRect(Math.ceil(h)-.5,Math.ceil(d)-.5,s,a)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();function b(t,e){for(var n=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),o=0,s=w.length;o<=s;o++){var a=0;switch(e){case r.L:a=w[o][0];break;case r.M:a=w[o][1];break;case r.Q:a=w[o][2];break;case r.H:a=w[o][3]}if(i<=a)break;n++}if(n>w.length)throw new Error("Too long data");return n}(A=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:r.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(v=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new v(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(b(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},A.prototype.clear=function(){this._oDrawing.clear()},A.prototype.getCanvas=function(){for(let t=0;t<this._el.children.length;t++){const e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},A.CorrectLevel=r}();var P=A;const N=Date.now();"undefined"==typeof performance&&(window.performance={now:()=>Date.now()-N});const j=["simulate","update","render","snapshot"],q={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"};let R=null,I=null,D=null,z=null;function L(t){for(R=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",(I=document.createElement("div")).id="text_stats",I.style.padding=5,I.style.background="rgba(255,255,255,0.2)",I.style.fontFamily="sans-serif",t.appendChild(I),t.title=Object.entries(q).map(([t,e])=>`${e}: ${t}`).join("\n"),(D=document.createElement("canvas")).width=Math.min(125,window.innerWidth)*window.devicePixelRatio,D.height=125*window.devicePixelRatio,D.style.width="100%",t.appendChild(D),(z=D.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio)}const B=[];let U=0,F=!1,H=V(0);function V(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:F}}const J=[],W={animationFrame(t,e={}){!function(t){for(H.total=t-H.start,B.push(H);B.length>Math.min(120,window.innerWidth);)B.shift();if(!R||"none"===window.getComputedStyle(R).display)return;const e=B.slice(1).filter(t=>t.total),n=e.map(t=>t.total).reduce((t,e)=>t+e,0)/e.length;Math.max(...e.map(t=>Math.max(t.backlog,t.network))),U=1e3,I.parentElement||(console.warn("who broke the stats div and canvas?"),R.appendChild(I),R.appendChild(D)),I.innerText=`${H.users} users, ${Math.round(1e3/n)} fps, `+(H.backlog<100&&H.activity<1e3?`latency: ${H.latency} ms`:`backlog: ${H.backlog<100?"0.0":(H.backlog/1e3).toFixed(1)} s`),z.clearRect(0,0,D.width,D.height);const r=t=>20*(1-t/(1e3/60))+60,i=t=>r(t/U*-2*(1e3/60))+5;for(let t=0;t<B.length;t++){const e=B[t],n=t+.5;let o=r(0);z.beginPath(),z.moveTo(n,o),z.lineTo(n,r(e.total)),z.strokeStyle=q[e.connected?"total":"network"],z.stroke(),z.beginPath(),z.moveTo(n,o),o=r(e.total);let s=0;for(const t of j)e.items[t]&&(s+=e.items[t],o=r(s),z.lineTo(n,o),z.strokeStyle=q[t],z.stroke(),z.beginPath(),z.moveTo(n,o));e.network&&(z.beginPath(),z.moveTo(n,i(0)),z.lineTo(n,i(e.network)),z.strokeStyle=q.network,z.stroke())}z.strokeStyle="rgba(255, 255, 255, 0.2)";for(let t=0;t<60;t+=1e3/60)z.moveTo(0,r(t)),z.lineTo(120,r(t)),z.stroke()}(t),H=V(t);for(const[t,n]of Object.entries(e))this[t](n)},begin(t){const e=performance.now();H.items[t]=(H.items[t]||0)-e;const n=J[J.length-1];return n&&(H.items[n]+=e),J.push(t),e},end(t){const e=performance.now();if(H.items[t]+=e,J.pop()!==t)throw Error("Unmatched stats calls for "+t);const n=J[J.length-1];return n&&(H.items[n]-=e),e},backlog(t){H.backlog=Math.max(t,H.backlog)},network(t){H.network=t},starvation(t){H.network=t},latency(t){H.latency=t},activity(t){H.activity=t},users(t){H.users=t},connected(t){H.connected=F=t}},G="ontouchstart"in document.documentElement,Z=18,K=2,Y=G?20:12,Q=2,X=G?0:15,tt=2,et=.3;!function(){const t=`\n        #croquet_dock { position: absolute; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 84px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all ${et}s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n\n        .croquet_dock_button { position: absolute; width: ${Y}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ${K+X+Y+Q}% }\n        #croquet_dock_right { right: ${K+X}%; }\n        #croquet_dock_pin { right: ${K}%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: ${tt}px; top: ${tt}px; right: ${tt}px; bottom: ${tt}px; background: white; }\n        #croquet_dock:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; border: 6px solid white; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader:before,\n        #croquet_loader:after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader:before,\n        #croquet_loader:after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader:before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader:after { left: 3.5em; }\n`,e=document.createElement("style");e.innerHTML=t,document.head.insertBefore(e,document.head.getElementsByTagName("style")[0])}(),function(){let t="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n";t+="\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n";const e=document.createElement("style");e.innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n",document.head.insertBefore(e,document.head.getElementsByTagName("style")[0])}();const nt=new Set;function rt(t,e={}){return t&&gt.showMessage(t,{...e,level:"error"})}function it(t,e={}){return t&&gt.showMessage(t,{...e,level:"warning"})}function ot(t,e={}){return t&&gt.showMessage(t,{...e,level:"status"})}function st(t,e){console.error(`Error during ${t}`,e);const n=(e.stack||"").split("\n").filter(t=>!t.match(/croquet-.*\.min.js/)).join("\n");gt.showMessage(`<b>Error during ${t}: ${e.message}</b>\n\n${n}`.replace(/\n/g,"<br>"),{level:"error",duration:1e4,stopOnFocus:!0})}const at={get pinned(){return"true"===localStorage["croquet-debug-ui-pinned"]},set pinned(t){localStorage["croquet-debug-ui-pinned"]=!!t},get activePage(){return localStorage["croquet-debug-ui-activePage"]},set activePage(t){localStorage["croquet-debug-ui-activePage"]=t}};function ct(t,e,n){const r=document.createElement("canvas"),i=r.width=40*Y/12,o=r.height=60,s=r.getContext("2d");s.font="36px Arial",s.textAlign="center",s.textBaseline="middle",s.fillStyle="black",s.fillText(t,i/2,.55*o);const a=document.createElement("button");a.id=e,a.className="croquet_dock_button";const c=t=>{t.preventDefault(),t.stopPropagation(),n()};return G?a.ontouchstart=c:a.onclick=c,a.appendChild(r),a}function lt(t,e){if(!1===gt.badge)return;const n=function(t){const e=new s(t),n=["bcdfghjklmnpqrstvwxyz","aeiou"];let r="";for(let t=0;t<5;t++)r+=n[t%2][e.quick()*n[t%2].length|0];return r}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+n;t.firstChild;)t.removeChild(t.firstChild);const r=document.createElement("canvas"),i=r.width=120,o=r.height=40;r.style.width="100%",t.appendChild(r);const a=r.getContext("2d"),c=function(t,e=1){const n=new s(t),r=[];for(let t=0;t<e;t++)r.push(`hsl(${360*n.quick()}, 50%, 70%)`);return r}(e,2);a.fillStyle=c[0],a.beginPath(),a.moveTo(0,0),a.lineTo(0,o),a.lineTo(i,0),a.closePath(),a.fill(),a.fillStyle=c[1],a.beginPath(),a.moveTo(i,o),a.lineTo(i,0),a.lineTo(0,o),a.closePath(),a.fill(),a.font="30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(n,i/2,o/2)}function ut(t,e,n={}){for(;t.firstChild;)t.removeChild(t.firstChild);return new P(t,{text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:P.CorrectLevel.L,...n})}let ht,dt,ft=0;function pt(t){if(dt!==t)if(!1===gt.sync&&(t=!1),t&&!ht&&(ht=function(){const t=document.createElement("div");t.id="croquet_spinnerOverlay";const e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}()),dt=t,t)clearTimeout(ft),ft=setTimeout(()=>{if(!dt)return;mt(gt.root,()=>document.body).appendChild(ht),ht.style.opacity=.9},500);else{if(!ht)return;clearTimeout(ft),ht.style.opacity=0,ft=setTimeout(()=>{dt||ht.parentElement&&ht.parentElement.removeChild(ht)},500)}}function mt(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){const e=document.getElementById(t);if(e)return e}return e?e():null}const gt={sessionURL:window.location.href,root:document.body,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(t={}){if(d.nodock)return;const e=document.getElementById("croquet_dock");e&&e.parentElement.removeChild(e);const n=mt(gt.root);if(!n)return;const r=document.createElement("div");r.id="croquet_dock",n.appendChild(r);const i=document.createElement("div");let o;i.id="croquet_dock_bar",r.appendChild(i),!1!==t.badge&&((o=document.createElement("div")).id="croquet_badge",i.appendChild(o),gt.badge=o);const s=document.createElement("div");s.id="croquet_dock_content",r.appendChild(s);const a=[];let c,l;!1!==t.qrcode&&gt.sessionURL&&((c=document.createElement("div")).id="croquet_qrcode",s.appendChild(c),a.push(c.id),gt.qrcode=c);if(!1!==t.stats&&((l=document.createElement("div")).id="croquet_stats",s.appendChild(l),a.push(l.id),gt.stats=l),a.length){function u(t){const e=a.length;let n,r=0;if(at.activePage){const t=a.indexOf(at.activePage);t>=0?(r=t,n=document.getElementById(at.activePage)):at.activePage=null}const i=a[(r+e+t)%e];let o;i===at.activePage?o=n:(n&&n.classList.remove("active"),o=document.getElementById(i)),o&&o.classList.add("active"),at.activePage=i}a.length>1&&(i.appendChild(ct("<","croquet_dock_left",()=>u(-1))),i.appendChild(ct(">","croquet_dock_right",()=>u(1)))),u(0)}if(!G){const t=ct("📌","croquet_dock_pin",()=>{at.pinned=!at.pinned,e()}),e=()=>{at.pinned?t.classList.add("pinned"):t.classList.remove("pinned")};e(),i.appendChild(t)}const h=t=>{r.style.width=`${t}px`,r.style.height=`${t*(1+Z/100)}px`;const e=t*Z/100;i.style.height=`${e}px`,s.style.top=`${e+tt}px`,o&&(o.style.height=`${.9*e}px`,o.style.width=`${.9*e*3}px`),c&&(c.style.border=`${8*t/200}px solid white`)};let f=200;const p=()=>{r.classList.add("active"),h(f),setTimeout(()=>r.style.transition="none",1e3*et)},m=()=>{r.style.transition="",r.classList.remove("active"),r.style.width=r.style.height="",i.style.height="",s.style.top="",o&&(o.style.height=o.style.width=""),c&&(c.style.border="")};if(G)m(),r.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),(()=>r.classList.contains("active"))()?m():p()};else{at.pinned?p():m();let t=0;r.onwheel=e=>{e.preventDefault(),e.stopPropagation();const n=Date.now();if(n-t<100)return;t=n;let{deltaY:i}=e;i=Math.sign(i)*Math.min(5,Math.abs(i));const o=.8*Math.min(window.innerWidth,window.innerHeight);f=Math.max(166,Math.min(o,r.offsetWidth*1.05**i)),h(f)},r.onmouseenter=p,r.onmouseleave=()=>{at.pinned||m()}}},makeSessionWidgets:function(t){!function(t){if(!t||!1===gt.root)return;const e=mt(gt.badge);e&&lt(e,t)}(t),function(){if(!1===gt.root||!1===gt.qrcode)return;if(d.noqr)return;const t=gt.sessionURL;if(!t)return void console.warn("App.sessionURL is not set");const e=mt(gt.qrcode);e&&(G||(e.onclick=e=>{e.preventDefault(),e.stopPropagation(),window.open(t)}),ut(e,t).getCanvas().style.width="100%")}(),function(){if(!1===gt.root)return;if(d.nostats)return;const t=mt(gt.stats);t&&L(t)}()},makeQRCanvas(t={}){if(!gt.sessionURL)return null;const e=ut(document.createElement("div"),gt.sessionURL,t);return e&&e.getCanvas()},clearSessionMoniker:function(){!1!==gt.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(t){!1===gt.root&&(t=!1),pt(t)},messageFunction:function(t,e={}){if("once"===e.only){if(nt.has(t))return null;nt.add(t)}const n=e.level;let r;return"error"===n?(r="red",console.error(t)):"warning"===n?(r="gold",console.warn(t)):r="#aaa",function(t,e){const n=gt.root;if(!1===n)return null;const r={text:t,duration:3e3,gravity:"bottom",position:"left",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)",stopOnFocus:!0,...e};let i;return n instanceof Element&&n!==document.body?(i=n.id)||(n.id=i="_croquetToastParent"):"string"==typeof n&&(i=n),i&&(r.selector=i),o(r).showToast()}(t,{backgroundColor:r,...e})},showMessage:(t,e={})=>d.nomessages||!1===gt.root||!1===gt.messages||!gt.messageFunction?null:gt.messageFunction(t,e)};class yt extends a{poll(){const t=super.poll();return this.array[this.size]=null,t}asArray(){const t=[];return this.forEach(e=>t.push(e)),t}asUnsortedArray(){return this.array.slice(0,this.size)}}const wt="#__vote";function vt(t,e){function n(t){for(const n of t)n.for===e&&t.delete(n)}return n(t.immediate),n(t.oncePerFrame),n(t.oncePerFrameWhileSynced),n(t.queued),t.immediate.size+t.queued.size+t.oncePerFrame.size+t.oncePerFrameWhileSynced.size}const bt=new class{constructor(){this.subscriptions={},this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.id=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)),this.lastId=0}register(t){return this.id+"/V"+ ++this.lastId}deregister(t){}addSubscription(t,e,n,r,i){if("vote"===i)return void this.addSubscription(t,e+wt,n,r,"immediate");const o=t+":"+e,s=r;s.for=n;let a=this.subscriptions[o];if(a||(a=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[i])throw Error(`Unknown subscribe() option: handling="${i}"`);a[i].add(s)}removeSubscription(t,e,n){const r=t+":"+e,i=this.subscriptions[r];i&&0===vt(i,n)&&delete this.subscriptions[r],e.endsWith(wt)||this.removeSubscription(t,e+wt,n)}removeAllSubscriptionsFor(t){const e=`${t}:`;for(const[n,r]of Object.entries(this.subscriptions))n.startsWith(e)?delete this.subscriptions[n]:0===vt(r,t)&&delete this.subscriptions[n]}handleEvent(t,e,n=(t=>t())){const r=this.subscriptions[t];r&&(r.queued.size>0&&this.queuedEvents.push({topic:t,data:e}),r.oncePerFrame.size>0&&this.perFrameEvents.set(t,e),r.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(t,e),r.immediate.size>0&&n(()=>{for(const t of r.immediate)t(e)}))}processFrameEvents(t){let e=0;const n=(t,n,r)=>{const i=this.subscriptions[t];if(i)for(const t of i[r])t(n),e++};for(const{topic:t,data:e}of this.queuedEvents)n(t,e,"queued");this.queuedEvents.length=0;for(const[t,e]of this.perFrameEvents)n(t,e,"oncePerFrame");if(this.perFrameEvents.clear(),t){for(const[t,e]of this.perSyncedFrameEvents)n(t,e,"oncePerFrameWhileSynced");this.perSyncedFrameEvents.clear()}for(const{topic:t,data:e}of this.queuedEvents)n(t,e,"queued");return this.queuedEvents.length=0,e}};let _t={get subscribe(){return(_t={subscribe:d.has("debug","subscribe",!1)}).subscribe}};class kt{constructor(t){this.island=t}register(t){return this.island.registerModel(t)}deregister(t){this.island.deregisterModel(t.id)}publish(t,e,n){this.island.publishFromModel(n,t,e)}subscribe(t,e,n,r){return _t.subscribe&&console.log(`Model.subscribe("${e}:${n}", ${t} ${(""+r).replace(/\(.*/s,"")})`),this.island.addSubscription(t,e,n,r)}unsubscribe(t,e,n,r="*"){_t.subscribe&&console.log(`Model.unsubscribe(${e}:${n}", ${t} ${(""+r).replace(/\(.*/s,"")})`),this.island.removeSubscription(t,e,n,r)}unsubscribeAll(t){_t.subscribe&&console.log(`Model.unsubscribeAll(${t} ${t.id})`),this.island.removeAllSubscriptionsFor(t)}future(t,e,n,r){if(xt&&xt.equal(this))return this.island.future(t,e,n,r);if(e)throw Error("tOffset not supported from cross-realm future send yet.");const i=this.island;return new Proxy(t,{get(e,n){if("function"==typeof t[n]){return new Proxy(t[n],{apply(e,r,o){i.callModelMethod(t.id,n,o)}})}throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}random(){return this.island.random()}now(){return this.island.time}equal(t){return t instanceof kt&&t.island===this.island}}class St{constructor(t){this.island=t}register(t){return bt.register(t)}deregister(t){bt.deregister(t)}publish(t,e,n){this.island.publishFromView(n,t,e)}subscribe(t,e,n,r,i="queued"){_t.subscribe&&console.log(`View.subscribe("${r}:${t}", ${e} ${n.name||(""+n).replace(/\(.*/s,"")} [${i}])`),bt.addSubscription(r,t,e,n,i)}unsubscribe(t,e,n,r){_t.subscribe&&console.log(`View.unsubscribe("${r}:${t}", ${e} ${n.name||(""+n).replace(/\(.*/s,"")})`),bt.removeSubscription(r,t,e,n)}unsubscribeAll(t){_t.subscribe&&console.log(`View.unsubscribeAll(${t})`),bt.removeAllSubscriptionsFor(t)}future(t,e){return e?new Proxy(t,{get(n,r){if("function"==typeof t[r]){return new Proxy(t[r],{apply(n,i,o){setTimeout(()=>{t.id&&t[r](...o)},e)}})}throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}}):t}random(){return Math.random()}now(){return this.island.time}externalNow(){return this.island.controller.time}isSynced(){return!!this.island.controller.synced}equal(t){return t instanceof St&&t.island===this.island}}let xt=null;function Ct(){if(!xt)throw Error("Tried to execute code that requires realm outside of realm.");return xt}function Et(t,e){if(null!==xt)throw Error("Can't switch realms from inside realm");try{return xt=new kt(t),e()}finally{xt=null}}function Mt(t,e,n=!1){if(null!==xt&&!n)throw Error("Can't switch realms from inside realm");const r=xt;try{return xt=new St(t),e()}finally{xt=r}}!function(){var t,e=function(t){return t!=t},n=Math.sqrt,r=.7853981633974483,i=function(t){var i,o,s,a,c;if(e(t))return NaN;if(t>0?s=t:(i=!0,s=-t),s>1)return NaN;if(s>.625)a=(o=1-s)*function(t){var e,n;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),n=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),n=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/n)}(o),o=n(o+o),c=r-o,c-=o=o*a-6.123233995736766e-17,c+=r;else{if(s<1e-8)return t;c=s*(c=(o=s*s)*function(t){var e,n;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,n=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),n=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/n)}(o))+s}return i?-c:c},o="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),s=Object.prototype.toString,a=Object.prototype.hasOwnProperty,c="function"==typeof Symbol?Symbol.toStringTag:"",l={};t=o&&"symbol"==typeof Symbol.toStringTag?function(t){var e,n,r;if(null==t)return s.call(t);n=t[c],e=function(t,e){return null!=t&&a.call(t,e)}(t,c);try{t[c]=void 0}catch(e){return s.call(t)}return r=s.call(t),e?t[c]=n:delete t[c],r}:function(t){return s.call(t)},l=t;var u="function"==typeof Uint32Array,h="function"==typeof Uint32Array?Uint32Array:null,d="function"==typeof Uint32Array?Uint32Array:null,f={};f=function(){var t,e;if("function"!=typeof h)return!1;try{t=function(t){return u&&t instanceof Uint32Array||"[object Uint32Array]"===l(t)}(e=new h(e=[1,3.14,-3.14,4294967296,4294967297]))&&1===e[0]&&3===e[1]&&4294967293===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?d:function(){throw new Error("not implemented")};var p="function"==typeof Float64Array,m="function"==typeof Float64Array?Float64Array:null,g="function"==typeof Float64Array?Float64Array:null,y={};y=function(){var t,e;if("function"!=typeof m)return!1;try{t=function(t){return p&&t instanceof Float64Array||"[object Float64Array]"===l(t)}(e=new m([1,3.14,-3.14,NaN]))&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t}()?g:function(){throw new Error("not implemented")};var w,v="function"==typeof Uint8Array,b="function"==typeof Uint8Array?Uint8Array:null,_="function"==typeof Uint8Array?Uint8Array:null;w=function(){var t,e;if("function"!=typeof b)return!1;try{t=function(t){return v&&t instanceof Uint8Array||"[object Uint8Array]"===l(t)}(e=new b(e=[1,3.14,-3.14,256,257]))&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?_:function(){throw new Error("not implemented")};var k,S="function"==typeof Uint16Array,x="function"==typeof Uint16Array?Uint16Array:null,C="function"==typeof Uint16Array?Uint16Array:null,E={uint16:function(){var t,e;if("function"!=typeof x)return!1;try{t=function(t){return S&&t instanceof Uint16Array||"[object Uint16Array]"===l(t)}(e=new x(e=[1,3.14,-3.14,65536,65537]))&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?C:function(){throw new Error("not implemented")},uint8:w};(k=new E.uint16(1))[0]=4660;var M,O=52===new E.uint8(k.buffer)[0];M=!0===O?1:0;var T,$=new y(1),A=new f($.buffer),P=function(t){return $[0]=t,A[M]};T=!0===O?1:0;var N,j,q,R=new y(1),I=new f(R.buffer),D=function(t,e){return R[0]=t,I[T]=e>>>0,R[0]},z=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,B=.6931471803691238,U=1.9082149292705877e-10,F=function(t){var n,r,i,o,s,a,c,l,u,h;if(t<-1||e(t))return NaN;if(-1===t)return L;if(t===z)return t;if(0===t)return t;if(h=1,(i=t<0?-t:t)<.41421356237309503){if(i<1.862645149230957e-9)return i<5.551115123125783e-17?t:t-t*t*.5;t>-.2928932188134525&&(h=0,o=t,r=1)}return 0!==h&&(i<9007199254740992?(s=(h=((r=P(u=1+t))>>20)-1023)>0?1-(u-t):t-(u-1),s/=u):(h=((r=P(u=t))>>20)-1023,s=0),(r&=1048575)<434334?u=D(u,1072693248|r):(h+=1,u=D(u,1071644672|r),r=1048576-r>>2),o=u-1),n=.5*o*o,0===r?0===o?h*B+(s+=h*U):h*B-((l=n*(1-.6666666666666666*o))-(h*U+s)-o):(l=(c=(a=o/(2+o))*a)*(0===c?.6666666666666735:.6666666666666735+c*(.3999999999940942+c*(.2857142874366239+c*(.22222198432149784+c*(.1818357216161805+c*(.15313837699209373+.14798198605116586*c)))))),0===h?o-(n-a*(n+l)):h*B-(n-(a*(n+l)+(h*U+s))-o))},H=.6931471805599453,V=1.9082149292705877e-10,J=function(t){var n,r,i,o,s,a,c,l,u,h;return 0===t?L:e(t)||t<0?NaN:(o=0,(r=P(t))<1048576&&(o-=54,r=P(t*=0x40000000000000)),r>=2146435072?t+t:(o+=(r>>20)-1023|0,o+=(c=614244+(r&=1048575)&1048576|0)>>20|0,a=(t=D(t,r|1072693248^c))-1,(1048575&2+r)<3?0===a?0===o?0:.6931471803691238*o+o*V:(s=a*a*(.5-.3333333333333333*a),0===o?a-s:.6931471803691238*o-(s-o*V-a)):(c=r-398458|0,i=(u=(h=(l=a/(2+a))*l)*h)*(0===u?.3999999999940942:.3999999999940942+u*(.22222198432149784+.15313837699209373*u)),s=h*(0===u?.6666666666666735:.6666666666666735+u*(.2857142874366239+u*(.1818357216161805+.14798198605116586*u)))+i,(c|=440401-r|0)>0?(n=.5*a*a,0===o?a-(n-l*(n+s)):.6931471803691238*o-(n-(l*(n+s)+o*V)-a)):0===o?a-l*(a-s):.6931471803691238*o-(l*(a-s)-o*V-a))))},W=function(t){return t===z||t===L},G=1.5707963267948966,Z=function(t){var n,i,o,s;return e(t)||0===t?t:t===z?G:t===L?-G:(t<0&&(i=!0,t=-t),n=0,t>2.414213562373095?(o=G,n=1,t=-1/t):t<=.66?o=0:(o=r,n=2,t=(t-1)/(t+1)),s=t*(s=(s=t*t)*(0===s?-64.85021904942025:s*(s*(s*(-.8750608600031904*s-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025)/(0===s?194.5506571482614:194.5506571482614+s*(485.3903996359137+s*(432.88106049129027+s*(165.02700983169885+s*(24.858464901423062+1*s))))))+t,2===n?s+=3.061616997868383e-17:1===n&&(s+=6.123233995736766e-17),o+=s,i?-o:o)};!0===O?(j=1,q=0):(j=0,q=1),N={HIGH:j,LOW:q};var K,Y,Q,X=new y(1),tt=new f(X.buffer),et=N.HIGH,nt=N.LOW,rt=function(t,e){return X[0]=e,t[0]=tt[et],t[1]=tt[nt],t},it=function(t,e){return 1===arguments.length?rt([0,0],t):rt(t,e)};!0===O?(Y=1,Q=0):(Y=0,Q=1),K={HIGH:Y,LOW:Q};var ot,st=new y(1),at=new f(st.buffer),ct=K.HIGH,lt=K.LOW,ut=function(t,e){return at[ct]=t,at[lt]=e,st[0]},ht=[0,0],dt=function(t,e){var n,r;return it(ht,t),n=ht[0],n&=2147483647,r=P(e),ut(n|=r&=2147483648,ht[1])},ft=3.141592653589793,pt=function(t,e){var n,r,i,o;return i=(o=t*t)*o,r=o*(0===o?.0416666666666666:.0416666666666666+o*(2480158728947673e-20*o-.001388888888887411)),r+=i*i*(0===o?-2.7557314351390663e-7:o*(2.087572321298175e-9+-1.1359647557788195e-11*o)-2.7557314351390663e-7),(i=1-(n=.5*o))+(1-i-n+(o*r-t*e))},mt=-.16666666666666632,gt=function(t,e){var n,r,i;return n=.00833333333332249+(i=t*t)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),r=i*t,0===e?t+r*(mt+i*n):t-(i*(.5*e-r*n)-e-r*mt)};ot=!0===O?0:1;var yt=new y(1),wt=new f(yt.buffer),vt=Math.floor,bt=function(t){return t<0?-t:0===t?0:t},_t=function(t,n){return e(n)||W(n)?(t[0]=n,t[1]=0,t):0!==n&&bt(n)<2.2250738585072014e-308?(t[0]=4503599627370496*n,t[1]=-52,t):(t[0]=n,t[1]=0,t)},kt=[0,0],St=[0,0],xt=function(t,n){var r,i;return 0===t||e(t)||W(t)?t:(function(t,e){1===arguments.length?_t([0,0],t):_t(t,e)}(kt,t),n+=kt[1],(n+=function(t){var e=P(t);return(e=(2146435072&e)>>>20)-1023|0}(t=kt[0]))<-1074?dt(0,t):n>1023?t<0?L:z:(n<=-1023?(n+=52,i=2.220446049250313e-16):i=1,it(St,t),r=St[0],r&=2148532223,i*ut(r|=n+1023<<20,St[1])))},Ct=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Et=[1.570796251296997,7.549789415861596e-8,5.390302529957765e-15,3.282003415807913e-22,1.270655753080676e-29,1.2293330898111133e-36,2.7337005381646456e-44,2.1674168387780482e-51],Mt=5.960464477539063e-8,Ot=Pt(new Array(20)),Tt=Pt(new Array(20)),$t=Pt(new Array(20)),At=Pt(new Array(20));function Pt(t){var e,n=t.length;for(e=0;e<n;e++)t[e]=0;return t}var Nt,jt=Math.round,qt=function(t,e,n){var r,i,o,s,a;return o=t-1.5707963267341256*(r=jt(.6366197723675814*t)),s=6.077100506506192e-11*r,a=e>>20|0,n[0]=o-s,a-(P(n[0])>>20&2047)>16&&(s=2.0222662487959506e-21*r-((i=o)-(o=i-(s=6.077100506303966e-11*r))-s),n[0]=o-s,a-(P(n[0])>>20&2047)>49&&(s=8.4784276603689e-32*r-((i=o)-(o=i-(s=2.0222662487111665e-21*r))-s),n[0]=o-s)),n[1]=o-n[0]-s,r},Rt=1.5707963267341256,It=6.077100506506192e-11,Dt=2*It,zt=4*It,Lt=new Array(3),Bt=new Array(2),Ut=function(t,e){var n,r,i,o,s,a,c;if((i=2147483647&P(t)|0)<=1072243195)return e[0]=t,e[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?qt(t,i,e):i<=1073928572?t>0?(c=t-Rt,e[0]=c-It,e[1]=c-e[0]-It,1):(c=t+Rt,e[0]=c+It,e[1]=c-e[0]+It,-1):t>0?(c=t-2*Rt,e[0]=c-Dt,e[1]=c-e[0]-Dt,2):(c=t+2*Rt,e[0]=c+Dt,e[1]=c-e[0]+Dt,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?qt(t,i,e):t>0?(c=t-3*Rt,e[0]=c-1.8231301519518578e-10,e[1]=c-e[0]-1.8231301519518578e-10,3):(c=t+3*Rt,e[0]=c+1.8231301519518578e-10,e[1]=c-e[0]+1.8231301519518578e-10,-3):1075388923===i?qt(t,i,e):t>0?(c=t-4*Rt,e[0]=c-zt,e[1]=c-e[0]-zt,4):(c=t+4*Rt,e[0]=c+zt,e[1]=c-e[0]+zt,-4);if(i<1094263291)return qt(t,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(n=function(t){return yt[0]=t,wt[ot]}(t),c=ut(i-((r=(i>>20)-1046)<<20|0),n),s=0;s<2;s++)Lt[s]=0|c,c=16777216*(c-Lt[s]);for(Lt[2]=c,o=3;0===Lt[o-1];)o-=1;return a=function(t,e,n,r){var i,o,s,a,c,l,u;for((o=(n-3)/24|0)<0&&(o=0),a=n-24*(o+1),l=o-(s=r-1),u=s+4,c=0;c<=u;c++)Ot[c]=l<0?0:Ct[l],l+=1;for(c=0;c<=4;c++){for(i=0,l=0;l<=s;l++)i+=t[l]*Ot[s+(c-l)];Tt[c]=i}return function t(e,n,r,i,o,s,a,c,l){var u,h,d,f,p,m,g,y,w;for(f=s,w=i[r],y=r,p=0;y>0;p++)h=Mt*w|0,At[p]=w-16777216*h|0,w=i[y-1]+h,y-=1;if(w=xt(w,o),w-=8*vt(.125*w),w-=g=0|w,d=0,o>0?(g+=p=At[r-1]>>24-o,At[r-1]-=p<<24-o,d=At[r-1]>>23-o):0===o?d=At[r-1]>>23:w>=.5&&(d=2),d>0){for(g+=1,u=0,p=0;p<r;p++)y=At[p],0===u?0!==y&&(u=1,At[p]=16777216-y):At[p]=16777215-y;if(o>0)switch(o){case 1:At[r-1]&=8388607;break;case 2:At[r-1]&=4194303}2===d&&(w=1-w,0!==u&&(w-=xt(1,o)))}if(0===w){for(y=0,p=r-1;p>=s;p--)y|=At[p];if(0===y){for(m=1;0===At[s-m];m++);for(p=r+1;p<=r+m;p++){for(l[c+p]=Ct[a+p],h=0,y=0;y<=c;y++)h+=e[y]*l[c+(p-y)];i[p]=h}return t(e,n,r+=m,i,o,s,a,c,l)}}if(0===w)for(r-=1,o-=24;0===At[r];)r-=1,o-=24;else(w=xt(w,-o))>=16777216?(h=Mt*w|0,At[r]=w-16777216*h|0,o+=24,At[r+=1]=h):At[r]=0|w;for(h=xt(1,o),p=r;p>=0;p--)i[p]=h*At[p],h*=Mt;for(p=r;p>=0;p--){for(h=0,m=0;m<=f&&m<=r-p;m++)h+=Et[m]*i[p+m];$t[r-p]=h}for(h=0,p=r;p>=0;p--)h+=$t[p];for(n[0]=0===d?h:-h,h=$t[0]-h,p=1;p<=r;p++)h+=$t[p];return n[1]=0===d?h:-h,7&g}(t,e,4,Tt,a,4,o,s,Ot)}(Lt,Bt,r,o),t<0?(e[0]=-Bt[0],e[1]=-Bt[1],-a):(e[0]=Bt[0],e[1]=Bt[1],a)},Ft=[0,0],Ht=Math.ceil,Vt=function(t){var n;return e(t)||t===z?t:t===L?0:t>709.782712893384?z:t<-745.1332191019411?0:t>-1/(1<<28)&&t<1/(1<<28)?1+t:function(t,e,n){var r,i,o,s;return o=(r=t-e)-(i=r*r)*(0===(s=i)?.16666666666666602:.16666666666666602+s*(s*(6613756321437934e-20+s*(4.1381367970572385e-8*s-16533902205465252e-22))-.0027777777777015593)),xt(1-(e-r*o/(2-o)-t),n)}(t-.6931471803691238*(n=function(t){return t<0?Ht(t):vt(t)}(t<0?1.4426950408889634*t-.5:1.4426950408889634*t+.5)),1.9082149292705877e-10*n,n)};Nt=!0===O?0:1;var Jt=new y(1),Wt=new f(Jt.buffer),Gt=function(t,e){return Jt[0]=t,Wt[Nt]=e>>>0,Jt[0]},Zt=[0,0],Kt=[0,0],Yt=function(t,e,n){var r,i,o,s,a,c,l,u,h;return(i=2147483647&(r=P(t))|0)>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(u=3.061616997868383e-17-e),e=0),s=e+(h=t*t)*((a=h*t)*((s=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))}(u=h*h))+(l=h*(0===u?.05396825397622605:.05396825397622605+u*(.0088632398235993+u*(.0014562094543252903+u*(.0002464631348184699+u*(7140724913826082e-20+2590730518636337e-20*u)))))))+e),u=t+(s+=.3333333333333341*a),i>=1072010280?(1-(r>>30&2))*((l=n)-2*(t-(u*u/(u+l)-s))):1===n?u:(Gt(h=u,0),l=s-(h-t),Gt(c=o=-1/u,0),c+o*((a=1+c*h)+c*l))},Qt=[0,0];void 0===window.CroquetMath&&(window.CroquetMath={}),window.CroquetMath.acos=function(t){var o;return e(t)?NaN:t<-1||t>1?NaN:t>.5?2*i(n(.5-.5*t)):(o=r-i(t),o+=6.123233995736766e-17,o+=r)},window.CroquetMath.acosh=function(t){var r;return e(t)?NaN:t<1?NaN:1===t?0:t>=1<<28?J(t)+H:t>2?J(2*t-1/(t+n(t*t-1))):F((r=t-1)+n(2*r+r*r))},window.CroquetMath.asin=i,window.CroquetMath.asinh=function(t){var r,i,o;return e(t)||W(t)?t:(t<0&&(t=-t,r=!0),o=t<1/(1<<28)?t:t>1<<28?J(t)+H:t>2?J(2*t+1/(n(t*t+1)+t)):F(t+(i=t*t)/(1+n(1+i))),r?-o:o)},window.CroquetMath.atan=Z,window.CroquetMath.atanh=function(t){var n,r;return e(t)?NaN:t<-1||t>1?NaN:1===t?z:-1===t?L:(t<0&&(n=!0,t=-t),t<1/(1<<28)?n?-t:t:(r=t<.5?.5*F((r=t+t)+r*t/(1-t)):.5*F((t+t)/(1-t)),n?-r:r))},window.CroquetMath.atan2=function(t,n){var r;return e(n)||e(t)?NaN:W(n)?n===z?W(t)?dt(ft/4,t):dt(0,t):W(t)?dt(3*ft/4,t):dt(ft,t):W(t)?dt(ft/2,t):0===t?n>=0&&!function(t){return!!(P(t)>>>31)}(n)?dt(0,t):dt(ft,t):0===n?dt(ft/2,t):(r=Z(t/n),n<0?r<=0?r+ft:r-ft:r)},window.CroquetMath.cbrt=function(t){var n,r,i,o,s;return e(t)||W(t)||0===t?t:(r=-2147483648&(i=P(t)),i&=2147483647,s=0,t<2.2250738585072014e-308?(s=0x40000000000000,n=P(s*=t),s=ut(r|(n=(2147483647&n)/3+696219795),0)):s=D(s,r|(n=i/3+715094163)),s*=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)}(o=s*s*(s/t)),n=P(s),s=ut(n+1,0),s+=s*(o=((o=t/(s*s))-s)/(s+s+o)))},window.CroquetMath.cos=function(t){var e;if(e=P(t),(e&=2147483647)<=1072243195)return e<1044381696?1:pt(t,0);if(e>=2146435072)return NaN;switch(3&Ut(t,Ft)){case 0:return pt(Ft[0],Ft[1]);case 1:return-gt(Ft[0],Ft[1]);case 2:return-pt(Ft[0],Ft[1]);default:return gt(Ft[0],Ft[1])}},window.CroquetMath.cosh=function(t){return e(t)?t:(t<0&&(t=-t),t>21?Vt(t)/2:(Vt(t)+Vt(-t))/2)},window.CroquetMath.exp=Vt,window.CroquetMath.expm1=function(t){var n,r,i,o,s,a,c,l,u,h,d,f;if(t===z||e(t))return t;if(t===L)return-1;if(0===t)return t;if(t<0?(r=!0,c=-t):(r=!1,c=t),c>=38.816242111356935){if(r)return-1;if(c>=709.782712893384)return z}if(s=0|P(c),c>.34657359027997264)c<1.0397207708399179?r?(i=t+.6931471803691238,o=-1.9082149292705877e-10,f=-1):(i=t-.6931471803691238,o=1.9082149292705877e-10,f=1):(f=r?1.4426950408889634*t-.5:1.4426950408889634*t+.5,i=t-.6931471803691238*(h=f|=0),o=1.9082149292705877e-10*h),u=i-(t=i-o)-o;else{if(s<1016070144)return t;f=0}return d=(l=t*(n=.5*t))*(((a=1+l*(0===l?-.03333333333333313:l*(.0015873015872548146+l*(l*(4008217827329362e-21+-2.0109921818362437e-7*l)-793650757867488e-19))-.03333333333333313))-(h=3-a*n))/(6-t*h)),0===f?t-(t*d-l):(d=t*(d-u)-u,d-=l,-1===f?.5*(t-d)-.5:1===f?t<-.25?-2*(d-(t+.5)):1+2*(t-d):f<=-2||f>56?(i=P(c=1-(d-t))+(f<<20)|0,(c=D(c,i))-1):(h=1,f<20?c=(h=D(h,i=1072693248-(2097152>>f)|0))-(d-t):(c=t-(d+(h=D(h,i=1023-f<<20|0))),c+=1),i=P(c)+(f<<20)|0,D(c,i)))},window.CroquetMath.log=J,window.CroquetMath.log1p=F,window.CroquetMath.log10=function(t){var n,r,i,o,s,a,c;return e(t)||t<0?NaN:0===t?L:(s=0,(r=P(t))<1048576&&(s-=54,r=P(t*=0x40000000000000)),r>=2146435072?t+t:(s+=(r>>20)-1023|0,t=D(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),a=s+=o>>20|0,i=function(t){var e,n,r,i,o,s,a,c,l;return i=t-1,(1048575&2+(r=P(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(l=(r&=1048575)-398458|0,n=(c=(s=(o=i/(2+i))*o)*s)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),a=s*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(l|=440401-r|0)>0?o*((e=.5*i*i)+a)-e:o*(a-i))}(t),n=Gt(t-=1,0),c=3.694239077158931e-13*a+2.5082946711645275e-11*(t+i),(c+=.4342944818781689*(t-n+i)+.4342944818781689*n)+.30102999566361177*a))},window.CroquetMath.log2=function(t){var n,r,i,o,s;if(e(t)||t<0)return NaN;if(it(Zt,t),s=0,(r=Zt[0])<1048576){if(0==(2147483647&r|Zt[1]))return L;s-=54,r=P(t*=0x40000000000000)}return r>=2146435072?t+t:(s+=(r>>20)-1023|0,t=D(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),s+=o>>20|0,i=function(t){var e,n,r,i,o,s,a,c,l;return i=t-1,(1048575&2+(r=P(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(l=(r&=1048575)-398458|0,n=(c=(s=(o=i/(2+i))*o)*s)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),a=s*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(l|=440401-r|0)>0?o*((e=.5*i*i)+a)-e:o*(a-i))}(t),n=Gt(t-=1,0),1.6751713164886512e-10*(t+i)+1.4426950407214463*(t-n+i)+1.4426950407214463*n+s)},window.CroquetMath.sin=function(t){var e;if(e=P(t),(e&=2147483647)<=1072243195)return e<1045430272?t:gt(t,0);if(e>=2146435072)return NaN;switch(3&Ut(t,Kt)){case 0:return gt(Kt[0],Kt[1]);case 1:return pt(Kt[0],Kt[1]);case 2:return-gt(Kt[0],Kt[1]);default:return-pt(Kt[0],Kt[1])}},window.CroquetMath.sinh=function(t){var e;return 0===t?t:(e=bt(t),t>710.4758600739439||t<-709.089565712824?t>0?z:L:e>1?e>=709.0895657128241?(e=Vt(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=Vt(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*function(t){var e,n;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,n=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,n=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/n)}(e))},window.CroquetMath.tan=function(t){var e,n;return e=P(t),(e&=2147483647)<=1072243195?e<1044381696?t:Yt(t,0,1):e>=2146435072?NaN:(n=Ut(t,Qt),Yt(Qt[0],Qt[1],1-((1&n)<<1)))},window.CroquetMath.tanh=function(t){var e,n;if((n=bt(t))>44.014845965556525)return t<0?-1:1;if(n>=.625)n=1-2/((e=Vt(2*n))+1),t<0&&(n=-n);else{if(0===t)return t;n=t+t*(e=t*t)*function(t){var e,n;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,n=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),n=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/n)}(e)}return n};const Xt=Math.pow;function te(t){return t===1/0||t===-1/0}window.CroquetMath.pow=(t,e)=>{if(isNaN(t)||isNaN(e))return NaN;if(te(t)||te(e))return Xt(t,e);if(0===t||0===e)return Xt(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;let n=1;return t<0&&(t*=-1,n=Xt(-1,e)),window.CroquetMath.exp(window.CroquetMath.log(t)*e)*n}}();let Ot=null;const Tt={};function $t(t,e){const{qPara:n,qArgs:r,qFn:i}=JSON.parse(atob(t.slice(1,-1))),o=JSON.stringify(n),s=Tt[o]||(Tt[o]=new Function(...n));return"number"==typeof i&&(r[i]=s),s.call(e,...r).bind(e)}function At(t,e){if(Ot)throw Error("Island confusion");if(!(t instanceof qt))throw Error("not an island: "+t);const n=Ot;try{Ot=t,window.ISLAND=t,e()}finally{Ot=n}}const Pt="#__vote",Nt="#reflected",jt="#divergence";class qt{static current(){return Ot||console.warn("No CurrentIsland!"),Ot}static hasCurrent(){return!!Ot}static installCustomMath(){if(!window.BrowserMath){window.CroquetMath.random=()=>Ot.random(),window.BrowserMath={};for(const[t,e]of Object.entries(window.CroquetMath)){const n=window.Math[t];window.BrowserMath[t]=n,window.Math[t]=["pow","atan2"].includes(t)?(t,r)=>Ot?e(t,r):n(t,r):t=>Ot?e(t):n(t)}}}constructor(t,e){qt.installCustomMath(),At(this,()=>{Et(this,()=>{if(this.modelsById={},this.modelsByName={},this.messages=new yt((t,e)=>t.before(e)),this.subscriptions={},this.users={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=t.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.tuttiSeq=0,this.lastSnapshotPoll=0,this.modelsId=0,t.modelsById){const e=Ut.newOrRecycled(this).readIsland(t,"$");for(const t of Object.keys(e))if(t in this||"meta"===t)if("messages"===t)for(const t of e.messages)this.messages.add(t);else this[t]=e[t];else console.warn(`Ignoring property snapshot.${t}`)}else{this._random=new s(null,{state:!0});const t=e(this)||{};Object.assign(this.modelsByName,t),this.addSubscription(this,this.id,"__users__",this.generateJoinExit)}})})}registerModel(t,e){if(Ot!==this)throw Error("Island Error");return e||(e=this.id+"/M"+ ++this.modelsId),this.modelsById[e]=t,e}deregisterModel(t){if(Ot!==this)throw Error("Island Error");const e=this.modelsById;delete this.modelsById[t];for(const[t,n]of Object.entries(this.modelsByName))e===n&&delete this.modelsByName[t];this.messages.removeMany(e=>e.hasReceiver(t))}lookUpModel(t){if(t===this.id)return this;const e=this.modelsById[t];if(e)return e;const[n,r,i]=t.match(/^([^#]+)#(.*)$/);return this.modelsById[r].lookUp(i)}get(t){return this.modelsByName[t]}set(t,e){if(Ot!==this)throw Error("Island Error");this.modelsByName[t]=e}getNextTuttiSeq(){return this.tuttiSeq=this.tuttiSeq+1>>>0,this.tuttiSeq}callModelMethod(t,e,n){if(Ot)throw Error("Island Error");const r=this.lookUpModel(t);if(!r)return void console.error(Error(`Model not found: ${t}`));const i=new Dt(this.time,0,r.id,e,n);this.controller.sendMessage(i)}noop(){}generateJoinExit({entered:t,exited:e,count:n}){e=t.length===n?Object.keys(this.users):e.map(t=>t[0]);for(const t of e)this.users[t]&&(delete this.users[t],this.publishFromModel(this.id,"view-exit",t));for(const[e,n,r]of t)this.users[e]||(this.users[e]={name:n},r&&(this.users[e].location=r),this.publishFromModel(this.id,"view-join",e))}scheduleExternalMessage(t){const e=Dt.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);const n=this.externalSeq+1>>>0;if(e.seq!==n)throw Error(`External message error. Expected message #${n} got #${e.seq}`);return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.messages.add(e),e}futureSend(t,e,n,r){if(t.every)return this.futureRepeat(t.every,e,n,r);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const i=new Dt(this.time+t,2*this.futureSeq,e,n,r);return this.messages.add(i),i}futureRepeat(t,e,n,r){this.futureSend(t,this.id,"futureExecAndRepeat",[t,e,n,r])}futureExecAndRepeat(t,e,n,r){const i=this.lookUpModel(e);if("function"==typeof i[n])try{i[n](...r)}catch(t){st(`future message ${i}.${n}`,t)}else{const t=$t(n,i);try{t(...r)}catch(e){st(`future message ${i} ${t}`,e)}}this.futureRepeat(t,e,n,r)}future(t,e,n,r){const i=this.asQFunc(t,n);if("string"==typeof i)return this.futureSend(e,t.id,i,r);const o=this;return new Proxy(t,{get(n,r){if("function"==typeof t[r])return(...n)=>{if(o.lookUpModel(t.id)!==t)throw Error("future send to unregistered model");return o.futureSend(e,t.id,r,n)};throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}advanceTo(t,e){if(Ot)throw Error("Island Error");let n,r=0;for(;(n=this.messages.peek())&&n.time<=t;){const{time:t,seq:i}=n;if(t<this.time)throw Error("past message encountered: "+n);if(1&i&&(this.seq=this.seq+1>>>0,i/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${i/2>>>0} in ${n}`);if(this.messages.poll(),this.time=n.time,n.executeOn(this),++r>100&&(r=0,Date.now()>e))return!1}return this.time=t,!0}asQFunc(t,e){if("string"==typeof e)return e;if("function"==typeof e){if(t[e.name]===e)return e.name;let n=t;for(;null!==n;){for(const[t,r]of Object.entries(Object.getOwnPropertyDescriptors(n)))if(r.value===e)return t;n=Object.getPrototypeOf(n)}const r=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,i=e.toString().match(r);return!i||i[3]&&i[3]!==i[1]?function(t,e){"function"==typeof t&&(e=t,t={});const n=Object.keys(t).concat(["return "+e]),r=Object.values(t),i={qPara:n,qArgs:r},o=r.indexOf(e);return o>=0&&(r[o]=n[o],i.qFn=o),`{${btoa(JSON.stringify(i))}}`}(e):i[2]}return null}addSubscription(t,e,n,r){if(Ot!==this)throw Error("Island Error");const i=this.asQFunc(t,r);if("string"!=typeof i)throw Error(`Subscription handler for "${n}" must be a method name`);if("function"!=typeof t[i]&&"{"!==i[0])throw Error(`Subscriber method for "${n}" not found: ${t}.${i}()`);const o=e+":"+n,s=t.id+"."+i;if(this.subscriptions[o]){if(-1!==this.subscriptions[o].indexOf(s))throw Error(`${t}.${i} already subscribed to ${n}`)}else this.subscriptions[o]=[];this.subscriptions[o].push(s)}removeSubscription(t,e,n,r){if(Ot!==this)throw Error("Island Error");const i=e+":"+n,o=t.id+"."+r,s=this.subscriptions[i];if(s){const t=s.indexOf(o);s.splice(t,1),0===s.length&&delete this.subscriptions[i]}}removeAllSubscriptionsFor(t){const e=`${t.id}:`,n=`${t.id}.`;for(const[t,r]of Object.entries(this.subscriptions))if(t.startsWith(e))delete this.subscriptions[t];else{for(let t=r.length-1;t>=0;t--)r[t].startsWith(n)&&r.splice(t,1);0===r.size&&delete this.subscriptions[t]}}publishFromModel(t,e,n){if(Ot!==this)throw Error("Island Error");const r=e.endsWith(Nt);r&&(e=e.slice(0,e.length-Nt.length));const i=t+":"+e;this.handleModelEventInModel(i,n,r),this.handleModelEventInView(i,n)}publishFromView(t,e,n){if(Ot)throw Error("Island Error");const r=t+":"+e;this.handleViewEventInModel(r,n),this.handleViewEventInView(r,n)}handleModelEventInModel(t,e,n=!1){if(Ot!==this)throw Error("Island Error");if(n){const n=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;const r=t+Pt,i=t+jt,o=!!bt.subscriptions[r],s=!!this.subscriptions[t],a=!!this.subscriptions[i];o&&a&&console.log(`divergence subscription for ${t} overridden by vote subscription`);const c=s?new Dt(this.time,0,this.id,"handleModelEventInModel",[t,e]):null;let l;l=o?[this.id,"handleModelEventInView",r]:[this.id,"handleTuttiDivergence",i],this.controller.sendTutti(this.time,n,e,c,o,l)}else if(this.subscriptions[t])for(const n of this.subscriptions[t]){const[r,...i]=n.split("."),o=i.join("."),s=this.lookUpModel(r);if(s){if("{"===o[0]){const n=$t(o,s);try{n(e)}catch(e){st(`event ${t} ${s} ${n}`,e)}continue}"function"!=typeof s[o]&&it(`event ${t} ${s}.${o}(): method not found`)}else it(`event ${t} .${o}(): subscriber not found`);try{s[o](e)}catch(e){st(`event ${t} ${s}.${o}()`,e)}}}handleViewEventInModel(t,e){if(this.subscriptions[t]){const n=new Dt(this.time,0,this.id,"handleModelEventInModel",[t,e]);this.controller.sendMessage(n)}}handleModelEventInView(t,e){bt.handleEvent(t,e,t=>(function(t){if(!Ot)throw Error("Island confusion");const e=Ot;try{Ot=null,t()}finally{Ot=e}})(()=>Mt(this,t,!0)))}handleViewEventInView(t,e){bt.handleEvent(t,e)}handleTuttiDivergence(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{const n=t.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${n}:`,e)}}processModelViewEvents(){if(Ot)throw Error("Island Error");return Mt(this,()=>bt.processFrameEvents(!!this.controller.synced))}pollToCheckSync(){const t=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;const e=Date.now(),n={date_island:this.time,hash:this.getSummaryHash()},r=Date.now()-e;this.controller.cpuTime-=r;const i=[this.id,"handleSyncCheckVote","syncCheckVote"];this.controller.sendTutti(this.time,t,n,null,!0,i)}handleSyncCheckVote(t,e){this.controller.handleSyncCheckVote(e)}pollForSnapshot(){const t=this.getNextTuttiSeq(),e=this.time,n=e-this.lastSnapshotPoll;if(n<5e3)return void console.log(`rejecting snapshot poll ${n}ms after previous`);this.lastSnapshotPoll=e;const r=this.controller.preparePollForSnapshot();if(!r)return;const i=Date.now();r.hash=this.getSummaryHash();const o=Date.now()-i;this.controller.cpuTime-=o,Promise.resolve().then(()=>this.controller.pollForSnapshot(e,t,r))}handleSnapshotVote(t,e){this.controller.handleSnapshotVote(e)}snapshot(){return Bt.newOrRecycled(this).snapshot(this,"$")}getSummaryHash(){return(new Lt).getHash(this)}random(){if(Ot!==this)throw Error("Island Error");return this._random()}randomID(){if(Ot!==this)throw Error("Island Error");let t="";for(let e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}}function Rt(t,e){const[n,r,i]=t.match(/^([^[]+)(\[.*)?$/i),[o,s]=r.split(">");let a=[];if(i){a=Ht.newOrRecycled(e).decode(JSON.parse(i))}return{receiver:o,selector:s,args:a}}function It(t,e){return(e-t|0)>=0}class Dt{constructor(t,e,n,r,i){this.time=t,this.seq=e,this.payload=function(t,e,n){n.length>0&&(n=Ft.newOrRecycled().encode(n));return`${t}>${e}${n.length>0?JSON.stringify(n):""}`}(n,r,i)}before(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?It(this.externalSeq,t.externalSeq):It(this.internalSeq,t.internalSeq)}hasReceiver(t){return function(t,e){return t.startsWith(`${e}>`)}(this.payload,t)}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(t){this.seq=2*t+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(t){this.seq=2*t}asState(){return[this.time,this.seq,this.payload]}static fromState(t,e){const[n,r,i]=t,{receiver:o,selector:s,args:a}=Rt(i,e);return new Dt(n,r,o,s,a)}executeOn(t){const{receiver:e,selector:n,args:r}=Rt(this.payload,t),i=t.lookUpModel(e);if(i)if("{"===n[0]){const e=$t(n,i);At(t,()=>{Et(t,()=>{try{e(...r)}catch(t){st(`${this.shortString()} ${e}`,t)}})})}else"function"!=typeof i[n]?it(`${this.shortString()} ${i}.${n}(): method not found`):At(t,()=>{Et(t,()=>{try{i[n](...r)}catch(t){st(`${this.shortString()} ${i}.${n}()`,t)}})});else it(`${this.shortString()} ${n}(): receiver not found`)}shortString(){return`${this.isExternal()?"External":"Future"}Message`}toString(){const{receiver:t,selector:e,args:n}=Rt(this.payload),r=this.isExternal(),i=r?this.externalSeq:this.internalSeq;return`${r?"External":"Future"}Message[${this.time}${":#"[+r]}${i} ${t}.${e}(${n.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const zt=(()=>{const t=new ArrayBuffer(8),e=new DataView(t);return t=>(e.setFloat64(0,t,!0),e.getInt32(0,!0)+e.getInt32(4,!0))})();class Lt{constructor(){this.refs=new Map,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",Dt);for(const[t,e]of Gt.allClassTypes())this.addHasher(t,e)}addHasher(t,e){const{cls:n,write:r}=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:t=>Object.assign({},t)};this.hashers.set(n,t=>this.hashStructure(t,r(t)))}getHash(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[e,n]of Object.entries(t))if("controller"!==e&&"meta"!==e)if("_random"===e)this.hash(n.state(),!1);else if("messages"===e){const t=n.asArray();(this.hashState.fC=t.length)&&this.hash(t,!1)}else this.hashEntry(e,n);return this.hashDeferred(),this.hashState}hashDeferred(){for(;this.todo.length>0;){const{key:t,value:e}=this.todo.shift();this.hashEntry(t,e,!1)}}hash(t,e=!0){switch(typeof t){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=zt(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;default:{const n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return void this.hashArray(t,e);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return void this.hashStructure(t,[...t]);case"Object":if(t instanceof Gt)this.hashModel(t);else if(t.constructor===Object)this.hashObject(t,e);else{const e=this.hashers.get(t.constructor);if(!e)throw Error(`Don't know how to hash ${t.constructor.name}`);e(t)}return;case"Null":return;default:throw Error(`Don't know how to hash ${n}`)}}}}hashModel(t){if(!this.refs.has(t)){this.hashState.mC++,this.refs.set(t,!0);for(const[e,n]of Object.entries(t))"__realm"!==e&&void 0!==n&&this.hashEntry(e,n)}}hashObject(t,e=!0){if(!this.refs.has(t)){this.hashState.oC++,this.refs.set(t,!0);for(const[n,r]of Object.entries(t))void 0!==r&&this.hashEntry(n,r,e)}}hashArray(t,e=!0){if(!this.refs.has(t)){this.refs.set(t,!0);for(let n=0;n<t.length;n++)this.hashEntry(n,t[n],e)}}hashStructure(t,e){void 0!==e&&(this.refs.has(t)||(this.refs.set(t,!0),this.hash(e,!1)))}hashEntry(t,e,n=!0){"$"!==t[0]?n&&"object"==typeof e?this.todo.push({key:t,value:e}):this.hash(e):it(`snapshot: ignoring property ${t}`,{only:"once"})}}class Bt{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.island=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.island=t,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",Dt);for(const[t,e]of Gt.allClassTypes())this.addWriter(t,e)}addWriter(t,e){const{cls:n,write:r}=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:t=>Object.assign({},t)};this.writers.set(n,(e,n)=>this.writeAs(t,e,r(e),n))}snapshot(t){const e={_random:t._random.state(),messages:this.write(t.messages.asArray())};for(const[n,r]of Object.entries(t))"controller"!==n&&(e[n]||this.writeInto(e,n,r,"$"));return this.writeDeferred(),e}writeDeferred(){for(;this.todo.length>0;){const{state:t,key:e,value:n,path:r}=this.todo.shift();this.writeInto(t,e,n,r,!1)}}write(t,e,n=!0){switch(typeof t){case"number":return Number.isSafeInteger(t)?t:Number.isNaN(t)?{$class:"NaN"}:Number.isFinite(t)?this.writeFloat(t):{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":case"undefined":return t;default:{const r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.writeArray(t,e,n);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return this.writeAs(r,t,[...t],e);case"Object":{if(t instanceof Gt)return this.writeModel(t,e);if(t.constructor===Object)return this.writeObject(t,e,n);const r=this.writers.get(t.constructor);if(r)return r(t,e);throw Error(`Don't know how to write ${t.constructor.name} at ${e}`)}case"Null":return t;default:throw Error(`Don't know how to write ${r} at ${e}`)}}}}writeModel(t,e){if(this.refs.has(t))return this.writeRef(t);const n={$model:Gt.classToID(t.constructor)};this.refs.set(t,n);for(const r of Object.keys(t).sort()){if("__realm"===r)continue;const i=t[r];void 0!==i&&this.writeInto(n,r,i,e)}return n}writeObject(t,e,n=!0){if(this.refs.has(t))return this.writeRef(t);const r={};this.refs.set(t,r);for(const i of Object.keys(t).sort()){const o=t[i];void 0!==o&&this.writeInto(r,i,o,e,n)}return r}writeArray(t,e,n=!0){if(this.refs.has(t))return this.writeRef(t);const r=[];this.refs.set(t,r);for(let i=0;i<t.length;i++)this.writeInto(r,i,t[i],e,n);return r}writeFloat(t){return t}writeAs(t,e,n,r){if(void 0===n)return n;if(this.refs.has(e))return this.writeRef(e);const i={$class:t};this.refs.set(e,i);const o=this.write(n,r,!1);return"object"!=typeof o||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}writeRef(t){const e=this.refs.get(t);if("object"!=typeof e)throw Error("Non-object in refs: "+t);return Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}}),{$ref:e.$id||(e.$id=this.nextRef++)}}writeInto(t,e,n,r,i=!0){if("$"===e[0])return void it(`snapshot: ignoring property ${e}`,{only:"once"});if(i&&"object"==typeof n)return void this.todo.push({state:t,key:e,value:n,path:r});const o=r+("string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i)?`.${e}`:`[${JSON.stringify(e)}]`),s=this.write(n,o);void 0!==s&&(t[e]=s)}}class Ut{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.island=t,e.refs=new Map,e.todo=[],e.unresolved=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.island=t,this.refs=new Map,this.todo=[],this.unresolved=[],this.readers=new Map,this.addReader("Teatime:Message",Dt);for(const[t,e]of Gt.allClassTypes())this.addReader(t,e);this.readers.set("NaN",()=>NaN),this.readers.set("Infinity",t=>t*(1/0)),this.readers.set("Set",t=>new Set(t)),this.readers.set("Map",t=>new Map(t)),this.readers.set("Array",t=>t.slice(0)),this.readers.set("Uint8Array",t=>new Uint8Array(t)),this.readers.set("Uint16Array",t=>new Uint16Array(t)),this.readers.set("Float32Array",t=>new Float32Array(t))}addReader(t,e){const n="object"==typeof e?e.read:t=>Object.assign(Object.create(e.prototype),t);this.readers.set(t,n)}readIsland(t,e){if("$"!==e)throw Error("Island must be root object");const n={_random:new s(null,{state:t._random})};for(const[r,i]of Object.entries(t))n[r]||this.readInto(n,r,i,e);return this.readDeferred(),this.resolveRefs(),n}readDeferred(){for(;this.todo.length>0;){const{object:t,key:e,value:n,path:r}=this.todo.shift();this.readInto(t,e,n,r,1)}}resolveRefs(){for(const{object:t,key:e,ref:n,path:r}of this.unresolved){if(!this.refs.has(n))throw Error(`Unresolved ref: ${n} at ${r}[${JSON.stringify(e)}]`);t[e]=this.refs.get(n)}}read(t,e,n=0){switch(typeof t){case"number":case"string":case"boolean":return t;default:{const r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.readArray(t,e,n);case"Null":return null;case"Object":{const{$class:r,$model:i,$ref:o}=t;if(o)throw Error("refs should have been handled in readInto()");return i?this.readModel(t,e):r?this.readAs(r,t,e):this.readObject(Object,t,e,n)}default:throw Error(`Don't know how to read ${r} at ${e}`)}}}}readModel(t,e){const n=Gt.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,n);for(const[r,i]of Object.entries(t))"id"!==r&&"$"!==r[0]&&this.readInto(n,r,i,e);return n}readObject(t,e,n,r=0){const i=new t;e.$id&&this.refs.set(e.$id,i);for(const[t,o]of Object.entries(e))"$"!==t[0]&&this.readInto(i,t,o,n,r);return i}readArray(t,e,n=0){const r=[];t.$id&&this.refs.set(t.$id,r);for(let i=0;i<t.length;i++)void 0!==t[i]&&this.readInto(r,i,t[i],e,n);return r}readAs(t,e,n){let r={};const i=new Map;if("$value"in e)r=this.read(e.$value,n,2);else for(const[t,o]of Object.entries(e)){if("$"===t[0])continue;const e=o&&o.$ref;e?this.refs.has(e)?r[t]=this.refs.get(e):(r[t]="<unresolved>",i.set(e,t)):this.readInto(r,t,o,n,1)}const o=this.readers.get(t)(r,n);o||"NaN"===t||console.warn(`Reading "${t}" returned ${o} at ${n}`),e.$id&&this.refs.set(e.$id,o);for(const[t,e]of i.entries())this.unresolved.push({object:o,key:e,ref:t,path:n});return o}readRef(t,e,n,r){if(!n||!n.$ref)return!1;const i=n.$ref;return this.refs.has(i)?t[e]=this.refs.get(i):(t[e]="<unresolved>",this.unresolved.push({object:t,key:e,ref:i,path:r})),!0}readInto(t,e,n,r,i=0){if(this.readRef(t,e,n,r))return;if(0===i&&"object"==typeof n)return void this.todo.push({object:t,key:e,value:n,path:r});const o=r+("string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i)?`.${e}`:`[${JSON.stringify(e)}]`);t[e]=this.read(n,o,i>0?i-1:0)}}class Ft extends Bt{encode(t){const e=this.writeArray(t,"$");return this.writeDeferred(),e}writeModel(t){return{$ref:t.id}}}class Ht extends Ut{decode(t){const e=this.readArray(t,"$");return this.readDeferred(),this.resolveRefs(),e}resolveRefs(){for(const{object:t,key:e,ref:n,path:r}of this.unresolved)if(this.refs.has(n))t[e]=this.refs.get(n);else{const i=this.island.lookUpModel(n);if(!i)throw Error(`Unresolved ref: ${n} at ${r}[${JSON.stringify(e)}]`);t[e]=i}}}const Vt={classes:d.has("debug","classes",!1)};let Jt=Symbol("SECRET");const Wt=new WeakSet;class Gt{static __isTeatimeModelClass__(){return!0}static create(t,e){const n=this,r=Ct(),i=new n(Jt);return Object.defineProperty(i,"__realm",{value:r}),Object.defineProperty(i,"id",{value:r.register(i),enumerable:!0}),Wt.add(i),e&&i.beWellKnownAs(e),i.init(t),Wt.has(i)&&(Wt.delete(i),Object.getPrototypeOf(n)!==Gt&&console.warn(`${i} did not call super.init(options)`)),i}static createNoInit(t){const e=Ct(),n=new this(Jt);return Object.defineProperty(n,"__realm",{value:e}),Object.defineProperty(n,"id",{value:t,enumerable:!0}),n}static allowConstructors(){Jt=void 0,console.warn("disabling error reporting for Model constructors")}static register(t="unknown-file"){return Ut.resetInstance(),Bt.resetInstance(),Ft.resetInstance(),Ht.resetInstance(),function(t){const e=E(function(t){const e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}");return`${e.slice(0,n).replace(/\s+/g," ").trim()} {\n${e.slice(n+1,r).trim()}}`}(t));e.then(e=>{console.log(`hashing class ${t.name}: ${e}`),_()&&(k[e].name=`Class ${t.name}`)}),T.push(e)}(this),ee(t,this.name,this),this}static registerIfNeeded(){Xt(this)||this.register()}static types(){return{}}static classToID(t){return function(t){if(Xt(t))return t[Kt];if(Yt(),Xt(t))return t[Kt];throw Error(`Class "${t.name}" not found, did you call ${t.name}.register()?`)}(t)}static classFromID(t){return te(t)}static allClasses(){return Qt()}static allClassTypes(){return function(){const t={};for(const e of Qt())Object.prototype.hasOwnProperty.call(e,"types")&&Object.assign(t,e.types());return Object.entries(t)}()}static instantiateClassID(t,e){return te(t).createNoInit(e)}constructor(t){if(t!==Jt)throw Error(`You must create ${this} using create() not "new"!`)}init(t){Wt.delete(this)}destroy(){Ct().unsubscribeAll(this),Ct().deregister(this)}publish(t,e,n){this.__realm||this.__realmError(),this.__realm.publish(e,n,t)}subscribe(t,e,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,n)}unsubscribe(t,e){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(t=0,e,...n){return this.__realm||this.__realmError(),this.__realm.future(this,t,e,n)}random(){return Ct().random()}now(){return Ct().now()}beWellKnownAs(t){Ct().island.set(t,this)}wellKnownModel(t){return this.__realm.island.get(t)}modelOnly(t){let e="none";try{e=Ct()}catch(t){}if(e===this.__realm)return!0;const n=Error(t||`${this}.modelOnly() called from outside a model!`);throw st("view code",n),n}get sessionId(){return this.__realm.island.id}[Symbol.toPrimitive](){const t=this.constructor.name;return t.includes("Model")?t:`${t}[Model]`}}const Zt={},Kt=Symbol("CLASS_ID");function Yt(){if(e.bundle)for(const[t,n]of Object.entries(e.bundle.cache))for(const[e,r]of Object.entries(n.exports))r&&r.__isTeatimeModelClass__&&ee(t,"default"===e?r.name:e,r)}function Qt(){return 0===Object.keys(Zt).length&&Yt(),Object.values(Zt).map(t=>t.cls)}function Xt(t){return Object.prototype.hasOwnProperty.call(t,Kt)}function te(t){if(Zt[t])return Zt[t].cls;if(Yt(),Zt[t])return Zt[t].cls;throw Error(`Class "${t}" in snapshot, but not found in current source?`)}function ee(t,e,n){const r=`${t}:${e}`,i=Zt[r];if(i&&i.cls!==n)throw Error(`Duplicate class ${e} in ${t}`);return Xt(n)?Vt.classes&&!i&&console.warn(`ignoring re-exported class ${e} from ${t}`):(Vt.classes&&console.log(`registering class ${e} from ${t}`),n[Kt]=r),Zt[r]={cls:n,file:t},n}class ne{static displayStatus(t,e){return ot(t,e)}static displayWarning(t,e){return it(t,e)}static displayError(t,e){return rt(t,e)}constructor(t){Object.defineProperty(this,"realm",{value:Ct()}),Object.defineProperty(this,"id",{value:this.realm.register(this),configurable:!0})}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(t,e,n){this.realm.publish(e,n,t)}subscribe(t,e,n){n=n.bind(this);const{event:r,handling:i}=e.event?e:{event:e};this.realm.subscribe(r,this.id,n,t,i)}unsubscribe(t,e){this.realm.unsubscribe(e,this.id,null,t)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}future(t=0){return this.realm.future(this,t)}random(){return Ct().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}update(t){}wellKnownModel(t){return this.realm.island.get(t)}get sessionId(){return this.realm.island.id}get viewId(){return this.realm.island.controller.viewId}inSameViewRealm(t){return Mt(this.realm.island,t,!0)}[Symbol.toPrimitive](){const t=this.constructor.name;return t.includes("View")?t:`${t}[View]`}}const re=Symbol("hash");function ie(t){return d.has("debug",t,!1)}function oe(t,e){return`https://croquet.io/files/v1/sessiondata/${e}`}class se{static async store(t,e){if(qt.hasCurrent())throw Error("Croquet.Data.store() called from Model code");const n=await async function(t,e){return e}(0,e),r=await async function(t){return b(t)}(n),i=oe(0,r);return await async function(t,e){ie("data")&&console.log(`Uploading ${e.byteLength} bytes to ${t}`);const n=await fetch(t,{method:"PUT",body:e});if(!n.ok)throw Error(`Croquet.Data: failed to upload ${t} (${n.status} ${n.statusText})`);ie("data")&&console.log(`Croquet.Data: uploaded (${n.status} ${n.statusText}) ${e.byteLength} bytes to ${t}`)}(i,n),new se(r)}static async fetch(t,e){if(qt.hasCurrent())throw Error("Croquet.Data.fetch() called from Model code");const n=oe(0,e[re]);return async function(t,e){return e}(0,await async function(t){ie("data")&&console.log(`Downloading from ${t}`);const e=await fetch(t);if(e.ok)return e.arrayBuffer();throw Error(`Croquet.Data: failed to download ${t} (${e.status} ${e.statusText})`)}(n))}constructor(t){Object.defineProperty(this,re,{value:t})}}(class extends Gt{static types(){return{"@croquet.data":{cls:se,write:t=>t[re],read:t=>new se(t)}}}}).register();const ae=t("pako"),ce=1,le="0.3.0:worldcore-patch:a82c4d922b98d437efe19248919f9c464d390019";console.log("Croquet SDK "+le);const ue=`wss://${window.location.hostname.endsWith("croquet.io")?`${window.location.host}/reflector`:"croquet.io/reflector"}/v${ce}`,he="wss://croquet.io/reflector-dev/dev";let de=null;const fe=d.nocheat,pe=["tps"],me=5e3,ge=5,ye=100,we=1e3,ve=200;function be(){return Math.floor(Math.random()*2**53).toString(36)}const _e=new Set;class ke{constructor(){this.reset()}reset(){this.island=null,this.connection=this.connection||new Ce(this),this.networkQueue=new $,this.time=0,this.session="",this.viewId=this.viewId||be(),this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(window.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(window.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],bt.removeAllSubscriptionsFor(this.viewId),bt.addSubscription(this.viewId,"__users__",this.viewId,t=>ot(`users now ${t.count}`),"oncePerFrameWhileSynced"),gt.showSyncWait(!0)}get id(){return this.island?this.island.id:this.islandCreator.snapshot.id}get user(){return{id:this.viewId,name:f("name","GUEST")}}get viewOnly(){return this.islandCreator.viewOnly}get backlog(){return this.island?this.time-this.island.time:0}get starvation(){return Date.now()-this.lastReceived}get activity(){return Date.now()-this.lastSent}get connected(){return this.connection.connected}checkForConnection(t){this.connection.checkForConnection(t)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async establishSession(t,e){de={messages:d.has("debug","messages",!1),sends:d.has("debug","sends",!1),ticks:d.has("debug","ticks",!1),pong:d.has("debug","pong",!1),snapshot:d.has("debug","snapshot",!1),session:d.has("debug","session",!1),initsnapshot:d.has("debug","initsnapshot","localhost"),reflector:d.has("debug","reflector",d.dev||"localhost")};const{optionsFromUrl:n,multiRoom:r,autoSession:o,login:s}=e,a={...e.options};for(const t of[...pe,...n||[]])t in d&&(a[t]=d[t]);if(s&&await async function(){return!d.nologin&&(!(!f("name")||d.user)||new Promise(t=>{const e=document.createElement("style");e.innerHTML='\n            .overlay {\n                z-index: 1010;\n                position: fixed;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                background-color:#333;\n                opacity:0.9;\n                display:flex;\n                align-items:center;\n                justify-content:center\n            }\n            form {\n                background-color: #fff;\n                color: #666;\n                border-radius: 10px;\n                padding: 16px;\n                font-size: 14px;\n            }\n            form dt { margin: 4px 0 }\n            form dd { margin-left: 0 }\n            form input {\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                min-height: 46px;\n                padding: 10px;\n                font-size: 16px;\n                width: 100%;\n                box-shadow: inset 0 1px 2px #666;\n            }\n            form input:invalid { border: 1px solid red; }\n            form input:valid   { border: 1px solid #ccc; }\n            form button {\n                padding: 20px 32px;\n                background-color: #3b5;\n                color: #fff;\n                border-radius: 50px;\n                border-width:0;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n            }\n            .error {\n                visibility: hidden;\n                width: 250px;\n                background-color: #fcc;\n                color: #900;\n                padding: 5px;\n                border-radius: 6px;\n                border: 1px solid #c99;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n            .error::after {\n                content: " ";\n                position: absolute;\n                bottom: 100%;  /* At the top of message */\n                left: 10px;\n                border-width: 5px;\n                border-style: solid;\n                border-color: transparent transparent #c99 transparent;\n            }\n            .notice {\n                visibility: hidden;\n                width: 270px;\n                height: 70px;\n                background-color: #fff;\n                padding: 5px;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n        ',document.head.appendChild(e);const n=document.createElement("form");n.innerHTML='\n            <dl>\n                <dt><label for="user[name]">Username</label></dt>\n                <dd>\n                    <input type="text" required pattern="^[a-zA-Z0-9_]*$" minlength="2" maxlength="15" name="user[name]" id="user[name]" placeholder="Enter a username" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n                <dd class="notice"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[email]">Email</label></dt>\n                <dd>\n                    <input type="email" required id="user[email]" placeholder="you@example.com" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[password]">Password</label></dt>\n                <dd>\n                    <input type="password" required minlength="8" id="user[password]" placeholder="Create a password" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <button id="user[create]">Sign up / Log in</button>\n            <div style="margin:16px auto;text-align: center">— OR —</div>\n            <button id="user[guest]" style="background-color: #999">Continue as Croquet Guest</button>\n            <div style="max-width:280px;text-align: center;font-size:11px;margin:4px auto">\n                Continuing from this screen to our website indicates that you agree to our\n                <a href="/terms.html" target="_blank" style="color:#36c;text-decoration:none">terms of service</a>\n                and\n                <a href="/privacy.html" target="_blank" style="color:#36c;text-decoration:none">privacy statement</a>.\n            </div>\n        ';const r=document.createElement("div");r.classList.add("overlay"),r.appendChild(n),document.body.appendChild(r);const[i,o,s]=n.getElementsByTagName("input"),[a,c,l]=n.getElementsByClassName("error"),[u]=n.getElementsByClassName("notice"),[h,p]=n.getElementsByTagName("button");"string"==typeof d.user?i.value=d.user:f("name")&&(i.value=f("name"));let g=0;i.oninput=()=>{clearTimeout(g),g=setTimeout(()=>k(),300)},C(!0),i.oninput();let y=0;o.oninput=()=>{clearTimeout(y),y=setTimeout(()=>S(),300)};let w=0;function b(){n.reset(),document.head.removeChild(e),document.body.removeChild(r)}function _(t,e,n=".json"){return`${m()}/user/${t.toLowerCase()}/${e}${n}`}async function k(t=!1){a.style.visibility="hidden",t||C(!0);const e=i.value.trim();if(!e&&!t)return!1;if(i.validity.tooShort||i.validity.tooLong)return a.innerHTML=`Your username must be between ${i.minLength} and ${i.maxLength} characters long.`,a.style.visibility="visible",!1;if(i.validity.patternMismatch)return a.innerHTML="Your username can only contain alphanumeric characters (letters A-Z, numbers 0-9) and underscores.",a.style.visibility="visible",!1;try{const r=g,i=await fetch(_(e,"salt"),{mode:"cors"});if(r!==g&&!t)return!1;if(i.ok){t||C(!1);const r=await i.json();return{name:e,salt:(n=r.salt,new Uint8Array(atob(n.padEnd(n.length+3&-4,"=").replace(/-/g,"+").replace(/_/g,"/")).split("").map(t=>t.charCodeAt(0))))}}}catch(t){}var n;return{name:e}}function S(t=!1){c.style.visibility="hidden";const e=o.value.trim();return!(!e&&!t)&&(o.validity.valid?e:(c.innerHTML="Please enter a valid email address.",c.style.visibility="visible",!1))}function x(t=!1){l.style.visibility="hidden";const e=s.value;return!(!e&&!t)&&(s.validity.tooShort?(l.innerHTML=`Your password must be at least ${s.minLength} characters long.`,l.style.visibility="visible",!1):e)}function C(t){const e=i.value.trim();u.innerHTML=`“${e}” is already registered as a user.<br><br>\n                If this is you, please enter your password below to continue.\n                Otherwise, please pick a different name.`,u.style.visibility=t?"hidden":"visible",o.disabled=!t,s.placeholder=e?t?`Create a password for “${e}”`:`Enter password for “${e}”`:"Enter a password",h.innerHTML=e?t?`Sign up as “${e}”`:`Log in as “${e}”`:"Sign up / Log in"}s.oninput=()=>{clearTimeout(w),w=setTimeout(()=>x(),300)},h.onclick=async e=>{e.preventDefault();const{name:n,salt:r}=await k(!0),i=!!r||S(!0),o=x(!0);if(!n||!i||!o)return;let s=r;s||(s=crypto.getRandomValues(new Uint8Array(8)),fetch(_(n,"salt"),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({salt:v(s)})}));const a=await window.crypto.subtle.importKey("raw",(new TextEncoder).encode(o),{name:"PBKDF2"},!1,["deriveBits"]),c=v(await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:s,iterations:5e5,hash:"SHA-256"},a,256));if(r)try{const t=await fetch(_(n,c),{mode:"cors"});if(!t.ok)throw Error("wrong password");const e=await t.json();console.log(`Logged in as ${e.name} <${e.email}>`),localStorage.croquetUser=JSON.stringify(e)}catch(t){return l.innerHTML=`Wrong password for “${n}“`,void(l.style.visibility="visible")}else{const t=crypto.getRandomValues(new Uint8Array(16)),e={name:n,email:i,salt:v(s),secret:v(t)};localStorage.croquetUser=JSON.stringify(e),fetch(_(n,c),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),console.log(`Signed up as ${e.name} <${e.email}>`)}b(),t(!0)},p.onclick=e=>{e.preventDefault(),delete localStorage.croquetUser,b(),t(!1)}}))}(),o){const e=t,n=d.getSession().split("/");let i=r?n[1]:n[0],s=r?n[2]:n[1];const a=!i||!s;a&&(o.user&&(i=o.user),o.random&&(s=o.random),i||(i=f("name","").toLowerCase()||"GUEST"),s||(s=be())),this.session=r?`${e}/${i}/${s}`:`${i}/${s}`,r||(d.setSession(this.session,a),gt.sessionURL=window.location.href),t=`${e}/${i}/${s}`}const c=Object.keys(a).length?t+"?"+Object.entries(a).map(([t,e])=>`${t}=${(t=>"object"==typeof t?i(t):t)(e)}`).sort().join("&"):t,{hash:l,codeHash:u}=await async function(t,e){const n=y().filter(t=>{const e=t.endsWith("/package.json")||t.endsWith("/ar.js");return e&&console.warn(`excluding ${t} from code hash`),!e}).sort(),r=await Promise.all([...n.map(O),...T]),i=await E([e,...r].join("|")),o=await E([t,i].join("|"));if(_()){k[i].name="All code",k[o].name="Session name and code";const t=[...r,i,o].map(t=>({hash:t,...k[t]}));console.log(`Debug Hashing for session ${o}`,t)}return{hash:o,codeHash:i}}(c,le);console.log(`Session ID for "${t}": ${l}`),this.islandCreator={...e,options:a,name:t,codeHash:u};let h=!1;return this.islandCreator.snapshot?this.islandCreator.snapshot.id!==l&&(console.warn("Existing snapshot was for different code base!"),h=!0):h=!0,h&&(this.islandCreator.snapshot={id:l,time:0,meta:{id:l,codeHash:u,created:(new Date).toISOString()}}),await this.join(),await this.startedOrSynced(),this.island.modelsByName}lastKnownTime(t){return Math.max(t.time,t.externalTime)}handleSyncCheckVote(t){if(!0!==this.synced)return;const{_local:e,tally:n}=t,r=Object.keys(n);e&&r.includes(e)?r.length>1?console.log(r):console.log("ok"):console.log(this.id,"Sync: local vote not found",e,n)}takeSnapshot(){const t=this.island.snapshot(),e=this.lastKnownTime(t),n=t.externalSeq;return t.meta={...this.islandCreator.snapshot.meta,options:this.islandCreator.options,time:e,seq:n,date:(new Date).toISOString(),host:window.location.hostname,sdk:le},delete t.meta.hash,t}scheduleSnapshot(){if(!this.island)return;const t=this.island.time,e=t-this.island.lastSnapshotPoll;if(e<5e3)return void(de.snapshot&&console.log(`not requesting snapshot poll (${e}ms since poll scheduled)`));const n=new Dt(t,0,this.island.id,"pollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),de.snapshot&&console.log(this.id,"Controller scheduling snapshot via reflector")}preparePollForSnapshot(){const t=this.triggeringCpuTime||this.cpuTime;return this.triggeringCpuTime=null,this.cpuTime=0,!0===this.synced?{cpuTime:t}:null}pollForSnapshot(t,e,n){n.cpuTime+=Math.random();const r=[this.id,"handleSnapshotVote","snapshotVote"];this.sendTutti(t,e,n,null,!0,r)}handleSnapshotVote(t){if(!0!==this.synced)return void(de.snapshot&&console.log("Ignoring snapshot vote during sync"));const{_local:e,tally:n}=t,r=Object.keys(n);if(!e||!r.includes(e))return de.snapshot&&console.log(this.id,"Snapshot: local vote not found"),void(this.cpuTime=0);const i=(t,n)=>{const i=s[t];i.length>1&&i.sort((t,e)=>o[t].cpuTime-o[e].cpuTime);const a=i[0];r[a]===e&&this.serveSnapshot(n)},o=r.map(t=>JSON.parse(t)),s={};o.forEach(({hash:t},e)=>{s[t]||(s[t]=[]),s[t].push(e)});const a=Object.keys(s);let c=a[0];a.length>1&&(de.snapshot&&console.log(this.id,`Snapshots fall into ${a.length} groups`),a.sort((t,e)=>s[e].length-s[t].length),s[a[0]].length===s[a[1]].length&&(de.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),c=a[0]<a[1]?a[0]:a[1])),a.forEach(t=>i(t,t===c))}serveSnapshot(t){const e=W.begin("snapshot"),n=this.takeSnapshot(),r=W.end("snapshot")-e;this.cpuTime-=r,de.snapshot&&console.log(this.id,`Snapshotting took ${Math.ceil(r)} ms`),this.uploadSnapshot(n,t)}snapshotUrl(t,e,n,r,i){const o=`.json${i?"."+i:""}`;return`${`${function(t="code"){const e=d.has("dev","host","localhost")?`dev/${f("name","GUEST")}/`:"";return`${m()}/${e}${t}/`}("snapshots")}${this.id}`}/${`${(t=>(""+t).padStart(10,"0"))(Math.round(e))}_${n}-${t}-${r}${o}`}`}hashSnapshot(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise(e=>{const n={...t};delete n.meta,E(JSON.stringify(n)).then(n=>{t.meta.hash=n,delete t.meta.hashPromise,e(n)})})),t.meta.hashPromise)}async uploadSnapshot(t,e=!0){await this.hashSnapshot(t);const n=Date.now(),r=JSON.stringify(t),i=Date.now()-n,{time:o,seq:s,hash:a}=t.meta,c=this.snapshotUrl("snap",o,s,a,"gz");de.snapshot&&console.log(this.id,`Controller uploading snapshot (${r.length} bytes, ${i}ms) to ${c}`);const l=this.connection.socket,u=await this.uploadGzipped(c,r);return this.connection.socket!==l?(console.error("Controller was reset while trying to upload snapshot"),!1):u?(e&&this.announceSnapshotUrl(o,s,a,c),!0):(console.error("Failed to upload snapshot"),!1)}announceSnapshotUrl(t,e,n,r){de.snapshot&&console.log(this.id,`Controller sending snapshot url to reflector (time: ${t}, seq: ${e}, hash: ${n}): ${r}`);try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:n,url:r}}))}catch(t){console.error("ERROR while sending",t)}}async fetchJSON(t,e){try{const e=await fetch(t,{mode:"cors"});if(t.endsWith(".gz")){const t=await e.arrayBuffer(),n=ae.inflate(new Uint8Array(t),{to:"string"});return JSON.parse(n)}return await e.json()}catch(t){}return e}async uploadJSON(t,e){try{const{ok:n}=await fetch(t,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:e});return n}catch(t){}return!1}async uploadGzipped(t,e){const n=Date.now(),r=(new TextEncoder).encode(e),i=ae.gzip(r,{level:1});de.snapshot&&console.log(`Snapshot gzipping took ${Date.now()-n}ms`);try{const{ok:e}=await fetch(t,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/octet-stream"},body:i});return e}catch(t){}return!1}convertReflectorMessage(t){let e=this.id,n="noop",r=[];switch(t[2].what){case"users":{const{joined:i,left:o,active:s,total:a}=t[2];this.users=s,this.usersTotal=a;const c=this.id,l="__users__",u={entered:i||[],exited:o||[],count:s};for(const t of u.entered)t.length>2&&(t.length=2);e=this.id,n="publishFromModel",r=[c,l,u],bt.handleEvent(this.viewId+":"+l,u);break}case"tally":{const{tuttiSeq:i,tally:o,tallyTarget:s}=t[2],a={tuttiSeq:i,tally:o},c=this.tuttiHistory.find(t=>t.tuttiSeq===i);let l;c&&(a._local=c.payload),[e,n,l]=s,r=[l,a];break}}const i=new Dt(0,0,e,n,r);t[2]=i.asState()[2]}async receive(t,e){switch(this.lastReceived=this.connection.lastReceived,t){case"START":{de.session&&console.log(this.id,"Controller received START"),this.install();const t=this.takeSnapshot(),e=await this.uploadSnapshot(t,!0);return this.islandCreator.startedOrSynced.resolve(this.island),void(e?this.requestTicks():this.connection.closeConnectionWithError("start","failed to establish session"))}case"SYNC":{const{messages:t,url:n,time:r}=e;de.session&&console.log(this.id,`Controller received SYNC: time ${r}, ${t.length} messages, ${n}`);for(const e of t)de.messages&&console.log(this.id,"Controller received message in SYNC "+JSON.stringify(e)),e[1]>>>=0,"string"!=typeof e[2]&&this.convertReflectorMessage(e),this.networkQueue.put(e),this.timeFromReflector(e[0]);this.timeFromReflector(r),de.session&&console.log(`${this.id} fetching snapshot ${n}`);const i=await this.fetchJSON(n);if(this.islandCreator.snapshot=i,!this.connected)return void console.log(this.id,"socket went away during SYNC");this.install(),de.session&&console.log(`${this.id} fast forwarding from ${Math.round(this.island.time)} to ${r}`),this.getTickAndMultiplier();const o=()=>{this.simulate(Date.now()+200)?(de.session&&console.log(`${this.id} fast forwarded to ${Math.round(this.island.time)}`),this.islandCreator.startedOrSynced.resolve(this.island)):setTimeout(o,0)};return void setTimeout(o,0)}case"RECV":{de.messages&&console.log(this.id,"Controller received RECV "+JSON.stringify(e));const t=e;return"string"!=typeof t[2]&&this.convertReflectorMessage(t),t[1]>>>=0,t[3]===this.viewId&&this.addToStatistics(t[4],this.lastReceived),this.networkQueue.put(t),void this.timeFromReflector(t[0])}case"TICK":{if(!this.island)return;const t="number"==typeof e?e:e.time;return de.ticks&&console.log(this.id,"Controller received TICK "+t),this.timeFromReflector(t),void(this.tickMultiplier&&this.multiplyTick(t))}case"LEAVE":return console.log(this.id,"Controller received LEAVE"),void this.leave();default:console.warn("Unknown action:",t,e)}}install(){de.session&&console.log(`${this.id} installing island`);const{snapshot:t,init:e,options:n}=this.islandCreator;let r=new qt(t,()=>{try{return e(n)}catch(t){throw st("init",t),t}});if(de.initsnapshot&&!t.modelsById){const t=JSON.stringify(r.snapshot());r=new qt(JSON.parse(t),()=>e(n))}const i=this.lastKnownTime(r);this.time=Math.max(this.time,i),this.setIsland(r)}setIsland(t){this.island=t,this.island.controller=this}createCleanIsland(){const{options:t,init:e}=this.islandCreator,n={id:this.id};return new qt(n,()=>e(t))}async join(){this.checkForConnection(!1),await this.connection.connectionPromise,_e.add(this),de.session&&console.log(this.id,"Controller sending JOIN");const{name:t,id:e}=this.user,n={name:this.islandCreator.name,options:this.islandCreator.options,version:ce,user:[e,t],url:gt.sessionURL,codeHash:this.islandCreator.codeHash,sdk:le};this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:n}))}async startedOrSynced(){return new Promise((t,e)=>this.islandCreator.startedOrSynced={resolve:t,reject:e})}leave(){this.connected&&(console.log(this.id,`Controller LEAVING session for ${this.islandCreator.name}`),this.connection.send(JSON.stringify({id:this.id,action:"LEAVING"}))),_e.delete(this);const{destroyerFn:t}=this.islandCreator;if(this.reset(),!this.islandCreator)throw Error("do not discard islandCreator!");t&&t()}sendMessage(t){this.connected&&(this.viewOnly||(de.sends&&console.log(this.id,`Controller sending SEND ${t.asState()}`),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[...t.asState(),this.viewId,this.lastSent,this.latency]}))))}sendTagged(t,e){this.connected&&(this.viewOnly||(de.sends&&console.log(this.id,`Controller sending tagged SEND ${t.asState()} with tags ${JSON.stringify(e)}`),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[...t.asState(),this.viewId,this.lastSent],tags:e}))))}sendTutti(t,e,n,r,o,s){if(!this.connected)return;if(this.viewOnly)return;const a=i(n);de.sends&&console.log(this.id,`Controller sending TUTTI ${a} ${r&&r.asState()} ${s}`),this.tuttiHistory.push({tuttiSeq:e,payload:a}),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,e,a,r&&r.asState(),o,s]}))}sendVote(t,e,n){const r=[this.island.id,"handleModelEventInView",this.island.id+":"+e];this.sendTutti(this.island.time,t,n,null,!0,r)}addToStatistics(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const t=this.islandCreator.options,e="tps"in t?t.tps:"tps"in this.islandCreator?this.islandCreator.tps:20,[n,r]=(e+"x").split("x").map(t=>Number.parseInt("0"+t,10)),i=1e3/Math.max(1,Math.min(60,n)),o=Math.max(1,r);return o>1&&!fe&&(this.tickMultiplier={tick:i,multiplier:o}),{tick:i,multiplier:o}}requestTicks(t={}){if(!this.connected||!this.island)return;const{tick:e,multiplier:n}=this.getTickAndMultiplier();t.tick=e,t.delay=e*(n-1)/n,de.session&&console.log(this.id,"Controller requesting TICKS",t);try{this.connection.send(JSON.stringify({id:this.id,action:"TICKS",args:t}))}catch(t){console.error("ERROR while sending",t)}}simulate(t){if(!this.island)return!0;try{const e=W.begin("simulate");let n=!0;for(;n;){const e=this.networkQueue.peek();if(!e)break;if(!(n=this.island.advanceTo(e[0],t)))break;this.networkQueue.nextNonBlocking();const r=this.island.scheduleExternalMessage(e);n=this.island.advanceTo(r.time,t),this.cpuTime+=ge}n&&(n=this.island.advanceTo(this.time,t)),this.cpuTime+=Math.max(.01,W.end("simulate")-e);const r=this.backlog;if(W.backlog(r),"boolean"==typeof this.synced&&(this.synced&&r>we||!this.synced&&r<ye)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout(()=>{delete this.syncTimer,this.backlog<ye&&this.applySyncChange(!0)},ve)):this.applySyncChange(!1)}return n&&this.cpuTime>me&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,setTimeout(()=>this.scheduleSnapshot(),Math.floor(2e3*Math.random()))),n}catch(t){return st("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}applySyncChange(t){this.synced=t,gt.showSyncWait(!t),this.island.publishFromView(this.viewId,"synced",t)}inViewRealm(t){return Mt(this.island,()=>t(this.island))}processModelViewEvents(){return this.island?this.island.processModelViewEvents():0}timeFromReflector(t,e="reflector"){t<this.time?("controller"!==e||de.ticks)&&console.warn(`time is ${this.time}, ignoring time ${t} from ${e}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.time=t,this.island&&W.backlog(this.backlog),this.tickHook&&this.tickHook())}multiplyTick(t){this.localTicker&&window.clearInterval(this.localTicker);const{tick:e,multiplier:n}=this.tickMultiplier,r=e/n;let i=1;this.localTicker=window.setInterval(()=>{this.timeFromReflector(t+i*r,"controller"),de.ticks&&console.log(this.id,"Controller generate TICK "+this.time,i),++i>=n&&(window.clearInterval(this.localTicker),this.localTicker=0)},r)}}const Se=100,xe=2e4;class Ce{constructor(t){this.controller=t,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.setUpConnectionPromise()}setUpConnectionPromise(){this.connectionPromise=new Promise(t=>this.resolveConnection=t)}get connected(){return this.socket&&this.socket.readyState===WebSocket.OPEN}checkForConnection(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}async connectToReflector(){this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;let t=d.reflector||(de.reflector?he:ue);if(!t.match(/^wss?:/))throw Error("Cannot interpret reflector address "+t);return t.endsWith("/")||(t+="/"),new Promise(e=>{const n=Object.assign(new WebSocket(`${t}${this.controller.id}`),{onopen:t=>{this.socket=n,(de.session||de.reflector)&&console.log(this.socket.constructor.name,"connected to",this.socket.url),W.connected(!0),this.resolveConnection(null),e()},onmessage:t=>{this.receive(t.data)},onerror:t=>{rt("Connection error"),console.log(n.constructor.name,"error")},onclose:t=>{const e=1e3!==t.code&&t.code<4100,r=4110===t.code;r||rt(`Connection closed: ${t.code} ${t.reason}`,{duration:e?void 0:36e5}),de.session&&console.log(n.constructor.name,"closed:",t.code,t.reason),W.connected(!1),r?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),e&&(it("Reconnecting ..."),window.setTimeout(()=>this.connectToReflector(),2e3))}})})}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.lastSent=0,this.connectHasBeenCalled=!1,this.setUpConnectionPromise(),this.controller.leave())}send(t){this.lastSent=Date.now(),this.socket.send(t)}receive(t){this.lastReceived=Date.now();const{id:e,action:n,args:r}=JSON.parse(t);if(e)try{this.controller.receive(n,r)}catch(t){this.closeConnectionWithError("receive",t)}else switch(n){case"PONG":de.pong&&console.log("PONG after",Date.now()-r,"ms");break;default:console.warn("Unknown action",n)}}dormantDisconnect(){this.connected&&(console.log("dormant; disconnecting from reflector"),this.socket.close(4110,"Going dormant"))}closeConnectionWithError(t,e){console.error(e),console.warn("closing socket"),this.socket.close(4e3,"Error in "+t)}PING(){this.connected&&(this.socket.bufferedAmount?console.log(`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent`):this.send(JSON.stringify({action:"PING",args:Date.now()})))}PULSE(){this.connected&&(this.socket.bufferedAmount&&console.log(`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent`),this.send(JSON.stringify({action:"PULSE"})))}keepAlive(){0!==this.lastReceived&&(Date.now()-this.lastReceived>Se?this.PING():Date.now()-this.lastSent>xe&&this.PULSE())}}window.setInterval(()=>{for(const t of _e)t.connected&&t.connection.keepAlive()},100);class Ee{static async join(t,e=Gt,n=ne,r){function o(t,e){return t===e||t.prototype instanceof e}if("string"!=typeof t?t=JSON.stringify(t)||"undefined":t||(t="unnamed"),!o(e,Gt))throw Error("ModelRoot must inherit from Croquet.Model");if(!o(n,ne)){if(!n||Object.getPrototypeOf(n)!==Object.prototype||void 0!==r)throw Error("ViewRoot must inherit from Croquet.View");r=n,n=ne}r||(r={});const s=d.reflector||r.reflector;if(s&&(s.includes("://")?d.reflector=s:console.warn(`Not a valid websocket url, ignoring reflector "${s}"`)),r.debug){function a(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]}d.debug=[...a(r.debug),...a(d.debug)].join(",")}let c=null;"autoSleep"in r&&(d.autoSleep=r.autoSleep),setInterval(()=>{if("hidden"===document.visibilityState)if(!1===d.autoSleep)Pe(performance.now(),h,p.view);else{const t=Date.now();c?t-c>1e4&&h.dormantDisconnect():c=t}else c=null},1e3),"expectedSimFPS"in r&&(Ae=Math.min(r.expectedSimFPS,$e));const l=["tps"],u=["optionsFromUrl","login","autoSession"];!function(){if(Object.isFrozen(Ne))return;(function t(e){if(Object.isFrozen(e))return;Object.freeze(e);for(const n of Object.values(e))!n||"object"!=typeof n&&"function"!=typeof n||t(n)})(Ne),function(t){const e=JSON.stringify(t,(t,e)=>"function"==typeof e?""+e:e);if("{}"===e)return;const n=JSON.parse(e),r=E(i(n));r.then(t=>{console.log(`hashing Croquet.Constants(${Object.keys(n).join(", ")}): ${t}`),_()&&(k[t].name="Croquet Constants")}),T.push(r)}(Ne)}();const h=new ke,f={};r.options&&Object.assign(f,JSON.parse(JSON.stringify(r.options)));for(const[t,e]of Object.entries(r))l.includes(t)&&(f[t]=e);const p={id:"",model:null,view:null,step(t){"hidden"!==document.visibilityState&&(c=null,Pe(t,h,p.view))},leave(){console.warn("Session leave not implemented yet!")},get latency(){return h.latency},get latencies(){return h.latencies}};if(await async function e(i){!function(){p.model=null,p.view&&(d.has("debug","session",!1)&&console.log(p.id,"Detaching root view"),p.view.detach(),""!==p.view.id&&console.warn(`${p.view} did not call super.detach()`),p.view=null);gt.clearSessionMoniker()}();const o={snapshot:i,init:m,destroyerFn:e,options:f};for(const[t,e]of Object.entries(r))u.includes(t)&&(o[t]=e);p.model=(await h.establishSession(t,o)).modelRoot;p.id=h.id;gt.makeSessionWidgets(p.id);h.inViewRealm(()=>{d.has("debug","session",!1)&&console.log(p.id,"Creating root view"),p.view=new n(p.model)})}(),"manual"!==r.step){const t=e=>{p.step(e),window.requestAnimationFrame(t)};window.requestAnimationFrame(t)}return p;function m(t){return{modelRoot:e.create(t,"modelRoot")}}}}const Me=200,Oe=[0],Te=4,$e=120;let Ae=60;function Pe(t,e,n){e.checkForConnection(!0);const{backlog:r,latency:i,starvation:o,activity:s}=e;if(W.animationFrame(t,{backlog:r,starvation:o,latency:i,activity:s,users:e.users}),!e.island)return;const a=Date.now(),c=Oe.reduce((t,e)=>t+e,0)/Oe.length;e.simulate(a+Math.min(c,Me));const l=0===Ae?0:Te*(1e3/Ae);e.backlog>l&&e.simulate(a+Me-c),Oe.push(Date.now()-a),Oe.length>Te&&Oe.shift(),W.begin("update"),e.processModelViewEvents(),W.end("update"),n&&(W.begin("render"),e.inViewRealm(()=>n.update(t)),W.end("render"))}const Ne={};n.App=gt,n.Constants=Ne,n.Data=se,n.Model=Gt,n.Session=Ee,n.View=ne,n.gatherInternalClassTypes=function(t,e){const n={};return function t(e,n="",r={},i=new Set){const o=Object.values(e).filter(t=>{const e=Object.prototype.toString.call(t).slice(8,-1);return("Object"===e||"Array"===e)&&!i.has(t)});for(const t of o){i.add(t);const e=n+"."+t.constructor.name;if(r[e]){if(r[e]!==t.constructor)throw new Error("Class with name "+e+" already gathered, but new one has different identity")}else r[e]=t.constructor}for(const e of o)t(e,n,r,i)}({root:t},e,n,new Set),n},n.startSession=function(...t){return gt.showMessage("Croquet.startSession() is deprecated, please use Croquet.Session.join()",{level:"warning",only:"once"}),Ee.join(...t)}},{"fast-json-stable-stringify":"vwDV","toastify-js":"D2QR","seedrandom/seedrandom":"u80Q",fastpriorityqueue:"wmWq",pako:"JWfd"}],O3jn:[function(t,e,n){"use strict";var r=t("../utils/common"),i=4,o=0,s=1,a=2;function c(t){for(var e=t.length;--e>=0;)t[e]=0}var l=0,u=1,h=2,d=29,f=256,p=f+1+d,m=30,g=19,y=2*p+1,w=15,v=16,b=7,_=256,k=16,S=17,x=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],T=new Array(2*(p+2));c(T);var $=new Array(2*m);c($);var A=new Array(512);c(A);var P=new Array(256);c(P);var N=new Array(d);c(N);var j,q,R,I=new Array(m);function D(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function L(t){return t<256?A[t]:A[256+(t>>>7)]}function B(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function U(t,e,n){t.bi_valid>v-n?(t.bi_buf|=e<<t.bi_valid&65535,B(t,t.bi_buf),t.bi_buf=e>>v-t.bi_valid,t.bi_valid+=n-v):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function F(t,e,n){U(t,n[2*e],n[2*e+1])}function H(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function V(t,e,n){var r,i,o=new Array(w+1),s=0;for(r=1;r<=w;r++)o[r]=s=s+n[r-1]<<1;for(i=0;i<=e;i++){var a=t[2*i+1];0!==a&&(t[2*i]=H(o[a]++,a))}}function J(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<m;e++)t.dyn_dtree[2*e]=0;for(e=0;e<g;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*_]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function W(t){t.bi_valid>8?B(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function G(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function Z(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&G(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!G(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function K(t,e,n){var r,i,o,s,a=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],i=t.pending_buf[t.l_buf+a],a++,0===r?F(t,i,e):(F(t,(o=P[i])+f+1,e),0!==(s=C[o])&&U(t,i-=N[o],s),F(t,o=L(--r),n),0!==(s=E[o])&&U(t,r-=I[o],s))}while(a<t.last_lit);F(t,_,e)}function Y(t,e){var n,r,i,o=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,c=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=y,n=0;n<c;n++)0!==o[2*n]?(t.heap[++t.heap_len]=l=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[i]=0,t.opt_len--,a&&(t.static_len-=s[2*i+1]);for(e.max_code=l,n=t.heap_len>>1;n>=1;n--)Z(t,o,n);i=c;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,Z(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,o,s,a,c=e.dyn_tree,l=e.max_code,u=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,m=0;for(o=0;o<=w;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<y;n++)(o=c[2*c[2*(r=t.heap[n])+1]+1]+1)>p&&(o=p,m++),c[2*r+1]=o,r>l||(t.bl_count[o]++,s=0,r>=f&&(s=d[r-f]),a=c[2*r],t.opt_len+=a*(o+s),h&&(t.static_len+=a*(u[2*r+1]+s)));if(0!==m){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>l||(c[2*i+1]!==o&&(t.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),r--)}}(t,e),V(o,l,t.bl_count)}function Q(t,e,n){var r,i,o=-1,s=e[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=e[2*(r+1)+1],++a<c&&i===s||(a<l?t.bl_tree[2*i]+=a:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*k]++):a<=10?t.bl_tree[2*S]++:t.bl_tree[2*x]++,a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4))}function X(t,e,n){var r,i,o=-1,s=e[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),r=0;r<=n;r++)if(i=s,s=e[2*(r+1)+1],!(++a<c&&i===s)){if(a<l)do{F(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(F(t,i,t.bl_tree),a--),F(t,k,t.bl_tree),U(t,a-3,2)):a<=10?(F(t,S,t.bl_tree),U(t,a-3,3)):(F(t,x,t.bl_tree),U(t,a-11,7));a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4)}}c(I);var tt=!1;function et(t,e,n,i){U(t,(l<<1)+(i?1:0),3),function(t,e,n,i){W(t),i&&(B(t,n),B(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}n._tr_init=function(t){tt||(function(){var t,e,n,r,i,o=new Array(w+1);for(n=0,r=0;r<d-1;r++)for(N[r]=n,t=0;t<1<<C[r];t++)P[n++]=r;for(P[n-1]=r,i=0,r=0;r<16;r++)for(I[r]=i,t=0;t<1<<E[r];t++)A[i++]=r;for(i>>=7;r<m;r++)for(I[r]=i<<7,t=0;t<1<<E[r]-7;t++)A[256+i++]=r;for(e=0;e<=w;e++)o[e]=0;for(t=0;t<=143;)T[2*t+1]=8,t++,o[8]++;for(;t<=255;)T[2*t+1]=9,t++,o[9]++;for(;t<=279;)T[2*t+1]=7,t++,o[7]++;for(;t<=287;)T[2*t+1]=8,t++,o[8]++;for(V(T,p+1,o),t=0;t<m;t++)$[2*t+1]=5,$[2*t]=H(t,5);j=new D(T,C,f+1,p,w),q=new D($,E,0,m,w),R=new D(new Array(0),M,0,g,b)}(),tt=!0),t.l_desc=new z(t.dyn_ltree,j),t.d_desc=new z(t.dyn_dtree,q),t.bl_desc=new z(t.bl_tree,R),t.bi_buf=0,t.bi_valid=0,J(t)},n._tr_stored_block=et,n._tr_flush_block=function(t,e,n,r){var c,l,d=0;t.level>0?(t.strm.data_type===a&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return s;return o}(t)),Y(t,t.l_desc),Y(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),e=g-1;e>=3&&0===t.bl_tree[2*O[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),c=t.opt_len+3+7>>>3,(l=t.static_len+3+7>>>3)<=c&&(c=l)):c=l=n+5,n+4<=c&&-1!==e?et(t,e,n,r):t.strategy===i||l===c?(U(t,(u<<1)+(r?1:0),3),K(t,T,$)):(U(t,(h<<1)+(r?1:0),3),function(t,e,n,r){var i;for(U(t,e-257,5),U(t,n-1,5),U(t,r-4,4),i=0;i<r;i++)U(t,t.bl_tree[2*O[i]+1],3);X(t,t.dyn_ltree,e-1),X(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),K(t,t.dyn_ltree,t.dyn_dtree)),J(t),r&&W(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(P[n]+f+1)]++,t.dyn_dtree[2*L(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){U(t,u<<1,3),F(t,_,T),function(t){16===t.bi_valid?(B(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":"JNpU"}],wDpY:[function(t,e,n){"use strict";var r,i=t("../utils/common"),o=t("./trees"),s=t("./adler32"),a=t("./crc32"),c=t("./messages"),l=0,u=1,h=3,d=4,f=5,p=0,m=1,g=-2,y=-3,w=-5,v=-1,b=1,_=2,k=3,S=4,x=0,C=2,E=8,M=9,O=15,T=8,$=286,A=30,P=19,N=2*$+1,j=15,q=3,R=258,I=R+q+1,D=32,z=42,L=69,B=73,U=91,F=103,H=113,V=666,J=1,W=2,G=3,Z=4,K=3;function Y(t,e){return t.msg=c[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function X(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function et(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function nt(t,e){t.pending_buf[t.pending++]=e}function rt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var n,r,i=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match,c=t.strstart>t.w_size-I?t.strstart-(t.w_size-I):0,l=t.window,u=t.w_mask,h=t.prev,d=t.strstart+R,f=l[o+s-1],p=l[o+s];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(l[(n=e)+s]===p&&l[n+s-1]===f&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<d);if(r=R-(d-o),o=d-R,r>s){if(t.match_start=e,s=r,r>=a)break;f=l[o+s-1],p=l[o+s]}}}while((e=h[e&u])>c&&0!=--i);return s<=t.lookahead?s:t.lookahead}function ot(t){var e,n,r,o,c,l,u,h,d,f,p=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-I)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=p?r-p:0}while(--n);e=n=p;do{r=t.prev[--e],t.prev[e]=r>=p?r-p:0}while(--n);o+=p}if(0===t.strm.avail_in)break;if(l=t.strm,u=t.window,h=t.strstart+t.lookahead,d=o,f=void 0,(f=l.avail_in)>d&&(f=d),n=0===f?0:(l.avail_in-=f,i.arraySet(u,l.input,l.next_in,f,h),1===l.state.wrap?l.adler=s(l.adler,u,f,h):2===l.state.wrap&&(l.adler=a(l.adler,u,f,h)),l.next_in+=f,l.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=q)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+q-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<q)););}while(t.lookahead<I&&0!==t.strm.avail_in)}function st(t,e){for(var n,r;;){if(t.lookahead<I){if(ot(t),t.lookahead<I&&e===l)return J;if(0===t.lookahead)break}if(n=0,t.lookahead>=q&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-I&&(t.match_length=it(t,n)),t.match_length>=q)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-q),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=q){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=t.strstart<q-1?t.strstart:q-1,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}function at(t,e){for(var n,r,i;;){if(t.lookahead<I){if(ot(t),t.lookahead<I&&e===l)return J;if(0===t.lookahead)break}if(n=0,t.lookahead>=q&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=q-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-I&&(t.match_length=it(t,n),t.match_length<=5&&(t.strategy===b||t.match_length===q&&t.strstart-t.match_start>4096)&&(t.match_length=q-1)),t.prev_length>=q&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-q,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-q),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+q-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=q-1,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return J}else if(t.match_available){if((r=o._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return J}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<q-1?t.strstart:q-1,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}function ct(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function lt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*N),this.dyn_dtree=new i.Buf16(2*(2*A+1)),this.bl_tree=new i.Buf16(2*(2*P+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(j+1),this.heap=new i.Buf16(2*$+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*$+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ut(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=C,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?z:H,t.adler=2===e.wrap?0:1,e.last_flush=l,o._tr_init(e),p):Y(t,g)}function ht(t){var e,n=ut(t);return n===p&&((e=t.state).window_size=2*e.w_size,X(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=q-1,e.match_available=0,e.ins_h=0),n}function dt(t,e,n,r,o,s){if(!t)return g;var a=1;if(e===v&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),o<1||o>M||n!==E||r<8||r>15||e<0||e>9||s<0||s>S)return Y(t,g);8===r&&(r=9);var c=new lt;return t.state=c,c.strm=t,c.wrap=a,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+q-1)/q),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=s,c.method=n,ht(t)}r=[new ct(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ot(t),0===t.lookahead&&e===l)return J;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,et(t,!1),0===t.strm.avail_out))return J;if(t.strstart-t.block_start>=t.w_size-I&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),J)}),new ct(4,4,8,4,st),new ct(4,5,16,8,st),new ct(4,6,32,32,st),new ct(4,4,16,16,at),new ct(8,16,32,32,at),new ct(8,16,128,128,at),new ct(8,32,128,256,at),new ct(32,128,258,1024,at),new ct(32,258,258,4096,at)],n.deflateInit=function(t,e){return dt(t,e,E,O,T,x)},n.deflateInit2=dt,n.deflateReset=ht,n.deflateResetKeep=ut,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,p):g},n.deflate=function(t,e){var n,i,s,c;if(!t||!t.state||e>f||e<0)return t?Y(t,g):g;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===V&&e!==d)return Y(t,0===t.avail_out?w:g);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===z)if(2===i.wrap)t.adler=0,nt(i,31),nt(i,139),nt(i,8),i.gzhead?(nt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),nt(i,255&i.gzhead.time),nt(i,i.gzhead.time>>8&255),nt(i,i.gzhead.time>>16&255),nt(i,i.gzhead.time>>24&255),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(nt(i,255&i.gzhead.extra.length),nt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=a(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=L):(nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0),nt(i,K),i.status=H);else{var y=E+(i.w_bits-8<<4)<<8;y|=(i.strategy>=_||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=D),y+=31-y%31,i.status=H,rt(i,y),0!==i.strstart&&(rt(i,t.adler>>>16),rt(i,65535&t.adler)),t.adler=1}if(i.status===L)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending!==i.pending_buf_size));)nt(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=B)}else i.status=B;if(i.status===B)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),0===c&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,nt(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>s&&(t.adler=a(t.adler,i.pending_buf,i.pending-s,s)),0===c&&(i.status=F)}else i.status=F;if(i.status===F&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(nt(i,255&t.adler),nt(i,t.adler>>8&255),t.adler=0,i.status=H)):i.status=H),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(n)&&e!==d)return Y(t,w);if(i.status===V&&0!==t.avail_in)return Y(t,w);if(0!==t.avail_in||0!==i.lookahead||e!==l&&i.status!==V){var v=i.strategy===_?function(t,e){for(var n;;){if(0===t.lookahead&&(ot(t),0===t.lookahead)){if(e===l)return J;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}(i,e):i.strategy===k?function(t,e){for(var n,r,i,s,a=t.window;;){if(t.lookahead<=R){if(ot(t),t.lookahead<=R&&e===l)return J;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=q&&t.strstart>0&&(r=a[i=t.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){s=t.strstart+R;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);t.match_length=R-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=q?(n=o._tr_tally(t,1,t.match_length-q),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(et(t,!1),0===t.strm.avail_out))return J}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?G:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?J:W}(i,e):r[i.level].func(i,e);if(v!==G&&v!==Z||(i.status=V),v===J||v===G)return 0===t.avail_out&&(i.last_flush=-1),p;if(v===W&&(e===u?o._tr_align(i):e!==f&&(o._tr_stored_block(i,0,0,!1),e===h&&(X(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,p}return e!==d?p:i.wrap<=0?m:(2===i.wrap?(nt(i,255&t.adler),nt(i,t.adler>>8&255),nt(i,t.adler>>16&255),nt(i,t.adler>>24&255),nt(i,255&t.total_in),nt(i,t.total_in>>8&255),nt(i,t.total_in>>16&255),nt(i,t.total_in>>24&255)):(rt(i,t.adler>>>16),rt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:m)},n.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==z&&e!==L&&e!==B&&e!==U&&e!==F&&e!==H&&e!==V?Y(t,g):(t.state=null,e===H?Y(t,y):p):g},n.deflateSetDictionary=function(t,e){var n,r,o,a,c,l,u,h,d=e.length;if(!t||!t.state)return g;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==z||n.lookahead)return g;for(1===a&&(t.adler=s(t.adler,e,d,0)),n.wrap=0,d>=n.w_size&&(0===a&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,e,d-n.w_size,n.w_size,0),e=h,d=n.w_size),c=t.avail_in,l=t.next_in,u=t.input,t.avail_in=d,t.next_in=0,t.input=e,ot(n);n.lookahead>=q;){r=n.strstart,o=n.lookahead-(q-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+q-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=q-1,ot(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=q-1,n.match_available=0,t.next_in=l,t.input=u,t.avail_in=c,n.wrap=a,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":"JNpU","./trees":"O3jn","./adler32":"PDe7","./crc32":"Nls6","./messages":"NGcu"}],hB2j:[function(t,e,n){"use strict";var r=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var s=new r.Buf8(256),a=0;a<256;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",s=0;s<e;s++)n+=String.fromCharCode(t[s]);return n}s[254]=s[254]=1,n.string2buf=function(t){var e,n,i,o,s,a=t.length,c=0;for(o=0;o<a;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(c),s=0,o=0;s<c;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},n.buf2binstring=function(t){return c(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,i,o,a=e||t.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((i=t[n++])<128)l[r++]=i;else if((o=s[i])>4)l[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<a;)i=i<<6|63&t[n++],o--;o>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return c(l,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+s[t[n]]>e?n:e}},{"./common":"JNpU"}],ZpAv:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),i=t("./utils/common"),o=t("./utils/strings"),s=t("./zlib/messages"),a=t("./zlib/zstream"),c=Object.prototype.toString,l=0,u=-1,h=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({level:u,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==l)throw new Error(s[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==l)throw new Error(s[n]);this._dict_set=!0}}function p(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}f.prototype.push=function(t,e){var n,s,a=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(u),a.next_out=0,a.avail_out=u),1!==(n=r.deflate(a,s))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===s?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==s||(this.onEnd(l),a.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=f,n.deflate=p,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./zlib/deflate":"wDpY","./utils/common":"JNpU","./utils/strings":"hB2j","./zlib/messages":"NGcu","./zlib/zstream":"w28B"}],ISOm:[function(t,e,n){"use strict";var r=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,c,l,u,h,d){var f,p,m,g,y,w,v,b,_,k=d.bits,S=0,x=0,C=0,E=0,M=0,O=0,T=0,$=0,A=0,P=0,N=null,j=0,q=new r.Buf16(16),R=new r.Buf16(16),I=null,D=0;for(S=0;S<=15;S++)q[S]=0;for(x=0;x<c;x++)q[e[n+x]]++;for(M=k,E=15;E>=1&&0===q[E];E--);if(M>E&&(M=E),0===E)return l[u++]=20971520,l[u++]=20971520,d.bits=1,0;for(C=1;C<E&&0===q[C];C++);for(M<C&&(M=C),$=1,S=1;S<=15;S++)if($<<=1,($-=q[S])<0)return-1;if($>0&&(0===t||1!==E))return-1;for(R[1]=0,S=1;S<15;S++)R[S+1]=R[S]+q[S];for(x=0;x<c;x++)0!==e[n+x]&&(h[R[e[n+x]]++]=x);if(0===t?(N=I=h,w=19):1===t?(N=i,j-=257,I=o,D-=257,w=256):(N=s,I=a,w=-1),P=0,x=0,S=C,y=u,O=M,T=0,m=-1,g=(A=1<<M)-1,1===t&&A>852||2===t&&A>592)return 1;for(;;){v=S-T,h[x]<w?(b=0,_=h[x]):h[x]>w?(b=I[D+h[x]],_=N[j+h[x]]):(b=96,_=0),f=1<<S-T,C=p=1<<O;do{l[y+(P>>T)+(p-=f)]=v<<24|b<<16|_|0}while(0!==p);for(f=1<<S-1;P&f;)f>>=1;if(0!==f?(P&=f-1,P+=f):P=0,x++,0==--q[S]){if(S===E)break;S=e[n+h[x]]}if(S>M&&(P&g)!==m){for(0===T&&(T=M),y+=C,$=1<<(O=S-T);O+T<E&&!(($-=q[O+T])<=0);)O++,$<<=1;if(A+=1<<O,1===t&&A>852||2===t&&A>592)return 1;l[m=P&g]=M<<24|O<<16|y-u|0}}return 0!==P&&(l[y+P]=S-T<<24|64<<16|0),d.bits=M,0}},{"../utils/common":"JNpU"}],Y7L2:[function(t,e,n){"use strict";var r=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),s=t("./inffast"),a=t("./inftrees"),c=0,l=1,u=2,h=4,d=5,f=6,p=0,m=1,g=2,y=-2,w=-3,v=-4,b=-5,_=8,k=1,S=2,x=3,C=4,E=5,M=6,O=7,T=8,$=9,A=10,P=11,N=12,j=13,q=14,R=15,I=16,D=17,z=18,L=19,B=20,U=21,F=22,H=23,V=24,J=25,W=26,G=27,Z=28,K=29,Y=30,Q=31,X=32,tt=852,et=592,nt=15;function rt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,p):y}function st(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,ot(t)):y}function at(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?y:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,st(t))):y}function ct(t,e){var n,r;return t?(r=new it,t.state=r,r.window=null,(n=at(t,e))!==p&&(t.state=null),n):y}var lt,ut,ht=!0;function dt(t){if(ht){var e;for(lt=new r.Buf32(512),ut=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(l,t.lens,0,288,lt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(u,t.lens,0,32,ut,0,t.work,{bits:5}),ht=!1}t.lencode=lt,t.lenbits=9,t.distcode=ut,t.distbits=5}function ft(t,e,n,i){var o,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new r.Buf8(s.wsize)),i>=s.wsize?(r.arraySet(s.window,e,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((o=s.wsize-s.wnext)>i&&(o=i),r.arraySet(s.window,e,n-i,o,s.wnext),(i-=o)?(r.arraySet(s.window,e,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0}n.inflateReset=st,n.inflateReset2=at,n.inflateResetKeep=ot,n.inflateInit=function(t){return ct(t,nt)},n.inflateInit2=ct,n.inflate=function(t,e){var n,tt,et,nt,it,ot,st,at,ct,lt,ut,ht,pt,mt,gt,yt,wt,vt,bt,_t,kt,St,xt,Ct,Et=0,Mt=new r.Buf8(4),Ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return y;(n=t.state).mode===N&&(n.mode=j),it=t.next_out,et=t.output,st=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,at=n.hold,ct=n.bits,lt=ot,ut=st,St=p;t:for(;;)switch(n.mode){case k:if(0===n.wrap){n.mode=j;break}for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(2&n.wrap&&35615===at){n.check=0,Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0),at=0,ct=0,n.mode=S;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&at)<<8)+(at>>8))%31){t.msg="incorrect header check",n.mode=Y;break}if((15&at)!==_){t.msg="unknown compression method",n.mode=Y;break}if(ct-=4,kt=8+(15&(at>>>=4)),0===n.wbits)n.wbits=kt;else if(kt>n.wbits){t.msg="invalid window size",n.mode=Y;break}n.dmax=1<<kt,t.adler=n.check=1,n.mode=512&at?A:N,at=0,ct=0;break;case S:for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(n.flags=at,(255&n.flags)!==_){t.msg="unknown compression method",n.mode=Y;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Y;break}n.head&&(n.head.text=at>>8&1),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0)),at=0,ct=0,n.mode=x;case x:for(;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.time=at),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,Mt[2]=at>>>16&255,Mt[3]=at>>>24&255,n.check=o(n.check,Mt,4,0)),at=0,ct=0,n.mode=C;case C:for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.head&&(n.head.xflags=255&at,n.head.os=at>>8),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0)),at=0,ct=0,n.mode=E;case E:if(1024&n.flags){for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.length=at,n.head&&(n.head.extra_len=at),512&n.flags&&(Mt[0]=255&at,Mt[1]=at>>>8&255,n.check=o(n.check,Mt,2,0)),at=0,ct=0}else n.head&&(n.head.extra=null);n.mode=M;case M:if(1024&n.flags&&((ht=n.length)>ot&&(ht=ot),ht&&(n.head&&(kt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,ht,kt)),512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,n.length-=ht),n.length))break t;n.length=0,n.mode=O;case O:if(2048&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.name+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=T;case T:if(4096&n.flags){if(0===ot)break t;ht=0;do{kt=tt[nt+ht++],n.head&&kt&&n.length<65536&&(n.head.comment+=String.fromCharCode(kt))}while(kt&&ht<ot);if(512&n.flags&&(n.check=o(n.check,tt,ht,nt)),ot-=ht,nt+=ht,kt)break t}else n.head&&(n.head.comment=null);n.mode=$;case $:if(512&n.flags){for(;ct<16;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(at!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Y;break}at=0,ct=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=N;break;case A:for(;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}t.adler=n.check=rt(at),at=0,ct=0,n.mode=P;case P:if(0===n.havedict)return t.next_out=it,t.avail_out=st,t.next_in=nt,t.avail_in=ot,n.hold=at,n.bits=ct,g;t.adler=n.check=1,n.mode=N;case N:if(e===d||e===f)break t;case j:if(n.last){at>>>=7&ct,ct-=7&ct,n.mode=G;break}for(;ct<3;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}switch(n.last=1&at,ct-=1,3&(at>>>=1)){case 0:n.mode=q;break;case 1:if(dt(n),n.mode=B,e===f){at>>>=2,ct-=2;break t}break;case 2:n.mode=D;break;case 3:t.msg="invalid block type",n.mode=Y}at>>>=2,ct-=2;break;case q:for(at>>>=7&ct,ct-=7&ct;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if((65535&at)!=(at>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Y;break}if(n.length=65535&at,at=0,ct=0,n.mode=R,e===f)break t;case R:n.mode=I;case I:if(ht=n.length){if(ht>ot&&(ht=ot),ht>st&&(ht=st),0===ht)break t;r.arraySet(et,tt,nt,ht,it),ot-=ht,nt+=ht,st-=ht,it+=ht,n.length-=ht;break}n.mode=N;break;case D:for(;ct<14;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(n.nlen=257+(31&at),at>>>=5,ct-=5,n.ndist=1+(31&at),at>>>=5,ct-=5,n.ncode=4+(15&at),at>>>=4,ct-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Y;break}n.have=0,n.mode=z;case z:for(;n.have<n.ncode;){for(;ct<3;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.lens[Ot[n.have++]]=7&at,at>>>=3,ct-=3}for(;n.have<19;)n.lens[Ot[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,xt={bits:n.lenbits},St=a(c,n.lens,0,19,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid code lengths set",n.mode=Y;break}n.have=0,n.mode=L;case L:for(;n.have<n.nlen+n.ndist;){for(;yt=(Et=n.lencode[at&(1<<n.lenbits)-1])>>>16&255,wt=65535&Et,!((gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(wt<16)at>>>=gt,ct-=gt,n.lens[n.have++]=wt;else{if(16===wt){for(Ct=gt+2;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(at>>>=gt,ct-=gt,0===n.have){t.msg="invalid bit length repeat",n.mode=Y;break}kt=n.lens[n.have-1],ht=3+(3&at),at>>>=2,ct-=2}else if(17===wt){for(Ct=gt+3;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}ct-=gt,kt=0,ht=3+(7&(at>>>=gt)),at>>>=3,ct-=3}else{for(Ct=gt+7;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}ct-=gt,kt=0,ht=11+(127&(at>>>=gt)),at>>>=7,ct-=7}if(n.have+ht>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Y;break}for(;ht--;)n.lens[n.have++]=kt}}if(n.mode===Y)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Y;break}if(n.lenbits=9,xt={bits:n.lenbits},St=a(l,n.lens,0,n.nlen,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){t.msg="invalid literal/lengths set",n.mode=Y;break}if(n.distbits=6,n.distcode=n.distdyn,xt={bits:n.distbits},St=a(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,xt),n.distbits=xt.bits,St){t.msg="invalid distances set",n.mode=Y;break}if(n.mode=B,e===f)break t;case B:n.mode=U;case U:if(ot>=6&&st>=258){t.next_out=it,t.avail_out=st,t.next_in=nt,t.avail_in=ot,n.hold=at,n.bits=ct,s(t,ut),it=t.next_out,et=t.output,st=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,at=n.hold,ct=n.bits,n.mode===N&&(n.back=-1);break}for(n.back=0;yt=(Et=n.lencode[at&(1<<n.lenbits)-1])>>>16&255,wt=65535&Et,!((gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(yt&&0==(240&yt)){for(vt=gt,bt=yt,_t=wt;yt=(Et=n.lencode[_t+((at&(1<<vt+bt)-1)>>vt)])>>>16&255,wt=65535&Et,!(vt+(gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}at>>>=vt,ct-=vt,n.back+=vt}if(at>>>=gt,ct-=gt,n.back+=gt,n.length=wt,0===yt){n.mode=W;break}if(32&yt){n.back=-1,n.mode=N;break}if(64&yt){t.msg="invalid literal/length code",n.mode=Y;break}n.extra=15&yt,n.mode=F;case F:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.length+=at&(1<<n.extra)-1,at>>>=n.extra,ct-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=H;case H:for(;yt=(Et=n.distcode[at&(1<<n.distbits)-1])>>>16&255,wt=65535&Et,!((gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(0==(240&yt)){for(vt=gt,bt=yt,_t=wt;yt=(Et=n.distcode[_t+((at&(1<<vt+bt)-1)>>vt)])>>>16&255,wt=65535&Et,!(vt+(gt=Et>>>24)<=ct);){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}at>>>=vt,ct-=vt,n.back+=vt}if(at>>>=gt,ct-=gt,n.back+=gt,64&yt){t.msg="invalid distance code",n.mode=Y;break}n.offset=wt,n.extra=15&yt,n.mode=V;case V:if(n.extra){for(Ct=n.extra;ct<Ct;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}n.offset+=at&(1<<n.extra)-1,at>>>=n.extra,ct-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Y;break}n.mode=J;case J:if(0===st)break t;if(ht=ut-st,n.offset>ht){if((ht=n.offset-ht)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Y;break}ht>n.wnext?(ht-=n.wnext,pt=n.wsize-ht):pt=n.wnext-ht,ht>n.length&&(ht=n.length),mt=n.window}else mt=et,pt=it-n.offset,ht=n.length;ht>st&&(ht=st),st-=ht,n.length-=ht;do{et[it++]=mt[pt++]}while(--ht);0===n.length&&(n.mode=U);break;case W:if(0===st)break t;et[it++]=n.length,st--,n.mode=U;break;case G:if(n.wrap){for(;ct<32;){if(0===ot)break t;ot--,at|=tt[nt++]<<ct,ct+=8}if(ut-=st,t.total_out+=ut,n.total+=ut,ut&&(t.adler=n.check=n.flags?o(n.check,et,ut,it-ut):i(n.check,et,ut,it-ut)),ut=st,(n.flags?at:rt(at))!==n.check){t.msg="incorrect data check",n.mode=Y;break}at=0,ct=0}n.mode=Z;case Z:if(n.wrap&&n.flags){for(;ct<32;){if(0===ot)break t;ot--,at+=tt[nt++]<<ct,ct+=8}if(at!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Y;break}at=0,ct=0}n.mode=K;case K:St=m;break t;case Y:St=w;break t;case Q:return v;case X:default:return y}return t.next_out=it,t.avail_out=st,t.next_in=nt,t.avail_in=ot,n.hold=at,n.bits=ct,(n.wsize||ut!==t.avail_out&&n.mode<Y&&(n.mode<G||e!==h))&&ft(t,t.output,t.next_out,ut-t.avail_out)?(n.mode=Q,v):(lt-=t.avail_in,ut-=t.avail_out,t.total_in+=lt,t.total_out+=ut,n.total+=ut,n.wrap&&ut&&(t.adler=n.check=n.flags?o(n.check,et,ut,t.next_out-ut):i(n.check,et,ut,t.next_out-ut)),t.data_type=n.bits+(n.last?64:0)+(n.mode===N?128:0)+(n.mode===B||n.mode===R?256:0),(0===lt&&0===ut||e===h)&&St===p&&(St=b),St)},n.inflateEnd=function(t){if(!t||!t.state)return y;var e=t.state;return e.window&&(e.window=null),t.state=null,p},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?y:(n.head=e,e.done=!1,p):y},n.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&n.mode!==P?y:n.mode===P&&i(1,e,r,0)!==n.check?w:ft(t,e,r,r)?(n.mode=Q,v):(n.havedict=1,p):y},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":"JNpU","./adler32":"PDe7","./crc32":"Nls6","./inffast":"odtK","./inftrees":"ISOm"}],zBAp:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),s=t("./zlib/constants"),a=t("./zlib/messages"),c=t("./zlib/zstream"),l=t("./zlib/gzheader"),u=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==s.Z_OK)throw new Error(a[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==s.Z_OK))throw new Error(a[n])}function d(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}h.prototype.push=function(t,e){var n,a,c,l,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?d.input=o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===s.Z_BUF_ERROR&&!0===m&&(n=s.Z_OK,m=!1),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==s.Z_STREAM_END&&(0!==d.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(d.output,d.next_out),l=d.next_out-c,h=o.buf2string(d.output,c),d.next_out=l,d.avail_out=f-l,l&&i.arraySet(d.output,d.output,c,l,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==s.Z_STREAM_END);return n===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./zlib/inflate":"Y7L2","./utils/common":"JNpU","./utils/strings":"hB2j","./zlib/constants":"NNt1","./zlib/messages":"NGcu","./zlib/zstream":"w28B","./zlib/gzheader":"bEbX"}],KkFj:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/utils/common":"JNpU","./lib/deflate":"ZpAv","./lib/inflate":"zBAp","./lib/zlib/constants":"NNt1"}],uCZq:[function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("fast-json-stable-stringify")),o=r(t("toastify-js")),s=r(t("seedrandom/seedrandom")),a=r(t("fastpriorityqueue"));if(void 0===window.TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(t){for(var e=t.length,n=-1,r="undefined"==typeof Uint8Array?new Array(1.5*e):new Uint8Array(3*e),i=0,o=0,s=0;s!==e;){if(i=t.charCodeAt(s),s+=1,i>=55296&&i<=56319){if(s===e){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;break}if(!((o=t.charCodeAt(s))>=56320&&o<=57343)){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;continue}if(s+=1,(i=1024*(i-55296)+o-56320+65536)>65535){r[n+=1]=240|i>>>18,r[n+=1]=128|i>>>12&63,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i;continue}}i<=127?r[n+=1]=0|i:i<=2047?(r[n+=1]=192|i>>>6,r[n+=1]=128|63&i):(r[n+=1]=224|i>>>12,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?r.subarray(0,n+1):(r.length=n+1,r)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(t){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}"object"==typeof e&&e.bundle&&e.bundle.modules&&e.bundle.cache&&function(){const t=e.bundle,n={},r={},i={};for(const[e,o]of Object.entries(t.modules)){const s=""+t.modules[e][0],a=r[s];a?i[e]=a:r[s]=e;for(const[t,e]of Object.entries(o[1]))(n[e]||(n[e]=new Set)).add(t)}const o=t=>n[t]?`${[...n[t]].sort().join('" and "')}`:"top-level",s={},a=[];for(const[e,n]of Object.entries(t.modules))for(const[r,c]of Object.entries(n[1])){const l=i[c];l&&(t.cache[c]?s[l]=c:(n[1][r]=l,delete t.modules[c],a.push(`"${r}" in "${o(e)}" (${e})`)))}for(const[n,r]of Object.entries(t.modules))for(const[i,c]of Object.entries(r[1])){const l=s[c];l&&(t.cache[c]?console.warn(`Could not deduplicate import "${i}" in "${o(n)}" (to fix, import "${o(e.id)}" earlier)`):(r[1][i]=l,delete t.modules[c],a.push(`"${i}" in "${o(n)}" (${n})`)))}for(const t of a.sort())console.log("Deduplicated import",t)}();const c=window.location.hostname.endsWith("croquet.studio");let l="",u="";function h(t,e){if(e)for(const n of e.split("&")){const e=n.split("="),r=e[0];let i=!0;if(e.length>1&&(i=decodeURIComponent(e.slice(1).join("="))).match(/^(true|false|null|[0-9.]*|["[{].*)$/))try{i=JSON.parse(i)}catch(t){"["===i[0]&&(i=i.slice(1,-1).split(","))}t[r]=i}}const d=new class{constructor(){this.getSession(),h(this,window.location.search.slice(1)),h(this,c?window.location.hash.slice(1):u),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(t,e,n){"boolean"!=typeof n&&(n=this.isHost(n));const r=this[t];if("string"!=typeof r)return n;const i=r.split(",");return!0===n&&(e=`no${e}`),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes(`${e}s`)?!n:n}getSession(){if(c){const t=/^\/([^/]+)\/(.*)$/,e=window.location.pathname.match(t);if(e)return l=e[1],e[2]}else{const t=/^#([^&]+)&?(.*)$/,e=window.location.hash.match(t);if(e)return e[1].includes("=")?(u=`${e[1]}&${e[2]}`,""):(u=e[2],e[1])}return"string"==typeof this.session?(u=window.location.hash.slice(1),this.session):""}setSession(t,e=!1){null==c&&this.getSession();const{search:n,hash:r}=window.location,i=c?`/${l}/${t}${n}${r}`:`#${t}${u?"&"+u:""}`;e?window.history.replaceState({},"",i):window.history.pushState({},"",i)}isHost(t){const e=window.location.hostname;return e===t||"localhost"===t&&(!!e.endsWith(".ngrok.io")||["127.0.0.1","::1"].includes(e))}isLocalhost(){return this.isHost("localhost")}};function f(t,e,n=null){let r={};try{r=JSON.parse(localStorage.croquetUser||"{}")}catch(t){}return t in r?r[t]:n?(r[t]=n(),r[t]!==e&&(localStorage.croquetUser=JSON.stringify(r)),r[t]):e}const p=window.location.hostname.endsWith("croquet.io")?window.location.host:"croquet.io";function m(){const t="string"==typeof d.files?d.files:`https://${p}/files/v1`;return t.endsWith("/")?t.slice(0,-1):t}function g(){return e.bundle?e.bundle.modules:[]}function y(){return Object.keys(g()).filter(t=>!t.endsWith("hmr-runtime.js"))}function w(t){return g()[t]}function v(t){return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}async function b(t){if(0===t.length)return"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU";return v(await window.crypto.subtle.digest("SHA-256",t))}function _(){return d.has("debug","hashing",!1)}window.crypto&&window.crypto.subtle&&"function"==typeof window.crypto.subtle.digest||console.error("ERROR: crypto.subtle.digest() browser API not available. Please access this page via https or localhost.");const k={},S={was_initialized:!1};function x(t){return S.was_initialized||function(){for(const t of y())for(const[e,n]of Object.entries(w(t)[1])){const t=S[n]||"",r=e.replace(/^[./]*/,"");r.length>t.length&&(S[n]=r)}S.was_initialized=!0}(),S[t]||t}const C=new TextEncoder;async function E(t){const e=C.encode(t),n=await b(e);return _()&&(k[n]={string:t,buffer:e}),n}const M={};async function O(t){if(M[t])return M[t];const e=function(t){return function(t){const e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}");return e.slice(n+1,r).trim()}(w(t)[0])}(t).replace(/\s+/g," "),n=await E(e);return _()&&(k[n].name=`Module ${x(t)}`),M[t]=n}const T=[];class ${constructor(){this.values=[],this.resolves=[]}async next(){return this.values.length>0?this.values.shift():new Promise(t=>this.resolves.push(t))}put(t){const e=this.resolves.shift();e?e(t):this.values.push(t)}putAll(t){for(const e of t)this.put(e)}peek(){return this.values[0]}nextNonBlocking(){return this.values.shift()}allNonBlocking(){if(0===this.values.length)return[];const t=this.values;return this.values=[],t}get size(){return this.values.length-this.resolves.length}}var A;!function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;e<r;e++){var i=[],o=this.data.charCodeAt(e);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;e<n;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+n][e+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=d.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e},createMovieClip:function(t,e,n){var r=t.createEmptyMovieClip(e,n);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,s=0;s<this.modules[i].length;s++){var a=1*s;this.modules[i][s]&&(r.beginFill(0,100),r.moveTo(a,o),r.lineTo(a+1,o),r.lineTo(a+1,o+1),r.lineTo(a,o+1),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=d.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=t[e],i=t[n];if(null==this.modules[r][i])for(var o=-2;o<=2;o++)for(var s=-2;s<=2;s++)this.modules[r+o][i+s]=-2==o||2==o||-2==s||2==s||0==o&&0==s}},setupTypeNumber:function(t){for(var e=d.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++){r=!t&&1==(e>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,r=d.getBCHTypeInfo(n),i=0;i<15;i++){var o=!t&&1==(r>>i&1);i<6?this.modules[i][8]=o:i<8?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;i<15;i++){o=!t&&1==(r>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=o:i<9?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,r=this.moduleCount-1,i=7,o=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var a=0;a<2;a++)if(null==this.modules[r][s-a]){var c=!1;o<t.length&&(c=1==(t[o]>>>i&1)),d.getMask(e,r,s-a)&&(c=!c),this.modules[r][s-a]=c,-1==--i&&(o++,i=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,r){for(var i=g.getRSBlocks(t,n),o=new y,s=0;s<r.length;s++){var a=r[s];o.put(a.mode,4),o.put(a.getLength(),d.getLengthInBits(a.mode,t)),a.write(o)}var c=0;for(s=0;s<i.length;s++)c+=i[s].dataCount;if(o.getLengthInBits()>8*c)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*c+")");for(o.getLengthInBits()+4<=8*c&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*c||(o.put(e.PAD0,8),o.getLengthInBits()>=8*c));)o.put(e.PAD1,8);return e.createBytes(o,i)},e.createBytes=function(t,e){for(var n=0,r=0,i=0,o=new Array(e.length),s=new Array(e.length),a=0;a<e.length;a++){var c=e[a].dataCount,l=e[a].totalCount-c;r=Math.max(r,c),i=Math.max(i,l),o[a]=new Array(c);for(var u=0;u<o[a].length;u++)o[a][u]=255&t.buffer[u+n];n+=c;var h=d.getErrorCorrectPolynomial(l),f=new m(o[a],h.getLength()-1).mod(h);s[a]=new Array(h.getLength()-1);for(u=0;u<s[a].length;u++){var p=u+f.getLength()-s[a].length;s[a][u]=p>=0?f.get(p):0}}var g=0;for(u=0;u<e.length;u++)g+=e[u].totalCount;var y=new Array(g),w=0;for(u=0;u<r;u++)for(a=0;a<e.length;a++)u<o[a].length&&(y[w++]=o[a][u]);for(u=0;u<i;u++)for(a=0;a<e.length;a++)u<s[a].length&&(y[w++]=s[a][u]);return y};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},i=0,o=1,s=2,a=3,c=4,l=5,u=6,h=7,d={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;d.getBCHDigit(e)-d.getBCHDigit(d.G15)>=0;)e^=d.G15<<d.getBCHDigit(e)-d.getBCHDigit(d.G15);return(t<<10|e)^d.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;d.getBCHDigit(e)-d.getBCHDigit(d.G18)>=0;)e^=d.G18<<d.getBCHDigit(e)-d.getBCHDigit(d.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return d.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case i:return(e+n)%2==0;case o:return e%2==0;case s:return n%3==0;case a:return(e+n)%3==0;case c:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case l:return e*n%2+e*n%3==0;case u:return(e*n%2+e*n%3)%2==0;case h:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new m([1],0),n=0;n<t;n++)e=e.multiply(new m([1,f.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,r=0;r<e;r++)for(var i=0;i<e;i++){for(var o=0,s=t.isDark(r,i),a=-1;a<=1;a++)if(!(r+a<0||e<=r+a))for(var c=-1;c<=1;c++)i+c<0||e<=i+c||0==a&&0==c||s==t.isDark(r+a,i+c)&&o++;o>5&&(n+=3+o-5)}for(r=0;r<e-1;r++)for(i=0;i<e-1;i++){var l=0;t.isDark(r,i)&&l++,t.isDark(r+1,i)&&l++,t.isDark(r,i+1)&&l++,t.isDark(r+1,i+1)&&l++,0!=l&&4!=l||(n+=3)}for(r=0;r<e;r++)for(i=0;i<e-6;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(n+=40);for(i=0;i<e;i++)for(r=0;r<e-6;r++)t.isDark(r,i)&&!t.isDark(r+1,i)&&t.isDark(r+2,i)&&t.isDark(r+3,i)&&t.isDark(r+4,i)&&!t.isDark(r+5,i)&&t.isDark(r+6,i)&&(n+=40);var u=0;for(i=0;i<e;i++)for(r=0;r<e;r++)t.isDark(r,i)&&u++;return n+=10*(Math.abs(100*u/e/e-50)/5)}},f={glog:function(t){if(t<1)throw new Error("glog("+t+")");return f.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return f.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;p<8;p++)f.EXP_TABLE[p]=1<<p;for(p=8;p<256;p++)f.EXP_TABLE[p]=f.EXP_TABLE[p-4]^f.EXP_TABLE[p-5]^f.EXP_TABLE[p-6]^f.EXP_TABLE[p-8];for(p=0;p<255;p++)f.LOG_TABLE[f.EXP_TABLE[p]]=p;function m(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var r=0;r<t.length-n;r++)this.num[r]=t[r+n]}function g(t,e){this.totalCount=t,this.dataCount=e}function y(){this.buffer=[],this.length=0}m.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<t.getLength();r++)e[n+r]^=f.gexp(f.glog(this.get(n))+f.glog(t.get(r)));return new m(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=f.glog(this.get(0))-f.glog(t.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<t.getLength();r++)n[r]^=f.gexp(f.glog(t.get(r))+e);return new m(n,0).mod(t)}},g.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],g.getRSBlocks=function(t,e){var n=g.getRsBlockTable(t,e);if(null==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=n.length/3,i=[],o=0;o<r;o++)for(var s=n[3*o+0],a=n[3*o+1],c=n[3*o+2],l=0;l<s;l++)i.push(new g(a,c));return i},g.getRsBlockTable=function(t,e){switch(e){case r.L:return g.RS_BLOCK_TABLE[4*(t-1)+0];case r.M:return g.RS_BLOCK_TABLE[4*(t-1)+1];case r.Q:return g.RS_BLOCK_TABLE[4*(t-1)+2];case r.H:return g.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},y.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var w=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],v=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,n=this._htOption,r=t.getModuleCount(),i=n.width/r,o=n.height/r,s=Math.round(i),a=Math.round(o);this.clear();for(var c=0;c<r;c++)for(var l=0;l<r;l++){var u=t.isDark(c,l),h=l*i,d=c*o;e.strokeStyle=u?n.colorDark:n.colorLight,e.lineWidth=1,e.fillStyle=u?n.colorDark:n.colorLight,e.fillRect(h,d,i,o),e.strokeRect(Math.floor(h)+.5,Math.floor(d)+.5,s,a),e.strokeRect(Math.ceil(h)-.5,Math.ceil(d)-.5,s,a)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();function b(t,e){for(var n=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),o=0,s=w.length;o<=s;o++){var a=0;switch(e){case r.L:a=w[o][0];break;case r.M:a=w[o][1];break;case r.Q:a=w[o][2];break;case r.H:a=w[o][3]}if(i<=a)break;n++}if(n>w.length)throw new Error("Too long data");return n}(A=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:r.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(v=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new v(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(b(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},A.prototype.clear=function(){this._oDrawing.clear()},A.prototype.getCanvas=function(){for(let t=0;t<this._el.children.length;t++){const e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},A.CorrectLevel=r}();var P=A;const N=Date.now();"undefined"==typeof performance&&(window.performance={now:()=>Date.now()-N});const j=["simulate","update","render","snapshot"],q={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"};let R=null,I=null,D=null,z=null;function L(t){for(R=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",(I=document.createElement("div")).id="text_stats",I.style.padding=5,I.style.background="rgba(255,255,255,0.2)",I.style.fontFamily="sans-serif",t.appendChild(I),t.title=Object.entries(q).map(([t,e])=>`${e}: ${t}`).join("\n"),(D=document.createElement("canvas")).width=Math.min(125,window.innerWidth)*window.devicePixelRatio,D.height=125*window.devicePixelRatio,D.style.width="100%",t.appendChild(D),(z=D.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio)}const B=[];let U=0,F=!1,H=V(0);function V(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:F}}const J=[],W={animationFrame(t,e={}){!function(t){for(H.total=t-H.start,B.push(H);B.length>Math.min(120,window.innerWidth);)B.shift();if(!R||"none"===window.getComputedStyle(R).display)return;const e=B.slice(1).filter(t=>t.total),n=e.map(t=>t.total).reduce((t,e)=>t+e,0)/e.length;Math.max(...e.map(t=>Math.max(t.backlog,t.network))),U=1e3,I.parentElement||(console.warn("who broke the stats div and canvas?"),R.appendChild(I),R.appendChild(D)),I.innerText=`${H.users} users, ${Math.round(1e3/n)} fps, `+(H.backlog<100&&H.activity<1e3?`latency: ${H.latency} ms`:`backlog: ${H.backlog<100?"0.0":(H.backlog/1e3).toFixed(1)} s`),z.clearRect(0,0,D.width,D.height);const r=t=>20*(1-t/(1e3/60))+60,i=t=>r(t/U*-2*(1e3/60))+5;for(let t=0;t<B.length;t++){const e=B[t],n=t+.5;let o=r(0);z.beginPath(),z.moveTo(n,o),z.lineTo(n,r(e.total)),z.strokeStyle=q[e.connected?"total":"network"],z.stroke(),z.beginPath(),z.moveTo(n,o),o=r(e.total);let s=0;for(const t of j)e.items[t]&&(s+=e.items[t],o=r(s),z.lineTo(n,o),z.strokeStyle=q[t],z.stroke(),z.beginPath(),z.moveTo(n,o));e.network&&(z.beginPath(),z.moveTo(n,i(0)),z.lineTo(n,i(e.network)),z.strokeStyle=q.network,z.stroke())}z.strokeStyle="rgba(255, 255, 255, 0.2)";for(let t=0;t<60;t+=1e3/60)z.moveTo(0,r(t)),z.lineTo(120,r(t)),z.stroke()}(t),H=V(t);for(const[t,n]of Object.entries(e))this[t](n)},begin(t){const e=performance.now();H.items[t]=(H.items[t]||0)-e;const n=J[J.length-1];return n&&(H.items[n]+=e),J.push(t),e},end(t){const e=performance.now();if(H.items[t]+=e,J.pop()!==t)throw Error("Unmatched stats calls for "+t);const n=J[J.length-1];return n&&(H.items[n]-=e),e},backlog(t){H.backlog=Math.max(t,H.backlog)},network(t){H.network=t},starvation(t){H.network=t},latency(t){H.latency=t},activity(t){H.activity=t},users(t){H.users=t},connected(t){H.connected=F=t}},G="ontouchstart"in document.documentElement,Z=18,K=2,Y=G?20:12,Q=2,X=G?0:15,tt=2,et=.3;!function(){const t=`\n        #croquet_dock { position: absolute; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 84px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all ${et}s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n\n        .croquet_dock_button { position: absolute; width: ${Y}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ${K+X+Y+Q}% }\n        #croquet_dock_right { right: ${K+X}%; }\n        #croquet_dock_pin { right: ${K}%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: ${tt}px; top: ${tt}px; right: ${tt}px; bottom: ${tt}px; background: white; }\n        #croquet_dock:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; border: 6px solid white; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader:before,\n        #croquet_loader:after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader:before,\n        #croquet_loader:after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader:before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader:after { left: 3.5em; }\n`,e=document.createElement("style");e.innerHTML=t,document.head.insertBefore(e,document.head.getElementsByTagName("style")[0])}(),function(){let t="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n";t+="\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n";const e=document.createElement("style");e.innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n",document.head.insertBefore(e,document.head.getElementsByTagName("style")[0])}();const nt=new Set;function rt(t,e={}){return t&&gt.showMessage(t,{...e,level:"error"})}function it(t,e={}){return t&&gt.showMessage(t,{...e,level:"warning"})}function ot(t,e={}){return t&&gt.showMessage(t,{...e,level:"status"})}function st(t,e){console.error(`Error during ${t}`,e);const n=(e.stack||"").split("\n").filter(t=>!t.match(/croquet-.*\.min.js/)).join("\n");gt.showMessage(`<b>Error during ${t}: ${e.message}</b>\n\n${n}`.replace(/\n/g,"<br>"),{level:"error",duration:1e4,stopOnFocus:!0})}const at={get pinned(){return"true"===localStorage["croquet-debug-ui-pinned"]},set pinned(t){localStorage["croquet-debug-ui-pinned"]=!!t},get activePage(){return localStorage["croquet-debug-ui-activePage"]},set activePage(t){localStorage["croquet-debug-ui-activePage"]=t}};function ct(t,e,n){const r=document.createElement("canvas"),i=r.width=40*Y/12,o=r.height=60,s=r.getContext("2d");s.font="36px Arial",s.textAlign="center",s.textBaseline="middle",s.fillStyle="black",s.fillText(t,i/2,.55*o);const a=document.createElement("button");a.id=e,a.className="croquet_dock_button";const c=t=>{t.preventDefault(),t.stopPropagation(),n()};return G?a.ontouchstart=c:a.onclick=c,a.appendChild(r),a}function lt(t,e){if(!1===gt.badge)return;const n=function(t){const e=new s(t),n=["bcdfghjklmnpqrstvwxyz","aeiou"];let r="";for(let t=0;t<5;t++)r+=n[t%2][e.quick()*n[t%2].length|0];return r}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+n;t.firstChild;)t.removeChild(t.firstChild);const r=document.createElement("canvas"),i=r.width=120,o=r.height=40;r.style.width="100%",t.appendChild(r);const a=r.getContext("2d"),c=function(t,e=1){const n=new s(t),r=[];for(let t=0;t<e;t++)r.push(`hsl(${360*n.quick()}, 50%, 70%)`);return r}(e,2);a.fillStyle=c[0],a.beginPath(),a.moveTo(0,0),a.lineTo(0,o),a.lineTo(i,0),a.closePath(),a.fill(),a.fillStyle=c[1],a.beginPath(),a.moveTo(i,o),a.lineTo(i,0),a.lineTo(0,o),a.closePath(),a.fill(),a.font="30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(n,i/2,o/2)}function ut(t,e,n={}){for(;t.firstChild;)t.removeChild(t.firstChild);return new P(t,{text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:P.CorrectLevel.L,...n})}let ht,dt,ft=0;function pt(t){if(dt!==t)if(!1===gt.sync&&(t=!1),t&&!ht&&(ht=function(){const t=document.createElement("div");t.id="croquet_spinnerOverlay";const e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}()),dt=t,t)clearTimeout(ft),ft=setTimeout(()=>{if(!dt)return;mt(gt.root,()=>document.body).appendChild(ht),ht.style.opacity=.9},500);else{if(!ht)return;clearTimeout(ft),ht.style.opacity=0,ft=setTimeout(()=>{dt||ht.parentElement&&ht.parentElement.removeChild(ht)},500)}}function mt(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){const e=document.getElementById(t);if(e)return e}return e?e():null}const gt={sessionURL:window.location.href,root:document.body,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(t={}){if(d.nodock)return;const e=document.getElementById("croquet_dock");e&&e.parentElement.removeChild(e);const n=mt(gt.root);if(!n)return;const r=document.createElement("div");r.id="croquet_dock",n.appendChild(r);const i=document.createElement("div");let o;i.id="croquet_dock_bar",r.appendChild(i),!1!==t.badge&&((o=document.createElement("div")).id="croquet_badge",i.appendChild(o),gt.badge=o);const s=document.createElement("div");s.id="croquet_dock_content",r.appendChild(s);const a=[];let c,l;!1!==t.qrcode&&gt.sessionURL&&((c=document.createElement("div")).id="croquet_qrcode",s.appendChild(c),a.push(c.id),gt.qrcode=c);if(!1!==t.stats&&((l=document.createElement("div")).id="croquet_stats",s.appendChild(l),a.push(l.id),gt.stats=l),a.length){function u(t){const e=a.length;let n,r=0;if(at.activePage){const t=a.indexOf(at.activePage);t>=0?(r=t,n=document.getElementById(at.activePage)):at.activePage=null}const i=a[(r+e+t)%e];let o;i===at.activePage?o=n:(n&&n.classList.remove("active"),o=document.getElementById(i)),o&&o.classList.add("active"),at.activePage=i}a.length>1&&(i.appendChild(ct("<","croquet_dock_left",()=>u(-1))),i.appendChild(ct(">","croquet_dock_right",()=>u(1)))),u(0)}if(!G){const t=ct("📌","croquet_dock_pin",()=>{at.pinned=!at.pinned,e()}),e=()=>{at.pinned?t.classList.add("pinned"):t.classList.remove("pinned")};e(),i.appendChild(t)}const h=t=>{r.style.width=`${t}px`,r.style.height=`${t*(1+Z/100)}px`;const e=t*Z/100;i.style.height=`${e}px`,s.style.top=`${e+tt}px`,o&&(o.style.height=`${.9*e}px`,o.style.width=`${.9*e*3}px`),c&&(c.style.border=`${8*t/200}px solid white`)};let f=200;const p=()=>{r.classList.add("active"),h(f),setTimeout(()=>r.style.transition="none",1e3*et)},m=()=>{r.style.transition="",r.classList.remove("active"),r.style.width=r.style.height="",i.style.height="",s.style.top="",o&&(o.style.height=o.style.width=""),c&&(c.style.border="")};if(G)m(),r.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),(()=>r.classList.contains("active"))()?m():p()};else{at.pinned?p():m();let t=0;r.onwheel=e=>{e.preventDefault(),e.stopPropagation();const n=Date.now();if(n-t<100)return;t=n;let{deltaY:i}=e;i=Math.sign(i)*Math.min(5,Math.abs(i));const o=.8*Math.min(window.innerWidth,window.innerHeight);f=Math.max(166,Math.min(o,r.offsetWidth*1.05**i)),h(f)},r.onmouseenter=p,r.onmouseleave=()=>{at.pinned||m()}}},makeSessionWidgets:function(t){!function(t){if(!t||!1===gt.root)return;const e=mt(gt.badge);e&&lt(e,t)}(t),function(){if(!1===gt.root||!1===gt.qrcode)return;if(d.noqr)return;const t=gt.sessionURL;if(!t)return void console.warn("App.sessionURL is not set");const e=mt(gt.qrcode);e&&(G||(e.onclick=e=>{e.preventDefault(),e.stopPropagation(),window.open(t)}),ut(e,t).getCanvas().style.width="100%")}(),function(){if(!1===gt.root)return;if(d.nostats)return;const t=mt(gt.stats);t&&L(t)}()},makeQRCanvas(t={}){if(!gt.sessionURL)return null;const e=ut(document.createElement("div"),gt.sessionURL,t);return e&&e.getCanvas()},clearSessionMoniker:function(){!1!==gt.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(t){!1===gt.root&&(t=!1),pt(t)},messageFunction:function(t,e={}){if("once"===e.only){if(nt.has(t))return null;nt.add(t)}const n=e.level;let r;return"error"===n?(r="red",console.error(t)):"warning"===n?(r="gold",console.warn(t)):r="#aaa",function(t,e){const n=gt.root;if(!1===n)return null;const r={text:t,duration:3e3,gravity:"bottom",position:"left",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)",stopOnFocus:!0,...e};let i;return n instanceof Element&&n!==document.body?(i=n.id)||(n.id=i="_croquetToastParent"):"string"==typeof n&&(i=n),i&&(r.selector=i),o(r).showToast()}(t,{backgroundColor:r,...e})},showMessage:(t,e={})=>d.nomessages||!1===gt.root||!1===gt.messages||!gt.messageFunction?null:gt.messageFunction(t,e)};class yt extends a{poll(){const t=super.poll();return this.array[this.size]=null,t}asArray(){const t=[];return this.forEach(e=>t.push(e)),t}asUnsortedArray(){return this.array.slice(0,this.size)}}const wt="#__vote";function vt(t,e){function n(t){for(const n of t)n.for===e&&t.delete(n)}return n(t.immediate),n(t.oncePerFrame),n(t.oncePerFrameWhileSynced),n(t.queued),t.immediate.size+t.queued.size+t.oncePerFrame.size+t.oncePerFrameWhileSynced.size}const bt=new class{constructor(){this.subscriptions={},this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.id=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)),this.lastId=0}register(t){return this.id+"/V"+ ++this.lastId}deregister(t){}addSubscription(t,e,n,r,i){if("vote"===i)return void this.addSubscription(t,e+wt,n,r,"immediate");const o=t+":"+e,s=r;s.for=n;let a=this.subscriptions[o];if(a||(a=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[i])throw Error(`Unknown subscribe() option: handling="${i}"`);a[i].add(s)}removeSubscription(t,e,n){const r=t+":"+e,i=this.subscriptions[r];i&&0===vt(i,n)&&delete this.subscriptions[r],e.endsWith(wt)||this.removeSubscription(t,e+wt,n)}removeAllSubscriptionsFor(t){const e=`${t}:`;for(const[n,r]of Object.entries(this.subscriptions))n.startsWith(e)?delete this.subscriptions[n]:0===vt(r,t)&&delete this.subscriptions[n]}handleEvent(t,e,n=(t=>t())){const r=this.subscriptions[t];r&&(r.queued.size>0&&this.queuedEvents.push({topic:t,data:e}),r.oncePerFrame.size>0&&this.perFrameEvents.set(t,e),r.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(t,e),r.immediate.size>0&&n(()=>{for(const t of r.immediate)t(e)}))}processFrameEvents(t){let e=0;const n=(t,n,r)=>{const i=this.subscriptions[t];if(i)for(const t of i[r])t(n),e++};for(const{topic:t,data:e}of this.queuedEvents)n(t,e,"queued");this.queuedEvents.length=0;for(const[t,e]of this.perFrameEvents)n(t,e,"oncePerFrame");if(this.perFrameEvents.clear(),t){for(const[t,e]of this.perSyncedFrameEvents)n(t,e,"oncePerFrameWhileSynced");this.perSyncedFrameEvents.clear()}for(const{topic:t,data:e}of this.queuedEvents)n(t,e,"queued");return this.queuedEvents.length=0,e}};let _t={get subscribe(){return(_t={subscribe:d.has("debug","subscribe",!1)}).subscribe}};class kt{constructor(t){this.island=t}register(t){return this.island.registerModel(t)}deregister(t){this.island.deregisterModel(t.id)}publish(t,e,n){this.island.publishFromModel(n,t,e)}subscribe(t,e,n,r){return _t.subscribe&&console.log(`Model.subscribe("${e}:${n}", ${t} ${(""+r).replace(/\(.*/s,"")})`),this.island.addSubscription(t,e,n,r)}unsubscribe(t,e,n,r="*"){_t.subscribe&&console.log(`Model.unsubscribe(${e}:${n}", ${t} ${(""+r).replace(/\(.*/s,"")})`),this.island.removeSubscription(t,e,n,r)}unsubscribeAll(t){_t.subscribe&&console.log(`Model.unsubscribeAll(${t} ${t.id})`),this.island.removeAllSubscriptionsFor(t)}future(t,e,n,r){if(xt&&xt.equal(this))return this.island.future(t,e,n,r);if(e)throw Error("tOffset not supported from cross-realm future send yet.");const i=this.island;return new Proxy(t,{get(e,n){if("function"==typeof t[n]){return new Proxy(t[n],{apply(e,r,o){i.callModelMethod(t.id,n,o)}})}throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}random(){return this.island.random()}now(){return this.island.time}equal(t){return t instanceof kt&&t.island===this.island}}class St{constructor(t){this.island=t}register(t){return bt.register(t)}deregister(t){bt.deregister(t)}publish(t,e,n){this.island.publishFromView(n,t,e)}subscribe(t,e,n,r,i="queued"){_t.subscribe&&console.log(`View.subscribe("${r}:${t}", ${e} ${n.name||(""+n).replace(/\(.*/s,"")} [${i}])`),bt.addSubscription(r,t,e,n,i)}unsubscribe(t,e,n,r){_t.subscribe&&console.log(`View.unsubscribe("${r}:${t}", ${e} ${n.name||(""+n).replace(/\(.*/s,"")})`),bt.removeSubscription(r,t,e,n)}unsubscribeAll(t){_t.subscribe&&console.log(`View.unsubscribeAll(${t})`),bt.removeAllSubscriptionsFor(t)}future(t,e){return e?new Proxy(t,{get(n,r){if("function"==typeof t[r]){return new Proxy(t[r],{apply(n,i,o){setTimeout(()=>{t.id&&t[r](...o)},e)}})}throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}}):t}random(){return Math.random()}now(){return this.island.time}externalNow(){return this.island.controller.time}isSynced(){return!!this.island.controller.synced}equal(t){return t instanceof St&&t.island===this.island}}let xt=null;function Ct(){if(!xt)throw Error("Tried to execute code that requires realm outside of realm.");return xt}function Et(t,e){if(null!==xt)throw Error("Can't switch realms from inside realm");try{return xt=new kt(t),e()}finally{xt=null}}function Mt(t,e,n=!1){if(null!==xt&&!n)throw Error("Can't switch realms from inside realm");const r=xt;try{return xt=new St(t),e()}finally{xt=r}}!function(){var t,e=function(t){return t!=t},n=Math.sqrt,r=.7853981633974483,i=function(t){var i,o,s,a,c;if(e(t))return NaN;if(t>0?s=t:(i=!0,s=-t),s>1)return NaN;if(s>.625)a=(o=1-s)*function(t){var e,n;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),n=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),n=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/n)}(o),o=n(o+o),c=r-o,c-=o=o*a-6.123233995736766e-17,c+=r;else{if(s<1e-8)return t;c=s*(c=(o=s*s)*function(t){var e,n;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,n=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),n=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/n)}(o))+s}return i?-c:c},o="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),s=Object.prototype.toString,a=Object.prototype.hasOwnProperty,c="function"==typeof Symbol?Symbol.toStringTag:"",l={};t=o&&"symbol"==typeof Symbol.toStringTag?function(t){var e,n,r;if(null==t)return s.call(t);n=t[c],e=function(t,e){return null!=t&&a.call(t,e)}(t,c);try{t[c]=void 0}catch(e){return s.call(t)}return r=s.call(t),e?t[c]=n:delete t[c],r}:function(t){return s.call(t)},l=t;var u="function"==typeof Uint32Array,h="function"==typeof Uint32Array?Uint32Array:null,d="function"==typeof Uint32Array?Uint32Array:null,f={};f=function(){var t,e;if("function"!=typeof h)return!1;try{t=function(t){return u&&t instanceof Uint32Array||"[object Uint32Array]"===l(t)}(e=new h(e=[1,3.14,-3.14,4294967296,4294967297]))&&1===e[0]&&3===e[1]&&4294967293===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?d:function(){throw new Error("not implemented")};var p="function"==typeof Float64Array,m="function"==typeof Float64Array?Float64Array:null,g="function"==typeof Float64Array?Float64Array:null,y={};y=function(){var t,e;if("function"!=typeof m)return!1;try{t=function(t){return p&&t instanceof Float64Array||"[object Float64Array]"===l(t)}(e=new m([1,3.14,-3.14,NaN]))&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t}()?g:function(){throw new Error("not implemented")};var w,v="function"==typeof Uint8Array,b="function"==typeof Uint8Array?Uint8Array:null,_="function"==typeof Uint8Array?Uint8Array:null;w=function(){var t,e;if("function"!=typeof b)return!1;try{t=function(t){return v&&t instanceof Uint8Array||"[object Uint8Array]"===l(t)}(e=new b(e=[1,3.14,-3.14,256,257]))&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?_:function(){throw new Error("not implemented")};var k,S="function"==typeof Uint16Array,x="function"==typeof Uint16Array?Uint16Array:null,C="function"==typeof Uint16Array?Uint16Array:null,E={uint16:function(){var t,e;if("function"!=typeof x)return!1;try{t=function(t){return S&&t instanceof Uint16Array||"[object Uint16Array]"===l(t)}(e=new x(e=[1,3.14,-3.14,65536,65537]))&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?C:function(){throw new Error("not implemented")},uint8:w};(k=new E.uint16(1))[0]=4660;var M,O=52===new E.uint8(k.buffer)[0];M=!0===O?1:0;var T,$=new y(1),A=new f($.buffer),P=function(t){return $[0]=t,A[M]};T=!0===O?1:0;var N,j,q,R=new y(1),I=new f(R.buffer),D=function(t,e){return R[0]=t,I[T]=e>>>0,R[0]},z=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,B=.6931471803691238,U=1.9082149292705877e-10,F=function(t){var n,r,i,o,s,a,c,l,u,h;if(t<-1||e(t))return NaN;if(-1===t)return L;if(t===z)return t;if(0===t)return t;if(h=1,(i=t<0?-t:t)<.41421356237309503){if(i<1.862645149230957e-9)return i<5.551115123125783e-17?t:t-t*t*.5;t>-.2928932188134525&&(h=0,o=t,r=1)}return 0!==h&&(i<9007199254740992?(s=(h=((r=P(u=1+t))>>20)-1023)>0?1-(u-t):t-(u-1),s/=u):(h=((r=P(u=t))>>20)-1023,s=0),(r&=1048575)<434334?u=D(u,1072693248|r):(h+=1,u=D(u,1071644672|r),r=1048576-r>>2),o=u-1),n=.5*o*o,0===r?0===o?h*B+(s+=h*U):h*B-((l=n*(1-.6666666666666666*o))-(h*U+s)-o):(l=(c=(a=o/(2+o))*a)*(0===c?.6666666666666735:.6666666666666735+c*(.3999999999940942+c*(.2857142874366239+c*(.22222198432149784+c*(.1818357216161805+c*(.15313837699209373+.14798198605116586*c)))))),0===h?o-(n-a*(n+l)):h*B-(n-(a*(n+l)+(h*U+s))-o))},H=.6931471805599453,V=1.9082149292705877e-10,J=function(t){var n,r,i,o,s,a,c,l,u,h;return 0===t?L:e(t)||t<0?NaN:(o=0,(r=P(t))<1048576&&(o-=54,r=P(t*=0x40000000000000)),r>=2146435072?t+t:(o+=(r>>20)-1023|0,o+=(c=614244+(r&=1048575)&1048576|0)>>20|0,a=(t=D(t,r|1072693248^c))-1,(1048575&2+r)<3?0===a?0===o?0:.6931471803691238*o+o*V:(s=a*a*(.5-.3333333333333333*a),0===o?a-s:.6931471803691238*o-(s-o*V-a)):(c=r-398458|0,i=(u=(h=(l=a/(2+a))*l)*h)*(0===u?.3999999999940942:.3999999999940942+u*(.22222198432149784+.15313837699209373*u)),s=h*(0===u?.6666666666666735:.6666666666666735+u*(.2857142874366239+u*(.1818357216161805+.14798198605116586*u)))+i,(c|=440401-r|0)>0?(n=.5*a*a,0===o?a-(n-l*(n+s)):.6931471803691238*o-(n-(l*(n+s)+o*V)-a)):0===o?a-l*(a-s):.6931471803691238*o-(l*(a-s)-o*V-a))))},W=function(t){return t===z||t===L},G=1.5707963267948966,Z=function(t){var n,i,o,s;return e(t)||0===t?t:t===z?G:t===L?-G:(t<0&&(i=!0,t=-t),n=0,t>2.414213562373095?(o=G,n=1,t=-1/t):t<=.66?o=0:(o=r,n=2,t=(t-1)/(t+1)),s=t*(s=(s=t*t)*(0===s?-64.85021904942025:s*(s*(s*(-.8750608600031904*s-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025)/(0===s?194.5506571482614:194.5506571482614+s*(485.3903996359137+s*(432.88106049129027+s*(165.02700983169885+s*(24.858464901423062+1*s))))))+t,2===n?s+=3.061616997868383e-17:1===n&&(s+=6.123233995736766e-17),o+=s,i?-o:o)};!0===O?(j=1,q=0):(j=0,q=1),N={HIGH:j,LOW:q};var K,Y,Q,X=new y(1),tt=new f(X.buffer),et=N.HIGH,nt=N.LOW,rt=function(t,e){return X[0]=e,t[0]=tt[et],t[1]=tt[nt],t},it=function(t,e){return 1===arguments.length?rt([0,0],t):rt(t,e)};!0===O?(Y=1,Q=0):(Y=0,Q=1),K={HIGH:Y,LOW:Q};var ot,st=new y(1),at=new f(st.buffer),ct=K.HIGH,lt=K.LOW,ut=function(t,e){return at[ct]=t,at[lt]=e,st[0]},ht=[0,0],dt=function(t,e){var n,r;return it(ht,t),n=ht[0],n&=2147483647,r=P(e),ut(n|=r&=2147483648,ht[1])},ft=3.141592653589793,pt=function(t,e){var n,r,i,o;return i=(o=t*t)*o,r=o*(0===o?.0416666666666666:.0416666666666666+o*(2480158728947673e-20*o-.001388888888887411)),r+=i*i*(0===o?-2.7557314351390663e-7:o*(2.087572321298175e-9+-1.1359647557788195e-11*o)-2.7557314351390663e-7),(i=1-(n=.5*o))+(1-i-n+(o*r-t*e))},mt=-.16666666666666632,gt=function(t,e){var n,r,i;return n=.00833333333332249+(i=t*t)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),r=i*t,0===e?t+r*(mt+i*n):t-(i*(.5*e-r*n)-e-r*mt)};ot=!0===O?0:1;var yt=new y(1),wt=new f(yt.buffer),vt=Math.floor,bt=function(t){return t<0?-t:0===t?0:t},_t=function(t,n){return e(n)||W(n)?(t[0]=n,t[1]=0,t):0!==n&&bt(n)<2.2250738585072014e-308?(t[0]=4503599627370496*n,t[1]=-52,t):(t[0]=n,t[1]=0,t)},kt=[0,0],St=[0,0],xt=function(t,n){var r,i;return 0===t||e(t)||W(t)?t:(function(t,e){1===arguments.length?_t([0,0],t):_t(t,e)}(kt,t),n+=kt[1],(n+=function(t){var e=P(t);return(e=(2146435072&e)>>>20)-1023|0}(t=kt[0]))<-1074?dt(0,t):n>1023?t<0?L:z:(n<=-1023?(n+=52,i=2.220446049250313e-16):i=1,it(St,t),r=St[0],r&=2148532223,i*ut(r|=n+1023<<20,St[1])))},Ct=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Et=[1.570796251296997,7.549789415861596e-8,5.390302529957765e-15,3.282003415807913e-22,1.270655753080676e-29,1.2293330898111133e-36,2.7337005381646456e-44,2.1674168387780482e-51],Mt=5.960464477539063e-8,Ot=Pt(new Array(20)),Tt=Pt(new Array(20)),$t=Pt(new Array(20)),At=Pt(new Array(20));function Pt(t){var e,n=t.length;for(e=0;e<n;e++)t[e]=0;return t}var Nt,jt=Math.round,qt=function(t,e,n){var r,i,o,s,a;return o=t-1.5707963267341256*(r=jt(.6366197723675814*t)),s=6.077100506506192e-11*r,a=e>>20|0,n[0]=o-s,a-(P(n[0])>>20&2047)>16&&(s=2.0222662487959506e-21*r-((i=o)-(o=i-(s=6.077100506303966e-11*r))-s),n[0]=o-s,a-(P(n[0])>>20&2047)>49&&(s=8.4784276603689e-32*r-((i=o)-(o=i-(s=2.0222662487111665e-21*r))-s),n[0]=o-s)),n[1]=o-n[0]-s,r},Rt=1.5707963267341256,It=6.077100506506192e-11,Dt=2*It,zt=4*It,Lt=new Array(3),Bt=new Array(2),Ut=function(t,e){var n,r,i,o,s,a,c;if((i=2147483647&P(t)|0)<=1072243195)return e[0]=t,e[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?qt(t,i,e):i<=1073928572?t>0?(c=t-Rt,e[0]=c-It,e[1]=c-e[0]-It,1):(c=t+Rt,e[0]=c+It,e[1]=c-e[0]+It,-1):t>0?(c=t-2*Rt,e[0]=c-Dt,e[1]=c-e[0]-Dt,2):(c=t+2*Rt,e[0]=c+Dt,e[1]=c-e[0]+Dt,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?qt(t,i,e):t>0?(c=t-3*Rt,e[0]=c-1.8231301519518578e-10,e[1]=c-e[0]-1.8231301519518578e-10,3):(c=t+3*Rt,e[0]=c+1.8231301519518578e-10,e[1]=c-e[0]+1.8231301519518578e-10,-3):1075388923===i?qt(t,i,e):t>0?(c=t-4*Rt,e[0]=c-zt,e[1]=c-e[0]-zt,4):(c=t+4*Rt,e[0]=c+zt,e[1]=c-e[0]+zt,-4);if(i<1094263291)return qt(t,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(n=function(t){return yt[0]=t,wt[ot]}(t),c=ut(i-((r=(i>>20)-1046)<<20|0),n),s=0;s<2;s++)Lt[s]=0|c,c=16777216*(c-Lt[s]);for(Lt[2]=c,o=3;0===Lt[o-1];)o-=1;return a=function(t,e,n,r){var i,o,s,a,c,l,u;for((o=(n-3)/24|0)<0&&(o=0),a=n-24*(o+1),l=o-(s=r-1),u=s+4,c=0;c<=u;c++)Ot[c]=l<0?0:Ct[l],l+=1;for(c=0;c<=4;c++){for(i=0,l=0;l<=s;l++)i+=t[l]*Ot[s+(c-l)];Tt[c]=i}return function t(e,n,r,i,o,s,a,c,l){var u,h,d,f,p,m,g,y,w;for(f=s,w=i[r],y=r,p=0;y>0;p++)h=Mt*w|0,At[p]=w-16777216*h|0,w=i[y-1]+h,y-=1;if(w=xt(w,o),w-=8*vt(.125*w),w-=g=0|w,d=0,o>0?(g+=p=At[r-1]>>24-o,At[r-1]-=p<<24-o,d=At[r-1]>>23-o):0===o?d=At[r-1]>>23:w>=.5&&(d=2),d>0){for(g+=1,u=0,p=0;p<r;p++)y=At[p],0===u?0!==y&&(u=1,At[p]=16777216-y):At[p]=16777215-y;if(o>0)switch(o){case 1:At[r-1]&=8388607;break;case 2:At[r-1]&=4194303}2===d&&(w=1-w,0!==u&&(w-=xt(1,o)))}if(0===w){for(y=0,p=r-1;p>=s;p--)y|=At[p];if(0===y){for(m=1;0===At[s-m];m++);for(p=r+1;p<=r+m;p++){for(l[c+p]=Ct[a+p],h=0,y=0;y<=c;y++)h+=e[y]*l[c+(p-y)];i[p]=h}return t(e,n,r+=m,i,o,s,a,c,l)}}if(0===w)for(r-=1,o-=24;0===At[r];)r-=1,o-=24;else(w=xt(w,-o))>=16777216?(h=Mt*w|0,At[r]=w-16777216*h|0,o+=24,At[r+=1]=h):At[r]=0|w;for(h=xt(1,o),p=r;p>=0;p--)i[p]=h*At[p],h*=Mt;for(p=r;p>=0;p--){for(h=0,m=0;m<=f&&m<=r-p;m++)h+=Et[m]*i[p+m];$t[r-p]=h}for(h=0,p=r;p>=0;p--)h+=$t[p];for(n[0]=0===d?h:-h,h=$t[0]-h,p=1;p<=r;p++)h+=$t[p];return n[1]=0===d?h:-h,7&g}(t,e,4,Tt,a,4,o,s,Ot)}(Lt,Bt,r,o),t<0?(e[0]=-Bt[0],e[1]=-Bt[1],-a):(e[0]=Bt[0],e[1]=Bt[1],a)},Ft=[0,0],Ht=Math.ceil,Vt=function(t){var n;return e(t)||t===z?t:t===L?0:t>709.782712893384?z:t<-745.1332191019411?0:t>-1/(1<<28)&&t<1/(1<<28)?1+t:function(t,e,n){var r,i,o,s;return o=(r=t-e)-(i=r*r)*(0===(s=i)?.16666666666666602:.16666666666666602+s*(s*(6613756321437934e-20+s*(4.1381367970572385e-8*s-16533902205465252e-22))-.0027777777777015593)),xt(1-(e-r*o/(2-o)-t),n)}(t-.6931471803691238*(n=function(t){return t<0?Ht(t):vt(t)}(t<0?1.4426950408889634*t-.5:1.4426950408889634*t+.5)),1.9082149292705877e-10*n,n)};Nt=!0===O?0:1;var Jt=new y(1),Wt=new f(Jt.buffer),Gt=function(t,e){return Jt[0]=t,Wt[Nt]=e>>>0,Jt[0]},Zt=[0,0],Kt=[0,0],Yt=function(t,e,n){var r,i,o,s,a,c,l,u,h;return(i=2147483647&(r=P(t))|0)>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(u=3.061616997868383e-17-e),e=0),s=e+(h=t*t)*((a=h*t)*((s=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))}(u=h*h))+(l=h*(0===u?.05396825397622605:.05396825397622605+u*(.0088632398235993+u*(.0014562094543252903+u*(.0002464631348184699+u*(7140724913826082e-20+2590730518636337e-20*u)))))))+e),u=t+(s+=.3333333333333341*a),i>=1072010280?(1-(r>>30&2))*((l=n)-2*(t-(u*u/(u+l)-s))):1===n?u:(Gt(h=u,0),l=s-(h-t),Gt(c=o=-1/u,0),c+o*((a=1+c*h)+c*l))},Qt=[0,0];void 0===window.CroquetMath&&(window.CroquetMath={}),window.CroquetMath.acos=function(t){var o;return e(t)?NaN:t<-1||t>1?NaN:t>.5?2*i(n(.5-.5*t)):(o=r-i(t),o+=6.123233995736766e-17,o+=r)},window.CroquetMath.acosh=function(t){var r;return e(t)?NaN:t<1?NaN:1===t?0:t>=1<<28?J(t)+H:t>2?J(2*t-1/(t+n(t*t-1))):F((r=t-1)+n(2*r+r*r))},window.CroquetMath.asin=i,window.CroquetMath.asinh=function(t){var r,i,o;return e(t)||W(t)?t:(t<0&&(t=-t,r=!0),o=t<1/(1<<28)?t:t>1<<28?J(t)+H:t>2?J(2*t+1/(n(t*t+1)+t)):F(t+(i=t*t)/(1+n(1+i))),r?-o:o)},window.CroquetMath.atan=Z,window.CroquetMath.atanh=function(t){var n,r;return e(t)?NaN:t<-1||t>1?NaN:1===t?z:-1===t?L:(t<0&&(n=!0,t=-t),t<1/(1<<28)?n?-t:t:(r=t<.5?.5*F((r=t+t)+r*t/(1-t)):.5*F((t+t)/(1-t)),n?-r:r))},window.CroquetMath.atan2=function(t,n){var r;return e(n)||e(t)?NaN:W(n)?n===z?W(t)?dt(ft/4,t):dt(0,t):W(t)?dt(3*ft/4,t):dt(ft,t):W(t)?dt(ft/2,t):0===t?n>=0&&!function(t){return!!(P(t)>>>31)}(n)?dt(0,t):dt(ft,t):0===n?dt(ft/2,t):(r=Z(t/n),n<0?r<=0?r+ft:r-ft:r)},window.CroquetMath.cbrt=function(t){var n,r,i,o,s;return e(t)||W(t)||0===t?t:(r=-2147483648&(i=P(t)),i&=2147483647,s=0,t<2.2250738585072014e-308?(s=0x40000000000000,n=P(s*=t),s=ut(r|(n=(2147483647&n)/3+696219795),0)):s=D(s,r|(n=i/3+715094163)),s*=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)}(o=s*s*(s/t)),n=P(s),s=ut(n+1,0),s+=s*(o=((o=t/(s*s))-s)/(s+s+o)))},window.CroquetMath.cos=function(t){var e;if(e=P(t),(e&=2147483647)<=1072243195)return e<1044381696?1:pt(t,0);if(e>=2146435072)return NaN;switch(3&Ut(t,Ft)){case 0:return pt(Ft[0],Ft[1]);case 1:return-gt(Ft[0],Ft[1]);case 2:return-pt(Ft[0],Ft[1]);default:return gt(Ft[0],Ft[1])}},window.CroquetMath.cosh=function(t){return e(t)?t:(t<0&&(t=-t),t>21?Vt(t)/2:(Vt(t)+Vt(-t))/2)},window.CroquetMath.exp=Vt,window.CroquetMath.expm1=function(t){var n,r,i,o,s,a,c,l,u,h,d,f;if(t===z||e(t))return t;if(t===L)return-1;if(0===t)return t;if(t<0?(r=!0,c=-t):(r=!1,c=t),c>=38.816242111356935){if(r)return-1;if(c>=709.782712893384)return z}if(s=0|P(c),c>.34657359027997264)c<1.0397207708399179?r?(i=t+.6931471803691238,o=-1.9082149292705877e-10,f=-1):(i=t-.6931471803691238,o=1.9082149292705877e-10,f=1):(f=r?1.4426950408889634*t-.5:1.4426950408889634*t+.5,i=t-.6931471803691238*(h=f|=0),o=1.9082149292705877e-10*h),u=i-(t=i-o)-o;else{if(s<1016070144)return t;f=0}return d=(l=t*(n=.5*t))*(((a=1+l*(0===l?-.03333333333333313:l*(.0015873015872548146+l*(l*(4008217827329362e-21+-2.0109921818362437e-7*l)-793650757867488e-19))-.03333333333333313))-(h=3-a*n))/(6-t*h)),0===f?t-(t*d-l):(d=t*(d-u)-u,d-=l,-1===f?.5*(t-d)-.5:1===f?t<-.25?-2*(d-(t+.5)):1+2*(t-d):f<=-2||f>56?(i=P(c=1-(d-t))+(f<<20)|0,(c=D(c,i))-1):(h=1,f<20?c=(h=D(h,i=1072693248-(2097152>>f)|0))-(d-t):(c=t-(d+(h=D(h,i=1023-f<<20|0))),c+=1),i=P(c)+(f<<20)|0,D(c,i)))},window.CroquetMath.log=J,window.CroquetMath.log1p=F,window.CroquetMath.log10=function(t){var n,r,i,o,s,a,c;return e(t)||t<0?NaN:0===t?L:(s=0,(r=P(t))<1048576&&(s-=54,r=P(t*=0x40000000000000)),r>=2146435072?t+t:(s+=(r>>20)-1023|0,t=D(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),a=s+=o>>20|0,i=function(t){var e,n,r,i,o,s,a,c,l;return i=t-1,(1048575&2+(r=P(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(l=(r&=1048575)-398458|0,n=(c=(s=(o=i/(2+i))*o)*s)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),a=s*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(l|=440401-r|0)>0?o*((e=.5*i*i)+a)-e:o*(a-i))}(t),n=Gt(t-=1,0),c=3.694239077158931e-13*a+2.5082946711645275e-11*(t+i),(c+=.4342944818781689*(t-n+i)+.4342944818781689*n)+.30102999566361177*a))},window.CroquetMath.log2=function(t){var n,r,i,o,s;if(e(t)||t<0)return NaN;if(it(Zt,t),s=0,(r=Zt[0])<1048576){if(0==(2147483647&r|Zt[1]))return L;s-=54,r=P(t*=0x40000000000000)}return r>=2146435072?t+t:(s+=(r>>20)-1023|0,t=D(t,(r&=1048575)|1072693248^(o=r+614244&1048576|0)),s+=o>>20|0,i=function(t){var e,n,r,i,o,s,a,c,l;return i=t-1,(1048575&2+(r=P(t)))<3?0===i?0:i*i*(.3333333333333333*i-.5):(l=(r&=1048575)-398458|0,n=(c=(s=(o=i/(2+i))*o)*s)*(0===c?.3999999999940942:.3999999999940942+c*(.22222198432149784+.15313837699209373*c)),a=s*(0===c?.6666666666666735:.6666666666666735+c*(.2857142874366239+c*(.1818357216161805+.14798198605116586*c)))+n,(l|=440401-r|0)>0?o*((e=.5*i*i)+a)-e:o*(a-i))}(t),n=Gt(t-=1,0),1.6751713164886512e-10*(t+i)+1.4426950407214463*(t-n+i)+1.4426950407214463*n+s)},window.CroquetMath.sin=function(t){var e;if(e=P(t),(e&=2147483647)<=1072243195)return e<1045430272?t:gt(t,0);if(e>=2146435072)return NaN;switch(3&Ut(t,Kt)){case 0:return gt(Kt[0],Kt[1]);case 1:return pt(Kt[0],Kt[1]);case 2:return-gt(Kt[0],Kt[1]);default:return-pt(Kt[0],Kt[1])}},window.CroquetMath.sinh=function(t){var e;return 0===t?t:(e=bt(t),t>710.4758600739439||t<-709.089565712824?t>0?z:L:e>1?e>=709.0895657128241?(e=Vt(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=Vt(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*function(t){var e,n;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,n=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,n=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/n)}(e))},window.CroquetMath.tan=function(t){var e,n;return e=P(t),(e&=2147483647)<=1072243195?e<1044381696?t:Yt(t,0,1):e>=2146435072?NaN:(n=Ut(t,Qt),Yt(Qt[0],Qt[1],1-((1&n)<<1)))},window.CroquetMath.tanh=function(t){var e,n;if((n=bt(t))>44.014845965556525)return t<0?-1:1;if(n>=.625)n=1-2/((e=Vt(2*n))+1),t<0&&(n=-n);else{if(0===t)return t;n=t+t*(e=t*t)*function(t){var e,n;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,n=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),n=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/n)}(e)}return n};const Xt=Math.pow;function te(t){return t===1/0||t===-1/0}window.CroquetMath.pow=(t,e)=>{if(isNaN(t)||isNaN(e))return NaN;if(te(t)||te(e))return Xt(t,e);if(0===t||0===e)return Xt(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;let n=1;return t<0&&(t*=-1,n=Xt(-1,e)),window.CroquetMath.exp(window.CroquetMath.log(t)*e)*n}}();let Ot=null;const Tt={};function $t(t,e){const{qPara:n,qArgs:r,qFn:i}=JSON.parse(atob(t.slice(1,-1))),o=JSON.stringify(n),s=Tt[o]||(Tt[o]=new Function(...n));return"number"==typeof i&&(r[i]=s),s.call(e,...r).bind(e)}function At(t,e){if(Ot)throw Error("Island confusion");if(!(t instanceof qt))throw Error("not an island: "+t);const n=Ot;try{Ot=t,window.ISLAND=t,e()}finally{Ot=n}}const Pt="#__vote",Nt="#reflected",jt="#divergence";class qt{static current(){return Ot||console.warn("No CurrentIsland!"),Ot}static hasCurrent(){return!!Ot}static installCustomMath(){if(!window.BrowserMath){window.CroquetMath.random=()=>Ot.random(),window.BrowserMath={};for(const[t,e]of Object.entries(window.CroquetMath)){const n=window.Math[t];window.BrowserMath[t]=n,window.Math[t]=["pow","atan2"].includes(t)?(t,r)=>Ot?e(t,r):n(t,r):t=>Ot?e(t):n(t)}}}constructor(t,e){qt.installCustomMath(),At(this,()=>{Et(this,()=>{if(this.modelsById={},this.modelsByName={},this.messages=new yt((t,e)=>t.before(e)),this.subscriptions={},this.users={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=t.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.tuttiSeq=0,this.lastSnapshotPoll=0,this.modelsId=0,t.modelsById){const e=Ut.newOrRecycled(this).readIsland(t,"$");for(const t of Object.keys(e))if(t in this||"meta"===t)if("messages"===t)for(const t of e.messages)this.messages.add(t);else this[t]=e[t];else console.warn(`Ignoring property snapshot.${t}`)}else{this._random=new s(null,{state:!0});const t=e(this)||{};Object.assign(this.modelsByName,t),this.addSubscription(this,this.id,"__users__",this.generateJoinExit)}})})}registerModel(t,e){if(Ot!==this)throw Error("Island Error");return e||(e=this.id+"/M"+ ++this.modelsId),this.modelsById[e]=t,e}deregisterModel(t){if(Ot!==this)throw Error("Island Error");const e=this.modelsById;delete this.modelsById[t];for(const[t,n]of Object.entries(this.modelsByName))e===n&&delete this.modelsByName[t];this.messages.removeMany(e=>e.hasReceiver(t))}lookUpModel(t){if(t===this.id)return this;const e=this.modelsById[t];if(e)return e;const[n,r,i]=t.match(/^([^#]+)#(.*)$/);return this.modelsById[r].lookUp(i)}get(t){return this.modelsByName[t]}set(t,e){if(Ot!==this)throw Error("Island Error");this.modelsByName[t]=e}getNextTuttiSeq(){return this.tuttiSeq=this.tuttiSeq+1>>>0,this.tuttiSeq}callModelMethod(t,e,n){if(Ot)throw Error("Island Error");const r=this.lookUpModel(t);if(!r)return void console.error(Error(`Model not found: ${t}`));const i=new Dt(this.time,0,r.id,e,n);this.controller.sendMessage(i)}noop(){}generateJoinExit({entered:t,exited:e,count:n}){e=t.length===n?Object.keys(this.users):e.map(t=>t[0]);for(const t of e)this.users[t]&&(delete this.users[t],this.publishFromModel(this.id,"view-exit",t));for(const[e,n,r]of t)this.users[e]||(this.users[e]={name:n},r&&(this.users[e].location=r),this.publishFromModel(this.id,"view-join",e))}scheduleExternalMessage(t){const e=Dt.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);const n=this.externalSeq+1>>>0;if(e.seq!==n)throw Error(`External message error. Expected message #${n} got #${e.seq}`);return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.messages.add(e),e}futureSend(t,e,n,r){if(t.every)return this.futureRepeat(t.every,e,n,r);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const i=new Dt(this.time+t,2*this.futureSeq,e,n,r);return this.messages.add(i),i}futureRepeat(t,e,n,r){this.futureSend(t,this.id,"futureExecAndRepeat",[t,e,n,r])}futureExecAndRepeat(t,e,n,r){const i=this.lookUpModel(e);if("function"==typeof i[n])try{i[n](...r)}catch(t){st(`future message ${i}.${n}`,t)}else{const t=$t(n,i);try{t(...r)}catch(e){st(`future message ${i} ${t}`,e)}}this.futureRepeat(t,e,n,r)}future(t,e,n,r){const i=this.asQFunc(t,n);if("string"==typeof i)return this.futureSend(e,t.id,i,r);const o=this;return new Proxy(t,{get(n,r){if("function"==typeof t[r])return(...n)=>{if(o.lookUpModel(t.id)!==t)throw Error("future send to unregistered model");return o.futureSend(e,t.id,r,n)};throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}advanceTo(t,e){if(Ot)throw Error("Island Error");let n,r=0;for(;(n=this.messages.peek())&&n.time<=t;){const{time:t,seq:i}=n;if(t<this.time)throw Error("past message encountered: "+n);if(1&i&&(this.seq=this.seq+1>>>0,i/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${i/2>>>0} in ${n}`);if(this.messages.poll(),this.time=n.time,n.executeOn(this),++r>100&&(r=0,Date.now()>e))return!1}return this.time=t,!0}asQFunc(t,e){if("string"==typeof e)return e;if("function"==typeof e){if(t[e.name]===e)return e.name;let n=t;for(;null!==n;){for(const[t,r]of Object.entries(Object.getOwnPropertyDescriptors(n)))if(r.value===e)return t;n=Object.getPrototypeOf(n)}const r=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,i=e.toString().match(r);return!i||i[3]&&i[3]!==i[1]?function(t,e){"function"==typeof t&&(e=t,t={});const n=Object.keys(t).concat(["return "+e]),r=Object.values(t),i={qPara:n,qArgs:r},o=r.indexOf(e);return o>=0&&(r[o]=n[o],i.qFn=o),`{${btoa(JSON.stringify(i))}}`}(e):i[2]}return null}addSubscription(t,e,n,r){if(Ot!==this)throw Error("Island Error");const i=this.asQFunc(t,r);if("string"!=typeof i)throw Error(`Subscription handler for "${n}" must be a method name`);if("function"!=typeof t[i]&&"{"!==i[0])throw Error(`Subscriber method for "${n}" not found: ${t}.${i}()`);const o=e+":"+n,s=t.id+"."+i;if(this.subscriptions[o]){if(-1!==this.subscriptions[o].indexOf(s))throw Error(`${t}.${i} already subscribed to ${n}`)}else this.subscriptions[o]=[];this.subscriptions[o].push(s)}removeSubscription(t,e,n,r){if(Ot!==this)throw Error("Island Error");const i=e+":"+n,o=t.id+"."+r,s=this.subscriptions[i];if(s){const t=s.indexOf(o);s.splice(t,1),0===s.length&&delete this.subscriptions[i]}}removeAllSubscriptionsFor(t){const e=`${t.id}:`,n=`${t.id}.`;for(const[t,r]of Object.entries(this.subscriptions))if(t.startsWith(e))delete this.subscriptions[t];else{for(let t=r.length-1;t>=0;t--)r[t].startsWith(n)&&r.splice(t,1);0===r.size&&delete this.subscriptions[t]}}publishFromModel(t,e,n){if(Ot!==this)throw Error("Island Error");const r=e.endsWith(Nt);r&&(e=e.slice(0,e.length-Nt.length));const i=t+":"+e;this.handleModelEventInModel(i,n,r),this.handleModelEventInView(i,n)}publishFromView(t,e,n){if(Ot)throw Error("Island Error");const r=t+":"+e;this.handleViewEventInModel(r,n),this.handleViewEventInView(r,n)}handleModelEventInModel(t,e,n=!1){if(Ot!==this)throw Error("Island Error");if(n){const n=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;const r=t+Pt,i=t+jt,o=!!bt.subscriptions[r],s=!!this.subscriptions[t],a=!!this.subscriptions[i];o&&a&&console.log(`divergence subscription for ${t} overridden by vote subscription`);const c=s?new Dt(this.time,0,this.id,"handleModelEventInModel",[t,e]):null;let l;l=o?[this.id,"handleModelEventInView",r]:[this.id,"handleTuttiDivergence",i],this.controller.sendTutti(this.time,n,e,c,o,l)}else if(this.subscriptions[t])for(const n of this.subscriptions[t]){const[r,...i]=n.split("."),o=i.join("."),s=this.lookUpModel(r);if(s){if("{"===o[0]){const n=$t(o,s);try{n(e)}catch(e){st(`event ${t} ${s} ${n}`,e)}continue}"function"!=typeof s[o]&&it(`event ${t} ${s}.${o}(): method not found`)}else it(`event ${t} .${o}(): subscriber not found`);try{s[o](e)}catch(e){st(`event ${t} ${s}.${o}()`,e)}}}handleViewEventInModel(t,e){if(this.subscriptions[t]){const n=new Dt(this.time,0,this.id,"handleModelEventInModel",[t,e]);this.controller.sendMessage(n)}}handleModelEventInView(t,e){bt.handleEvent(t,e,t=>(function(t){if(!Ot)throw Error("Island confusion");const e=Ot;try{Ot=null,t()}finally{Ot=e}})(()=>Mt(this,t,!0)))}handleViewEventInView(t,e){bt.handleEvent(t,e)}handleTuttiDivergence(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{const n=t.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${n}:`,e)}}processModelViewEvents(){if(Ot)throw Error("Island Error");return Mt(this,()=>bt.processFrameEvents(!!this.controller.synced))}pollToCheckSync(){const t=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;const e=Date.now(),n={date_island:this.time,hash:this.getSummaryHash()},r=Date.now()-e;this.controller.cpuTime-=r;const i=[this.id,"handleSyncCheckVote","syncCheckVote"];this.controller.sendTutti(this.time,t,n,null,!0,i)}handleSyncCheckVote(t,e){this.controller.handleSyncCheckVote(e)}pollForSnapshot(){const t=this.getNextTuttiSeq(),e=this.time,n=e-this.lastSnapshotPoll;if(n<5e3)return void console.log(`rejecting snapshot poll ${n}ms after previous`);this.lastSnapshotPoll=e;const r=this.controller.preparePollForSnapshot();if(!r)return;const i=Date.now();r.hash=this.getSummaryHash();const o=Date.now()-i;this.controller.cpuTime-=o,Promise.resolve().then(()=>this.controller.pollForSnapshot(e,t,r))}handleSnapshotVote(t,e){this.controller.handleSnapshotVote(e)}snapshot(){return Bt.newOrRecycled(this).snapshot(this,"$")}getSummaryHash(){return(new Lt).getHash(this)}random(){if(Ot!==this)throw Error("Island Error");return this._random()}randomID(){if(Ot!==this)throw Error("Island Error");let t="";for(let e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}}function Rt(t,e){const[n,r,i]=t.match(/^([^[]+)(\[.*)?$/i),[o,s]=r.split(">");let a=[];if(i){a=Ht.newOrRecycled(e).decode(JSON.parse(i))}return{receiver:o,selector:s,args:a}}function It(t,e){return(e-t|0)>=0}class Dt{constructor(t,e,n,r,i){this.time=t,this.seq=e,this.payload=function(t,e,n){n.length>0&&(n=Ft.newOrRecycled().encode(n));return`${t}>${e}${n.length>0?JSON.stringify(n):""}`}(n,r,i)}before(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?It(this.externalSeq,t.externalSeq):It(this.internalSeq,t.internalSeq)}hasReceiver(t){return function(t,e){return t.startsWith(`${e}>`)}(this.payload,t)}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(t){this.seq=2*t+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(t){this.seq=2*t}asState(){return[this.time,this.seq,this.payload]}static fromState(t,e){const[n,r,i]=t,{receiver:o,selector:s,args:a}=Rt(i,e);return new Dt(n,r,o,s,a)}executeOn(t){const{receiver:e,selector:n,args:r}=Rt(this.payload,t),i=t.lookUpModel(e);if(i)if("{"===n[0]){const e=$t(n,i);At(t,()=>{Et(t,()=>{try{e(...r)}catch(t){st(`${this.shortString()} ${e}`,t)}})})}else"function"!=typeof i[n]?it(`${this.shortString()} ${i}.${n}(): method not found`):At(t,()=>{Et(t,()=>{try{i[n](...r)}catch(t){st(`${this.shortString()} ${i}.${n}()`,t)}})});else it(`${this.shortString()} ${n}(): receiver not found`)}shortString(){return`${this.isExternal()?"External":"Future"}Message`}toString(){const{receiver:t,selector:e,args:n}=Rt(this.payload),r=this.isExternal(),i=r?this.externalSeq:this.internalSeq;return`${r?"External":"Future"}Message[${this.time}${":#"[+r]}${i} ${t}.${e}(${n.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const zt=(()=>{const t=new ArrayBuffer(8),e=new DataView(t);return t=>(e.setFloat64(0,t,!0),e.getInt32(0,!0)+e.getInt32(4,!0))})();class Lt{constructor(){this.refs=new Map,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",Dt);for(const[t,e]of Gt.allClassTypes())this.addHasher(t,e)}addHasher(t,e){const{cls:n,write:r}=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:t=>Object.assign({},t)};this.hashers.set(n,t=>this.hashStructure(t,r(t)))}getHash(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[e,n]of Object.entries(t))if("controller"!==e&&"meta"!==e)if("_random"===e)this.hash(n.state(),!1);else if("messages"===e){const t=n.asArray();(this.hashState.fC=t.length)&&this.hash(t,!1)}else this.hashEntry(e,n);return this.hashDeferred(),this.hashState}hashDeferred(){for(;this.todo.length>0;){const{key:t,value:e}=this.todo.shift();this.hashEntry(t,e,!1)}}hash(t,e=!0){switch(typeof t){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=zt(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;default:{const n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return void this.hashArray(t,e);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return void this.hashStructure(t,[...t]);case"Object":if(t instanceof Gt)this.hashModel(t);else if(t.constructor===Object)this.hashObject(t,e);else{const e=this.hashers.get(t.constructor);if(!e)throw Error(`Don't know how to hash ${t.constructor.name}`);e(t)}return;case"Null":return;default:throw Error(`Don't know how to hash ${n}`)}}}}hashModel(t){if(!this.refs.has(t)){this.hashState.mC++,this.refs.set(t,!0);for(const[e,n]of Object.entries(t))"__realm"!==e&&void 0!==n&&this.hashEntry(e,n)}}hashObject(t,e=!0){if(!this.refs.has(t)){this.hashState.oC++,this.refs.set(t,!0);for(const[n,r]of Object.entries(t))void 0!==r&&this.hashEntry(n,r,e)}}hashArray(t,e=!0){if(!this.refs.has(t)){this.refs.set(t,!0);for(let n=0;n<t.length;n++)this.hashEntry(n,t[n],e)}}hashStructure(t,e){void 0!==e&&(this.refs.has(t)||(this.refs.set(t,!0),this.hash(e,!1)))}hashEntry(t,e,n=!0){"$"!==t[0]?n&&"object"==typeof e?this.todo.push({key:t,value:e}):this.hash(e):it(`snapshot: ignoring property ${t}`,{only:"once"})}}class Bt{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.island=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.island=t,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",Dt);for(const[t,e]of Gt.allClassTypes())this.addWriter(t,e)}addWriter(t,e){const{cls:n,write:r}=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:t=>Object.assign({},t)};this.writers.set(n,(e,n)=>this.writeAs(t,e,r(e),n))}snapshot(t){const e={_random:t._random.state(),messages:this.write(t.messages.asArray())};for(const[n,r]of Object.entries(t))"controller"!==n&&(e[n]||this.writeInto(e,n,r,"$"));return this.writeDeferred(),e}writeDeferred(){for(;this.todo.length>0;){const{state:t,key:e,value:n,path:r}=this.todo.shift();this.writeInto(t,e,n,r,!1)}}write(t,e,n=!0){switch(typeof t){case"number":return Number.isSafeInteger(t)?t:Number.isNaN(t)?{$class:"NaN"}:Number.isFinite(t)?this.writeFloat(t):{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":case"undefined":return t;default:{const r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.writeArray(t,e,n);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return this.writeAs(r,t,[...t],e);case"Object":{if(t instanceof Gt)return this.writeModel(t,e);if(t.constructor===Object)return this.writeObject(t,e,n);const r=this.writers.get(t.constructor);if(r)return r(t,e);throw Error(`Don't know how to write ${t.constructor.name} at ${e}`)}case"Null":return t;default:throw Error(`Don't know how to write ${r} at ${e}`)}}}}writeModel(t,e){if(this.refs.has(t))return this.writeRef(t);const n={$model:Gt.classToID(t.constructor)};this.refs.set(t,n);for(const r of Object.keys(t).sort()){if("__realm"===r)continue;const i=t[r];void 0!==i&&this.writeInto(n,r,i,e)}return n}writeObject(t,e,n=!0){if(this.refs.has(t))return this.writeRef(t);const r={};this.refs.set(t,r);for(const i of Object.keys(t).sort()){const o=t[i];void 0!==o&&this.writeInto(r,i,o,e,n)}return r}writeArray(t,e,n=!0){if(this.refs.has(t))return this.writeRef(t);const r=[];this.refs.set(t,r);for(let i=0;i<t.length;i++)this.writeInto(r,i,t[i],e,n);return r}writeFloat(t){return t}writeAs(t,e,n,r){if(void 0===n)return n;if(this.refs.has(e))return this.writeRef(e);const i={$class:t};this.refs.set(e,i);const o=this.write(n,r,!1);return"object"!=typeof o||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}writeRef(t){const e=this.refs.get(t);if("object"!=typeof e)throw Error("Non-object in refs: "+t);return Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}}),{$ref:e.$id||(e.$id=this.nextRef++)}}writeInto(t,e,n,r,i=!0){if("$"===e[0])return void it(`snapshot: ignoring property ${e}`,{only:"once"});if(i&&"object"==typeof n)return void this.todo.push({state:t,key:e,value:n,path:r});const o=r+("string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i)?`.${e}`:`[${JSON.stringify(e)}]`),s=this.write(n,o);void 0!==s&&(t[e]=s)}}class Ut{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.island=t,e.refs=new Map,e.todo=[],e.unresolved=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.island=t,this.refs=new Map,this.todo=[],this.unresolved=[],this.readers=new Map,this.addReader("Teatime:Message",Dt);for(const[t,e]of Gt.allClassTypes())this.addReader(t,e);this.readers.set("NaN",()=>NaN),this.readers.set("Infinity",t=>t*(1/0)),this.readers.set("Set",t=>new Set(t)),this.readers.set("Map",t=>new Map(t)),this.readers.set("Array",t=>t.slice(0)),this.readers.set("Uint8Array",t=>new Uint8Array(t)),this.readers.set("Uint16Array",t=>new Uint16Array(t)),this.readers.set("Float32Array",t=>new Float32Array(t))}addReader(t,e){const n="object"==typeof e?e.read:t=>Object.assign(Object.create(e.prototype),t);this.readers.set(t,n)}readIsland(t,e){if("$"!==e)throw Error("Island must be root object");const n={_random:new s(null,{state:t._random})};for(const[r,i]of Object.entries(t))n[r]||this.readInto(n,r,i,e);return this.readDeferred(),this.resolveRefs(),n}readDeferred(){for(;this.todo.length>0;){const{object:t,key:e,value:n,path:r}=this.todo.shift();this.readInto(t,e,n,r,1)}}resolveRefs(){for(const{object:t,key:e,ref:n,path:r}of this.unresolved){if(!this.refs.has(n))throw Error(`Unresolved ref: ${n} at ${r}[${JSON.stringify(e)}]`);t[e]=this.refs.get(n)}}read(t,e,n=0){switch(typeof t){case"number":case"string":case"boolean":return t;default:{const r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.readArray(t,e,n);case"Null":return null;case"Object":{const{$class:r,$model:i,$ref:o}=t;if(o)throw Error("refs should have been handled in readInto()");return i?this.readModel(t,e):r?this.readAs(r,t,e):this.readObject(Object,t,e,n)}default:throw Error(`Don't know how to read ${r} at ${e}`)}}}}readModel(t,e){const n=Gt.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,n);for(const[r,i]of Object.entries(t))"id"!==r&&"$"!==r[0]&&this.readInto(n,r,i,e);return n}readObject(t,e,n,r=0){const i=new t;e.$id&&this.refs.set(e.$id,i);for(const[t,o]of Object.entries(e))"$"!==t[0]&&this.readInto(i,t,o,n,r);return i}readArray(t,e,n=0){const r=[];t.$id&&this.refs.set(t.$id,r);for(let i=0;i<t.length;i++)void 0!==t[i]&&this.readInto(r,i,t[i],e,n);return r}readAs(t,e,n){let r={};const i=new Map;if("$value"in e)r=this.read(e.$value,n,2);else for(const[t,o]of Object.entries(e)){if("$"===t[0])continue;const e=o&&o.$ref;e?this.refs.has(e)?r[t]=this.refs.get(e):(r[t]="<unresolved>",i.set(e,t)):this.readInto(r,t,o,n,1)}const o=this.readers.get(t)(r,n);o||"NaN"===t||console.warn(`Reading "${t}" returned ${o} at ${n}`),e.$id&&this.refs.set(e.$id,o);for(const[t,e]of i.entries())this.unresolved.push({object:o,key:e,ref:t,path:n});return o}readRef(t,e,n,r){if(!n||!n.$ref)return!1;const i=n.$ref;return this.refs.has(i)?t[e]=this.refs.get(i):(t[e]="<unresolved>",this.unresolved.push({object:t,key:e,ref:i,path:r})),!0}readInto(t,e,n,r,i=0){if(this.readRef(t,e,n,r))return;if(0===i&&"object"==typeof n)return void this.todo.push({object:t,key:e,value:n,path:r});const o=r+("string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i)?`.${e}`:`[${JSON.stringify(e)}]`);t[e]=this.read(n,o,i>0?i-1:0)}}class Ft extends Bt{encode(t){const e=this.writeArray(t,"$");return this.writeDeferred(),e}writeModel(t){return{$ref:t.id}}}class Ht extends Ut{decode(t){const e=this.readArray(t,"$");return this.readDeferred(),this.resolveRefs(),e}resolveRefs(){for(const{object:t,key:e,ref:n,path:r}of this.unresolved)if(this.refs.has(n))t[e]=this.refs.get(n);else{const i=this.island.lookUpModel(n);if(!i)throw Error(`Unresolved ref: ${n} at ${r}[${JSON.stringify(e)}]`);t[e]=i}}}const Vt={classes:d.has("debug","classes",!1)};let Jt=Symbol("SECRET");const Wt=new WeakSet;class Gt{static __isTeatimeModelClass__(){return!0}static create(t,e){const n=this,r=Ct(),i=new n(Jt);return Object.defineProperty(i,"__realm",{value:r}),Object.defineProperty(i,"id",{value:r.register(i),enumerable:!0}),Wt.add(i),e&&i.beWellKnownAs(e),i.init(t),Wt.has(i)&&(Wt.delete(i),Object.getPrototypeOf(n)!==Gt&&console.warn(`${i} did not call super.init(options)`)),i}static createNoInit(t){const e=Ct(),n=new this(Jt);return Object.defineProperty(n,"__realm",{value:e}),Object.defineProperty(n,"id",{value:t,enumerable:!0}),n}static allowConstructors(){Jt=void 0,console.warn("disabling error reporting for Model constructors")}static register(t="unknown-file"){return Ut.resetInstance(),Bt.resetInstance(),Ft.resetInstance(),Ht.resetInstance(),function(t){const e=E(function(t){const e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}");return`${e.slice(0,n).replace(/\s+/g," ").trim()} {\n${e.slice(n+1,r).trim()}}`}(t));e.then(e=>{console.log(`hashing class ${t.name}: ${e}`),_()&&(k[e].name=`Class ${t.name}`)}),T.push(e)}(this),ee(t,this.name,this),this}static registerIfNeeded(){Xt(this)||this.register()}static types(){return{}}static classToID(t){return function(t){if(Xt(t))return t[Kt];if(Yt(),Xt(t))return t[Kt];throw Error(`Class "${t.name}" not found, did you call ${t.name}.register()?`)}(t)}static classFromID(t){return te(t)}static allClasses(){return Qt()}static allClassTypes(){return function(){const t={};for(const e of Qt())Object.prototype.hasOwnProperty.call(e,"types")&&Object.assign(t,e.types());return Object.entries(t)}()}static instantiateClassID(t,e){return te(t).createNoInit(e)}constructor(t){if(t!==Jt)throw Error(`You must create ${this} using create() not "new"!`)}init(t){Wt.delete(this)}destroy(){Ct().unsubscribeAll(this),Ct().deregister(this)}publish(t,e,n){this.__realm||this.__realmError(),this.__realm.publish(e,n,t)}subscribe(t,e,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,n)}unsubscribe(t,e){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(t=0,e,...n){return this.__realm||this.__realmError(),this.__realm.future(this,t,e,n)}random(){return Ct().random()}now(){return Ct().now()}beWellKnownAs(t){Ct().island.set(t,this)}wellKnownModel(t){return this.__realm.island.get(t)}modelOnly(t){let e="none";try{e=Ct()}catch(t){}if(e===this.__realm)return!0;const n=Error(t||`${this}.modelOnly() called from outside a model!`);throw st("view code",n),n}get sessionId(){return this.__realm.island.id}[Symbol.toPrimitive](){const t=this.constructor.name;return t.includes("Model")?t:`${t}[Model]`}}const Zt={},Kt=Symbol("CLASS_ID");function Yt(){if(e.bundle)for(const[t,n]of Object.entries(e.bundle.cache))for(const[e,r]of Object.entries(n.exports))r&&r.__isTeatimeModelClass__&&ee(t,"default"===e?r.name:e,r)}function Qt(){return 0===Object.keys(Zt).length&&Yt(),Object.values(Zt).map(t=>t.cls)}function Xt(t){return Object.prototype.hasOwnProperty.call(t,Kt)}function te(t){if(Zt[t])return Zt[t].cls;if(Yt(),Zt[t])return Zt[t].cls;throw Error(`Class "${t}" in snapshot, but not found in current source?`)}function ee(t,e,n){const r=`${t}:${e}`,i=Zt[r];if(i&&i.cls!==n)throw Error(`Duplicate class ${e} in ${t}`);return Xt(n)?Vt.classes&&!i&&console.warn(`ignoring re-exported class ${e} from ${t}`):(Vt.classes&&console.log(`registering class ${e} from ${t}`),n[Kt]=r),Zt[r]={cls:n,file:t},n}class ne{static displayStatus(t,e){return ot(t,e)}static displayWarning(t,e){return it(t,e)}static displayError(t,e){return rt(t,e)}constructor(t){Object.defineProperty(this,"realm",{value:Ct()}),Object.defineProperty(this,"id",{value:this.realm.register(this),configurable:!0})}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(t,e,n){this.realm.publish(e,n,t)}subscribe(t,e,n){n=n.bind(this);const{event:r,handling:i}=e.event?e:{event:e};this.realm.subscribe(r,this.id,n,t,i)}unsubscribe(t,e){this.realm.unsubscribe(e,this.id,null,t)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}future(t=0){return this.realm.future(this,t)}random(){return Ct().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}update(t){}wellKnownModel(t){return this.realm.island.get(t)}get sessionId(){return this.realm.island.id}get viewId(){return this.realm.island.controller.viewId}inSameViewRealm(t){return Mt(this.realm.island,t,!0)}[Symbol.toPrimitive](){const t=this.constructor.name;return t.includes("View")?t:`${t}[View]`}}const re=Symbol("hash");function ie(t){return d.has("debug",t,!1)}function oe(t,e){return`https://croquet.io/files/v1/sessiondata/${e}`}class se{static async store(t,e){if(qt.hasCurrent())throw Error("Croquet.Data.store() called from Model code");const n=await async function(t,e){return e}(0,e),r=await async function(t){return b(t)}(n),i=oe(0,r);return await async function(t,e){ie("data")&&console.log(`Uploading ${e.byteLength} bytes to ${t}`);const n=await fetch(t,{method:"PUT",body:e});if(!n.ok)throw Error(`Croquet.Data: failed to upload ${t} (${n.status} ${n.statusText})`);ie("data")&&console.log(`Croquet.Data: uploaded (${n.status} ${n.statusText}) ${e.byteLength} bytes to ${t}`)}(i,n),new se(r)}static async fetch(t,e){if(qt.hasCurrent())throw Error("Croquet.Data.fetch() called from Model code");const n=oe(0,e[re]);return async function(t,e){return e}(0,await async function(t){ie("data")&&console.log(`Downloading from ${t}`);const e=await fetch(t);if(e.ok)return e.arrayBuffer();throw Error(`Croquet.Data: failed to download ${t} (${e.status} ${e.statusText})`)}(n))}constructor(t){Object.defineProperty(this,re,{value:t})}}(class extends Gt{static types(){return{"@croquet.data":{cls:se,write:t=>t[re],read:t=>new se(t)}}}}).register();const ae=t("pako"),ce=1,le="0.3.0:worldcore-patch:a82c4d922b98d437efe19248919f9c464d390019";console.log("Croquet SDK "+le);const ue=`wss://${window.location.hostname.endsWith("croquet.io")?`${window.location.host}/reflector`:"croquet.io/reflector"}/v${ce}`,he="wss://croquet.io/reflector-dev/dev";let de=null;const fe=d.nocheat,pe=["tps"],me=5e3,ge=5,ye=100,we=1e3,ve=200;function be(){return Math.floor(Math.random()*2**53).toString(36)}const _e=new Set;class ke{constructor(){this.reset()}reset(){this.island=null,this.connection=this.connection||new Ce(this),this.networkQueue=new $,this.time=0,this.session="",this.viewId=this.viewId||be(),this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(window.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(window.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],bt.removeAllSubscriptionsFor(this.viewId),bt.addSubscription(this.viewId,"__users__",this.viewId,t=>ot(`users now ${t.count}`),"oncePerFrameWhileSynced"),gt.showSyncWait(!0)}get id(){return this.island?this.island.id:this.islandCreator.snapshot.id}get user(){return{id:this.viewId,name:f("name","GUEST")}}get viewOnly(){return this.islandCreator.viewOnly}get backlog(){return this.island?this.time-this.island.time:0}get starvation(){return Date.now()-this.lastReceived}get activity(){return Date.now()-this.lastSent}get connected(){return this.connection.connected}checkForConnection(t){this.connection.checkForConnection(t)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async establishSession(t,e){de={messages:d.has("debug","messages",!1),sends:d.has("debug","sends",!1),ticks:d.has("debug","ticks",!1),pong:d.has("debug","pong",!1),snapshot:d.has("debug","snapshot",!1),session:d.has("debug","session",!1),initsnapshot:d.has("debug","initsnapshot","localhost"),reflector:d.has("debug","reflector",d.dev||"localhost")};const{optionsFromUrl:n,multiRoom:r,autoSession:o,login:s}=e,a={...e.options};for(const t of[...pe,...n||[]])t in d&&(a[t]=d[t]);if(s&&await async function(){return!d.nologin&&(!(!f("name")||d.user)||new Promise(t=>{const e=document.createElement("style");e.innerHTML='\n            .overlay {\n                z-index: 1010;\n                position: fixed;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                background-color:#333;\n                opacity:0.9;\n                display:flex;\n                align-items:center;\n                justify-content:center\n            }\n            form {\n                background-color: #fff;\n                color: #666;\n                border-radius: 10px;\n                padding: 16px;\n                font-size: 14px;\n            }\n            form dt { margin: 4px 0 }\n            form dd { margin-left: 0 }\n            form input {\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                min-height: 46px;\n                padding: 10px;\n                font-size: 16px;\n                width: 100%;\n                box-shadow: inset 0 1px 2px #666;\n            }\n            form input:invalid { border: 1px solid red; }\n            form input:valid   { border: 1px solid #ccc; }\n            form button {\n                padding: 20px 32px;\n                background-color: #3b5;\n                color: #fff;\n                border-radius: 50px;\n                border-width:0;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n            }\n            .error {\n                visibility: hidden;\n                width: 250px;\n                background-color: #fcc;\n                color: #900;\n                padding: 5px;\n                border-radius: 6px;\n                border: 1px solid #c99;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n            .error::after {\n                content: " ";\n                position: absolute;\n                bottom: 100%;  /* At the top of message */\n                left: 10px;\n                border-width: 5px;\n                border-style: solid;\n                border-color: transparent transparent #c99 transparent;\n            }\n            .notice {\n                visibility: hidden;\n                width: 270px;\n                height: 70px;\n                background-color: #fff;\n                padding: 5px;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n        ',document.head.appendChild(e);const n=document.createElement("form");n.innerHTML='\n            <dl>\n                <dt><label for="user[name]">Username</label></dt>\n                <dd>\n                    <input type="text" required pattern="^[a-zA-Z0-9_]*$" minlength="2" maxlength="15" name="user[name]" id="user[name]" placeholder="Enter a username" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n                <dd class="notice"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[email]">Email</label></dt>\n                <dd>\n                    <input type="email" required id="user[email]" placeholder="you@example.com" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[password]">Password</label></dt>\n                <dd>\n                    <input type="password" required minlength="8" id="user[password]" placeholder="Create a password" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <button id="user[create]">Sign up / Log in</button>\n            <div style="margin:16px auto;text-align: center">— OR —</div>\n            <button id="user[guest]" style="background-color: #999">Continue as Croquet Guest</button>\n            <div style="max-width:280px;text-align: center;font-size:11px;margin:4px auto">\n                Continuing from this screen to our website indicates that you agree to our\n                <a href="/terms.html" target="_blank" style="color:#36c;text-decoration:none">terms of service</a>\n                and\n                <a href="/privacy.html" target="_blank" style="color:#36c;text-decoration:none">privacy statement</a>.\n            </div>\n        ';const r=document.createElement("div");r.classList.add("overlay"),r.appendChild(n),document.body.appendChild(r);const[i,o,s]=n.getElementsByTagName("input"),[a,c,l]=n.getElementsByClassName("error"),[u]=n.getElementsByClassName("notice"),[h,p]=n.getElementsByTagName("button");"string"==typeof d.user?i.value=d.user:f("name")&&(i.value=f("name"));let g=0;i.oninput=()=>{clearTimeout(g),g=setTimeout(()=>k(),300)},C(!0),i.oninput();let y=0;o.oninput=()=>{clearTimeout(y),y=setTimeout(()=>S(),300)};let w=0;function b(){n.reset(),document.head.removeChild(e),document.body.removeChild(r)}function _(t,e,n=".json"){return`${m()}/user/${t.toLowerCase()}/${e}${n}`}async function k(t=!1){a.style.visibility="hidden",t||C(!0);const e=i.value.trim();if(!e&&!t)return!1;if(i.validity.tooShort||i.validity.tooLong)return a.innerHTML=`Your username must be between ${i.minLength} and ${i.maxLength} characters long.`,a.style.visibility="visible",!1;if(i.validity.patternMismatch)return a.innerHTML="Your username can only contain alphanumeric characters (letters A-Z, numbers 0-9) and underscores.",a.style.visibility="visible",!1;try{const r=g,i=await fetch(_(e,"salt"),{mode:"cors"});if(r!==g&&!t)return!1;if(i.ok){t||C(!1);const r=await i.json();return{name:e,salt:(n=r.salt,new Uint8Array(atob(n.padEnd(n.length+3&-4,"=").replace(/-/g,"+").replace(/_/g,"/")).split("").map(t=>t.charCodeAt(0))))}}}catch(t){}var n;return{name:e}}function S(t=!1){c.style.visibility="hidden";const e=o.value.trim();return!(!e&&!t)&&(o.validity.valid?e:(c.innerHTML="Please enter a valid email address.",c.style.visibility="visible",!1))}function x(t=!1){l.style.visibility="hidden";const e=s.value;return!(!e&&!t)&&(s.validity.tooShort?(l.innerHTML=`Your password must be at least ${s.minLength} characters long.`,l.style.visibility="visible",!1):e)}function C(t){const e=i.value.trim();u.innerHTML=`“${e}” is already registered as a user.<br><br>\n                If this is you, please enter your password below to continue.\n                Otherwise, please pick a different name.`,u.style.visibility=t?"hidden":"visible",o.disabled=!t,s.placeholder=e?t?`Create a password for “${e}”`:`Enter password for “${e}”`:"Enter a password",h.innerHTML=e?t?`Sign up as “${e}”`:`Log in as “${e}”`:"Sign up / Log in"}s.oninput=()=>{clearTimeout(w),w=setTimeout(()=>x(),300)},h.onclick=async e=>{e.preventDefault();const{name:n,salt:r}=await k(!0),i=!!r||S(!0),o=x(!0);if(!n||!i||!o)return;let s=r;s||(s=crypto.getRandomValues(new Uint8Array(8)),fetch(_(n,"salt"),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({salt:v(s)})}));const a=await window.crypto.subtle.importKey("raw",(new TextEncoder).encode(o),{name:"PBKDF2"},!1,["deriveBits"]),c=v(await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:s,iterations:5e5,hash:"SHA-256"},a,256));if(r)try{const t=await fetch(_(n,c),{mode:"cors"});if(!t.ok)throw Error("wrong password");const e=await t.json();console.log(`Logged in as ${e.name} <${e.email}>`),localStorage.croquetUser=JSON.stringify(e)}catch(t){return l.innerHTML=`Wrong password for “${n}“`,void(l.style.visibility="visible")}else{const t=crypto.getRandomValues(new Uint8Array(16)),e={name:n,email:i,salt:v(s),secret:v(t)};localStorage.croquetUser=JSON.stringify(e),fetch(_(n,c),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),console.log(`Signed up as ${e.name} <${e.email}>`)}b(),t(!0)},p.onclick=e=>{e.preventDefault(),delete localStorage.croquetUser,b(),t(!1)}}))}(),o){const e=t,n=d.getSession().split("/");let i=r?n[1]:n[0],s=r?n[2]:n[1];const a=!i||!s;a&&(o.user&&(i=o.user),o.random&&(s=o.random),i||(i=f("name","").toLowerCase()||"GUEST"),s||(s=be())),this.session=r?`${e}/${i}/${s}`:`${i}/${s}`,r||(d.setSession(this.session,a),gt.sessionURL=window.location.href),t=`${e}/${i}/${s}`}const c=Object.keys(a).length?t+"?"+Object.entries(a).map(([t,e])=>`${t}=${(t=>"object"==typeof t?i(t):t)(e)}`).sort().join("&"):t,{hash:l,codeHash:u}=await async function(t,e){const n=y().filter(t=>{const e=t.endsWith("/package.json")||t.endsWith("/ar.js");return e&&console.warn(`excluding ${t} from code hash`),!e}).sort(),r=await Promise.all([...n.map(O),...T]),i=await E([e,...r].join("|")),o=await E([t,i].join("|"));if(_()){k[i].name="All code",k[o].name="Session name and code";const t=[...r,i,o].map(t=>({hash:t,...k[t]}));console.log(`Debug Hashing for session ${o}`,t)}return{hash:o,codeHash:i}}(c,le);console.log(`Session ID for "${t}": ${l}`),this.islandCreator={...e,options:a,name:t,codeHash:u};let h=!1;return this.islandCreator.snapshot?this.islandCreator.snapshot.id!==l&&(console.warn("Existing snapshot was for different code base!"),h=!0):h=!0,h&&(this.islandCreator.snapshot={id:l,time:0,meta:{id:l,codeHash:u,created:(new Date).toISOString()}}),await this.join(),await this.startedOrSynced(),this.island.modelsByName}lastKnownTime(t){return Math.max(t.time,t.externalTime)}handleSyncCheckVote(t){if(!0!==this.synced)return;const{_local:e,tally:n}=t,r=Object.keys(n);e&&r.includes(e)?r.length>1?console.log(r):console.log("ok"):console.log(this.id,"Sync: local vote not found",e,n)}takeSnapshot(){const t=this.island.snapshot(),e=this.lastKnownTime(t),n=t.externalSeq;return t.meta={...this.islandCreator.snapshot.meta,options:this.islandCreator.options,time:e,seq:n,date:(new Date).toISOString(),host:window.location.hostname,sdk:le},delete t.meta.hash,t}scheduleSnapshot(){if(!this.island)return;const t=this.island.time,e=t-this.island.lastSnapshotPoll;if(e<5e3)return void(de.snapshot&&console.log(`not requesting snapshot poll (${e}ms since poll scheduled)`));const n=new Dt(t,0,this.island.id,"pollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),de.snapshot&&console.log(this.id,"Controller scheduling snapshot via reflector")}preparePollForSnapshot(){const t=this.triggeringCpuTime||this.cpuTime;return this.triggeringCpuTime=null,this.cpuTime=0,!0===this.synced?{cpuTime:t}:null}pollForSnapshot(t,e,n){n.cpuTime+=Math.random();const r=[this.id,"handleSnapshotVote","snapshotVote"];this.sendTutti(t,e,n,null,!0,r)}handleSnapshotVote(t){if(!0!==this.synced)return void(de.snapshot&&console.log("Ignoring snapshot vote during sync"));const{_local:e,tally:n}=t,r=Object.keys(n);if(!e||!r.includes(e))return de.snapshot&&console.log(this.id,"Snapshot: local vote not found"),void(this.cpuTime=0);const i=(t,n)=>{const i=s[t];i.length>1&&i.sort((t,e)=>o[t].cpuTime-o[e].cpuTime);const a=i[0];r[a]===e&&this.serveSnapshot(n)},o=r.map(t=>JSON.parse(t)),s={};o.forEach(({hash:t},e)=>{s[t]||(s[t]=[]),s[t].push(e)});const a=Object.keys(s);let c=a[0];a.length>1&&(de.snapshot&&console.log(this.id,`Snapshots fall into ${a.length} groups`),a.sort((t,e)=>s[e].length-s[t].length),s[a[0]].length===s[a[1]].length&&(de.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),c=a[0]<a[1]?a[0]:a[1])),a.forEach(t=>i(t,t===c))}serveSnapshot(t){const e=W.begin("snapshot"),n=this.takeSnapshot(),r=W.end("snapshot")-e;this.cpuTime-=r,de.snapshot&&console.log(this.id,`Snapshotting took ${Math.ceil(r)} ms`),this.uploadSnapshot(n,t)}snapshotUrl(t,e,n,r,i){const o=`.json${i?"."+i:""}`;return`${`${function(t="code"){const e=d.has("dev","host","localhost")?`dev/${f("name","GUEST")}/`:"";return`${m()}/${e}${t}/`}("snapshots")}${this.id}`}/${`${(t=>(""+t).padStart(10,"0"))(Math.round(e))}_${n}-${t}-${r}${o}`}`}hashSnapshot(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise(e=>{const n={...t};delete n.meta,E(JSON.stringify(n)).then(n=>{t.meta.hash=n,delete t.meta.hashPromise,e(n)})})),t.meta.hashPromise)}async uploadSnapshot(t,e=!0){await this.hashSnapshot(t);const n=Date.now(),r=JSON.stringify(t),i=Date.now()-n,{time:o,seq:s,hash:a}=t.meta,c=this.snapshotUrl("snap",o,s,a,"gz");de.snapshot&&console.log(this.id,`Controller uploading snapshot (${r.length} bytes, ${i}ms) to ${c}`);const l=this.connection.socket,u=await this.uploadGzipped(c,r);return this.connection.socket!==l?(console.error("Controller was reset while trying to upload snapshot"),!1):u?(e&&this.announceSnapshotUrl(o,s,a,c),!0):(console.error("Failed to upload snapshot"),!1)}announceSnapshotUrl(t,e,n,r){de.snapshot&&console.log(this.id,`Controller sending snapshot url to reflector (time: ${t}, seq: ${e}, hash: ${n}): ${r}`);try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:n,url:r}}))}catch(t){console.error("ERROR while sending",t)}}async fetchJSON(t,e){try{const e=await fetch(t,{mode:"cors"});if(t.endsWith(".gz")){const t=await e.arrayBuffer(),n=ae.inflate(new Uint8Array(t),{to:"string"});return JSON.parse(n)}return await e.json()}catch(t){}return e}async uploadJSON(t,e){try{const{ok:n}=await fetch(t,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:e});return n}catch(t){}return!1}async uploadGzipped(t,e){const n=Date.now(),r=(new TextEncoder).encode(e),i=ae.gzip(r,{level:1});de.snapshot&&console.log(`Snapshot gzipping took ${Date.now()-n}ms`);try{const{ok:e}=await fetch(t,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/octet-stream"},body:i});return e}catch(t){}return!1}convertReflectorMessage(t){let e=this.id,n="noop",r=[];switch(t[2].what){case"users":{const{joined:i,left:o,active:s,total:a}=t[2];this.users=s,this.usersTotal=a;const c=this.id,l="__users__",u={entered:i||[],exited:o||[],count:s};for(const t of u.entered)t.length>2&&(t.length=2);e=this.id,n="publishFromModel",r=[c,l,u],bt.handleEvent(this.viewId+":"+l,u);break}case"tally":{const{tuttiSeq:i,tally:o,tallyTarget:s}=t[2],a={tuttiSeq:i,tally:o},c=this.tuttiHistory.find(t=>t.tuttiSeq===i);let l;c&&(a._local=c.payload),[e,n,l]=s,r=[l,a];break}}const i=new Dt(0,0,e,n,r);t[2]=i.asState()[2]}async receive(t,e){switch(this.lastReceived=this.connection.lastReceived,t){case"START":{de.session&&console.log(this.id,"Controller received START"),this.install();const t=this.takeSnapshot(),e=await this.uploadSnapshot(t,!0);return this.islandCreator.startedOrSynced.resolve(this.island),void(e?this.requestTicks():this.connection.closeConnectionWithError("start","failed to establish session"))}case"SYNC":{const{messages:t,url:n,time:r}=e;de.session&&console.log(this.id,`Controller received SYNC: time ${r}, ${t.length} messages, ${n}`);for(const e of t)de.messages&&console.log(this.id,"Controller received message in SYNC "+JSON.stringify(e)),e[1]>>>=0,"string"!=typeof e[2]&&this.convertReflectorMessage(e),this.networkQueue.put(e),this.timeFromReflector(e[0]);this.timeFromReflector(r),de.session&&console.log(`${this.id} fetching snapshot ${n}`);const i=await this.fetchJSON(n);if(this.islandCreator.snapshot=i,!this.connected)return void console.log(this.id,"socket went away during SYNC");this.install(),de.session&&console.log(`${this.id} fast forwarding from ${Math.round(this.island.time)} to ${r}`),this.getTickAndMultiplier();const o=()=>{this.simulate(Date.now()+200)?(de.session&&console.log(`${this.id} fast forwarded to ${Math.round(this.island.time)}`),this.islandCreator.startedOrSynced.resolve(this.island)):setTimeout(o,0)};return void setTimeout(o,0)}case"RECV":{de.messages&&console.log(this.id,"Controller received RECV "+JSON.stringify(e));const t=e;return"string"!=typeof t[2]&&this.convertReflectorMessage(t),t[1]>>>=0,t[3]===this.viewId&&this.addToStatistics(t[4],this.lastReceived),this.networkQueue.put(t),void this.timeFromReflector(t[0])}case"TICK":{if(!this.island)return;const t="number"==typeof e?e:e.time;return de.ticks&&console.log(this.id,"Controller received TICK "+t),this.timeFromReflector(t),void(this.tickMultiplier&&this.multiplyTick(t))}case"LEAVE":return console.log(this.id,"Controller received LEAVE"),void this.leave();default:console.warn("Unknown action:",t,e)}}install(){de.session&&console.log(`${this.id} installing island`);const{snapshot:t,init:e,options:n}=this.islandCreator;let r=new qt(t,()=>{try{return e(n)}catch(t){throw st("init",t),t}});if(de.initsnapshot&&!t.modelsById){const t=JSON.stringify(r.snapshot());r=new qt(JSON.parse(t),()=>e(n))}const i=this.lastKnownTime(r);this.time=Math.max(this.time,i),this.setIsland(r)}setIsland(t){this.island=t,this.island.controller=this}createCleanIsland(){const{options:t,init:e}=this.islandCreator,n={id:this.id};return new qt(n,()=>e(t))}async join(){this.checkForConnection(!1),await this.connection.connectionPromise,_e.add(this),de.session&&console.log(this.id,"Controller sending JOIN");const{name:t,id:e}=this.user,n={name:this.islandCreator.name,options:this.islandCreator.options,version:ce,user:[e,t],url:gt.sessionURL,codeHash:this.islandCreator.codeHash,sdk:le};this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:n}))}async startedOrSynced(){return new Promise((t,e)=>this.islandCreator.startedOrSynced={resolve:t,reject:e})}leave(){this.connected&&(console.log(this.id,`Controller LEAVING session for ${this.islandCreator.name}`),this.connection.send(JSON.stringify({id:this.id,action:"LEAVING"}))),_e.delete(this);const{destroyerFn:t}=this.islandCreator;if(this.reset(),!this.islandCreator)throw Error("do not discard islandCreator!");t&&t()}sendMessage(t){this.connected&&(this.viewOnly||(de.sends&&console.log(this.id,`Controller sending SEND ${t.asState()}`),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[...t.asState(),this.viewId,this.lastSent,this.latency]}))))}sendTagged(t,e){this.connected&&(this.viewOnly||(de.sends&&console.log(this.id,`Controller sending tagged SEND ${t.asState()} with tags ${JSON.stringify(e)}`),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[...t.asState(),this.viewId,this.lastSent],tags:e}))))}sendTutti(t,e,n,r,o,s){if(!this.connected)return;if(this.viewOnly)return;const a=i(n);de.sends&&console.log(this.id,`Controller sending TUTTI ${a} ${r&&r.asState()} ${s}`),this.tuttiHistory.push({tuttiSeq:e,payload:a}),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,e,a,r&&r.asState(),o,s]}))}sendVote(t,e,n){const r=[this.island.id,"handleModelEventInView",this.island.id+":"+e];this.sendTutti(this.island.time,t,n,null,!0,r)}addToStatistics(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const t=this.islandCreator.options,e="tps"in t?t.tps:"tps"in this.islandCreator?this.islandCreator.tps:20,[n,r]=(e+"x").split("x").map(t=>Number.parseInt("0"+t,10)),i=1e3/Math.max(1,Math.min(60,n)),o=Math.max(1,r);return o>1&&!fe&&(this.tickMultiplier={tick:i,multiplier:o}),{tick:i,multiplier:o}}requestTicks(t={}){if(!this.connected||!this.island)return;const{tick:e,multiplier:n}=this.getTickAndMultiplier();t.tick=e,t.delay=e*(n-1)/n,de.session&&console.log(this.id,"Controller requesting TICKS",t);try{this.connection.send(JSON.stringify({id:this.id,action:"TICKS",args:t}))}catch(t){console.error("ERROR while sending",t)}}simulate(t){if(!this.island)return!0;try{const e=W.begin("simulate");let n=!0;for(;n;){const e=this.networkQueue.peek();if(!e)break;if(!(n=this.island.advanceTo(e[0],t)))break;this.networkQueue.nextNonBlocking();const r=this.island.scheduleExternalMessage(e);n=this.island.advanceTo(r.time,t),this.cpuTime+=ge}n&&(n=this.island.advanceTo(this.time,t)),this.cpuTime+=Math.max(.01,W.end("simulate")-e);const r=this.backlog;if(W.backlog(r),"boolean"==typeof this.synced&&(this.synced&&r>we||!this.synced&&r<ye)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout(()=>{delete this.syncTimer,this.backlog<ye&&this.applySyncChange(!0)},ve)):this.applySyncChange(!1)}return n&&this.cpuTime>me&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,setTimeout(()=>this.scheduleSnapshot(),Math.floor(2e3*Math.random()))),n}catch(t){return st("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}applySyncChange(t){this.synced=t,gt.showSyncWait(!t),this.island.publishFromView(this.viewId,"synced",t)}inViewRealm(t){return Mt(this.island,()=>t(this.island))}processModelViewEvents(){return this.island?this.island.processModelViewEvents():0}timeFromReflector(t,e="reflector"){t<this.time?("controller"!==e||de.ticks)&&console.warn(`time is ${this.time}, ignoring time ${t} from ${e}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.time=t,this.island&&W.backlog(this.backlog),this.tickHook&&this.tickHook())}multiplyTick(t){this.localTicker&&window.clearInterval(this.localTicker);const{tick:e,multiplier:n}=this.tickMultiplier,r=e/n;let i=1;this.localTicker=window.setInterval(()=>{this.timeFromReflector(t+i*r,"controller"),de.ticks&&console.log(this.id,"Controller generate TICK "+this.time,i),++i>=n&&(window.clearInterval(this.localTicker),this.localTicker=0)},r)}}const Se=100,xe=2e4;class Ce{constructor(t){this.controller=t,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.setUpConnectionPromise()}setUpConnectionPromise(){this.connectionPromise=new Promise(t=>this.resolveConnection=t)}get connected(){return this.socket&&this.socket.readyState===WebSocket.OPEN}checkForConnection(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}async connectToReflector(){this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;let t=d.reflector||(de.reflector?he:ue);if(!t.match(/^wss?:/))throw Error("Cannot interpret reflector address "+t);return t.endsWith("/")||(t+="/"),new Promise(e=>{const n=Object.assign(new WebSocket(`${t}${this.controller.id}`),{onopen:t=>{this.socket=n,(de.session||de.reflector)&&console.log(this.socket.constructor.name,"connected to",this.socket.url),W.connected(!0),this.resolveConnection(null),e()},onmessage:t=>{this.receive(t.data)},onerror:t=>{rt("Connection error"),console.log(n.constructor.name,"error")},onclose:t=>{const e=1e3!==t.code&&t.code<4100,r=4110===t.code;r||rt(`Connection closed: ${t.code} ${t.reason}`,{duration:e?void 0:36e5}),de.session&&console.log(n.constructor.name,"closed:",t.code,t.reason),W.connected(!1),r?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),e&&(it("Reconnecting ..."),window.setTimeout(()=>this.connectToReflector(),2e3))}})})}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.lastSent=0,this.connectHasBeenCalled=!1,this.setUpConnectionPromise(),this.controller.leave())}send(t){this.lastSent=Date.now(),this.socket.send(t)}receive(t){this.lastReceived=Date.now();const{id:e,action:n,args:r}=JSON.parse(t);if(e)try{this.controller.receive(n,r)}catch(t){this.closeConnectionWithError("receive",t)}else switch(n){case"PONG":de.pong&&console.log("PONG after",Date.now()-r,"ms");break;default:console.warn("Unknown action",n)}}dormantDisconnect(){this.connected&&(console.log("dormant; disconnecting from reflector"),this.socket.close(4110,"Going dormant"))}closeConnectionWithError(t,e){console.error(e),console.warn("closing socket"),this.socket.close(4e3,"Error in "+t)}PING(){this.connected&&(this.socket.bufferedAmount?console.log(`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent`):this.send(JSON.stringify({action:"PING",args:Date.now()})))}PULSE(){this.connected&&(this.socket.bufferedAmount&&console.log(`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent`),this.send(JSON.stringify({action:"PULSE"})))}keepAlive(){0!==this.lastReceived&&(Date.now()-this.lastReceived>Se?this.PING():Date.now()-this.lastSent>xe&&this.PULSE())}}window.setInterval(()=>{for(const t of _e)t.connected&&t.connection.keepAlive()},100);class Ee{static async join(t,e=Gt,n=ne,r){function o(t,e){return t===e||t.prototype instanceof e}if("string"!=typeof t?t=JSON.stringify(t)||"undefined":t||(t="unnamed"),!o(e,Gt))throw Error("ModelRoot must inherit from Croquet.Model");if(!o(n,ne)){if(!n||Object.getPrototypeOf(n)!==Object.prototype||void 0!==r)throw Error("ViewRoot must inherit from Croquet.View");r=n,n=ne}r||(r={});const s=d.reflector||r.reflector;if(s&&(s.includes("://")?d.reflector=s:console.warn(`Not a valid websocket url, ignoring reflector "${s}"`)),r.debug){function a(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]}d.debug=[...a(r.debug),...a(d.debug)].join(",")}let c=null;"autoSleep"in r&&(d.autoSleep=r.autoSleep),setInterval(()=>{if("hidden"===document.visibilityState)if(!1===d.autoSleep)Pe(performance.now(),h,p.view);else{const t=Date.now();c?t-c>1e4&&h.dormantDisconnect():c=t}else c=null},1e3),"expectedSimFPS"in r&&(Ae=Math.min(r.expectedSimFPS,$e));const l=["tps"],u=["optionsFromUrl","login","autoSession"];!function(){if(Object.isFrozen(Ne))return;(function t(e){if(Object.isFrozen(e))return;Object.freeze(e);for(const n of Object.values(e))!n||"object"!=typeof n&&"function"!=typeof n||t(n)})(Ne),function(t){const e=JSON.stringify(t,(t,e)=>"function"==typeof e?""+e:e);if("{}"===e)return;const n=JSON.parse(e),r=E(i(n));r.then(t=>{console.log(`hashing Croquet.Constants(${Object.keys(n).join(", ")}): ${t}`),_()&&(k[t].name="Croquet Constants")}),T.push(r)}(Ne)}();const h=new ke,f={};r.options&&Object.assign(f,JSON.parse(JSON.stringify(r.options)));for(const[t,e]of Object.entries(r))l.includes(t)&&(f[t]=e);const p={id:"",model:null,view:null,step(t){"hidden"!==document.visibilityState&&(c=null,Pe(t,h,p.view))},leave(){console.warn("Session leave not implemented yet!")},get latency(){return h.latency},get latencies(){return h.latencies}};if(await async function e(i){!function(){p.model=null,p.view&&(d.has("debug","session",!1)&&console.log(p.id,"Detaching root view"),p.view.detach(),""!==p.view.id&&console.warn(`${p.view} did not call super.detach()`),p.view=null);gt.clearSessionMoniker()}();const o={snapshot:i,init:m,destroyerFn:e,options:f};for(const[t,e]of Object.entries(r))u.includes(t)&&(o[t]=e);p.model=(await h.establishSession(t,o)).modelRoot;p.id=h.id;gt.makeSessionWidgets(p.id);h.inViewRealm(()=>{d.has("debug","session",!1)&&console.log(p.id,"Creating root view"),p.view=new n(p.model)})}(),"manual"!==r.step){const t=e=>{p.step(e),window.requestAnimationFrame(t)};window.requestAnimationFrame(t)}return p;function m(t){return{modelRoot:e.create(t,"modelRoot")}}}}const Me=200,Oe=[0],Te=4,$e=120;let Ae=60;function Pe(t,e,n){e.checkForConnection(!0);const{backlog:r,latency:i,starvation:o,activity:s}=e;if(W.animationFrame(t,{backlog:r,starvation:o,latency:i,activity:s,users:e.users}),!e.island)return;const a=Date.now(),c=Oe.reduce((t,e)=>t+e,0)/Oe.length;e.simulate(a+Math.min(c,Me));const l=0===Ae?0:Te*(1e3/Ae);e.backlog>l&&e.simulate(a+Me-c),Oe.push(Date.now()-a),Oe.length>Te&&Oe.shift(),W.begin("update"),e.processModelViewEvents(),W.end("update"),n&&(W.begin("render"),e.inViewRealm(()=>n.update(t)),W.end("render"))}const Ne={};n.App=gt,n.Constants=Ne,n.Data=se,n.Model=Gt,n.Session=Ee,n.View=ne,n.gatherInternalClassTypes=function(t,e){const n={};return function t(e,n="",r={},i=new Set){const o=Object.values(e).filter(t=>{const e=Object.prototype.toString.call(t).slice(8,-1);return("Object"===e||"Array"===e)&&!i.has(t)});for(const t of o){i.add(t);const e=n+"."+t.constructor.name;if(r[e]){if(r[e]!==t.constructor)throw new Error("Class with name "+e+" already gathered, but new one has different identity")}else r[e]=t.constructor}for(const e of o)t(e,n,r,i)}({root:t},e,n,new Set),n},n.startSession=function(...t){return gt.showMessage("Croquet.startSession() is deprecated, please use Croquet.Session.join()",{level:"warning",only:"once"}),Ee.join(...t)}},{"fast-json-stable-stringify":"vwDV","toastify-js":"D2QR","seedrandom/seedrandom":"u80Q",fastpriorityqueue:"wmWq",pako:"KkFj"}],kAKX:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Actor=n.ActorManager=void 0;var r=t("@croquet/croquet");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function c(t,e,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){return function(){var e,n=p(t);if(f()){var r=p(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return d(this,e)}}function d(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=function(t){l(n,r.Model);var e=h(n);function n(){return o(this,n),e.apply(this,arguments)}return a(n,[{key:"init",value:function(){c(p(n.prototype),"init",this).call(this),this.beWellKnownAs("ActorManager"),this.actors=new Map}},{key:"add",value:function(t){this.actors.set(t.id,t)}},{key:"has",value:function(t){return this.actors.has(t)}},{key:"get",value:function(t){return this.actors.get(t)}},{key:"delete",value:function(t){this.actors.delete(t.id)}},{key:"destroyAll",value:function(){new Map(this.actors).forEach(function(t){return t.destroy()})}}]),n}();n.ActorManager=m,m.register("ActorManager");var g=function(t){l(n,r.Model);var e=h(n);function n(){return o(this,n),e.apply(this,arguments)}return a(n,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pawn";c(p(n.prototype),"init",this).call(this),this.pawnType=t,this.wellKnownModel("ActorManager").add(this),this.publish("actor","createActor",this)}},{key:"destroy",value:function(){this.doomed=!0,this.say("destroyActor"),this.wellKnownModel("ActorManager").delete(this),c(p(n.prototype),"destroy",this).call(this)}},{key:"say",value:function(t,e){this.publish(this.id,t,e)}},{key:"listen",value:function(t,e){this.subscribe(this.id,t,e)}}]),n}();n.Actor=g,g.register("Actor")},{"@croquet/croquet":"uCZq"}],UlnH:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ClearNamedViews=function(){h.clear()},n.GetNamedView=d,n.GetNamedModel=function(t){return d("ViewRoot").model.wellKnownModel(t)},n.NamedView=void 0;var r=t("@croquet/croquet");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=new Map;function d(t){return h.get(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(p,r.View);var e,n,i,d,f=(e=p,function(){var t,n=u(e);if(l()){var r=u(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return c(this,t)});function p(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),(e=f.call(this)).name=t,t?e.registerName():console.error("All named views must have public names!"),e}return n=p,(i=[{key:"registerName",value:function(){h.set(this.name,this)}},{key:"destroy",value:function(){this.detach()}},{key:"detach",value:function(){s(u(p.prototype),"detach",this).call(this),h.delete(this.name)}}])&&o(n.prototype,i),d&&o(n,d),p}();n.NamedView=f},{"@croquet/croquet":"uCZq"}],H7A5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PM_Dynamic=n.Pawn=n.PawnManager=void 0;var r=t("@croquet/croquet"),i=t("./NamedView");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){return function(){var e,n=g(t);if(m()){var r=g(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return f(this,e)}}function f(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=new Map,w=function(t){u(n,i.NamedView);var e=d(n);function n(){var t;return a(this,n),(t=e.call(this,"PawnManager")).pawns=new Map,t.dynamic=new Set,t.rebuild(),t.subscribe("actor",{event:"createActor",handling:"immediate"},t.spawnPawn),t}return l(n,[{key:"destroy",value:function(){new Map(this.pawns).forEach(function(t){return t.destroy()}),this.detach()}},{key:"rebuild",value:function(){var t=this;(0,i.GetNamedView)("ViewRoot").model.wellKnownModel("ActorManager").actors.forEach(function(e){return t.rebuildPawn(e)}),this.pawns.forEach(function(t){return t.link()})}},{key:"rebuildPawn",value:function(t){this.spawnPawn(t)}},{key:"spawnPawn",value:function(t){var e=y.get(t.pawnType);e?new e(t):console.log("Unknown pawn type!")}},{key:"add",value:function(t){this.pawns.set(t.actor.id,t)}},{key:"has",value:function(t){return this.pawns.has(t)}},{key:"get",value:function(t){return this.pawns.get(t)}},{key:"delete",value:function(t){this.pawns.delete(t.actor.id)}},{key:"addDynamic",value:function(t){this.dynamic.add(t)}},{key:"deleteDynamic",value:function(t){this.dynamic.delete(t)}},{key:"update",value:function(t){this.dynamic.forEach(function(e){return e.update(t)})}}]),n}();n.PawnManager=w;var v=function(t){u(n,r.View);var e=d(n);function n(t){var r;return a(this,n),(r=e.call(this)).actor=t,(0,i.GetNamedView)("PawnManager").add(p(r)),r.listen("destroyActor",r.destroy),r}return l(n,null,[{key:"register",value:function(t){y.set(t,this)}}]),l(n,[{key:"link",value:function(){}},{key:"refresh",value:function(){}},{key:"destroy",value:function(){(0,i.GetNamedView)("PawnManager").delete(this),this.detach()}},{key:"say",value:function(t,e){this.publish(this.actor.id,t,e)}},{key:"listen",value:function(t,e){this.subscribe(this.actor.id,t,e)}},{key:"listenOnce",value:function(t,e){this.subscribe(this.actor.id,{event:t,handling:"oncePerFrame"},e)}}]),n}();n.Pawn=v,v.register("Pawn");n.PM_Dynamic=function(t){return function(e){u(r,t);var n=d(r);function r(){var t;a(this,r);for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];return t=n.call.apply(n,[this].concat(o)),(0,i.GetNamedView)("PawnManager").addDynamic(p(t)),t}return l(r,[{key:"destroy",value:function(){(0,i.GetNamedView)("PawnManager").deleteDynamic(this),s(g(r.prototype),"destroy",this).call(this)}},{key:"update",value:function(t){}}]),r}()}},{"@croquet/croquet":"uCZq","./NamedView":"UlnH"}],NWvo:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GetViewTime=function(){return p},n.GetViewDelta=function(){return m},n.ViewRoot=void 0;var r=t("./NamedView"),i=t("./Pawn");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(y,r.NamedView);var e,n,o,d,g=(e=y,function(){var t,n=h(e);if(u()){var r=h(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return l(this,t)});function y(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),(0,r.ClearNamedViews)(),e=g.call(this,"ViewRoot"),console.log("Starting view ..."),e.model=t,e.managers=new Set,e.createManagers(),e}return n=y,(o=[{key:"createManagers",value:function(){this.pawnManager=this.addManager(new i.PawnManager)}},{key:"detach",value:function(){this.managers.forEach(function(t){return t.destroy()}),(0,r.ClearNamedViews)(),a(h(y.prototype),"detach",this).call(this)}},{key:"addManager",value:function(t){return this.managers.add(t),t}},{key:"update",value:function(t){f=p,m=(p=t)-f,this.managers.forEach(function(e){e.update&&e.update(t)})}}])&&s(n.prototype,o),d&&s(n,d),y}();n.ViewRoot=d;var f=0,p=0,m=0},{"./NamedView":"UlnH","./Pawn":"H7A5"}],kStk:[function(t,e,n){"use strict";function r(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Object.defineProperty(n,"__esModule",{value:!0}),n.toRad=function(t){return t*o},n.toDeg=function(t){return t*s},n.gaussian=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=2*n*n,i=1/Math.sqrt(Math.PI*r),o=1/r,s=[i],a=1;a<t;a++){var c=e*a;s.push(i*Math.pow(Math.E,-o*c*c))}return s},n.rayTriangleIntersect=function(t,e,n){var r=n[0],i=n[1],o=n[2],s=b(i,r),a=b(o,r),c=k(e,a),l=_(s,c);if(l>-1e-5&&l<1e-5)return null;var u=1/l,h=b(t,r),d=u*_(h,c);if(d<0||d>1)return null;var f=k(h,s),p=u*_(e,f);if(p<0||d+p>1)return null;var m=u*_(a,f);return m<1e-5||m>1/1e-5?null:v(t,g(e,m))},n.sphericalRandom=function(){var t=Math.random(),e=Math.random(),n=2*Math.sqrt(t-t*t),r=a*e;return[n*Math.cos(r),n*Math.sin(r),1-2*t]},n.v2_zero=function(){return[0,0]},n.v2_unit=function(){return[1,0]},n.v2_random=function(){var t=2*Math.random()*Math.PI;return[Math.cos(t),Math.sin(t)]},n.v2_magnitude=c,n.v2_sqrMag=function(t){return t[0]*t[0]+t[1]*t[1]},n.v2_normalize=l,n.v2_ceil=function(t){return[Math.ceil(t[0]),Math.v3_ceil(t[1])]},n.v2_floor=function(t){return[Math.floor(t[0]),Math.floor(t[1])]},n.v2_inverse=function(t){return[1/t[0],1/t[1]]},n.v2_scale=function(t,e){return[t[0]*e,t[1]*e]},n.v2_multiply=function(t,e){return[t[0]*e[0],t[1]*e[1]]},n.v2_rotate=function(t,e,n){var r=Math.sin(e),i=Math.cos(e);if(n){var o=h(t,n);return u(n,[i*o[0]-r*o[1],r*o[0]+i*o[1]])}return[i*t[0]-r*t[1],r*t[0]+i*t[1]]},n.v2_add=u,n.v2_sub=h,n.v2_dot=d,n.v2_min=function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1])]},n.v2_max=function(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1])]},n.v2_angle=function(t,e){return Math.acos(Math.min(1,Math.max(-1,d(l(t),l(e)))))},n.v2_lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]},n.v2_equals=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n?n>Math.abs(t[0]-e[0])&&n>Math.abs(t[1]-e[1]):t[0]===e[0]&&t[1]===e[1]},n.v2_transform=function(t,e){var n=t[0],r=t[1];return[e[0]*n+e[2]*r,e[1]*n+e[3]*r]},n.v3_zero=function(){return[0,0,0]},n.v3_unit=f,n.v3_random=function(){var t=2*Math.random()*Math.PI,e=Math.acos(2*Math.random()-1);return w(y([1,1,1],e),t)},n.v3_magnitude=p,n.v3_sqrMag=function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},n.v3_normalize=m,n.v3_inverse=function(t){return[1/t[0],1/t[1],1/t[2]]},n.v3_ceil=function(t){return[Math.ceil(t[0]),Math.v3_ceil(t[1]),Math.v3_ceil(t[2])]},n.v3_floor=function(t){return[Math.floor(t[0]),Math.floor(t[1]),Math.floor(t[2])]},n.v3_scale=g,n.v3_opposite=function(t){return[-1*t[0],-1*t[1],-1*t[2]]},n.v3_multiply=function(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2]]},n.v3_divide=function(t,e){return[t[0]/e[0],t[1]/e[1],t[2]/e[2]]},n.v3_rotateX=function(t,e){var n=Math.sin(e),r=Math.cos(e);return[t[0],r*t[1]-n*t[2],n*t[1]+r*t[2]]},n.v3_rotateY=y,n.v3_rotateZ=w,n.v3_add=v,n.v3_sub=b,n.v3_dot=_,n.v3_cross=k,n.v3_min=function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.min(t[2],e[2])]},n.v3_max=function(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1]),Math.max(t[2],e[2])]},n.v3_manhattan=function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])+Math.abs(t[2]-e[2])},n.v3_angle=function(t,e){return Math.acos(Math.min(1,Math.max(-1,_(m(t),m(e)))))},n.v3_lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n,t[2]+(e[2]-t[2])*n]},n.v3_transform=function(t,e){var n=t[0],r=t[1],i=t[2],o=e[3]*n+e[7]*r+e[11]*i+e[15];return[(e[0]*n+e[4]*r+e[8]*i+e[12])/o,(e[1]*n+e[5]*r+e[9]*i+e[13])/o,(e[2]*n+e[6]*r+e[10]*i+e[14])/o]},n.v3_equals=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n?n>Math.abs(t[0]-e[0])&&n>Math.abs(t[1]-e[1])&&n>Math.abs(t[2]-e[2]):t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},n.v3_isZero=function(t){return!(t[0]||t[1]||t[2])},n.v4_zero=function(){return[0,0,0,0]},n.v4_unit=function(){return[1,0,0,0]},n.v4_magnitude=S,n.v4_sqrMag=function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},n.v4_normalize=function(t){var e=1/S(t);return[t[0]*e,t[1]*e,t[2]*e,t[3]*e]},n.v4_inverse=function(t){return[1/t[0],1/t[1],1/t[2],1/t[3]]},n.v4_ceil=function(t){return[Math.ceil(t[0]),Math.v3_ceil(t[1]),Math.v3_ceil(t[2]),Math.v3_ceil(t[3])]},n.v4_floor=function(t){return[Math.floor(t[0]),Math.floor(t[1]),Math.floor(t[2]),Math.floor(t[3])]},n.v4_scale=function(t,e){return[t[0]*e,t[1]*e,t[2]*e,t[3]*e]},n.v4_multiply=function(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3]]},n.v4_add=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3]]},n.v4_sub=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3]]},n.v4_dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.v4_min=function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.min(t[2],e[2]),Math.min(t[3],e[3])]},n.v4_max=function(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1]),Math.max(t[2],e[2]),Math.max(t[3],e[3])]},n.v4_transform=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3];return[e[0]*n+e[4]*r+e[8]*i+e[12]*o,e[1]*n+e[5]*r+e[9]*i+e[13]*o,e[2]*n+e[6]*r+e[10]*i+e[14]*o,e[3]*n+e[7]*r+e[11]*i+e[15]*o]},n.v4_equals=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n?n>Math.abs(t[0]-e[0])&&n>Math.abs(t[1]-e[1])&&n>Math.abs(t[2]-e[2])&&n>Math.abs(t[3]-e[3]):t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.m2_zero=function(){return[0,0,0,0]},n.m2_identity=function(){return[1,0,0,1]},n.m2_rotation=function(t){var e=Math.sin(t),n=Math.cos(t);return[n,-e,e,n]},n.m3_zero=function(){return[0,0,0,0,0,0,0,0,0]},n.m3_identity=function(){return[1,0,0,0,1,0,0,0,1]},n.m3_transpose=function(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]},n.m3_invert=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=o*l-c*s,h=i*l-a*s,d=i*c-a*o,f=e*u+n*-h+r*d;return[u/f,-(n*l-c*r)/f,(n*s-o*r)/f,-h/f,(e*l-a*r)/f,-(e*s-i*r)/f,d/f,-(e*c-a*n)/f,(e*o-i*n)/f]},n.m3_multiply=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=e[0],d=e[1],f=e[2],p=e[3],m=e[4],g=e[5],y=e[6],w=e[7],v=e[8];return[h*n+d*o+f*c,h*r+d*s+f*l,h*i+d*a+f*u,p*n+m*o+g*c,p*r+m*s+g*l,p*i+m*a+g*u,y*n+w*o+v*c,y*r+w*s+v*l,y*i+w*a+v*u]},n.m4_zero=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},n.m4_identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},n.m4_translation=function(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1]},n.m4_getTranslation=function(t){return[t[12],t[13],t[14]]},n.m4_scaling=function(t){if(t instanceof Array)return[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1];return[t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1]},n.m4_rotation=function(t,e){var n=m(t),r=Math.sin(e),i=Math.cos(e),o=1-i;return[n[0]*n[0]*o+i,n[1]*n[0]*o+n[2]*r,n[2]*n[0]*o-n[1]*r,0,n[0]*n[1]*o-n[2]*r,n[1]*n[1]*o+i,n[2]*n[1]*o+n[0]*r,0,n[0]*n[2]*o+n[1]*r,n[1]*n[2]*o-n[0]*r,n[2]*n[2]*o+i,0,0,0,0,1]},n.m4_rotationX=function(t){var e=Math.sin(t),n=Math.cos(t);return[1,0,0,0,0,n,e,0,0,-e,n,0,0,0,0,1]},n.m4_rotationY=function(t){var e=Math.sin(t),n=Math.cos(t);return[n,0,-e,0,0,1,0,0,e,0,n,0,0,0,0,1]},n.m4_rotationZ=function(t){var e=Math.sin(t),n=Math.cos(t);return[n,e,0,0,-e,n,0,0,0,0,1,0,0,0,0,1]},n.m4_rotationQ=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=e+e,s=n+n,a=r+r,c=e*o,l=n*o,u=n*s,h=r*o,d=r*s,f=r*a,p=i*o,m=i*s,g=i*a;return[1-u-f,l+g,h-m,0,l-g,1-c-f,d+p,0,h+m,d-p,1-c-u,0,0,0,0,1]},n.m4_scalingRotationTranslation=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=r+r,c=i+i,l=o+o,u=r*a,h=r*c,d=r*l,f=i*c,p=i*l,m=o*l,g=s*a,y=s*c,w=s*l,v=1,b=1,_=1;t instanceof Array?(v=t[0],b=t[1],_=t[2]):(v=t,b=t,_=t);return[(1-(f+m))*v,(h+w)*v,(d-y)*v,0,(h-w)*b,(1-(u+m))*b,(p+g)*b,0,(d+y)*_,(p-g)*_,(1-(u+f))*_,0,n[0],n[1],n[2],1]},n.m4_perspective=function(t,e,n,r){var i=1/Math.tan(t/2),o=1/(n-r);return[i/e,0,0,0,0,i,0,0,0,0,(r+n)*o,-1,0,0,2*r*n*o,0]},n.m4_transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},n.m4_determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],d=t[11],f=t[12],p=t[13],m=t[14],g=t[15];return(e*s-n*o)*(h*g-d*m)-(e*a-r*o)*(u*g-d*p)+(e*c-i*o)*(u*m-h*p)+(n*a-r*s)*(l*g-d*f)-(n*c-i*s)*(l*m-h*f)+(r*c-i*a)*(l*p-u*f)},n.m4_invert=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],d=t[11],f=t[12],p=t[13],m=t[14],g=t[15],y=e*s-n*o,w=e*a-r*o,v=e*c-i*o,b=n*a-r*s,_=n*c-i*s,k=r*c-i*a,S=l*p-u*f,x=l*m-h*f,C=l*g-d*f,E=u*m-h*p,M=u*g-d*p,O=h*g-d*m,T=y*O-w*M+v*E+b*C-_*x+k*S;return[(s*O-a*M+c*E)/T,(r*M-n*O-i*E)/T,(p*k-m*_+g*b)/T,(h*_-u*k-d*b)/T,(a*C-o*O-c*x)/T,(e*O-r*C+i*x)/T,(m*v-f*k-g*w)/T,(l*k-h*v+d*w)/T,(o*M-s*C+c*S)/T,(n*C-e*M-i*S)/T,(f*_-p*v+g*y)/T,(u*v-l*_-d*y)/T,(s*x-o*E-a*S)/T,(e*E-n*x+r*S)/T,(p*w-f*b-m*y)/T,(l*b-u*w+h*y)/T]},n.m4_multiply=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15],w=e[0],v=e[1],b=e[2],_=e[3],k=e[4],S=e[5],x=e[6],C=e[7],E=e[8],M=e[9],O=e[10],T=e[11],$=e[12],A=e[13],P=e[14],N=e[15];return[n*w+r*k+i*E+o*$,n*v+r*S+i*M+o*A,n*b+r*x+i*O+o*P,n*_+r*C+i*T+o*N,s*w+a*k+c*E+l*$,s*v+a*S+c*M+l*A,s*b+a*x+c*O+l*P,s*_+a*C+c*T+l*N,u*w+h*k+d*E+f*$,u*v+h*S+d*M+f*A,u*b+h*x+d*O+f*P,u*_+h*C+d*T+f*N,p*w+m*k+g*E+y*$,p*v+m*S+g*M+y*A,p*b+m*x+g*O+y*P,p*_+m*C+g*T+y*N]},n.m4_toNormal4=function(t){var e=t[0],n=t[1],r=t[2],i=t[4],o=t[5],s=t[6],a=t[8],c=t[9],l=t[10],u=o*l-c*s,h=i*l-a*s,d=i*c-a*o,f=e*u+n*-h+r*d;return[u/f,-h/f,d/f,0,-(n*l-c*r)/f,(e*l-a*r)/f,-(e*c-a*n)/f,0,(n*s-o*r)/f,-(e*s-i*r)/f,(e*o-i*n)/f,0,0,0,0,1]},n.m4_toNormal3=function(t){var e=t[0],n=t[1],r=t[2],i=t[4],o=t[5],s=t[6],a=t[8],c=t[9],l=t[10],u=o*l-c*s,h=i*l-a*s,d=i*c-a*o,f=e*u+n*-h+r*d;return[u/f,-h/f,d/f,-(n*l-c*r)/f,(e*l-a*r)/f,-(e*c-a*n)/f,(n*s-o*r)/f,-(e*s-i*r)/f,(e*o-i*n)/f]},n.m4_grounded=function(t){var e=[0,1,0],n=[t[0],t[1],t[2]],r=k(n,e);return r[1]=0,r=m(r),(n=k(e,r))[1]=0,[(n=m(n))[0],n[1],n[2],0,0,1,0,0,r[0],r[1],r[2],0,0,0,0,1]},n.m4_fastGrounded=function(t){var e=m([t[0],0,t[2]]),n=m([t[8],0,t[10]]);return[e[0],e[1],e[2],0,0,1,0,0,n[0],n[1],n[2],0,0,0,0,1]},n.q_identity=function(){return[0,0,0,1]},n.q_magnitude=x,n.q_normalize=function(t){var e=1/x(t);return[t[0]*e,t[1]*e,t[2]*e,t[3]*e]},n.q_conjugate=function(t){return[-t[0],-t[1],-t[2],t[3]]},n.q_axisAngle=C,n.q_scale=function(t,e){return[t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*e]},n.q_add=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3]]},n.q_dot=E,n.q_multiply=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=e[0],a=e[1],c=e[2],l=e[3];return[s*o+a*i-c*r+l*n,a*o-s*i+l*r+c*n,c*o+l*i+s*r-a*n,l*o-c*i-a*r-s*n]},n.q_slerp=function(t,e,n){var r,i,o,s,a,c=t[0],l=t[1],u=t[2],h=t[3],d=e[0],f=e[1],p=e[2],m=e[3];(i=c*d+l*f+u*p+h*m)<0&&(i=-i,d=-d,f=-f,p=-p,m=-m);1-i>1e-5?(r=Math.acos(i),o=Math.sin(r),s=Math.sin((1-n)*r)/o,a=Math.sin(n*r)/o):(s=1-n,a=n);return[s*c+a*d,s*l+a*f,s*u+a*p,s*h+a*m]},n.q_equals=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return Math.abs(E(t,e))+n>=1},n.q_isZero=function(t){return!(t[0]||t[1]||t[2])},n.q2_identity=function(){return[0,0,0,1,0,0,0,0]},n.q2_magnitude=M,n.q2_rotation=O,n.q2_translation=function(t){return[0,0,0,1].concat(r(g(t,.5)),[0])},n.q2_axisAngle=function(t,e){return O(C(t,e))},n.q2_rotationTranslation=T,n.q2_axisAngleTranslation=function(t,e,n){return T(C(t,e),n)},n.q2_normalize=function(t){var e=1/M(t),n=t[0]*e,r=t[1]*e,i=t[2]*e,o=t[3]*e,s=t[4],a=t[5],c=t[6],l=t[7],u=n*s+r*a+i*c+o*l;return[n,r,i,o,(s-n*u)*e,(a-r*u)*e,(c-i*u)*e,(l-o*u)*e]},n.q2_multiply=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=e[0],h=e[1],d=e[2],f=e[3],p=e[4],m=e[5],g=e[6],y=e[7];return[u*o+f*n+h*i-d*r,h*o+f*r+d*n-u*i,d*o+f*i+u*r-h*n,f*o-u*n-h*r-d*i,u*l+f*s+h*c-d*a+p*o+y*n+m*i-g*r,h*l+f*a+d*s-u*c+m*o+y*r+g*n-p*i,d*l+f*c+u*a-h*s+g*o+y*i+p*r-m*n,f*l-u*s-h*a-d*c+y*o-p*n-m*r-g*i]},n.TAU=n.TO_DEG=n.TO_RAD=void 0;var o=Math.PI/180;n.TO_RAD=o;var s=1/o;n.TO_DEG=s;var a=2*Math.PI;function c(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function l(t){var e=1/c(t);return[t[0]*e,t[1]*e]}function u(t,e){return[t[0]+e[0],t[1]+e[1]]}function h(t,e){return[t[0]-e[0],t[1]-e[1]]}function d(t,e){return t[0]*e[0]+t[1]*e[1]}function f(){return[1,1,1]}function p(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function m(t){var e=1/p(t);return[t[0]*e,t[1]*e,t[2]*e]}function g(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function y(t,e){var n=Math.sin(e),r=Math.cos(e);return[n*t[2]+r*t[0],t[1],r*t[2]-n*t[0]]}function w(t,e){var n=Math.sin(e),r=Math.cos(e);return[r*t[0]-n*t[1],n*t[0]+r*t[1],t[2]]}function v(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}function b(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function _(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function k(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2];return[r*a-i*s,i*o-n*a,n*s-r*o]}function S(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function x(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function C(t,e){var n=.5*e,r=Math.sin(n),i=Math.cos(n);return[r*t[0],r*t[1],r*t[2],i]}function E(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function M(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function O(t){return[].concat(r(t),[0,0,0,0])}function T(t,e){var n=.5*e[0],r=.5*e[1],i=.5*e[2],o=t[0],s=t[1],a=t[2],c=t[3];return[o,s,a,c,n*c+r*a-i*s,r*c+i*o-n*a,i*c+n*s-r*o,-n*o-r*s-i*a]}n.TAU=a},{}],cgNl:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PM_MouseLook=n.AM_MouseLook=n.PM_Avatar=n.AM_Avatar=n.PM_Smoothed=n.AM_Smoothed=n.PM_Spatial=n.AM_Spatial=n.PM_Tree=n.AM_Tree=n.RegisterMixin=n.mix=void 0;var r=t("@croquet/croquet"),i=t("./NamedView"),o=t("./Pawn"),s=t("./ViewRoot"),a=t("./Vector");function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){return function(){var e,n=m(t);if(p()){var r=m(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return f(this,e)}}function f(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e,n){return e&&y(t.prototype,e),n&&y(t,n),t}r.Constants.WC_MIXIN_REGISTRY=[],r.Constants.WC_MIXIN_USAGE=[];n.mix=function(t){return new b(t)};var v=function(t){return r.Constants.WC_MIXIN_REGISTRY.push(t)};n.RegisterMixin=v;var b=function(){function t(e){g(this,t),this.superclass=e}return w(t,[{key:"with",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.Constants.WC_MIXIN_USAGE.push(e),e.reduce(function(t,e){return e(t)},this.superclass)}}]),t}(),_=function(t){return function(e){u(r,t);var n=d(r);function r(){return g(this,r),n.apply(this,arguments)}return w(r,[{key:"destroy",value:function(){this.parent&&this.parent.removeChild(this),this.children&&this.children.forEach(function(t){return t.destroy()}),l(m(r.prototype),"destroy",this).call(this)}},{key:"addChild",value:function(t){t.parent&&t.parent.removeChild(t),this.children||(this.children=new Set),this.children.add(t),t.parent=this,this.say("tree_addChild",t.id)}},{key:"removeChild",value:function(t){this.children&&this.children.delete(t),t.parent=null,this.say("tree_removeChild",t.id)}}]),r}()};n.AM_Tree=_,v(_);var k=function(t){return function(e){u(r,t);var n=d(r);function r(){var t;g(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).listen("tree_addChild",t.onAddChild),t.listen("tree_removeChild",t.onRemoveChild),t}return w(r,[{key:"link",value:function(){var t=this;l(m(r.prototype),"link",this).call(this),this.actor.children&&this.actor.children.forEach(function(e){return t.onAddChild(e.id)})}},{key:"onAddChild",value:function(t){var e=(0,i.GetNamedView)("PawnManager").get(t);e&&(this.children||(this.children=new Set),this.children.add(e),e.parent=this)}},{key:"onRemoveChild",value:function(t){var e=(0,i.GetNamedView)("PawnManager").get(t);e&&(this.children&&this.children.delete(e),e.parent=null)}}]),r}()};n.PM_Tree=k;var S=function(t){return function(e){u(r,_(t));var n=d(r);function r(){return g(this,r),n.apply(this,arguments)}return w(r,[{key:"init",value:function(){var t;this.scale=(0,a.v3_unit)(),this.rotation=(0,a.q_identity)(),this.location=(0,a.v3_zero)();for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=l(m(r.prototype),"init",this)).call.apply(t,[this].concat(n))}},{key:"localChanged",value:function(){this.$local=null,this.say("spatial_localChanged"),this.globalChanged()}},{key:"globalChanged",value:function(){this.$global=null,this.say("spatial_globalChanged"),this.children&&this.children.forEach(function(t){return t.globalChanged()})}},{key:"setScale",value:function(t){this.scale=t,this.say("spatial_setScale",t),this.localChanged()}},{key:"setRotation",value:function(t){this.rotation=t,this.say("spatial_setRotation",t),this.localChanged()}},{key:"setLocation",value:function(t){this.location=t,this.say("spatial_setLocation",t),this.localChanged()}},{key:"local",get:function(){return this.$local||(this.$local=(0,a.m4_scalingRotationTranslation)(this.scale,this.rotation,this.location)),this.$local}},{key:"global",get:function(){return this.$global?this.$global:(this.parent?this.$global=(0,a.m4_multiply)(this.local,this.parent.global):this.$global=this.local,this.$global)}}]),r}()};n.AM_Spatial=S,v(S);var x=function(t){return function(e){u(r,k(t));var n=d(r);function r(){var t;g(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).listenOnce("spatial_localChanged",function(){return t.localChanged()}),t.listenOnce("spatial_globalChanged",function(){return t.globalChanged()}),t}return w(r,[{key:"localChanged",value:function(){}},{key:"globalChanged",value:function(){this.refresh()}},{key:"scale",get:function(){return this.actor.scale}},{key:"location",get:function(){return this.actor.location}},{key:"rotation",get:function(){return this.actor.rotation}},{key:"local",get:function(){return this.actor.local}},{key:"global",get:function(){return this.actor.global}}]),r}()};n.PM_Spatial=x;var C=function(t){return function(e){u(r,S(t));var n=d(r);function r(){return g(this,r),n.apply(this,arguments)}return w(r,[{key:"moveTo",value:function(t){this.location=t,this.say("smoothed_moveTo",t)}},{key:"rotateTo",value:function(t){this.rotation=t,this.say("smoothed_rotateTo",t)}},{key:"scaleTo",value:function(t){this.scale=t,this.say("smoothed_scaleTo",t)}}]),r}()};n.AM_Smoothed=C,v(C);var E=function(t){return(0,o.PM_Dynamic)(x(t))},M=function(t){return function(e){u(r,E(t));var n=d(r);function r(){var t;g(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i)))._scale=t.actor.scale,t._rotation=t.actor.rotation,t._location=t.actor.location,t.tug=.2,t.scaleEpsilon=1e-4,t.rotationEpsilon=1e-6,t.locationEpsilon=1e-4,t.listenOnce("spatial_setScale",function(e){return t._scale=e}),t.listenOnce("spatial_setRotation",function(e){return t._rotation=e}),t.listenOnce("spatial_setLocation",function(e){return t._location=e}),t.listenOnce("smoothed_moveTo",function(){return t.isMoving=!0}),t.listenOnce("smoothed_rotateTo",function(){return t.isRotating=!0}),t.listenOnce("smoothed_scaleTo",function(){return t.isScaling=!0}),t}return w(r,[{key:"localChanged",value:function(){this._local=null,this.globalChanged()}},{key:"globalChanged",value:function(){this._global=null,this.needRefresh=!0,this.children&&this.children.forEach(function(t){return t.globalChanged()})}},{key:"update",value:function(t){l(m(r.prototype),"update",this).call(this,t);var e=this.tug;this.delta&&(e=Math.min(1,e*this.delta/15));var n=this.isMoving||this.isRotating||this.isScaling;this.isScaling&&(this._scale=(0,a.v3_lerp)(this._scale,this.actor.scale,e),this.isScaling=!(0,a.v3_equals)(this._scale,this.actor.scale,this.scaleEpsilon)),this.isRotating&&(this._rotation=(0,a.q_slerp)(this._rotation,this.actor.rotation,e),this.isRotating=!(0,a.q_equals)(this._rotation,this.actor.rotation,this.rotationEpsilon)),this.isMoving&&(this._location=(0,a.v3_lerp)(this._location,this.actor.location,e),this.isMoving=!(0,a.v3_equals)(this._location,this.actor.location,this.locationEpsilon)),n&&this.localChanged(),this.needRefresh&&this.refresh(),this.needRefresh=!1}},{key:"scale",get:function(){return this._scale}},{key:"location",get:function(){return this._location}},{key:"rotation",get:function(){return this._rotation}},{key:"local",get:function(){return this._local||(this._local=(0,a.m4_scalingRotationTranslation)(this._scale,this._rotation,this._location)),this._local}},{key:"global",get:function(){return this._global?this._global:(this.parent?this._global=(0,a.m4_multiply)(this.local,this.parent.global):this._global=this.local,this._global)}}]),r}()};n.PM_Smoothed=M;var O=function(t){return function(e){u(r,C(t));var n=d(r);function r(){return g(this,r),n.apply(this,arguments)}return w(r,[{key:"init",value:function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=l(m(r.prototype),"init",this)).call.apply(t,[this].concat(n)),this.avatar_tickStep=15,this.velocity=(0,a.v3_zero)(),this.spin=(0,a.q_identity)(),this.listen("avatar_moveTo",this.onMoveTo),this.listen("avatar_rotateTo",this.onRotateTo),this.listen("avatar_setVelocity",this.onSetVelocity),this.listen("avatar_setSpin",this.onSetSpin),this.future(0).tick(0)}},{key:"onMoveTo",value:function(t){this.moveTo(t)}},{key:"onRotateTo",value:function(t){this.rotateTo(t)}},{key:"onSetVelocity",value:function(t){this.velocity=t,this.isMoving=!(0,a.v3_isZero)(this.velocity)}},{key:"onSetSpin",value:function(t){this.spin=t,this.isRotating=!(0,a.q_isZero)(this.spin)}},{key:"tick",value:function(t){if(this.isRotating&&this.rotateTo((0,a.q_normalize)((0,a.q_slerp)(this.rotation,(0,a.q_multiply)(this.rotation,this.spin),t))),this.isMoving){var e=this.location;this.moveTo(this.verify((0,a.v3_add)(this.location,(0,a.v3_scale)(this.velocity,t)),e))}this.doomed||this.future(this.avatar_tickStep).tick(this.avatar_tickStep)}},{key:"verify",value:function(t,e){return t}}]),r}()};n.AM_Avatar=O,v(O);n.PM_Avatar=function(t){return function(e){u(r,M(t));var n=d(r);function r(){var t;g(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).tug=.05,t.velocity=(0,a.v3_zero)(),t.spin=(0,a.q_identity)(),t}return w(r,[{key:"moveTo",value:function(t){this._location=t,this.say("avatar_moveTo",t)}},{key:"rotateTo",value:function(t){this._rotation=t,this.say("avatar_rotateTo",t)}},{key:"setVelocity",value:function(t){this.velocity=t,this.isMoving=this.isMoving||!(0,a.v3_isZero)(this.velocity),this.say("avatar_setVelocity",this.velocity)}},{key:"setSpin",value:function(t){this.spin=t,this.isRotating=this.isRotating||!(0,a.q_isZero)(this.spin),this.say("avatar_setSpin",this.spin)}},{key:"update",value:function(t){if(this.isRotating&&(this._rotation=(0,a.q_normalize)((0,a.q_slerp)(this._rotation,(0,a.q_multiply)(this._rotation,this.spin),(0,s.GetViewDelta)()))),this.isMoving){var e=this._location;this._location=this.verify((0,a.v3_add)(this._location,(0,a.v3_scale)(this.velocity,(0,s.GetViewDelta)())),e)}l(m(r.prototype),"update",this).call(this,t)}},{key:"verify",value:function(t,e){return t}}]),r}()};var T=function(t){return function(e){u(r,C(t));var n=d(r);function r(){return g(this,r),n.apply(this,arguments)}return w(r,[{key:"init",value:function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=l(m(r.prototype),"init",this)).call.apply(t,[this].concat(n)),this.mouseLook_tickStep=15,this.speed=0,this.strafeSpeed=0,this.multiplySpeed=1,this.spin=(0,a.q_identity)(),this.grounded=!0,this.listen("mouseLook_moveTo",this.onMoveTo),this.listen("mouseLook_rotateTo",this.onRotateTo),this.listen("mouseLook_setSpeed",this.onSetSpeed),this.listen("mouseLook_setStrafeSpeed",this.onSetStrafeSpeed),this.listen("mouseLook_setMultiplySpeed",this.onSetMultiplySpeed),this.listen("mouseLook_setSpin",this.onSetSpin),this.listen("mouseLook_showState",this.onShowState),this.tickCounter=0,this.movingCounter=0,this.checkSum=0,this.future(0).tick(0)}},{key:"onMoveTo",value:function(t){this.moveTo(t)}},{key:"onRotateTo",value:function(t){this.rotateTo(t)}},{key:"onSetSpeed",value:function(t){this.speed=t,this.isMoving=0!==t||0!==this.strafeSpeed}},{key:"onSetStrafeSpeed",value:function(t){this.strafeSpeed=t,this.isMoving=0!==t||0!==this.speed}},{key:"onSetMultiplySpeed",value:function(t){this.multiplySpeed=t}},{key:"onSetSpin",value:function(t){this.spin=t,this.isRotating=!(0,a.q_isZero)(this.spin)}},{key:"onShowState",value:function(){console.log("--AM_MouseLook State--"),console.log("AM_MouseLook: ",this),console.log("location: ",this.location),console.log("rotation: ",this.rotation),console.log("checkSum: ",this.checkSum)}},{key:"setGrounded",value:function(t){this.grounded=t}},{key:"tick",value:function(t){if(this.isRotating&&this.rotateTo((0,a.q_normalize)((0,a.q_slerp)(this.rotation,(0,a.q_multiply)(this.rotation,this.spin),t))),this.isMoving){var e=(0,a.m4_rotationQ)(this.rotation);this.grounded&&(e=(0,a.m4_fastGrounded)(e));var n=this.location,r=this.location;this.speed&&(r=(0,a.v3_add)(r,(0,a.v3_scale)([e[8],e[9],e[10]],t*this.speed*this.multiplySpeed))),this.strafeSpeed&&(r=(0,a.v3_add)(r,(0,a.v3_scale)([e[0],e[1],e[2]],t*this.strafeSpeed*this.multiplySpeed))),this.moveTo(this.verify(r,n))}this.doomed||this.future(this.mouseLook_tickStep).tick(this.mouseLook_tickStep)}},{key:"verify",value:function(t,e){return t}}]),r}()};n.AM_MouseLook=T,v(T);n.PM_MouseLook=function(t){return function(e){u(r,M(t));var n=d(r);function r(){var t;g(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).tug=.05,t.speed=0,t.strafeSpeed=0,t.multiplySpeed=1,t.spin=(0,a.q_identity)(),t.grounded=!0,t}return w(r,[{key:"moveTo",value:function(t){this._location=t,this.say("mouseLook_moveTo",t)}},{key:"rotateTo",value:function(t){this._rotation=t,this.say("mouseLook_rotateTo",t)}},{key:"setSpeed",value:function(t){this.speed=t,this.isMoving=this.isMoving||0!=t,this.say("mouseLook_setSpeed",t)}},{key:"setStrafeSpeed",value:function(t){this.strafeSpeed=t,this.isMoving=this.isMoving||0!=t,this.say("mouseLook_setStrafeSpeed",t)}},{key:"setMultiplySpeed",value:function(t){this.multiplySpeed=t,this.say("mouseLook_setMultiplySpeed",t)}},{key:"setSpin",value:function(t){this.spin=t,this.isRotating=this.isRotating||!(0,a.q_isZero)(this.spin),this.say("mouseLook_setSpin",this.spin)}},{key:"showState",value:function(){console.log("--PM_MouseLook State--"),console.log("PM_MouseLook: ",this),console.log("location: ",this._location),console.log("rotation: ",this._rotation),this.say("mouseLook_showState")}},{key:"update",value:function(t){if(this.isRotating&&(this._rotation=(0,a.q_normalize)((0,a.q_slerp)(this._rotation,(0,a.q_multiply)(this._rotation,this.spin),(0,s.GetViewDelta)()))),this.isMoving){var e=this._location,n=(0,a.m4_rotationQ)(this._rotation);this.grounded&&(n=(0,a.m4_fastGrounded)(n)),this.speed&&(this._location=(0,a.v3_add)(this._location,(0,a.v3_scale)([n[8],n[9],n[10]],(0,s.GetViewDelta)()*this.speed*this.multiplySpeed))),this.strafeSpeed&&(this._location=(0,a.v3_add)(this._location,(0,a.v3_scale)([n[0],n[1],n[2]],(0,s.GetViewDelta)()*this.strafeSpeed*this.multiplySpeed))),this._location=this.verify(this._location,e)}l(m(r.prototype),"update",this).call(this,t)}},{key:"verify",value:function(t,e){return t}}]),r}()}},{"@croquet/croquet":"uCZq","./NamedView":"UlnH","./Pawn":"H7A5","./ViewRoot":"NWvo","./Vector":"kStk"}],yOdO:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ModelRoot=void 0;var r=t("@croquet/croquet"),i=t("./Actor");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(p,r.Model);var e,n,o,d,f=(e=p,function(){var t,n=h(e);if(u()){var r=h(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return l(this,t)});function p(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),f.apply(this,arguments)}return n=p,(o=[{key:"init",value:function(){a(h(p.prototype),"init",this).call(this),console.log("Starting model ..."),this.managers=new Set,this.actorManager=this.addManager(i.ActorManager.create())}},{key:"destroy",value:function(){a(h(p.prototype),"destroy",this).call(this),this.managers.forEach(function(t){return t.destroy()})}},{key:"addManager",value:function(t){return this.managers.add(t),t}}])&&s(n.prototype,o),d&&s(n,d),p}();n.ModelRoot=d,d.register("ModelRoot")},{"@croquet/croquet":"uCZq","./Actor":"kAKX"}],Txgd:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.KeyDown=p,n.ChordDown=m,n.WebInputManager=void 0;var r=t("./Vector"),i=t("./NamedView");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=new Set;function p(t){return f.has(t)}function m(t){var e=!0;return t.forEach(function(t){e&=p(t)}),e}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(y,i.NamedView);var e,n,o,a,g=(e=y,function(){var t,n=d(e);if(h()){var r=d(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return u(this,t)});function y(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),(t=g.call(this,"Input")).listeners=[],t.touches=[],t.chords=new Map,t.addListener(document,"contextmenu",function(t){return t.preventDefault()}),t.addListener(window,"resize",function(e){return t.onResize(e)}),"ontouchstart"in document.documentElement&&(t.addListener(document,"touchstart",function(e){return t.onTouchStart(e)}),t.addListener(document,"touchend",function(e){return t.onTouchEnd(e)}),t.addListener(document,"touchmove",function(e){return t.onTouchMove(e)}),t.addListener(document,"touchcancel",function(e){return t.onTouchCancel(e)})),"onmousedown"in document.documentElement&&(t.addListener(document,"click",function(e){return t.onClick(e)}),t.addListener(document,"mousedown",function(e){return t.onMouseDown(e)}),t.addListener(document,"mouseup",function(e){return t.onMouseUp(e)}),t.addListener(document,"mousemove",function(e){return t.onMouseMove(e)}),t.addListener(document,"pointerlockchange",function(e){return t.onPointerLock(e)}),t.addListener(document,"wheel",function(e){return t.onWheel(e)})),"onkeydown"in document.documentElement&&(t.addListener(document,"keydown",function(e){return t.onKeyDown(e)}),t.addListener(document,"keyup",function(e){return t.onKeyUp(e)})),t}return n=y,(o=[{key:"destroy",value:function(){this.detach(),this.removeAllListeners()}},{key:"addListener",value:function(t,e,n){t.addEventListener(e,n,{passive:!1}),this.listeners.push({element:t,type:e,callback:n})}},{key:"removeListener",value:function(t){var e=this.listeners.filter(function(e){return e.type!==t});this.listeners.forEach(function(e){e.type===t&&e.element.removeEventListener(e.type,e.callback,{passive:!1})}),this.listeners=e}},{key:"removeAllListeners",value:function(){this.listeners.forEach(function(t){return t.element.removeEventListener(t.type,t.callback,{passive:!1})}),this.listeners=[]}},{key:"addChord",value:function(t,e){var n=this;e.forEach(function(r){return n.chords.set(r,{name:t,chord:e})})}},{key:"addTouch",value:function(t){this.getTouch(t.id)||this.touches.push(t)}},{key:"removeTouch",value:function(t){this.touches=this.touches.filter(function(e){return e.id!==t})}},{key:"getTouch",value:function(t){return this.touches.find(function(e){return e.id===t})}},{key:"onChordDown",value:function(t){if(this.chords.has(t)){var e=this.chords.get(t);m(e.chord)&&this.inPointerLock&&this.publish("input",e.name+"Down")}}},{key:"onChordUp",value:function(t){if(this.chords.has(t)){var e=this.chords.get(t);m(e.chord)&&this.inPointerLock&&this.publish("input",e.name+"Up")}}},{key:"requestPointerLock",value:function(){return!this.inPointerLock&&(document.requestPointerLock=document.requestPointerLock||document.mozRequestPointerLock,document.documentElement.requestPointerLock(),!0)}},{key:"onClick",value:function(t){}},{key:"onPointerLock",value:function(t){this.inPointerLock?this.publish("input","pointerLockStart"):this.publish("input","pointerLockEnd")}},{key:"onResize",value:function(t){this.publish("input","beforeResize"),this.future(500).futureResize()}},{key:"futureResize",value:function(){this.publish("input","resize")}},{key:"onKeyDown",value:function(t){t.stopPropagation(),t.preventDefault();var e=t.key;p(e)||(f.add(e),this.publish("input",e+"Down"),this.publish("input","keyDown",e),this.onChordDown(e))}},{key:"onKeyUp",value:function(t){t.stopPropagation(),t.preventDefault();var e=t.key;p(e)&&(this.publish("input",e+"Up"),this.publish("input","keyUp",e),this.onChordUp(e),f.delete(e))}},{key:"onMouseDown",value:function(t){t.stopPropagation(),t.preventDefault();var e="mouse"+t.button;p("Control")&&"mouse0"===e&&(e="mouse2"),p(e)||(f.add(e),this.publish("input",e+"Down"),this.onChordDown(e))}},{key:"onMouseUp",value:function(t){t.stopPropagation(),t.preventDefault();var e="mouse"+t.button;p("Control")&&"mouse0"===e&&(e="mouse2"),p(e)&&(this.publish("input",e+"Up"),this.onChordUp(e),f.delete(e))}},{key:"onWheel",value:function(t){t.stopPropagation(),t.preventDefault();var e=t.deltaY;this.publish("input","wheel",e)}},{key:"onMouseMove",value:function(t){t.stopPropagation(),t.preventDefault();var e=t.clientX,n=t.clientY,r=t.movementX,i=t.movementY;this.publish("input","mouseXY",[e,n,r,i])}},{key:"onTouchStart",value:function(t){t.stopPropagation(),t.preventDefault();var e,n=s(t.changedTouches);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.identifier,a=i.clientX,c=i.clientY,l=t.timeStamp;this.addTouch({id:o,time:l,start:[a,c],current:[a,c]}),1===this.touchCount&&this.publish("input","touchDown",[a,c])}}catch(t){n.e(t)}finally{n.f()}if(!this.inDouble&&this.touchCount>1){this.inDouble=!0;var u=this.touches[0],h=this.touches[1];u.doubleStart=u.current,h.doubleStart=h.current;var d=(0,r.v2_scale)((0,r.v2_add)(u.doubleStart,h.doubleStart),.5);this.publish("input","doubleStart",d)}}},{key:"onTouchEnd",value:function(t){t.stopPropagation(),t.preventDefault();var e,n=s(t.changedTouches);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.identifier,a=this.getTouch(o);if(this.removeTouch(o),!this.touchCount&&a){var c=i.clientX,l=i.clientY,u=t.timeStamp-a.time,h=c-a.start[0],d=l-a.start[1],f=Math.abs(h),p=Math.abs(d);u<300&&f<10&&p<10&&this.publish("input","touchTap",[c,l]),u<300&&f>50&&this.publish("input","touchSwipeX",h),u<300&&p>50&&this.publish("input","touchSwipeY",d),this.publish("input","touchUp",[c,l])}}}catch(t){n.e(t)}finally{n.f()}if(this.inDouble)if(this.touchCount>1){var m=this.touches[0],g=this.touches[1];m.doubleStart=m.current,g.doubleStart=g.current;var y=(0,r.v2_scale)((0,r.v2_add)(m.doubleStart,g.doubleStart),.5);this.publish("input","doubleEnd"),this.publish("input","doubleStart",y)}else this.inDouble=!1,this.publish("input","doubleEnd")}},{key:"onTouchMove",value:function(t){t.stopPropagation(),t.preventDefault();var e,n=s(t.changedTouches);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.identifier,a=this.getTouch(o);if(a){var c=i.clientX,l=i.clientY;a.current=[c,l]}}}catch(t){n.e(t)}finally{n.f()}if(1===this.touchCount){var u=this.touches[0],h=u.current[0]-u.start[0],d=u.current[1]-u.start[1];(Math.abs(h)>10||Math.abs(d)>10)&&this.publish("input","touchXY",u.current)}else if(this.touchCount>1){var f=this.touches[0],p=this.touches[1],m=(0,r.v2_scale)((0,r.v2_add)(f.current,p.current),.5),g=(0,r.v2_sub)(p.doubleStart,f.doubleStart),y=(0,r.v2_sub)(p.current,f.current),w=(0,r.v2_magnitude)(g),v=(0,r.v2_magnitude)(y),b=1;w>0&&(b=v/w);var _=Math.atan2(g[0],g[1]),k=(Math.atan2(y[0],y[1])-_+r.TAU)%r.TAU;k>Math.PI&&(k-=r.TAU),this.publish("input","doubleChanged",{xy:m,zoom:b,dial:k})}}},{key:"onTouchCancel",value:function(t){t.stopPropagation(),t.preventDefault(),this.touches=[]}},{key:"validDouble",value:function(){return this.touch0&&this.touch1}},{key:"touchCount",get:function(){return this.touches.length}},{key:"inPointerLock",get:function(){return document.pointerLockElement||document.mozPointerLockElement}}])&&c(n.prototype,o),a&&c(n,a),y}();n.WebInputManager=g},{"./Vector":"kStk","./NamedView":"UlnH"}],scVq:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UnityViewStarter=n.UnityViewRoot=n.PM_UnityAvatar=n.PM_UnitySmoothed=n.PM_UnitySpatial=n.PM_RenderUnity=void 0;var r,i=t("@croquet/croquet"),o=t("./ViewRoot"),s=t("./NamedView"),a=t("./Mixins"),c=t("./Vector");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach(function(e){f(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return e&&m(t.prototype,e),n&&m(t,n),t}function y(t,e,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=x(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t){return function(){var e,n=x(t);if(S()){var r=x(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return _(this,e)}}function _(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?k(t):e}function k(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function S(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C=function(t){return t.map(function(t){return String(Math.round(1e4*t))}).join(",")},E=function(t){return function(e){w(i,t);var n=b(i);function i(){var t;p(this,i);for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];var a=(t=n.call.apply(n,[this].concat(o))).unityRenderManager=r;return t.unityHandle=a.nextHandleForPawn(k(t)),t.publish(a.id,"unity_pawn_created",t.unityHandle),t}return g(i,[{key:"destroy",value:function(){this.isDefunct||(this.isDefunct=!0,y(x(i.prototype),"destroy",this).call(this),this.deleteUnityObject())}},{key:"sendToUnity",value:function(t,e){this.unityRenderManager.sendToUnity(t,e)}},{key:"createUnityObject",value:function(){if(this.isDefunct)console.log("Pawn destroyed before unity object creation!");else{var t=this.unityConfig||this.actor.unityConfig||{},e={type:t.type||"empty"};this.addDefaultUnityConfig(e);var n=d({},e,{},t);this.unityRenderManager.create(this.unityHandle,n)}}},{key:"addDefaultUnityConfig",value:function(t){"empty"!==t.type&&Object.assign(t,{hsv:[120,100,100],alpha:1})}},{key:"deleteUnityObject",value:function(){this.unityRenderManager.delete(this.unityHandle)}}]),i}()};n.PM_RenderUnity=E;var M=function(t){return function(e){w(r,(0,a.mix)(t).with(E,a.PM_Spatial));var n=b(r);function r(){var t;p(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).listenOnce("spatial_setLocation",function(e){return t.sendUnityUpdate({setP:C(e)})}),t.listenOnce("spatial_setRotation",function(e){return t.sendUnityUpdate({setR:C(e)})}),t.listenOnce("spatial_setScale",function(e){return t.sendUnityUpdate({setS:C(e)})}),t}return g(r,[{key:"addDefaultUnityConfig",value:function(t){y(x(r.prototype),"addDefaultUnityConfig",this).call(this,t),Object.assign(t,{setP:C(this.location),setR:C(this.rotation),setS:C(this.scale)})}},{key:"onAddChild",value:function(t){var e=(0,s.GetNamedView)("PawnManager").get(t);e&&(y(x(r.prototype),"onAddChild",this).call(this,t),this.unityRenderManager.addChild(this.unityHandle,e.unityHandle))}},{key:"sendUnityUpdate",value:function(t){this.unityRenderManager.sendUpdate(this.unityHandle,t,this.actor.lastEventTime)}}]),r}()};n.PM_UnitySpatial=M;var O=function(t){return function(e){w(r,M(t));var n=b(r);function r(){var t;p(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).listenOnce("smoothed_moveTo",function(e){return t.sendUnityUpdate({toP:C(e)})}),t.listenOnce("smoothed_rotateTo",function(e){return t.sendUnityUpdate({toR:C(e)})}),t.listenOnce("smoothed_scaleTo",function(e){return t.sendUnityUpdate({toS:C(e)})}),t}return r}()};n.PM_UnitySmoothed=O;n.PM_UnityAvatar=function(t){return function(e){w(r,O(t));var n=b(r);function r(){return p(this,r),n.apply(this,arguments)}return g(r,[{key:"addDefaultUnityConfig",value:function(t){if(y(x(r.prototype),"addDefaultUnityConfig",this).call(this,t),"userAvatar"===t.type){var e=this.unityRenderManager.localUserRecord;e&&e.avatar===this.actor&&(t.viewId=this.viewId)}}},{key:"moveTo",value:function(t){this.say("avatar_moveTo",t)}},{key:"rotateTo",value:function(t){this.say("avatar_rotateTo",t)}},{key:"setVelocity",value:function(t){this.say("avatar_setVelocity",t)}},{key:"setSpin",value:function(t){this.say("avatar_setSpin",t)}}]),r}()};var T=function(t){w(n,s.NamedView);var e=b(n);function n(t){var r;return p(this,n),r=e.call(this,"UnityRenderManager"),console.log("Start up URM"),r.bootstrapView=t,r.nextHandle=1,r.pawnsByHandle={},r.dataChannelReady=!1,r.unityQueue=[],r.addSubscriptions(),window.unitySideChannelMessage=function(t){return r.handleUnityMessage(t)},r.prepareUnityDataChannel(),r}return g(n,[{key:"addSubscriptions",value:function(){this.subscribe(this.id,"unity_pawn_created",this.triggerCreateUnityObject),this.subscribe(this.viewId,{event:"synced",handling:"immediate"},this.handleSyncState),this.handleSyncState(this.realm.isSynced()),this.subscribe("unity","messageForUnity",this.forwardMessageToUnity)}},{key:"reattach",value:function(){y(x(n.prototype),"reattach",this).call(this),this.addSubscriptions()}},{key:"destroy",value:function(){console.log("shutting down URM ".concat(this.id));var t=(0,s.GetNamedView)("PawnManager");t&&t.pawns.forEach(function(t){t.createUnityObject&&t.destroy()}),this.flushUnityQueue(),this.unsubscribe("unity","messageForUnity"),this.bootstrapView=null,this.nextHandle=1,this.detach()}},{key:"forwardMessageToUnity",value:function(t){this.sendToUnity(t.selector,t.data)}},{key:"sendOnUnitySideChannel",value:function(t,e){var n=encodeURIComponent(JSON.stringify(e)),r="croquetMessage?selector=".concat(t,"&data=").concat(n),i="uniwebview://".concat(r);window.location.href=i}},{key:"prepareUnityDataChannel",value:function(){var t=this,e=this.connection=new RTCPeerConnection(null);e.addEventListener("datachannel",function(e){console.log("datachannel",e);var n=t.dataChannel=e.channel;n.onopen=function(t){return console.log("data channel opened")},n.onerror=function(t){return console.log("data channel error: ".concat(t.message))},n.onclose=function(t){return console.log("data channel closed")},n.addEventListener("message",function(e){return t.dataChannelMessage(e)})}),e.addEventListener("connectionstatechange",function(n){var r=e.connectionState;switch(console.log("connectionstatechange: ".concat(r)),r){case"connected":case"disconnected":break;case"failed":case"closed":console.warn("Unexpected shutdown of data channel"),t.dataChannelReady=!1,t.prepareUnityDataChannel()}}),e.addEventListener("icecandidate",function(t){return console.log("local ICE candidate",t)})}},{key:"addIceCandidate",value:function(t){var e=new RTCIceCandidate(t);this.connection.addIceCandidate(e).catch(function(t){return console.error("CONNECTION ADD ICE FAILED",t.name,t.message)})}},{key:"receiveOffer",value:function(){var t,e=(t=regeneratorRuntime.mark(function t(e){var n,r,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.offer.replace(/_\+_/g,"\n"),console.log("receive offer",n),r=this.connection,t.next=5,r.setRemoteDescription({type:"offer",sdp:n});case 5:return t.next=7,r.createAnswer();case 7:return i=t.sent,t.next=10,r.setLocalDescription(i);case 10:o=i.sdp.replace(/\r\n?|\n/g,"_+_"),this.sendOnUnitySideChannel("rtc_setup_answer",{answer:o});case 12:case"end":return t.stop()}},t,this)}),function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function s(t){u(o,r,i,s,a,"next",t)}function a(t){u(o,r,i,s,a,"throw",t)}s(void 0)})});return function(t){return e.apply(this,arguments)}}()},{key:"sendToUnity",value:function(t,e){this.unityQueue.push({selector:t,data:e})}},{key:"flushUnityQueue",value:function(){if(this.dataChannelReady){var t=this.unityQueue;if(t.length){for(var e=[],n=0,r=0;r<t.length&&n<6e4;){var i=t[r],o=JSON.stringify(i.data);e.push(i.selector,o),n+=i.selector.length+o.length+2,r++}r<t.length?(console.log("reached maximum message-buffer size; holding back ".concat(t.length-r," messages")),t.splice(0,r)):t.length=0;var s=e.join("\n");this.dataChannel.send(s)}}}},{key:"dataChannelMessage",value:function(t){this.handleUnityMessage(t.data)}},{key:"handleUnityMessage",value:function(t){if(this.bootstrapView){var e=JSON.parse(t);e.data=e.data||{};var n=e.selector,r=e.data;if("rtc_setup_ice_candidate"===n)this.addIceCandidate(r);else if("rtc_setup_offer"===n)this.receiveOffer(r);else if("unity_ready"===n)this.dataChannelReady=!0,this.handleSyncState(this.realm.isSynced());else if("avatar_velocity"===n){var i=this.pawnsByHandle[r.h];if(i){var o=void 0===r.x?[0,0,0]:[r.x,r.y,r.z];i.setVelocity(o)}}else if("avatar_spin"===n){var s=this.pawnsByHandle[r.h];if(s){var a;if(void 0===r.x)a=(0,c.q_identity)();else{var l=[r.x,r.y,r.z],u=r.rate;a=(0,c.q_axisAngle)(l,u)}s.setSpin(a)}}else r.userViewId=this.bootstrapView.viewId,this.publish("unity","reflectedUnityEvent",e)}}},{key:"handleSyncState",value:function(t){this.waitingForIslandSync=!t,console.log("synced: ".concat(t)),this.dataChannelReady&&this.sendToUnity("set_sync_state",{synced:t})}},{key:"update",value:function(t){y(x(n.prototype),"update",this).call(this,t),this.flushUnityQueue()}},{key:"nextHandleForPawn",value:function(t){var e=this.nextHandle++;return this.pawnsByHandle[e]=t,e}},{key:"triggerCreateUnityObject",value:function(t){var e=this.pawnsByHandle[t];e&&e.createUnityObject()}},{key:"create",value:function(t,e){this.sendToUnity("create_object",d({handle:t},e))}},{key:"delete",value:function(t){delete this.pawnsByHandle[t],this.sendToUnity("delete_object",{h:t})}},{key:"addChild",value:function(t,e){this.sendToUnity("add_child",{h:t,childH:e})}},{key:"sendUpdate",value:function(t,e){var n=d({h:t},e);this.sendToUnity("update_object",n)}},{key:"localUserRecord",get:function(){return this.bootstrapView.model.userRegistry[this.bootstrapView.viewId]}},{key:"localUserIndex",get:function(){var t=this.localUserRecord;return t&&t.userIndex}}]),n}(),$=function(t){w(n,o.ViewRoot);var e=b(n);function n(t){var r;return p(this,n),(r=e.call(this,t)).model=t,r}return g(n,[{key:"createManagers",value:function(){this.addManager(r),y(x(n.prototype),"createManagers",this).call(this)}}]),n}();n.UnityViewRoot=$;var A=$,P=function(t){w(n,i.View);var e=b(n);function n(t){var i;p(this,n),console.log("starting bootstrap view"),(i=e.call(this,t)).model=t,i.sessionView=null;var o=r;return o?(o.bootstrapView=k(i),o.reattach()):o=r=new T(k(i)),o.dataChannelReady||o.sendOnUnitySideChannel("URM_ready",{viewId:i.viewId}),i}return g(n,null,[{key:"setViewRoot",value:function(t){A=t}}]),g(n,[{key:"update",value:function(t){this.sessionView?this.sessionView.update(t):r.dataChannelReady&&A&&(this.sessionView=new A(this.model))}},{key:"detach",value:function(){this.sessionView&&(this.sessionView.detach(),delete this.sessionView),y(x(n.prototype),"detach",this).call(this)}}]),n}();n.UnityViewStarter=P},{"@croquet/croquet":"uCZq","./ViewRoot":"NWvo","./NamedView":"UlnH","./Mixins":"cgNl","./Vector":"kStk"}],Dn6Y:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./src/Actor");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return r[t]}})});var i=t("./src/Mixins");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return i[t]}})});var o=t("./src/ModelRoot");Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return o[t]}})});var s=t("./src/NamedView");Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return s[t]}})});var a=t("./src/Pawn");Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return a[t]}})});var c=t("./src/ViewRoot");Object.keys(c).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return c[t]}})});var l=t("./src/WebInput");Object.keys(l).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return l[t]}})});var u=t("./src/UnityRender");Object.keys(u).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return u[t]}})})},{"./src/Actor":"kAKX","./src/Mixins":"cgNl","./src/ModelRoot":"yOdO","./src/NamedView":"UlnH","./src/Pawn":"H7A5","./src/ViewRoot":"NWvo","./src/WebInput":"Txgd","./src/UnityRender":"scVq"}],hdhl:[function(t,e,n){"use strict";t("regenerator-runtime/runtime");var r=t("@croquet/croquet"),i=t("../worldcore"),o=t("../worldcore/src/Vector"),s=t("../worldcore/src/UnityRender");function a(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t){return function(){var e,n=b(t);if(v()){var r=b(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return w(this,e)}}function w(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=r.Constants;_.BALL_RADIUS=.2,_.BALL_SPEED=3,_.GRAVITY=1,_.BALL_LAUNCH_INTERVAL=250,_.BALL_STEP_MS=20;var k=function(t){m(n,(0,i.mix)(i.Actor).with(i.AM_Spatial));var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return n}();k.register("SpatialActor"),function(t){m(n,(0,i.mix)(i.Pawn).with(s.PM_UnitySpatial));var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return n}().register("UnitySpatialPawn");var S=function(t){m(n,(0,i.mix)(i.Actor).with(i.AM_Smoothed));var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return n}();S.register("SmoothedActor"),function(t){m(n,(0,i.mix)(i.Pawn).with(s.PM_UnitySmoothed));var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return n}().register("UnitySmoothedPawn");var x=function(t){m(n,(0,i.mix)(i.Actor).with(i.AM_Avatar));var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return n}();x.register("AvatarActor"),function(t){m(n,(0,i.mix)(i.Pawn).with(s.PM_UnityAvatar));var e=y(n);function n(){var t;p(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).listen("captureCamera",t.captureCamera),t}return d(n,[{key:"captureCamera",value:function(){this.sendToUnity("attach_camera",{h:this.unityHandle})}}]),n}().register("UnityAvatarPawn");var C=function(t){m(n,S);var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return d(n,[{key:"init",value:function(){var t=this;u(b(n.prototype),"init",this).call(this,"UnitySmoothedPawn");var e=function(e){return Math.floor(e*t.random())},r=[e(360),e(50)+50,75];this.unityConfig={type:"sphere",hsv:r},this.setLocation([-4,0,-4]),this.setScale([_.BALL_RADIUS,_.BALL_RADIUS,_.BALL_RADIUS]);var i=(40*Math.random()+30)*Math.PI/180;this.velocity=[_.BALL_SPEED*Math.cos(i),_.BALL_SPEED*Math.sin(i),0],this.future(_.BALL_STEP_MS).move()}},{key:"move",value:function(){var t=_.BALL_STEP_MS/1e3,e=this.location.slice();e[1]+=this.velocity[1]*t,e[1]<0?this.destroy():(e[0]+=this.velocity[0]*t,this.velocity[1]-=_.GRAVITY*t,this.moveTo(e),this.future(_.BALL_STEP_MS).move())}}]),n}();C.register("BallActor");var E=function(t){m(n,i.ModelRoot);var e=y(n);function n(){return p(this,n),e.apply(this,arguments)}return d(n,[{key:"init",value:function(){u(b(n.prototype),"init",this).call(this),console.log("starting root!"),this.userColors=[0,60,120,180,240,300,360].map(function(t){return[t,75,75]}),this.userRegistry={},this.cameraOwner=null,this.subscribe(this.sessionId,"view-join",this.addUser),this.subscribe(this.sessionId,"view-exit",this.removeUser),this.subscribe("unity","reflectedUnityEvent",this.reactToReflectedEvent),this.createSceneObjects(),this.tickSceneObjects(),this.tickBallLauncher()}},{key:"addUser",value:function(t){if(this.userRegistry[t])console.log("user ".concat(t," already registered"));else{for(var e=Object.values(this.userRegistry).map(function(t){return t.userIndex}),n=0;e.includes(n);)n++;var r=k.create("UnitySpatialPawn");r.unityConfig={type:"cube",hsv:this.userColors[n],alpha:.4},r.setScale([.5,1,.5]),r.setLocation([0,-.75,0]);var i=k.create("UnitySpatialPawn");i.unityConfig={type:"sphere",hsv:this.userColors[n],alpha:.4},i.setScale([.5,.5,.5]);var o=x.create("UnityAvatarPawn");o.unityConfig={type:"userAvatar"},o.addChild(r),o.addChild(i),o.setLocation([n-1,1.25,-7]),this.userRegistry[t]={userIndex:n,avatar:o}}console.log(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this.userRegistry))}},{key:"removeUser",value:function(t){var e=this.userRegistry[t];if(e){var n=e.avatar;if(n===this.cameraOwner){this.publish("unity","messageForUnity",{selector:"attach_camera",data:{h:null}}),this.cameraOwner=null}n.destroy(),delete this.userRegistry[t]}else console.log("user ".concat(t," not found"));console.log(this.userRegistry)}},{key:"reactToReflectedEvent",value:function(t){var e=t.selector,n=t.data.userViewId,r=this.userRegistry[n];if(r){if("test_trigger"===e){var i=r.avatar,o=i.location.slice();o[1]=3.5-o[1],i.setLocation(o)}else if("capture_camera"===e){var s=r.avatar;this.cameraOwner=s,s.say("captureCamera")}}else console.error("can't find user record for viewId ".concat(n))}},{key:"createSceneObjects",value:function(){var t=k.create("UnitySpatialPawn");t.unityConfig={type:"cube",hsv:[20,50,75]},t.setScale([100,.1,100]),this.bars=[[],[]],this.connectors=[[],[]];var e=this.minBarLength=.25;this.maxBarLength=1;for(var n=0;n<2;n++)for(var r=void 0,i=0;i<5;i++){var o=S.create("UnitySmoothedPawn");o.unityConfig={type:"cube",hsv:[1&i?120:240,75,75]};var s=.2-.02*i;if(o.setScale([s,e,s]),this.bars[n].push(o),r){var a=S.create("UnitySmoothedPawn");a.setLocation([.2*n-.1,e/2,0]),r.addChild(a),o.setLocation([0,e/2,0]),a.addChild(o),this.connectors[n].push(a)}else o.setLocation([0,e/2,-4]);r=o}this.t=0,this.stepDelta=50}},{key:"tickSceneObjects",value:function(){this.t+=this.stepDelta;for(var t=2*this.t*Math.PI/1e4,e=Math.sin(t),n=e*e,r=this.minBarLength+(this.maxBarLength-this.minBarLength)*n,i=this.bars[0].length,s=Math.PI/2/(i-1),a=0;a<2;a++)for(var c=0;c<i;c++){if(c>0){var l=this.connectors[a][c-1];l.moveTo([0,r/2,0]),l.rotateTo((0,o.q_axisAngle)([0,0,1],n*(a||-1)*s))}var u=this.bars[a][c],h=u.scale.slice();h[1]=r,u.scaleTo(h),u.moveTo([0,r/2,0===c?-4:0])}this.future(this.stepDelta).tickSceneObjects()}},{key:"tickBallLauncher",value:function(){C.create(),this.future(_.BALL_LAUNCH_INTERVAL).tickBallLauncher()}}]),n}();E.register("UnitySessionModel");var M=function(t){m(n,s.UnityViewRoot);var e=y(n);function n(t){var r;return p(this,n),console.log("starting app view root"),r=e.call(this,t),t.cameraOwner&&t.cameraOwner.say("captureCamera"),r}return n}();function O(){var t;return t=regeneratorRuntime.mark(function t(){var e,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,s.UnityViewStarter.setViewRoot(M),t.next=4,r.Session.join("wc-unity13",E,s.UnityViewStarter,{step:"manual",tps:"20x5",expectedSimFPS:0});case 4:n=t.sent,i=function(){var t=Date.now();t-e>15&&(n.step(t),e=t)},n.view.realm.island.controller.tickHook=function(){return Promise.resolve().then(i)};case 8:case"end":return t.stop()}},t)}),(O=function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function s(t){a(o,r,i,s,c,"next",t)}function c(t){a(o,r,i,s,c,"throw",t)}s(void 0)})}).apply(this,arguments)}!function(){O.apply(this,arguments)}()},{"regenerator-runtime/runtime":"KA2S","@croquet/croquet":"nlD3","../worldcore":"Dn6Y","../worldcore/src/Vector":"kStk","../worldcore/src/UnityRender":"scVq"}]},{},["hdhl"]);</script>
    </body>
</html>
