/**
 * Copyright Croquet Corporation 2020
 * Bundle of @croquet/croquet
 * Generated: 2020-05-01
 * Version: 0.3.0
 */

"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("@babel/runtime/helpers/slicedToArray")),n=t(require("@babel/runtime/helpers/classCallCheck")),r=t(require("@babel/runtime/helpers/createClass")),o=t(require("@babel/runtime/helpers/toConsumableArray")),i=t(require("@babel/runtime/helpers/typeof")),a=t(require("@babel/runtime/helpers/defineProperty")),s=t(require("@babel/runtime/regenerator")),c=t(require("@babel/runtime/helpers/asyncToGenerator")),u=t(require("fast-json-stable-stringify")),l=t(require("toastify-js")),h=t(require("seedrandom/seedrandom")),f=t(require("@babel/runtime/helpers/get")),d=t(require("@babel/runtime/helpers/inherits")),p=t(require("@babel/runtime/helpers/possibleConstructorReturn")),v=t(require("@babel/runtime/helpers/getPrototypeOf")),y=t(require("fastpriorityqueue")),m=t(require("@babel/runtime/helpers/toArray")),g=t(require("@babel/runtime/helpers/construct"));const b="production",w="0.3.0";if(void 0===window.TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(t){for(var e=t.length,n=-1,r="undefined"==typeof Uint8Array?new Array(1.5*e):new Uint8Array(3*e),o=0,i=0,a=0;a!==e;){if(o=t.charCodeAt(a),a+=1,o>=55296&&o<=56319){if(a===e){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;break}if(!((i=t.charCodeAt(a))>=56320&&i<=57343)){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;continue}if(a+=1,(o=1024*(o-55296)+i-56320+65536)>65535){r[n+=1]=240|o>>>18,r[n+=1]=128|o>>>12&63,r[n+=1]=128|o>>>6&63,r[n+=1]=128|63&o;continue}}o<=127?r[n+=1]=0|o:o<=2047?(r[n+=1]=192|o>>>6,r[n+=1]=128|63&o):(r[n+=1]=224|o>>>12,r[n+=1]=128|o>>>6&63,r[n+=1]=128|63&o)}return"undefined"!=typeof Uint8Array?r.subarray(0,n+1):(r.length=n+1,r)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(t){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function k(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function x(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}"object"===("undefined"==typeof module?"undefined":i(module))&&module.bundle&&module.bundle.modules&&module.bundle.cache&&function(){for(var t=module.bundle,n={},r={},i={},a=0,s=Object.entries(t.modules);a<s.length;a++){var c=e(s[a],2),u=c[0],l=c[1],h=""+t.modules[u][0],f=r[h];f?i[u]=f:r[h]=u;for(var d=0,p=Object.entries(l[1]);d<p.length;d++){var v=e(p[d],2),y=v[0],m=v[1];(n[m]||(n[m]=new Set)).add(y)}}for(var g=function(t){return n[t]?"".concat(o(n[t]).sort().join('" and "')):"top-level"},b={},w=[],S=0,x=Object.entries(t.modules);S<x.length;S++)for(var C=e(x[S],2),E=C[0],O=C[1],_=0,A=Object.entries(O[1]);_<A.length;_++){var T=e(A[_],2),M=T[0],j=T[1],I=i[j];I&&(t.cache[j]?b[I]=j:(O[1][M]=I,delete t.modules[j],w.push('"'.concat(M,'" in "').concat(g(E),'" (').concat(E,")"))))}for(var q=0,P=Object.entries(t.modules);q<P.length;q++)for(var N=e(P[q],2),D=N[0],R=N[1],L=0,B=Object.entries(R[1]);L<B.length;L++){var U=e(B[L],2),F=U[0],H=U[1],$=b[H];$&&(t.cache[H]?console.warn('Could not deduplicate import "'.concat(F,'" in "').concat(g(D),'" (to fix, import "').concat(g(module.id),'" earlier)')):(R[1][F]=$,delete t.modules[H],w.push('"'.concat(F,'" in "').concat(g(D),'" (').concat(D,")"))))}var V,J=k(w.sort());try{for(J.s();!(V=J.n()).done;){var W=V.value;console.log("Deduplicated import",W)}}catch(t){J.e(t)}finally{J.f()}}();var E=window.location.hostname.endsWith("croquet.studio"),O="",_="";function A(t,e){if(e){var n,r=x(e.split("&"));try{for(r.s();!(n=r.n()).done;){var o=n.value.split("="),i=o[0],a=!0;if(o.length>1&&(a=decodeURIComponent(o.slice(1).join("="))).match(/^(true|false|null|[0-9.]*|["[{].*)$/))try{a=JSON.parse(a)}catch(t){"["===a[0]&&(a=a.slice(1,-1).split(","))}t[i]=a}}catch(t){r.e(t)}finally{r.f()}}}var T=new(function(){function t(){n(this,t),this.getSession(),A(this,window.location.search.slice(1)),A(this,E?window.location.hash.slice(1):_),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}return r(t,[{key:"has",value:function(t,e,n){"boolean"!=typeof n&&(n=this.isHost(n));var r=this[t];if("string"!=typeof r)return n;var o=r.split(",");return!0===n&&(e="no".concat(e)),e.endsWith("s")&&(e=e.slice(0,-1)),o.includes(e)||o.includes("".concat(e,"s"))?!n:n}},{key:"getSession",value:function(){if(E){var t=window.location.pathname.match(/^\/([^/]+)\/(.*)$/);if(t)return O=t[1],t[2]}else{var e=window.location.hash.match(/^#([^&]+)&?(.*)$/);if(e)return e[1].includes("=")?(_="".concat(e[1],"&").concat(e[2]),""):(_=e[2],e[1])}return"string"==typeof this.session?(_=window.location.hash.slice(1),this.session):""}},{key:"setSession",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==E&&this.getSession();var n=window.location,r=n.search,o=n.hash,i=E?"/".concat(O,"/").concat(t).concat(r).concat(o):"#".concat(t).concat(_?"&"+_:"");e?window.history.replaceState({},"",i):window.history.pushState({},"",i)}},{key:"isHost",value:function(t){var e=window.location.hostname;return e===t||"localhost"===t&&(!!e.endsWith(".ngrok.io")||["127.0.0.1","::1"].includes(e))}},{key:"isLocalhost",value:function(){return this.isHost("localhost")}}]),t}());function M(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={};try{r=JSON.parse(localStorage.croquetUser||"{}")}catch(t){}return t in r?r[t]:n?(r[t]=n(),r[t]!==e&&(localStorage.croquetUser=JSON.stringify(r)),r[t]):e}function j(){return I.apply(this,arguments)}function I(){return(I=c(s.mark((function t(){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!T.nologin){t.next=2;break}return t.abrupt("return",!1);case 2:if(!M("name")||T.user){t.next=4;break}return t.abrupt("return",!0);case 4:return t.abrupt("return",new Promise((function(t){var n=document.createElement("style");n.innerHTML='\n            .overlay {\n                z-index: 1010;\n                position: fixed;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                background-color:#333;\n                opacity:0.9;\n                display:flex;\n                align-items:center;\n                justify-content:center\n            }\n            form {\n                background-color: #fff;\n                color: #666;\n                border-radius: 10px;\n                padding: 16px;\n                font-size: 14px;\n            }\n            form dt { margin: 4px 0 }\n            form dd { margin-left: 0 }\n            form input {\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                min-height: 46px;\n                padding: 10px;\n                font-size: 16px;\n                width: 100%;\n                box-shadow: inset 0 1px 2px #666;\n            }\n            form input:invalid { border: 1px solid red; }\n            form input:valid   { border: 1px solid #ccc; }\n            form button {\n                padding: 20px 32px;\n                background-color: #3b5;\n                color: #fff;\n                border-radius: 50px;\n                border-width:0;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n            }\n            .error {\n                visibility: hidden;\n                width: 250px;\n                background-color: #fcc;\n                color: #900;\n                padding: 5px;\n                border-radius: 6px;\n                border: 1px solid #c99;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n            .error::after {\n                content: " ";\n                position: absolute;\n                bottom: 100%;  /* At the top of message */\n                left: 10px;\n                border-width: 5px;\n                border-style: solid;\n                border-color: transparent transparent #c99 transparent;\n            }\n            .notice {\n                visibility: hidden;\n                width: 270px;\n                height: 70px;\n                background-color: #fff;\n                padding: 5px;\n                position: absolute;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n        ',document.head.appendChild(n);var r=document.createElement("form");r.innerHTML='\n            <dl>\n                <dt><label for="user[name]">Username</label></dt>\n                <dd>\n                    <input type="text" required pattern="^[a-zA-Z0-9_]*$" minlength="2" maxlength="15" name="user[name]" id="user[name]" placeholder="Enter a username" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n                <dd class="notice"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[email]">Email</label></dt>\n                <dd>\n                    <input type="email" required id="user[email]" placeholder="you@example.com" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <dl>\n                <dt><label for="user[password]">Password</label></dt>\n                <dd>\n                    <input type="password" required minlength="8" id="user[password]" placeholder="Create a password" autocomplete="off" spellcheck="false"></input>\n                </dd>\n                <dd class="error"></dd>\n            </dl>\n            <button id="user[create]">Sign up / Log in</button>\n            <div style="margin:16px auto;text-align: center">— OR —</div>\n            <button id="user[guest]" style="background-color: #999">Continue as Croquet Guest</button>\n            <div style="max-width:280px;text-align: center;font-size:11px;margin:4px auto">\n                Continuing from this screen to our website indicates that you agree to our\n                <a href="/terms.html" target="_blank" style="color:#36c;text-decoration:none">terms of service</a>\n                and\n                <a href="/privacy.html" target="_blank" style="color:#36c;text-decoration:none">privacy statement</a>.\n            </div>\n        ';var o=document.createElement("div");o.classList.add("overlay"),o.appendChild(r),document.body.appendChild(o);var i=r.getElementsByTagName("input"),a=e(i,3),u=a[0],l=a[1],h=a[2],f=r.getElementsByClassName("error"),d=e(f,3),p=d[0],v=d[1],y=d[2],m=r.getElementsByClassName("notice"),g=e(m,1)[0],b=r.getElementsByTagName("button"),w=e(b,2),k=w[0],S=w[1];"string"==typeof T.user?u.value=T.user:M("name")&&(u.value=M("name"));var x=0;u.oninput=function(){clearTimeout(x),x=setTimeout((function(){return A()}),300)},P(!0),u.oninput();var C=0;l.oninput=function(){clearTimeout(C),C=setTimeout((function(){return I()}),300)};var E=0;function O(){r.reset(),document.head.removeChild(n),document.body.removeChild(o)}function _(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".json";return"".concat(L(),"/user/").concat(t.toLowerCase(),"/").concat(e).concat(n)}function A(){return j.apply(this,arguments)}function j(){return(j=c(s.mark((function t(){var e,n,r,o,i,a=arguments;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.length>0&&void 0!==a[0]&&a[0],p.style.visibility="hidden",e||P(!0),(n=u.value.trim())||e){t.next=6;break}return t.abrupt("return",!1);case 6:if(!u.validity.tooShort&&!u.validity.tooLong){t.next=10;break}return p.innerHTML="Your username must be between ".concat(u.minLength," and ").concat(u.maxLength," characters long."),p.style.visibility="visible",t.abrupt("return",!1);case 10:if(!u.validity.patternMismatch){t.next=14;break}return p.innerHTML="Your username can only contain alphanumeric characters (letters A-Z, numbers 0-9) and underscores.",p.style.visibility="visible",t.abrupt("return",!1);case 14:return t.prev=14,r=x,t.next=18,fetch(_(n,"salt"),{mode:"cors"});case 18:if(o=t.sent,r===x||e){t.next=21;break}return t.abrupt("return",!1);case 21:if(!o.ok){t.next=27;break}return e||P(!1),t.next=25,o.json();case 25:return i=t.sent,t.abrupt("return",{name:n,salt:$(i.salt)});case 27:t.next=31;break;case 29:t.prev=29,t.t0=t.catch(14);case 31:return t.abrupt("return",{name:n});case 32:case"end":return t.stop()}}),t,null,[[14,29]])})))).apply(this,arguments)}function I(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v.style.visibility="hidden";var e=l.value.trim();return!(!e&&!t)&&(l.validity.valid?e:(v.innerHTML="Please enter a valid email address.",v.style.visibility="visible",!1))}function q(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.style.visibility="hidden";var e=h.value;return!(!e&&!t)&&(h.validity.tooShort?(y.innerHTML="Your password must be at least ".concat(h.minLength," characters long."),y.style.visibility="visible",!1):e)}function P(t){var e=u.value.trim();g.innerHTML="“".concat(e,"” is already registered as a user.<br><br>\n                If this is you, please enter your password below to continue.\n                Otherwise, please pick a different name."),g.style.visibility=t?"hidden":"visible",l.disabled=!t,h.placeholder=e?t?"Create a password for “".concat(e,"”"):"Enter password for “".concat(e,"”"):"Enter a password",k.innerHTML=e?t?"Sign up as “".concat(e,"”"):"Log in as “".concat(e,"”"):"Sign up / Log in"}h.oninput=function(){clearTimeout(E),E=setTimeout((function(){return q()}),300)},k.onclick=function(){var e=c(s.mark((function e(n){var r,o,i,a,c,u,l,h,f,d,p,v,m;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,A(!0);case 3:if(r=e.sent,o=r.name,i=r.salt,a=!!i||I(!0),c=q(!0),o&&a&&c){e.next=10;break}return e.abrupt("return");case 10:return(u=i)||(u=crypto.getRandomValues(new Uint8Array(8)),fetch(_(o,"salt"),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({salt:V(u)})})),e.next=14,window.crypto.subtle.importKey("raw",(new TextEncoder).encode(c),{name:"PBKDF2"},!1,["deriveBits"]);case 14:return l=e.sent,e.next=17,window.crypto.subtle.deriveBits({name:"PBKDF2",salt:u,iterations:5e5,hash:"SHA-256"},l,256);case 17:if(h=e.sent,f=V(h),!i){e.next=40;break}return e.prev=20,e.next=23,fetch(_(o,f),{mode:"cors"});case 23:if((d=e.sent).ok){e.next=26;break}throw Error("wrong password");case 26:return e.next=28,d.json();case 28:p=e.sent,console.log("Logged in as ".concat(p.name," <").concat(p.email,">")),localStorage.croquetUser=JSON.stringify(p),e.next=38;break;case 33:return e.prev=33,e.t0=e.catch(20),y.innerHTML="Wrong password for “".concat(o,"“"),y.style.visibility="visible",e.abrupt("return");case 38:e.next=45;break;case 40:v=crypto.getRandomValues(new Uint8Array(16)),m={name:o,email:a,salt:V(u),secret:V(v)},localStorage.croquetUser=JSON.stringify(m),fetch(_(o,f),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),console.log("Signed up as ".concat(m.name," <").concat(m.email,">"));case 45:O(),t(!0);case 47:case"end":return e.stop()}}),e,null,[[20,33]])})));return function(t){return e.apply(this,arguments)}}(),S.onclick=function(e){e.preventDefault(),delete localStorage.croquetUser,O(),t(!1)}})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function N(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var R=window.location.hostname.endsWith("croquet.io")?window.location.host:"croquet.io";function L(){var t="string"==typeof T.files?T.files:"https://".concat(R,"/files/v1");return t.endsWith("/")?t.slice(0,-1):t}function B(){return module.bundle?module.bundle.modules:[]}function U(){return Object.keys(B()).filter((function(t){return!t.endsWith("hmr-runtime.js")}))}function F(t){return B()[t]}function H(t){var e,n,r,o;return e=F(t)[0],r=(n=""+e).indexOf("{"),o=n.lastIndexOf("}"),n.slice(r+1,o).trim()}function $(t){return new Uint8Array(atob(t.padEnd(t.length+3&-4,"=").replace(/-/g,"+").replace(/_/g,"/")).split("").map((function(t){return t.charCodeAt(0)})))}function V(t){return btoa(String.fromCharCode.apply(String,o(new Uint8Array(t)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function J(t){return W.apply(this,arguments)}function W(){return(W=c(s.mark((function t(e){var n;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return","47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU");case 2:return t.next=4,window.crypto.subtle.digest("SHA-256",e);case 4:return n=t.sent,t.abrupt("return",V(n));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(){return T.has("debug","hashing",!1)}window.crypto&&window.crypto.subtle&&"function"==typeof window.crypto.subtle.digest||console.error("ERROR: crypto.subtle.digest() browser API not available. Please access this page via https or localhost.");var G={},K={was_initialized:!1};function Q(t){return K.was_initialized||function(){var t,n=N(U());try{for(n.s();!(t=n.n()).done;)for(var r=t.value,o=0,i=Object.entries(F(r)[1]);o<i.length;o++){var a=e(i[o],2),s=a[0],c=a[1],u=K[c]||"",l=s.replace(/^[./]*/,"");l.length>u.length&&(K[c]=l)}}catch(t){n.e(t)}finally{n.f()}K.was_initialized=!0}(),K[t]||t}var Y=new TextEncoder;function X(t){return Z.apply(this,arguments)}function Z(){return(Z=c(s.mark((function t(e){var n,r;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Y.encode(e),t.next=3,J(n);case 3:return r=t.sent,z()&&(G[r]={string:e,buffer:n}),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tt={};function et(t){return nt.apply(this,arguments)}function nt(){return(nt=c(s.mark((function t(e){var n,r;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!tt[e]){t.next=2;break}return t.abrupt("return",tt[e]);case 2:return n=H(e).replace(/\s+/g," "),t.next=5,X(n);case 5:return r=t.sent,z()&&(G[r].name="Module ".concat(Q(e))),t.abrupt("return",tt[e]=r);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var rt=[];function ot(t){var e=X(function(t){var e=""+t,n=e.indexOf("{"),r=e.lastIndexOf("}"),o=e.slice(0,n).replace(/\s+/g," ").trim(),i=e.slice(n+1,r).trim();return"".concat(o," {\n").concat(i,"}")}(t));e.then((function(e){console.log("hashing class ".concat(t.name,": ").concat(e)),z()&&(G[e].name="Class ".concat(t.name))})),rt.push(e)}function it(t,e){return at.apply(this,arguments)}function at(){return(at=c(s.mark((function t(e,n){var r,i,a,c,u;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="production"===b?[]:U().filter((function(t){var e=t.endsWith("/package.json")||t.endsWith("/ar.js");return e&&console.warn("excluding ".concat(t," from code hash")),!e})).sort(),t.next=4,Promise.all([].concat(o(r.map(et)),rt));case 4:return i=t.sent,t.next=7,X([n].concat(o(i)).join("|"));case 7:return a=t.sent,t.next=10,X([e,a].join("|"));case 10:return c=t.sent,z()&&(G[a].name="All code",G[c].name="Session name and code",u=[].concat(o(i),[a,c]).map((function(t){return P({hash:t},G[t])})),console.log("Debug Hashing for session ".concat(c),u)),t.abrupt("return",{hash:c,codeHash:a});case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function st(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ct(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ut,lt=function(){function t(){n(this,t),this.values=[],this.resolves=[]}var e;return r(t,[{key:"next",value:(e=c(s.mark((function t(){var e=this;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.values.length>0)){t.next=2;break}return t.abrupt("return",this.values.shift());case 2:return t.abrupt("return",new Promise((function(t){return e.resolves.push(t)})));case 3:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"put",value:function(t){var e=this.resolves.shift();e?e(t):this.values.push(t)}},{key:"putAll",value:function(t){var e,n=st(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.put(r)}}catch(t){n.e(t)}finally{n.f()}}},{key:"peek",value:function(){return this.values[0]}},{key:"nextNonBlocking",value:function(){return this.values.shift()}},{key:"allNonBlocking",value:function(){if(0===this.values.length)return[];var t=this.values;return this.values=[],t}},{key:"size",get:function(){return this.values.length-this.resolves.length}}]),t}();!function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;e<r;e++){var o=[],i=this.data.charCodeAt(e);i>65536?(o[0]=240|(1835008&i)>>>18,o[1]=128|(258048&i)>>>12,o[2]=128|(4032&i)>>>6,o[3]=128|63&i):i>2048?(o[0]=224|(61440&i)>>>12,o[1]=128|(4032&i)>>>6,o[2]=128|63&i):i>128?(o[0]=192|(1984&i)>>>6,o[1]=128|63&i):o[0]=i,this.parsedData.push(o)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;e<n;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++)this.modules[r][o]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+n][e+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=f.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e},createMovieClip:function(t,e,n){var r=t.createEmptyMovieClip(e,n);this.make();for(var o=0;o<this.modules.length;o++)for(var i=1*o,a=0;a<this.modules[o].length;a++){var s=1*a;this.modules[o][a]&&(r.beginFill(0,100),r.moveTo(s,i),r.lineTo(s+1,i),r.lineTo(s+1,i+1),r.lineTo(s,i+1),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=f.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=t[e],o=t[n];if(null==this.modules[r][o])for(var i=-2;i<=2;i++)for(var a=-2;a<=2;a++)this.modules[r+i][o+a]=-2==i||2==i||-2==a||2==a||0==i&&0==a}},setupTypeNumber:function(t){for(var e=f.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++){r=!t&&1==(e>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,r=f.getBCHTypeInfo(n),o=0;o<15;o++){var i=!t&&1==(r>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(o=0;o<15;o++){i=!t&&1==(r>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,r=this.moduleCount-1,o=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;s<2;s++)if(null==this.modules[r][a-s]){var c=!1;i<t.length&&(c=1==(t[i]>>>o&1)),f.getMask(e,r,a-s)&&(c=!c),this.modules[r][a-s]=c,-1==--o&&(i++,o=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,r){for(var o=y.getRSBlocks(t,n),i=new m,a=0;a<r.length;a++){var s=r[a];i.put(s.mode,4),i.put(s.getLength(),f.getLengthInBits(s.mode,t)),s.write(i)}var c=0;for(a=0;a<o.length;a++)c+=o[a].dataCount;if(i.getLengthInBits()>8*c)throw new Error("code length overflow. ("+i.getLengthInBits()+">"+8*c+")");for(i.getLengthInBits()+4<=8*c&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(!1);for(;!(i.getLengthInBits()>=8*c||(i.put(e.PAD0,8),i.getLengthInBits()>=8*c));)i.put(e.PAD1,8);return e.createBytes(i,o)},e.createBytes=function(t,e){for(var n=0,r=0,o=0,i=new Array(e.length),a=new Array(e.length),s=0;s<e.length;s++){var c=e[s].dataCount,u=e[s].totalCount-c;r=Math.max(r,c),o=Math.max(o,u),i[s]=new Array(c);for(var l=0;l<i[s].length;l++)i[s][l]=255&t.buffer[l+n];n+=c;var h=f.getErrorCorrectPolynomial(u),d=new v(i[s],h.getLength()-1).mod(h);a[s]=new Array(h.getLength()-1);for(l=0;l<a[s].length;l++){var p=l+d.getLength()-a[s].length;a[s][l]=p>=0?d.get(p):0}}var y=0;for(l=0;l<e.length;l++)y+=e[l].totalCount;var m=new Array(y),g=0;for(l=0;l<r;l++)for(s=0;s<e.length;s++)l<i[s].length&&(m[g++]=i[s][l]);for(l=0;l<o;l++)for(s=0;s<e.length;s++)l<a[s].length&&(m[g++]=a[s][l]);return m};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},o=0,i=1,a=2,s=3,c=4,u=5,l=6,h=7,f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;f.getBCHDigit(e)-f.getBCHDigit(f.G15)>=0;)e^=f.G15<<f.getBCHDigit(e)-f.getBCHDigit(f.G15);return(t<<10|e)^f.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;f.getBCHDigit(e)-f.getBCHDigit(f.G18)>=0;)e^=f.G18<<f.getBCHDigit(e)-f.getBCHDigit(f.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return f.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case o:return(e+n)%2==0;case i:return e%2==0;case a:return n%3==0;case s:return(e+n)%3==0;case c:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case u:return e*n%2+e*n%3==0;case l:return(e*n%2+e*n%3)%2==0;case h:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new v([1],0),n=0;n<t;n++)e=e.multiply(new v([1,d.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,r=0;r<e;r++)for(var o=0;o<e;o++){for(var i=0,a=t.isDark(r,o),s=-1;s<=1;s++)if(!(r+s<0||e<=r+s))for(var c=-1;c<=1;c++)o+c<0||e<=o+c||0==s&&0==c||a==t.isDark(r+s,o+c)&&i++;i>5&&(n+=3+i-5)}for(r=0;r<e-1;r++)for(o=0;o<e-1;o++){var u=0;t.isDark(r,o)&&u++,t.isDark(r+1,o)&&u++,t.isDark(r,o+1)&&u++,t.isDark(r+1,o+1)&&u++,0!=u&&4!=u||(n+=3)}for(r=0;r<e;r++)for(o=0;o<e-6;o++)t.isDark(r,o)&&!t.isDark(r,o+1)&&t.isDark(r,o+2)&&t.isDark(r,o+3)&&t.isDark(r,o+4)&&!t.isDark(r,o+5)&&t.isDark(r,o+6)&&(n+=40);for(o=0;o<e;o++)for(r=0;r<e-6;r++)t.isDark(r,o)&&!t.isDark(r+1,o)&&t.isDark(r+2,o)&&t.isDark(r+3,o)&&t.isDark(r+4,o)&&!t.isDark(r+5,o)&&t.isDark(r+6,o)&&(n+=40);var l=0;for(o=0;o<e;o++)for(r=0;r<e;r++)t.isDark(r,o)&&l++;return n+=10*(Math.abs(100*l/e/e-50)/5)}},d={glog:function(t){if(t<1)throw new Error("glog("+t+")");return d.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return d.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;p<8;p++)d.EXP_TABLE[p]=1<<p;for(p=8;p<256;p++)d.EXP_TABLE[p]=d.EXP_TABLE[p-4]^d.EXP_TABLE[p-5]^d.EXP_TABLE[p-6]^d.EXP_TABLE[p-8];for(p=0;p<255;p++)d.LOG_TABLE[d.EXP_TABLE[p]]=p;function v(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var r=0;r<t.length-n;r++)this.num[r]=t[r+n]}function y(t,e){this.totalCount=t,this.dataCount=e}function m(){this.buffer=[],this.length=0}v.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<t.getLength();r++)e[n+r]^=d.gexp(d.glog(this.get(n))+d.glog(t.get(r)));return new v(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=d.glog(this.get(0))-d.glog(t.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<t.getLength();r++)n[r]^=d.gexp(d.glog(t.get(r))+e);return new v(n,0).mod(t)}},y.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],y.getRSBlocks=function(t,e){var n=y.getRsBlockTable(t,e);if(null==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=n.length/3,o=[],i=0;i<r;i++)for(var a=n[3*i+0],s=n[3*i+1],c=n[3*i+2],u=0;u<a;u++)o.push(new y(s,c));return o},y.getRsBlockTable=function(t,e){switch(e){case r.L:return y.RS_BLOCK_TABLE[4*(t-1)+0];case r.M:return y.RS_BLOCK_TABLE[4*(t-1)+1];case r.Q:return y.RS_BLOCK_TABLE[4*(t-1)+2];case r.H:return y.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},m.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var g=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],b=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,n=this._htOption,r=t.getModuleCount(),o=n.width/r,i=n.height/r,a=Math.round(o),s=Math.round(i);this.clear();for(var c=0;c<r;c++)for(var u=0;u<r;u++){var l=t.isDark(c,u),h=u*o,f=c*i;e.strokeStyle=l?n.colorDark:n.colorLight,e.lineWidth=1,e.fillStyle=l?n.colorDark:n.colorLight,e.fillRect(h,f,o,i),e.strokeRect(Math.floor(h)+.5,Math.floor(f)+.5,a,s),e.strokeRect(Math.ceil(h)-.5,Math.ceil(f)-.5,a,s)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();function w(t,e){for(var n=1,o=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),i=0,a=g.length;i<=a;i++){var s=0;switch(e){case r.L:s=g[i][0];break;case r.M:s=g[i][1];break;case r.Q:s=g[i][2];break;case r.H:s=g[i][3]}if(o<=s)break;n++}if(n>g.length)throw new Error("Too long data");return n}(ut=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:r.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(b=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new b(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(w(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},ut.prototype.clear=function(){this._oDrawing.clear()},ut.prototype.getCanvas=function(){for(var t=0;t<this._el.children.length;t++){var e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},ut.CorrectLevel=r}();var ht=ut;function ft(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dt(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pt=Date.now();"undefined"==typeof performance&&(window.performance={now:function(){return Date.now()-pt}});var vt=["simulate","update","render","snapshot"],yt={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"},mt=null,gt=null,bt=null,wt=null;function kt(t){for(mt=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",(gt=document.createElement("div")).id="text_stats",gt.style.padding=5,gt.style.background="rgba(255,255,255,0.2)",gt.style.fontFamily="sans-serif",t.appendChild(gt),t.title=Object.entries(yt).map((function(t){var n=e(t,2),r=n[0],o=n[1];return"".concat(o,": ").concat(r)})).join("\n"),(bt=document.createElement("canvas")).width=Math.min(125,window.innerWidth)*window.devicePixelRatio,bt.height=125*window.devicePixelRatio,bt.style.width="100%",t.appendChild(bt),(wt=bt.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio)}var St=[],xt=0,Ct=!1,Et=Ot(0);function Ot(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:Ct}}function _t(t){for(Et.total=t-Et.start,St.push(Et);St.length>Math.min(120,window.innerWidth);)St.shift();if(mt&&"none"!==window.getComputedStyle(mt).display){var e=St.slice(1).filter((function(t){return t.total})),n=e.map((function(t){return t.total})).reduce((function(t,e){return t+e}),0)/e.length;Math.max.apply(Math,o(e.map((function(t){return Math.max(t.backlog,t.network)}))));xt=1e3,gt.parentElement||(console.warn("who broke the stats div and canvas?"),mt.appendChild(gt),mt.appendChild(bt)),gt.innerText="".concat(Et.users," users, ").concat(Math.round(1e3/n)," fps, ")+(Et.backlog<100&&Et.activity<1e3?"latency: ".concat(Et.latency," ms"):"backlog: ".concat(Et.backlog<100?"0.0":(Et.backlog/1e3).toFixed(1)," s")),wt.clearRect(0,0,bt.width,bt.height);for(var r=function(t){return 20*(1-t/(1e3/60))+60},i=function(t){return r(t/xt*-2*(1e3/60))+5},a=0;a<St.length;a++){var s=St[a],c=a+.5,u=r(0);wt.beginPath(),wt.moveTo(c,u),wt.lineTo(c,r(s.total)),wt.strokeStyle=yt[s.connected?"total":"network"],wt.stroke(),wt.beginPath(),wt.moveTo(c,u),u=r(s.total);var l,h=0,f=ft(vt);try{for(f.s();!(l=f.n()).done;){var d=l.value;s.items[d]&&(h+=s.items[d],u=r(h),wt.lineTo(c,u),wt.strokeStyle=yt[d],wt.stroke(),wt.beginPath(),wt.moveTo(c,u))}}catch(t){f.e(t)}finally{f.f()}s.network&&(wt.beginPath(),wt.moveTo(c,i(0)),wt.lineTo(c,i(s.network)),wt.strokeStyle=yt.network,wt.stroke())}wt.strokeStyle="rgba(255, 255, 255, 0.2)";for(var p=0;p<60;p+=1e3/60)wt.moveTo(0,r(p)),wt.lineTo(120,r(p)),wt.stroke()}}var At=[],Tt={animationFrame:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(t),Et=Ot(t);for(var r=0,o=Object.entries(n);r<o.length;r++){var i=e(o[r],2),a=i[0],s=i[1];this[a](s)}},begin:function(t){var e=performance.now();Et.items[t]=(Et.items[t]||0)-e;var n=At[At.length-1];return n&&(Et.items[n]+=e),At.push(t),e},end:function(t){var e=performance.now();if(Et.items[t]+=e,At.pop()!==t)throw Error("Unmatched stats calls for "+t);var n=At[At.length-1];return n&&(Et.items[n]-=e),e},backlog:function(t){Et.backlog=Math.max(t,Et.backlog)},network:function(t){Et.network=t},starvation:function(t){Et.network=t},latency:function(t){Et.latency=t},activity:function(t){Et.activity=t},users:function(t){Et.users=t},connected:function(t){Et.connected=Ct=t}};function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var It,qt,Pt,Nt="ontouchstart"in document.documentElement,Dt=Nt?20:12,Rt=Nt?0:15;It="\n        #croquet_dock { position: absolute; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 84px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all ".concat(.3,"s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n\n        .croquet_dock_button { position: absolute; width: ").concat(Dt,"%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ").concat(2+Rt+Dt+2,"% }\n        #croquet_dock_right { right: ").concat(2+Rt,"%; }\n        #croquet_dock_pin { right: ").concat(2,"%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: ").concat(2,"px; top: ").concat(2,"px; right: ").concat(2,"px; bottom: ").concat(2,"px; background: white; }\n        #croquet_dock:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; border: 6px solid white; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader:before,\n        #croquet_loader:after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader:before,\n        #croquet_loader:after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader:before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader:after { left: 3.5em; }\n"),(qt=document.createElement("style")).innerHTML=It,document.head.insertBefore(qt,document.head.getElementsByTagName("style")[0]),(Pt=document.createElement("style")).innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify { font-family: sans-serif; border-radius: 8px; }\n",document.head.insertBefore(Pt,document.head.getElementsByTagName("style")[0]);var Lt=new Set;function Bt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Zt.showMessage(t,jt({},e,{level:"error"}))}function Ut(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Zt.showMessage(t,jt({},e,{level:"warning"}))}function Ft(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Zt.showMessage(t,jt({},e,{level:"status"}))}function Ht(t,e){console.error("Error during ".concat(t),e);var n=(e.stack||"").split("\n").filter((function(t){return!t.match(/croquet-.*\.min.js/)})).join("\n");Zt.showMessage("<b>Error during ".concat(t,": ").concat(e.message,"</b>\n\n").concat(n).replace(/\n/g,"<br>"),{level:"error",duration:1e4,stopOnFocus:!0})}function $t(t,e){var n=Zt.root;if(!1===n)return null;var r,o=jt({text:t,duration:3e3,gravity:"bottom",position:"left",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)",stopOnFocus:!0},e);return n instanceof Element&&n!==document.body?(r=n.id)||(n.id=r="_croquetToastParent"):"string"==typeof n&&(r=n),r&&(o.selector=r),l(o).showToast()}var Vt,Jt,Wt={get pinned(){return"true"===localStorage["croquet-debug-ui-pinned"]},set pinned(t){localStorage["croquet-debug-ui-pinned"]=!!t},get activePage(){return localStorage["croquet-debug-ui-activePage"]},set activePage(t){localStorage["croquet-debug-ui-activePage"]=t}};function zt(t,e,n){var r=document.createElement("canvas"),o=r.width=40*Dt/12,i=r.height=60,a=r.getContext("2d");a.font="36px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(t,o/2,.55*i);var s=document.createElement("button");s.id=e,s.className="croquet_dock_button";var c=function(t){t.preventDefault(),t.stopPropagation(),n()};return Nt?s.ontouchstart=c:s.onclick=c,s.appendChild(r),s}function Gt(t,e){if(!1!==Zt.badge){var n=function(t){for(var e=new h(t),n=["bcdfghjklmnpqrstvwxyz","aeiou"],r="",o=0;o<5;o++)r+=n[o%2][e.quick()*n[o%2].length|0];return r}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+n;t.firstChild;)t.removeChild(t.firstChild);var r=document.createElement("canvas"),o=r.width=120,i=r.height=40;r.style.width="100%",t.appendChild(r);var a=r.getContext("2d"),s=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new h(t),r=[],o=0;o<e;o++)r.push("hsl(".concat(360*n.quick(),", 50%, 70%)"));return r}(e,2);a.fillStyle=s[0],a.beginPath(),a.moveTo(0,0),a.lineTo(0,i),a.lineTo(o,0),a.closePath(),a.fill(),a.fillStyle=s[1],a.beginPath(),a.moveTo(o,i),a.lineTo(o,0),a.lineTo(0,i),a.closePath(),a.fill(),a.font="30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="black",a.fillText(n,o/2,i/2)}}function Kt(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.firstChild;)t.removeChild(t.firstChild);return new ht(t,jt({text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:ht.CorrectLevel.L},n))}var Qt=0;function Yt(t){if(Jt!==t)if(!1===Zt.sync&&(t=!1),t&&!Vt&&(Vt=function(){var t=document.createElement("div");t.id="croquet_spinnerOverlay";var e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}()),Jt=t,t)clearTimeout(Qt),Qt=setTimeout((function(){Jt&&(Xt(Zt.root,(function(){return document.body})).appendChild(Vt),Vt.style.opacity=.9)}),500);else{if(!Vt)return;clearTimeout(Qt),Vt.style.opacity=0,Qt=setTimeout((function(){Jt||Vt.parentElement&&Vt.parentElement.removeChild(Vt)}),500)}}function Xt(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){var n=document.getElementById(t);if(n)return n}return e?e():null}var Zt={sessionURL:window.location.href,root:document.body,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!T.nodock){var e=document.getElementById("croquet_dock");e&&e.parentElement.removeChild(e);var n=Xt(Zt.root);if(n){var r=document.createElement("div");r.id="croquet_dock",n.appendChild(r);var o,i=document.createElement("div");i.id="croquet_dock_bar",r.appendChild(i),!1!==t.badge&&((o=document.createElement("div")).id="croquet_badge",i.appendChild(o),Zt.badge=o);var a=document.createElement("div");a.id="croquet_dock_content",r.appendChild(a);var s,c,u=[];if(!1!==t.qrcode){var l=Zt.sessionURL;l&&((s=document.createElement("div")).id="croquet_qrcode",a.appendChild(s),u.push(s.id),Zt.qrcode=s)}if(!1!==t.stats&&((c=document.createElement("div")).id="croquet_stats",a.appendChild(c),u.push(c.id),Zt.stats=c),u.length){var h=function(t){var e,n=u.length,r=0;if(Wt.activePage){var o=u.indexOf(Wt.activePage);o>=0?(r=o,e=document.getElementById(Wt.activePage)):Wt.activePage=null}var i,a=u[(r+n+t)%n];a===Wt.activePage?i=e:(e&&e.classList.remove("active"),i=document.getElementById(a)),i&&i.classList.add("active"),Wt.activePage=a};u.length>1&&(i.appendChild(zt("<","croquet_dock_left",(function(){return h(-1)}))),i.appendChild(zt(">","croquet_dock_right",(function(){return h(1)})))),h(0)}if(!Nt){var f=zt("📌","croquet_dock_pin",(function(){Wt.pinned=!Wt.pinned,d()})),d=function(){Wt.pinned?f.classList.add("pinned"):f.classList.remove("pinned")};d(),i.appendChild(f)}var p=200,v=166,y=8,m=function(t){r.style.width="".concat(t,"px"),r.style.height="".concat(1.18*t,"px");var e=18*t/100;i.style.height="".concat(e,"px"),a.style.top="".concat(e+2,"px"),o&&(o.style.height="".concat(.9*e,"px"),o.style.width="".concat(.9*e*3,"px")),s&&(s.style.border="".concat(y*t/p,"px solid white"))},g=function(){r.style.width=r.style.height="",i.style.height="",a.style.top="",o&&(o.style.height=o.style.width=""),s&&(s.style.border="")},b=p,w=function(){return r.classList.contains("active")},k=function(){r.classList.add("active"),m(b),setTimeout((function(){return r.style.transition="none"}),300)},S=function(){r.style.transition="",r.classList.remove("active"),g()};if(Nt)S(),r.ontouchstart=function(t){t.preventDefault(),t.stopPropagation(),w()?S():k()};else{Wt.pinned?k():S();var x=0;r.onwheel=function(t){t.preventDefault(),t.stopPropagation();var e=Date.now();if(!(e-x<100)){x=e;var n=t.deltaY;n=Math.sign(n)*Math.min(5,Math.abs(n));var o=.8*Math.min(window.innerWidth,window.innerHeight);b=Math.max(v,Math.min(o,r.offsetWidth*Math.pow(1.05,n))),m(b)}},r.onmouseenter=k,r.onmouseleave=function(){Wt.pinned||S()}}}}},makeSessionWidgets:function(t){!function(t){if(t&&!1!==Zt.root){var e=Xt(Zt.badge);e&&Gt(e,t)}}(t),function(){if(!1!==Zt.root&&!1!==Zt.qrcode&&!T.noqr){var t=Zt.sessionURL;if(t){var e=Xt(Zt.qrcode);if(e)Nt||(e.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.open(t)}),Kt(e,t).getCanvas().style.width="100%"}else console.warn("App.sessionURL is not set")}}(),function(){if(!1!==Zt.root&&!T.nostats){var t=Xt(Zt.stats);t&&kt(t)}}()},makeQRCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Zt.sessionURL)return null;var e=document.createElement("div"),n=Kt(e,Zt.sessionURL,t);return n&&n.getCanvas()},clearSessionMoniker:function(){!1!==Zt.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait:function(t){!1===Zt.root&&(t=!1),Yt(t)},messageFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("once"===e.only){if(Lt.has(t))return null;Lt.add(t)}var n,r=e.level;return"error"===r?(n="red",console.error(t)):"warning"===r?(n="gold",console.warn(t)):n="#aaa",$t(t,jt({backgroundColor:n},e))},showMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T.nomessages||!1===Zt.root||!1===Zt.messages||!Zt.messageFunction?null:Zt.messageFunction(t,e)}};function te(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var ee=function(t){d(i,y);var e,o=(e=i,function(){var t,n=v(e);if(te()){var r=v(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return p(this,t)});function i(){return n(this,i),o.apply(this,arguments)}return r(i,[{key:"poll",value:function(){var t=f(v(i.prototype),"poll",this).call(this);return this.array[this.size]=null,t}},{key:"asArray",value:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t}},{key:"asUnsortedArray",value:function(){return this.array.slice(0,this.size)}}]),i}();function ne(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return re(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function re(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function oe(t,e){function n(t){var n,r=ne(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.for===e&&t.delete(o)}}catch(t){r.e(t)}finally{r.f()}}return n(t.immediate),n(t.oncePerFrame),n(t.oncePerFrameWhileSynced),n(t.queued),t.immediate.size+t.queued.size+t.oncePerFrame.size+t.oncePerFrameWhileSynced.size}var ie=new(function(){function t(){n(this,t),this.subscriptions={},this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.id=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})),this.lastId=0}return r(t,[{key:"register",value:function(t){return this.id+"/V"+ ++this.lastId}},{key:"deregister",value:function(t){}},{key:"addSubscription",value:function(t,e,n,r,o){if("vote"!==o){var i=t+":"+e,a=r;a.for=n;var s=this.subscriptions[i];if(s||(s=this.subscriptions[i]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!s[o])throw Error('Unknown subscribe() option: handling="'.concat(o,'"'));s[o].add(a)}else this.addSubscription(t,e+"#__vote",n,r,"immediate")}},{key:"removeSubscription",value:function(t,e,n){var r=t+":"+e,o=this.subscriptions[r];o&&(0===oe(o,n)&&delete this.subscriptions[r]);e.endsWith("#__vote")||this.removeSubscription(t,e+"#__vote",n)}},{key:"removeAllSubscriptionsFor",value:function(t){for(var n="".concat(t,":"),r=0,o=Object.entries(this.subscriptions);r<o.length;r++){var i=e(o[r],2),a=i[0],s=i[1];if(a.startsWith(n))delete this.subscriptions[a];else 0===oe(s,t)&&delete this.subscriptions[a]}}},{key:"handleEvent",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t()},r=this.subscriptions[t];r&&(r.queued.size>0&&this.queuedEvents.push({topic:t,data:e}),r.oncePerFrame.size>0&&this.perFrameEvents.set(t,e),r.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(t,e),r.immediate.size>0&&n((function(){var t,n=ne(r.immediate);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(t){n.e(t)}finally{n.f()}})))}},{key:"processFrameEvents",value:function(t){var n,r=this,o=0,i=function(t,e,n){var i=r.subscriptions[t];if(i){var a,s=ne(i[n]);try{for(s.s();!(a=s.n()).done;){(0,a.value)(e),o++}}catch(t){s.e(t)}finally{s.f()}}},a=ne(this.queuedEvents);try{for(a.s();!(n=a.n()).done;){var s=n.value;i(s.topic,s.data,"queued")}}catch(t){a.e(t)}finally{a.f()}this.queuedEvents.length=0;var c,u=ne(this.perFrameEvents);try{for(u.s();!(c=u.n()).done;){var l=e(c.value,2);i(l[0],l[1],"oncePerFrame")}}catch(t){u.e(t)}finally{u.f()}if(this.perFrameEvents.clear(),t){var h,f=ne(this.perSyncedFrameEvents);try{for(f.s();!(h=f.n()).done;){var d=e(h.value,2);i(d[0],d[1],"oncePerFrameWhileSynced")}}catch(t){f.e(t)}finally{f.f()}this.perSyncedFrameEvents.clear()}var p,v=ne(this.queuedEvents);try{for(v.s();!(p=v.n()).done;){var y=p.value;i(y.topic,y.data,"queued")}}catch(t){v.e(t)}finally{v.f()}return this.queuedEvents.length=0,o}}]),t}());var ae={get subscribe(){return(ae={subscribe:T.has("debug","subscribe",!1)}).subscribe}},se=function(){function t(e){n(this,t),this.island=e}return r(t,[{key:"register",value:function(t){return this.island.registerModel(t)}},{key:"deregister",value:function(t){this.island.deregisterModel(t.id)}},{key:"publish",value:function(t,e,n){this.island.publishFromModel(n,t,e)}},{key:"subscribe",value:function(t,e,n,r){return ae.subscribe&&console.log('Model.subscribe("'.concat(e,":").concat(n,'", ').concat(t," ").concat((""+r).replace(/\([\s\S]*/,""),")")),this.island.addSubscription(t,e,n,r)}},{key:"unsubscribe",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";ae.subscribe&&console.log("Model.unsubscribe(".concat(e,":").concat(n,'", ').concat(t," ").concat((""+r).replace(/\([\s\S]*/,""),")")),this.island.removeSubscription(t,e,n,r)}},{key:"unsubscribeAll",value:function(t){ae.subscribe&&console.log("Model.unsubscribeAll(".concat(t," ").concat(t.id,")")),this.island.removeAllSubscriptionsFor(t)}},{key:"future",value:function(t,e,n,r){if(ue&&ue.equal(this))return this.island.future(t,e,n,r);if(e)throw Error("tOffset not supported from cross-realm future send yet.");var o=this.island;return new Proxy(t,{get:function(e,n){if("function"==typeof t[n])return new Proxy(t[n],{apply:function(e,r,i){o.callModelMethod(t.id,n,i)}});throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}},{key:"random",value:function(){return this.island.random()}},{key:"now",value:function(){return this.island.time}},{key:"equal",value:function(e){return e instanceof t&&e.island===this.island}}]),t}(),ce=function(){function t(e){n(this,t),this.island=e}return r(t,[{key:"register",value:function(t){return ie.register(t)}},{key:"deregister",value:function(t){ie.deregister(t)}},{key:"publish",value:function(t,e,n){this.island.publishFromView(n,t,e)}},{key:"subscribe",value:function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"queued";ae.subscribe&&console.log('View.subscribe("'.concat(r,":").concat(t,'", ').concat(e," ").concat(n.name||(""+n).replace(/\([\s\S]*/,"")," [").concat(o,"])")),ie.addSubscription(r,t,e,n,o)}},{key:"unsubscribe",value:function(t,e,n,r){ae.subscribe&&console.log('View.unsubscribe("'.concat(r,":").concat(t,'", ').concat(e," ").concat(n.name||(""+n).replace(/\([\s\S]*/,""),")")),ie.removeSubscription(r,t,e,n)}},{key:"unsubscribeAll",value:function(t){ae.subscribe&&console.log("View.unsubscribeAll(".concat(t,")")),ie.removeAllSubscriptionsFor(t)}},{key:"future",value:function(t,e){return e?new Proxy(t,{get:function(n,r){if("function"==typeof t[r])return new Proxy(t[r],{apply:function(n,i,a){setTimeout((function(){t.id&&t[r].apply(t,o(a))}),e)}});throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}}):t}},{key:"random",value:function(){return Math.random()}},{key:"now",value:function(){return this.island.time}},{key:"externalNow",value:function(){return this.island.controller.time}},{key:"isSynced",value:function(){return!!this.island.controller.synced}},{key:"equal",value:function(e){return e instanceof t&&e.island===this.island}}]),t}(),ue=null;function le(){if(!ue)throw Error("Tried to execute code that requires realm outside of realm.");return ue}function he(t,e){if(null!==ue)throw Error("Can't switch realms from inside realm");try{return ue=new se(t),e()}finally{ue=null}}function fe(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==ue&&!n)throw Error("Can't switch realms from inside realm");var r=ue;try{return ue=new ce(t),e()}finally{ue=r}}function de(t){return function(){var e,n=v(t);if(pe()){var r=v(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return p(this,e)}}function pe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function ve(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return ye(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(){var t,e=function(t){return t!=t},n=Math.sqrt,r=.7853981633974483,o=function(t){var o,i,a,s,c;if(e(t))return NaN;if(t>0?a=t:(o=!0,a=-t),a>1)return NaN;if(a>.625)s=(i=1-a)*function(t){var e,n;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),n=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),n=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/n)}(i),i=n(i+i),c=r-i,c-=i=i*s-6123233995736766e-32,c+=r;else{if(a<1e-8)return t;c=a*(c=(i=a*a)*function(t){var e,n;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,n=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),n=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/n)}(i))+a}return o?-c:c},a="function"==typeof Symbol&&"symbol"==i(Symbol("foo")),s=Object.prototype.toString,c=Object.prototype.hasOwnProperty,u="function"==typeof Symbol?Symbol.toStringTag:"",l={};t=a&&"symbol"==i(Symbol.toStringTag)?function(t){var e,n,r;if(null==t)return s.call(t);n=t[u],e=function(t,e){return null!=t&&c.call(t,e)}(t,u);try{t[u]=void 0}catch(e){return s.call(t)}return r=s.call(t),e?t[u]=n:delete t[u],r}:function(t){return s.call(t)},l=t;var h="function"==typeof Uint32Array,f="function"==typeof Uint32Array?Uint32Array:null,d="function"==typeof Uint32Array?Uint32Array:null,p={};p=function(){var t,e;if("function"!=typeof f)return!1;try{t=function(t){return h&&t instanceof Uint32Array||"[object Uint32Array]"===l(t)}(e=new f(e=[1,3.14,-3.14,4294967296,4294967297]))&&1===e[0]&&3===e[1]&&4294967293===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?d:function(){throw new Error("not implemented")};var v="function"==typeof Float64Array,y="function"==typeof Float64Array?Float64Array:null,m="function"==typeof Float64Array?Float64Array:null,g={};g=function(){var t,e;if("function"!=typeof y)return!1;try{t=function(t){return v&&t instanceof Float64Array||"[object Float64Array]"===l(t)}(e=new y([1,3.14,-3.14,NaN]))&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t}()?m:function(){throw new Error("not implemented")};var b,w="function"==typeof Uint8Array,k="function"==typeof Uint8Array?Uint8Array:null,S="function"==typeof Uint8Array?Uint8Array:null;b=function(){var t,e;if("function"!=typeof k)return!1;try{t=function(t){return w&&t instanceof Uint8Array||"[object Uint8Array]"===l(t)}(e=new k(e=[1,3.14,-3.14,256,257]))&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?S:function(){throw new Error("not implemented")};var x,C="function"==typeof Uint16Array,E="function"==typeof Uint16Array?Uint16Array:null,O="function"==typeof Uint16Array?Uint16Array:null,_={uint16:function(){var t,e;if("function"!=typeof E)return!1;try{t=function(t){return C&&t instanceof Uint16Array||"[object Uint16Array]"===l(t)}(e=new E(e=[1,3.14,-3.14,65536,65537]))&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t}()?O:function(){throw new Error("not implemented")},uint8:b};(x=new _.uint16(1))[0]=4660;var A,T=52===new _.uint8(x.buffer)[0];A=!0===T?1:0;var M,j=new g(1),I=new p(j.buffer),q=function(t){return j[0]=t,I[A]};M=!0===T?1:0;var P,N,D,R=new g(1),L=new p(R.buffer),B=function(t,e){return R[0]=t,L[M]=e>>>0,R[0]},U=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,H=.6931471803691238,$=1.9082149292705877e-10,V=function(t){var n,r,o,i,a,s,c,u,l,h;if(t<-1||e(t))return NaN;if(-1===t)return F;if(t===U)return t;if(0===t)return t;if(h=1,(o=t<0?-t:t)<.41421356237309503){if(o<1.862645149230957e-9)return o<5551115123125783e-32?t:t-t*t*.5;t>-.2928932188134525&&(h=0,i=t,r=1)}return 0!==h&&(o<9007199254740992?(a=(h=((r=q(l=1+t))>>20)-1023)>0?1-(l-t):t-(l-1),a/=l):(h=((r=q(l=t))>>20)-1023,a=0),(r&=1048575)<434334?l=B(l,1072693248|r):(h+=1,l=B(l,1071644672|r),r=1048576-r>>2),i=l-1),n=.5*i*i,0===r?0===i?h*H+(a+=h*$):h*H-((u=n*(1-.6666666666666666*i))-(h*$+a)-i):(u=(c=(s=i/(2+i))*s)*function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.3999999999940942+t*(.2857142874366239+t*(.22222198432149784+t*(.1818357216161805+t*(.15313837699209373+.14798198605116586*t)))))}(c),0===h?i-(n-s*(n+u)):h*H-(n-(s*(n+u)+(h*$+a))-i))},J=.6931471805599453,W=1.9082149292705877e-10,z=function(t){var n,r,o,i,a,s,c,u,l,h,f;return 0===t?F:e(t)||t<0?NaN:(i=0,(r=q(t))<1048576&&(i-=54,r=q(t*=0x40000000000000)),r>=2146435072?t+t:(i+=(r>>20)-1023|0,i+=(c=614244+(r&=1048575)&1048576|0)>>20|0,s=(t=B(t,r|1072693248^c))-1,(1048575&2+r)<3?0===s?0===i?0:.6931471803691238*i+i*W:(a=s*s*(.5-.3333333333333333*s),0===i?s-a:.6931471803691238*i-(a-i*W-s)):(c=r-398458|0,u=440401-r|0,o=(h=(f=(l=s/(2+s))*l)*f)*function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)}(h),a=f*function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))}(h)+o,(c|=u)>0?(n=.5*s*s,0===i?s-(n-l*(n+a)):.6931471803691238*i-(n-(l*(n+a)+i*W)-s)):0===i?s-l*(s-a):.6931471803691238*i-(l*(s-a)-i*W-s))))},G=function(t){return t===U||t===F},K=1.5707963267948966,Q=function(t){var n,o,i,a;return e(t)||0===t?t:t===U?K:t===F?-K:(t<0&&(o=!0,t=-t),n=0,t>2.414213562373095?(i=K,n=1,t=-1/t):t<=.66?i=0:(i=r,n=2,t=(t-1)/(t+1)),a=t*(a=(a=t*t)*function(t){return 0===t?-64.85021904942025:t*(t*(t*(-.8750608600031904*t-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025}(a)/function(t){return 0===t?194.5506571482614:194.5506571482614+t*(485.3903996359137+t*(432.88106049129027+t*(165.02700983169885+t*(24.858464901423062+1*t))))}(a))+t,2===n?a+=3061616997868383e-32:1===n&&(a+=6123233995736766e-32),i+=a,o?-i:i)};!0===T?(N=1,D=0):(N=0,D=1),P={HIGH:N,LOW:D};var Y,X,Z,tt=new g(1),et=new p(tt.buffer),nt=P.HIGH,rt=P.LOW,ot=function(t,e){return tt[0]=e,t[0]=et[nt],t[1]=et[rt],t},it=function(t,e){return 1===arguments.length?ot([0,0],t):ot(t,e)};!0===T?(X=1,Z=0):(X=0,Z=1),Y={HIGH:X,LOW:Z};var at,st=new g(1),ct=new p(st.buffer),ut=Y.HIGH,lt=Y.LOW,ht=function(t,e){return ct[ut]=t,ct[lt]=e,st[0]},ft=[0,0],dt=function(t,e){var n,r;return it(ft,t),n=ft[0],n&=2147483647,r=q(e),ht(n|=r&=2147483648,ft[1])},pt=3.141592653589793,vt=function(t,e){var n,r,o,i;return o=(i=t*t)*i,r=i*function(t){return 0===t?.0416666666666666:.0416666666666666+t*(2480158728947673e-20*t-.001388888888887411)}(i),r+=o*o*function(t){return 0===t?-2.7557314351390663e-7:t*(2.087572321298175e-9+-11359647557788195e-27*t)-2.7557314351390663e-7}(i),(o=1-(n=.5*i))+(1-o-n+(i*r-t*e))},yt=-.16666666666666632,mt=function(t,e){var n,r,o;return n=.00833333333332249+(o=t*t)*(27557313707070068e-22*o-.0001984126982985795)+o*(o*o)*(1.58969099521155e-10*o-2.5050760253406863e-8),r=o*t,0===e?t+r*(yt+o*n):t-(o*(.5*e-r*n)-e-r*yt)};at=!0===T?0:1;var gt=new g(1),bt=new p(gt.buffer),wt=Math.floor,kt=function(t){return t<0?-t:0===t?0:t},St=function(t,n){return e(n)||G(n)?(t[0]=n,t[1]=0,t):0!==n&&kt(n)<22250738585072014e-324?(t[0]=4503599627370496*n,t[1]=-52,t):(t[0]=n,t[1]=0,t)},xt=[0,0],Ct=[0,0],Et=function(t,n){var r,o;return 0===t||e(t)||G(t)?t:(function(t,e){1===arguments.length?St([0,0],t):St(t,e)}(xt,t),n+=xt[1],(n+=function(t){var e=q(t);return(e=(2146435072&e)>>>20)-1023|0}(t=xt[0]))<-1074?dt(0,t):n>1023?t<0?F:U:(n<=-1023?(n+=52,o=2220446049250313e-31):o=1,it(Ct,t),r=Ct[0],r&=2148532223,o*ht(r|=n+1023<<20,Ct[1])))},Ot=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],_t=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],At=5.960464477539063e-8,Tt=qt(new Array(20)),Mt=qt(new Array(20)),jt=qt(new Array(20)),It=qt(new Array(20));function qt(t){var e,n=t.length;for(e=0;e<n;e++)t[e]=0;return t}var Pt,Nt=Math.round,Dt=function(t,e,n){var r,o,i,a,s;return i=t-1.5707963267341256*(r=Nt(.6366197723675814*t)),a=6077100506506192e-26*r,s=e>>20|0,n[0]=i-a,s-(q(n[0])>>20&2047)>16&&(a=20222662487959506e-37*r-((o=i)-(i=o-(a=6077100506303966e-26*r))-a),n[0]=i-a,s-(q(n[0])>>20&2047)>49&&(a=84784276603689e-45*r-((o=i)-(i=o-(a=20222662487111665e-37*r))-a),n[0]=i-a)),n[1]=i-n[0]-a,r},Rt=1.5707963267341256,Lt=6077100506506192e-26,Bt=2*Lt,Ut=4*Lt,Ft=new Array(3),Ht=new Array(2),$t=function(t,e){var n,r,o,i,a,s,c;if((o=2147483647&q(t)|0)<=1072243195)return e[0]=t,e[1]=0,0;if(o<=1074752122)return 598523==(1048575&o)?Dt(t,o,e):o<=1073928572?t>0?(c=t-Rt,e[0]=c-Lt,e[1]=c-e[0]-Lt,1):(c=t+Rt,e[0]=c+Lt,e[1]=c-e[0]+Lt,-1):t>0?(c=t-2*Rt,e[0]=c-Bt,e[1]=c-e[0]-Bt,2):(c=t+2*Rt,e[0]=c+Bt,e[1]=c-e[0]+Bt,-2);if(o<=1075594811)return o<=1075183036?1074977148===o?Dt(t,o,e):t>0?(c=t-3*Rt,e[0]=c-1.8231301519518578e-10,e[1]=c-e[0]-1.8231301519518578e-10,3):(c=t+3*Rt,e[0]=c+1.8231301519518578e-10,e[1]=c-e[0]+1.8231301519518578e-10,-3):1075388923===o?Dt(t,o,e):t>0?(c=t-4*Rt,e[0]=c-Ut,e[1]=c-e[0]-Ut,4):(c=t+4*Rt,e[0]=c+Ut,e[1]=c-e[0]+Ut,-4);if(o<1094263291)return Dt(t,o,e);if(o>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(n=function(t){return gt[0]=t,bt[at]}(t),c=ht(o-((r=(o>>20)-1046)<<20|0),n),a=0;a<2;a++)Ft[a]=0|c,c=16777216*(c-Ft[a]);for(Ft[2]=c,i=3;0===Ft[i-1];)i-=1;return s=function(t,e,n,r){var o,i,a,s,c,u,l;for((i=(n-3)/24|0)<0&&(i=0),s=n-24*(i+1),u=i-(a=r-1),l=a+4,c=0;c<=l;c++)Tt[c]=u<0?0:Ot[u],u+=1;for(c=0;c<=4;c++){for(o=0,u=0;u<=a;u++)o+=t[u]*Tt[a+(c-u)];Mt[c]=o}return function t(e,n,r,o,i,a,s,c,u){var l,h,f,d,p,v,y,m,g;for(d=a,g=o[r],m=r,p=0;m>0;p++)h=At*g|0,It[p]=g-16777216*h|0,g=o[m-1]+h,m-=1;if(g=Et(g,i),g-=8*wt(.125*g),g-=y=0|g,f=0,i>0?(y+=p=It[r-1]>>24-i,It[r-1]-=p<<24-i,f=It[r-1]>>23-i):0===i?f=It[r-1]>>23:g>=.5&&(f=2),f>0){for(y+=1,l=0,p=0;p<r;p++)m=It[p],0===l?0!==m&&(l=1,It[p]=16777216-m):It[p]=16777215-m;if(i>0)switch(i){case 1:It[r-1]&=8388607;break;case 2:It[r-1]&=4194303}2===f&&(g=1-g,0!==l&&(g-=Et(1,i)))}if(0===g){for(m=0,p=r-1;p>=a;p--)m|=It[p];if(0===m){for(v=1;0===It[a-v];v++);for(p=r+1;p<=r+v;p++){for(u[c+p]=Ot[s+p],h=0,m=0;m<=c;m++)h+=e[m]*u[c+(p-m)];o[p]=h}return t(e,n,r+=v,o,i,a,s,c,u)}}if(0===g)for(r-=1,i-=24;0===It[r];)r-=1,i-=24;else(g=Et(g,-i))>=16777216?(h=At*g|0,It[r]=g-16777216*h|0,i+=24,It[r+=1]=h):It[r]=0|g;for(h=Et(1,i),p=r;p>=0;p--)o[p]=h*It[p],h*=At;for(p=r;p>=0;p--){for(h=0,v=0;v<=d&&v<=r-p;v++)h+=_t[v]*o[p+v];jt[r-p]=h}for(h=0,p=r;p>=0;p--)h+=jt[p];for(n[0]=0===f?h:-h,h=jt[0]-h,p=1;p<=r;p++)h+=jt[p];return n[1]=0===f?h:-h,7&y}(t,e,4,Mt,s,4,i,a,Tt)}(Ft,Ht,r,i),t<0?(e[0]=-Ht[0],e[1]=-Ht[1],-s):(e[0]=Ht[0],e[1]=Ht[1],s)},Vt=[0,0],Jt=Math.ceil,Wt=function(t){var n;return e(t)||t===U?t:t===F?0:t>709.782712893384?U:t<-745.1332191019411?0:t>-1/(1<<28)&&t<1/(1<<28)?1+t:function(t,e,n){var r,o,i,a;return i=(r=t-e)-(o=r*r)*(0===(a=o)?.16666666666666602:.16666666666666602+a*(a*(6613756321437934e-20+a*(4.1381367970572385e-8*a-16533902205465252e-22))-.0027777777777015593)),Et(1-(e-r*i/(2-i)-t),n)}(t-.6931471803691238*(n=function(t){return t<0?Jt(t):wt(t)}(t<0?1.4426950408889634*t-.5:1.4426950408889634*t+.5)),1.9082149292705877e-10*n,n)};Pt=!0===T?0:1;var zt=new g(1),Gt=new p(zt.buffer),Kt=function(t,e){return zt[0]=t,Gt[Pt]=e>>>0,zt[0]},Qt=[0,0],Yt=[0,0],Xt=function(t,e,n){var r,o,i,a,s,c,u,l,h;return(o=2147483647&(r=q(t))|0)>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(l=3061616997868383e-32-e),e=0),a=e+(h=t*t)*((s=h*t)*((a=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))}(l=h*h))+(u=h*function(t){return 0===t?.05396825397622605:.05396825397622605+t*(.0088632398235993+t*(.0014562094543252903+t*(.0002464631348184699+t*(7140724913826082e-20+2590730518636337e-20*t))))}(l)))+e),l=t+(a+=.3333333333333341*s),o>=1072010280?(1-(r>>30&2))*((u=n)-2*(t-(l*l/(l+u)-a))):1===n?l:(Kt(h=l,0),u=a-(h-t),Kt(c=i=-1/l,0),c+i*((s=1+c*h)+c*u))},Zt=[0,0];void 0===window.CroquetMath&&(window.CroquetMath={}),window.CroquetMath.acos=function(t){var i;return e(t)||t<-1||t>1?NaN:t>.5?2*o(n(.5-.5*t)):(i=r-o(t),i+=6123233995736766e-32,i+=r)},window.CroquetMath.acosh=function(t){var r;return e(t)||t<1?NaN:1===t?0:t>=1<<28?z(t)+J:t>2?z(2*t-1/(t+n(t*t-1))):V((r=t-1)+n(2*r+r*r))},window.CroquetMath.asin=o,window.CroquetMath.asinh=function(t){var r,o,i;return e(t)||G(t)?t:(t<0&&(t=-t,r=!0),i=t<1/(1<<28)?t:t>1<<28?z(t)+J:t>2?z(2*t+1/(n(t*t+1)+t)):V(t+(o=t*t)/(1+n(1+o))),r?-i:i)},window.CroquetMath.atan=Q,window.CroquetMath.atanh=function(t){var n,r;return e(t)||t<-1||t>1?NaN:1===t?U:-1===t?F:(t<0&&(n=!0,t=-t),t<1/(1<<28)?n?-t:t:(r=t<.5?.5*V((r=t+t)+r*t/(1-t)):.5*V((t+t)/(1-t)),n?-r:r))},window.CroquetMath.atan2=function(t,n){var r;return e(n)||e(t)?NaN:G(n)?n===U?G(t)?dt(pt/4,t):dt(0,t):G(t)?dt(3*pt/4,t):dt(pt,t):G(t)?dt(pt/2,t):0===t?n>=0&&!function(t){return!!(q(t)>>>31)}(n)?dt(0,t):dt(pt,t):0===n?dt(pt/2,t):(r=Q(t/n),n<0?r<=0?r+pt:r-pt:r)},window.CroquetMath.cbrt=function(t){var n,r,o,i,a;return e(t)||G(t)||0===t?t:(r=-2147483648&(o=q(t)),o&=2147483647,a=0,t<22250738585072014e-324?(a=0x40000000000000,n=q(a*=t),a=ht(r|(n=(2147483647&n)/3+696219795),0)):a=B(a,r|(n=o/3+715094163)),a*=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)}(i=a*a*(a/t)),n=q(a),a=ht(n+1,0),a+=a*(i=((i=t/(a*a))-a)/(a+a+i)))},window.CroquetMath.cos=function(t){var e;if(e=q(t),(e&=2147483647)<=1072243195)return e<1044381696?1:vt(t,0);if(e>=2146435072)return NaN;switch(3&$t(t,Vt)){case 0:return vt(Vt[0],Vt[1]);case 1:return-mt(Vt[0],Vt[1]);case 2:return-vt(Vt[0],Vt[1]);default:return mt(Vt[0],Vt[1])}},window.CroquetMath.cosh=function(t){return e(t)?t:(t<0&&(t=-t),t>21?Wt(t)/2:(Wt(t)+Wt(-t))/2)},window.CroquetMath.exp=Wt,window.CroquetMath.expm1=function(t){var n,r,o,i,a,s,c,u,l,h,f,d;if(t===U||e(t))return t;if(t===F)return-1;if(0===t)return t;if(t<0?(r=!0,c=-t):(r=!1,c=t),c>=38.816242111356935){if(r)return-1;if(c>=709.782712893384)return U}if(a=0|q(c),c>.34657359027997264)c<1.0397207708399179?r?(o=t+.6931471803691238,i=-1.9082149292705877e-10,d=-1):(o=t-.6931471803691238,i=1.9082149292705877e-10,d=1):(d=r?1.4426950408889634*t-.5:1.4426950408889634*t+.5,o=t-.6931471803691238*(h=d|=0),i=1.9082149292705877e-10*h),l=o-(t=o-i)-i;else{if(a<1016070144)return t;d=0}return f=(u=t*(n=.5*t))*(((s=1+u*function(t){return 0===t?-.03333333333333313:t*(.0015873015872548146+t*(t*(4008217827329362e-21+-2.0109921818362437e-7*t)-793650757867488e-19))-.03333333333333313}(u))-(h=3-s*n))/(6-t*h)),0===d?t-(t*f-u):(f=t*(f-l)-l,f-=u,-1===d?.5*(t-f)-.5:1===d?t<-.25?-2*(f-(t+.5)):1+2*(t-f):d<=-2||d>56?(o=q(c=1-(f-t))+(d<<20)|0,(c=B(c,o))-1):(h=1,d<20?c=(h=B(h,o=1072693248-(2097152>>d)|0))-(f-t):(c=t-(f+(h=B(h,o=1023-d<<20|0))),c+=1),o=q(c)+(d<<20)|0,B(c,o)))},window.CroquetMath.log=z,window.CroquetMath.log1p=V,window.CroquetMath.log10=function(t){var n,r,o,i,a,s,c;return e(t)||t<0?NaN:0===t?F:(a=0,(r=q(t))<1048576&&(a-=54,r=q(t*=0x40000000000000)),r>=2146435072?t+t:(a+=(r>>20)-1023|0,t=B(t,(r&=1048575)|1072693248^(i=r+614244&1048576|0)),s=a+=i>>20|0,o=function(t){var e,n,r,o,i,a,s,c,u,l;return o=t-1,(1048575&2+(r=q(t)))<3?0===o?0:o*o*(.3333333333333333*o-.5):(u=(r&=1048575)-398458|0,l=440401-r|0,n=(c=(a=(i=o/(2+o))*i)*a)*function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)}(c),s=a*function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))}(c)+n,(u|=l)>0?i*((e=.5*o*o)+s)-e:i*(s-o))}(t),n=Kt(t-=1,0),c=3694239077158931e-28*s+25082946711645275e-27*(t+o),(c+=.4342944818781689*(t-n+o)+.4342944818781689*n)+.30102999566361177*s))},window.CroquetMath.log2=function(t){var n,r,o,i,a;if(e(t)||t<0)return NaN;if(it(Qt,t),a=0,(r=Qt[0])<1048576){if(0==(2147483647&r|Qt[1]))return F;a-=54,r=q(t*=0x40000000000000)}return r>=2146435072?t+t:(a+=(r>>20)-1023|0,t=B(t,(r&=1048575)|1072693248^(i=r+614244&1048576|0)),a+=i>>20|0,o=function(t){var e,n,r,o,i,a,s,c,u,l;return o=t-1,(1048575&2+(r=q(t)))<3?0===o?0:o*o*(.3333333333333333*o-.5):(u=(r&=1048575)-398458|0,l=440401-r|0,n=(c=(a=(i=o/(2+o))*i)*a)*function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)}(c),s=a*function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))}(c)+n,(u|=l)>0?i*((e=.5*o*o)+s)-e:i*(s-o))}(t),n=Kt(t-=1,0),1.6751713164886512e-10*(t+o)+1.4426950407214463*(t-n+o)+1.4426950407214463*n+a)},window.CroquetMath.sin=function(t){var e;if(e=q(t),(e&=2147483647)<=1072243195)return e<1045430272?t:mt(t,0);if(e>=2146435072)return NaN;switch(3&$t(t,Yt)){case 0:return mt(Yt[0],Yt[1]);case 1:return vt(Yt[0],Yt[1]);case 2:return-mt(Yt[0],Yt[1]);default:return-vt(Yt[0],Yt[1])}},window.CroquetMath.sinh=function(t){var e;return 0===t?t:(e=kt(t),t>710.4758600739439||t<-709.089565712824?t>0?U:F:e>1?e>=709.0895657128241?(e=Wt(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=Wt(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*function(t){var e,n;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,n=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,n=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/n)}(e))},window.CroquetMath.tan=function(t){var e,n;return e=q(t),(e&=2147483647)<=1072243195?e<1044381696?t:Xt(t,0,1):e>=2146435072?NaN:(n=$t(t,Zt),Xt(Zt[0],Zt[1],1-((1&n)<<1)))},window.CroquetMath.tanh=function(t){var e,n;if((n=kt(t))>44.014845965556525)return t<0?-1:1;if(n>=.625)n=1-2/((e=Wt(2*n))+1),t<0&&(n=-n);else{if(0===t)return t;n=t+t*(e=t*t)*function(t){var e,n;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,n=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),n=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/n)}(e)}return n};var te=Math.pow;function ee(t){return t===1/0||t===-1/0}window.CroquetMath.pow=function(t,e){if(isNaN(t)||isNaN(e))return NaN;if(ee(t)||ee(e))return te(t,e);if(0===t||0===e)return te(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;var n=1;return t<0&&(t*=-1,n=te(-1,e)),window.CroquetMath.exp(window.CroquetMath.log(t)*e)*n}}();var me=null,ge={};function be(t,e){var n=JSON.parse(atob(t.slice(1,-1))),r=n.qPara,i=n.qArgs,a=n.qFn,s=JSON.stringify(r),c=ge[s]||(ge[s]=g(Function,o(r)));return"number"==typeof a&&(i[a]=c),c.call.apply(c,[e].concat(o(i))).bind(e)}function we(t,e){if(me)throw Error("Island confusion");if(!(t instanceof ke))throw Error("not an island: "+t);var n=me;try{me=t,window.ISLAND=t,e()}finally{me=n}}var ke=function(){function t(e,r){var o=this;n(this,t),t.installCustomMath(),we(this,(function(){he(o,(function(){if(o.modelsById={},o.modelsByName={},o.messages=new ee((function(t,e){return t.before(e)})),o.subscriptions={},o.users={},o._random=function(){throw Error("You must not use random when applying state!")},o.id=e.id,o.time=0,o.seq=4294967280,o.externalTime=0,o.externalSeq=o.seq,o.futureSeq=0,o.tuttiSeq=0,o.lastSnapshotPoll=0,o.modelsId=0,e.modelsById)for(var t=Me.newOrRecycled(o).readIsland(e,"$"),n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];if(a in o||"meta"===a)if("messages"===a){var s,c=ve(t.messages);try{for(c.s();!(s=c.n()).done;){var u=s.value;o.messages.add(u)}}catch(t){c.e(t)}finally{c.f()}}else o[a]=t[a];else console.warn("Ignoring property snapshot.".concat(a))}else{o._random=new h(null,{state:!0});var l=r(o)||{};Object.assign(o.modelsByName,l),o.addSubscription(o,o.id,"__users__",o.generateJoinExit)}}))}))}return r(t,null,[{key:"current",value:function(){return me||console.warn("No CurrentIsland!"),me}},{key:"hasCurrent",value:function(){return!!me}},{key:"installCustomMath",value:function(){if(!window.BrowserMath){window.CroquetMath.random=function(){return me.random()},window.BrowserMath={};for(var t=function(){var t=e(r[n],2),o=t[0],i=t[1],a=window.Math[o];window.BrowserMath[o]=a,window.Math[o]=["pow","atan2"].includes(o)?function(t,e){return me?i(t,e):a(t,e)}:function(t){return me?i(t):a(t)}},n=0,r=Object.entries(window.CroquetMath);n<r.length;n++)t()}}}]),r(t,[{key:"registerModel",value:function(t,e){if(me!==this)throw Error("Island Error");return e||(e=this.id+"/M"+ ++this.modelsId),this.modelsById[e]=t,e}},{key:"deregisterModel",value:function(t){if(me!==this)throw Error("Island Error");var n=this.modelsById;delete this.modelsById[t];for(var r=0,o=Object.entries(this.modelsByName);r<o.length;r++){var i=e(o[r],2),a=i[0];n===i[1]&&delete this.modelsByName[a]}this.messages.removeMany((function(e){return e.hasReceiver(t)}))}},{key:"lookUpModel",value:function(t){if(t===this.id)return this;var n=this.modelsById[t];if(n)return n;var r=t.match(/^([^#]+)#(.*)$/),o=e(r,3),i=(o[0],o[1]),a=o[2];return this.modelsById[i].lookUp(a)}},{key:"get",value:function(t){return this.modelsByName[t]}},{key:"set",value:function(t,e){if(me!==this)throw Error("Island Error");this.modelsByName[t]=e}},{key:"getNextTuttiSeq",value:function(){return this.tuttiSeq=this.tuttiSeq+1>>>0,this.tuttiSeq}},{key:"callModelMethod",value:function(t,e,n){if(me)throw Error("Island Error");var r=this.lookUpModel(t);if(r){var o=new Oe(this.time,0,r.id,e,n);this.controller.sendMessage(o)}else console.error(Error("Model not found: ".concat(t)))}},{key:"noop",value:function(){}},{key:"generateJoinExit",value:function(t){var n,r=t.entered,o=t.exited,i=t.count,a=ve(o=r.length===i?Object.keys(this.users):o.map((function(t){return t[0]})));try{for(a.s();!(n=a.n()).done;){var s=n.value;this.users[s]&&(delete this.users[s],this.publishFromModel(this.id,"view-exit",s))}}catch(t){a.e(t)}finally{a.f()}var c,u=ve(r);try{for(u.s();!(c=u.n()).done;){var l=e(c.value,3),h=l[0],f=l[1],d=l[2];this.users[h]||(this.users[h]={name:f},d&&(this.users[h].location=d),this.publishFromModel(this.id,"view-join",h))}}catch(t){u.e(t)}finally{u.f()}}},{key:"scheduleExternalMessage",value:function(t){var e=Oe.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);var n=this.externalSeq+1>>>0;if(e.seq!==n)throw Error("External message error. Expected message #".concat(n," got #").concat(e.seq));return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.messages.add(e),e}},{key:"futureSend",value:function(t,e,n,r){if(t.every)return this.futureRepeat(t.every,e,n,r);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;var o=new Oe(this.time+t,2*this.futureSeq,e,n,r);return this.messages.add(o),o}},{key:"futureRepeat",value:function(t,e,n,r){this.futureSend(t,this.id,"futureExecAndRepeat",[t,e,n,r])}},{key:"futureExecAndRepeat",value:function(t,e,n,r){var i=this.lookUpModel(e);if("function"==typeof i[n])try{i[n].apply(i,o(r))}catch(t){Ht("future message ".concat(i,".").concat(n),t)}else{var a=be(n,i);try{a.apply(void 0,o(r))}catch(t){Ht("future message ".concat(i," ").concat(a),t)}}this.futureRepeat(t,e,n,r)}},{key:"future",value:function(t,e,n,r){var o=this.asQFunc(t,n);if("string"==typeof o)return this.futureSend(e,t.id,o,r);var i=this;return new Proxy(t,{get:function(n,r){if("function"==typeof t[r])return function(){if(i.lookUpModel(t.id)!==t)throw Error("future send to unregistered model");for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i.futureSend(e,t.id,r,o)};throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}},{key:"advanceTo",value:function(t,e){if(me)throw Error("Island Error");for(var n,r=0;(n=this.messages.peek())&&n.time<=t;){var o=n,i=o.time,a=o.seq;if(i<this.time)throw Error("past message encountered: "+n);if(1&a&&(this.seq=this.seq+1>>>0,a/2>>>0!==this.seq))throw Error("Sequence error: expected ".concat(this.seq," got ").concat(a/2>>>0," in ").concat(n));if(this.messages.poll(),this.time=n.time,n.executeOn(this),++r>100&&(r=0,Date.now()>e))return!1}return this.time=t,!0}},{key:"asQFunc",value:function(t,n){if("string"==typeof n)return n;if("function"==typeof n){if(t[n.name]===n)return n.name;for(var r=t;null!==r;){for(var o=0,i=Object.entries(Object.getOwnPropertyDescriptors(r));o<i.length;o++){var a=e(i[o],2),s=a[0];if(a[1].value===n)return s}r=Object.getPrototypeOf(r)}var c=n.toString().match(/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i);return!c||c[3]&&c[3]!==c[1]?function(t,e){"function"==typeof t&&(e=t,t={});var n=Object.keys(t).concat(["return "+e]),r=Object.values(t),o={qPara:n,qArgs:r},i=r.indexOf(e);return i>=0&&(r[i]=n[i],o.qFn=i),"{".concat(btoa(JSON.stringify(o)),"}")}(n):c[2]}return null}},{key:"addSubscription",value:function(t,e,n,r){if(me!==this)throw Error("Island Error");var o=this.asQFunc(t,r);if("string"!=typeof o)throw Error('Subscription handler for "'.concat(n,'" must be a method name'));if("function"!=typeof t[o]&&"{"!==o[0])throw Error('Subscriber method for "'.concat(n,'" not found: ').concat(t,".").concat(o,"()"));var i=e+":"+n,a=t.id+"."+o;if(this.subscriptions[i]){if(-1!==this.subscriptions[i].indexOf(a))throw Error("".concat(t,".").concat(o," already subscribed to ").concat(n))}else this.subscriptions[i]=[];this.subscriptions[i].push(a)}},{key:"removeSubscription",value:function(t,e,n,r){if(me!==this)throw Error("Island Error");var o=e+":"+n,i=t.id+"."+r,a=this.subscriptions[o];if(a){var s=a.indexOf(i);a.splice(s,1),0===a.length&&delete this.subscriptions[o]}}},{key:"removeAllSubscriptionsFor",value:function(t){for(var n="".concat(t.id,":"),r="".concat(t.id,"."),o=0,i=Object.entries(this.subscriptions);o<i.length;o++){var a=e(i[o],2),s=a[0],c=a[1];if(s.startsWith(n))delete this.subscriptions[s];else{for(var u=c.length-1;u>=0;u--)c[u].startsWith(r)&&c.splice(u,1);0===c.size&&delete this.subscriptions[s]}}}},{key:"publishFromModel",value:function(t,e,n){if(me!==this)throw Error("Island Error");var r=e.endsWith("#reflected");r&&(e=e.slice(0,e.length-"#reflected".length));var o=t+":"+e;this.handleModelEventInModel(o,n,r),this.handleModelEventInView(o,n)}},{key:"publishFromView",value:function(t,e,n){if(me)throw Error("Island Error");var r=t+":"+e;this.handleViewEventInModel(r,n),this.handleViewEventInView(r,n)}},{key:"handleModelEventInModel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(me!==this)throw Error("Island Error");if(n){var r=this.getNextTuttiSeq();if(!0!==this.controller.synced)return;var o=t+"#__vote",i=t+"#divergence",a=!!ie.subscriptions[o],s=!!this.subscriptions[t],c=!!this.subscriptions[i];a&&c&&console.log("divergence subscription for ".concat(t," overridden by vote subscription"));var u,l=s?new Oe(this.time,0,this.id,"handleModelEventInModel",[t,e]):null;u=a?[this.id,"handleModelEventInView",o]:[this.id,"handleTuttiDivergence",i],this.controller.sendTutti(this.time,r,e,l,a,u)}else if(this.subscriptions[t]){var h,f=ve(this.subscriptions[t]);try{for(f.s();!(h=f.n()).done;){var d=h.value,p=d.split("."),v=m(p),y=v[0],g=v.slice(1),b=g.join("."),w=this.lookUpModel(y);if(w){if("{"===b[0]){var k=be(b,w);try{k(e)}catch(e){Ht("event ".concat(t," ").concat(w," ").concat(k),e)}continue}"function"!=typeof w[b]&&Ut("event ".concat(t," ").concat(w,".").concat(b,"(): method not found"))}else Ut("event ".concat(t," .").concat(b,"(): subscriber not found"));try{w[b](e)}catch(e){Ht("event ".concat(t," ").concat(w,".").concat(b,"()"),e)}}}catch(t){f.e(t)}finally{f.f()}}}},{key:"handleViewEventInModel",value:function(t,e){if(this.subscriptions[t]){var n=new Oe(this.time,0,this.id,"handleModelEventInModel",[t,e]);this.controller.sendMessage(n)}}},{key:"handleModelEventInView",value:function(t,e){var n=this;ie.handleEvent(t,e,(function(t){return function(t){if(!me)throw Error("Island confusion");var e=me;try{me=null,t()}finally{me=e}}((function(){return fe(n,t,!0)}))}))}},{key:"handleViewEventInView",value:function(t,e){ie.handleEvent(t,e)}},{key:"handleTuttiDivergence",value:function(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{var n=t.split(":").slice(-1)[0];console.warn("uncaptured divergence in ".concat(n,":"),e)}}},{key:"processModelViewEvents",value:function(){var t=this;if(me)throw Error("Island Error");return fe(this,(function(){return ie.processFrameEvents(!!t.controller.synced)}))}},{key:"pollToCheckSync",value:function(){var t=this.getNextTuttiSeq();if(!0===this.controller.synced){var e=Date.now(),n={date_island:this.time,hash:this.getSummaryHash()},r=Date.now()-e;this.controller.cpuTime-=r;var o=[this.id,"handleSyncCheckVote","syncCheckVote"];this.controller.sendTutti(this.time,t,n,null,!0,o)}}},{key:"handleSyncCheckVote",value:function(t,e){this.controller.handleSyncCheckVote(e)}},{key:"pollForSnapshot",value:function(){var t=this,e=this.getNextTuttiSeq(),n=this.time,r=n-this.lastSnapshotPoll;if(r<5e3)console.log("rejecting snapshot poll ".concat(r,"ms after previous"));else{this.lastSnapshotPoll=n;var o=this.controller.preparePollForSnapshot();if(o){var i=Date.now();o.hash=this.getSummaryHash();var a=Date.now()-i;this.controller.cpuTime-=a,Promise.resolve().then((function(){return t.controller.pollForSnapshot(n,e,o)}))}}}},{key:"handleSnapshotVote",value:function(t,e){this.controller.handleSnapshotVote(e)}},{key:"snapshot",value:function(){return Te.newOrRecycled(this).snapshot(this,"$")}},{key:"getSummaryHash",value:function(){return(new Ae).getHash(this)}},{key:"random",value:function(){if(me!==this)throw Error("Island Error");return this._random()}},{key:"randomID",value:function(){if(me!==this)throw Error("Island Error");for(var t="",e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}}]),t}();function Se(t,n){var r=t.match(/^([^[]+)(\[.*)?$/i),o=e(r,3),i=(o[0],o[1]),a=o[2],s=i.split(">"),c=e(s,2),u=c[0],l=c[1],h=[];a&&(h=Ie.newOrRecycled(n).decode(JSON.parse(a)));return{receiver:u,selector:l,args:h}}function xe(t,e){return(e-t|0)>=0}var Ce,Ee,Oe=function(){function t(e,r,o,i,a){n(this,t),this.time=e,this.seq=r,this.payload=function(t,e,n){return n.length>0&&(n=je.newOrRecycled().encode(n)),"".concat(t,">").concat(e).concat(n.length>0?JSON.stringify(n):"")}(o,i,a)}return r(t,[{key:"before",value:function(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?xe(this.externalSeq,t.externalSeq):xe(this.internalSeq,t.internalSeq)}},{key:"hasReceiver",value:function(t){return function(t,e){return t.startsWith("".concat(e,">"))}(this.payload,t)}},{key:"isExternal",value:function(){return 1&this.seq}},{key:"asState",value:function(){return[this.time,this.seq,this.payload]}},{key:"executeOn",value:function(t){var e=this,n=Se(this.payload,t),r=n.receiver,i=n.selector,a=n.args,s=t.lookUpModel(r);if(s)if("{"===i[0]){var c=be(i,s);we(t,(function(){he(t,(function(){try{c.apply(void 0,o(a))}catch(t){Ht("".concat(e.shortString()," ").concat(c),t)}}))}))}else"function"!=typeof s[i]?Ut("".concat(this.shortString()," ").concat(s,".").concat(i,"(): method not found")):we(t,(function(){he(t,(function(){try{s[i].apply(s,o(a))}catch(t){Ht("".concat(e.shortString()," ").concat(s,".").concat(i,"()"),t)}}))}));else Ut("".concat(this.shortString()," ").concat(i,"(): receiver not found"))}},{key:"shortString",value:function(){return"".concat(this.isExternal()?"External":"Future","Message")}},{key:"toString",value:function(){var t=Se(this.payload),e=t.receiver,n=t.selector,r=t.args,o=this.isExternal(),i=o?this.externalSeq:this.internalSeq;return"".concat(o?"External":"Future","Message[").concat(this.time).concat(":#"[+o]).concat(i," ").concat(e,".").concat(n,"(").concat(r.map(JSON.stringify).join(", "),")]")}},{key:Symbol.toPrimitive,value:function(){return this.toString()}},{key:"externalSeq",get:function(){return this.seq/2>>>0},set:function(t){this.seq=2*t+1}},{key:"internalSeq",get:function(){return this.seq/2>>>0},set:function(t){this.seq=2*t}}],[{key:"fromState",value:function(n,r){var o=e(n,3),i=o[0],a=o[1],s=Se(o[2],r);return new t(i,a,s.receiver,s.selector,s.args)}}]),t}(),_e=(Ce=new ArrayBuffer(8),Ee=new DataView(Ce),function(t){return Ee.setFloat64(0,t,!0),Ee.getInt32(0,!0)+Ee.getInt32(4,!0)}),Ae=function(){function t(){n(this,t),this.refs=new Map,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",Oe);var r,o=ve(Be.allClassTypes());try{for(o.s();!(r=o.n()).done;){var i=e(r.value,2),a=i[0],s=i[1];this.addHasher(a,s)}}catch(t){o.e(t)}finally{o.f()}}return r(t,[{key:"addHasher",value:function(t,e){var n=this,r=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:function(t){return Object.assign({},t)}},o=r.cls,i=r.write;this.hashers.set(o,(function(t){return n.hashStructure(t,i(t))}))}},{key:"getHash",value:function(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(var n=0,r=Object.entries(t);n<r.length;n++){var o=e(r[n],2),i=o[0],a=o[1];if("controller"!==i&&"meta"!==i)if("_random"===i)this.hash(a.state(),!1);else if("messages"===i){var s=a.asArray();(this.hashState.fC=s.length)&&this.hash(s,!1)}else this.hashEntry(i,a)}return this.hashDeferred(),this.hashState}},{key:"hashDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.key,n=t.value;this.hashEntry(e,n,!1)}}},{key:"hash",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(i(t)){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=_e(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;default:var n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return void this.hashArray(t,e);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return void this.hashStructure(t,o(t));case"Object":if(t instanceof Be)this.hashModel(t);else if(t.constructor===Object)this.hashObject(t,e);else{var r=this.hashers.get(t.constructor);if(!r)throw Error("Don't know how to hash ".concat(t.constructor.name));r(t)}return;case"Null":return;default:throw Error("Don't know how to hash ".concat(n))}}}},{key:"hashModel",value:function(t){if(!this.refs.has(t)){this.hashState.mC++,this.refs.set(t,!0);for(var n=0,r=Object.entries(t);n<r.length;n++){var o=e(r[n],2),i=o[0],a=o[1];"__realm"!==i&&(void 0!==a&&this.hashEntry(i,a))}}}},{key:"hashObject",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.refs.has(t)){this.hashState.oC++,this.refs.set(t,!0);for(var r=0,o=Object.entries(t);r<o.length;r++){var i=e(o[r],2),a=i[0],s=i[1];void 0!==s&&this.hashEntry(a,s,n)}}}},{key:"hashArray",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.refs.has(t)){this.refs.set(t,!0);for(var n=0;n<t.length;n++)this.hashEntry(n,t[n],e)}}},{key:"hashStructure",value:function(t,e){void 0!==e&&(this.refs.has(t)||(this.refs.set(t,!0),this.hash(e,!1)))}},{key:"hashEntry",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"$"!==t[0]?n&&"object"===i(e)?this.todo.push({key:t,value:e}):this.hash(e):Ut("snapshot: ignoring property ".concat(t),{only:"once"})}}]),t}(),Te=function(){function t(r){n(this,t),this.island=r,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",Oe);var o,i=ve(Be.allClassTypes());try{for(i.s();!(o=i.n()).done;){var a=e(o.value,2),s=a[0],c=a[1];this.addWriter(s,c)}}catch(t){i.e(t)}finally{i.f()}}return r(t,null,[{key:"newOrRecycled",value:function(t){var e=this.reusableInstance;return e?(e.island=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}},{key:"resetInstance",value:function(){this.reusableInstance=null}},{key:"reusableInstance",get:function(){return this[this.name+"-instance"]},set:function(t){this[this.name+"-instance"]=t}}]),r(t,[{key:"addWriter",value:function(t,e){var n=this,r=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:function(t){return Object.assign({},t)}},o=r.cls,i=r.write;this.writers.set(o,(function(e,r){return n.writeAs(t,e,i(e),r)}))}},{key:"snapshot",value:function(t){for(var n={_random:t._random.state(),messages:this.write(t.messages.asArray())},r=0,o=Object.entries(t);r<o.length;r++){var i=e(o[r],2),a=i[0],s=i[1];"controller"!==a&&(n[a]||this.writeInto(n,a,s,"$"))}return this.writeDeferred(),n}},{key:"writeDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.state,n=t.key,r=t.value,o=t.path;this.writeInto(e,n,r,o,!1)}}},{key:"write",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(i(t)){case"number":return Number.isSafeInteger(t)?t:Number.isNaN(t)?{$class:"NaN"}:Number.isFinite(t)?this.writeFloat(t):{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":case"undefined":return t;default:var r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.writeArray(t,e,n);case"Set":case"Map":case"Uint8Array":case"Uint16Array":case"Float32Array":return this.writeAs(r,t,o(t),e);case"Object":if(t instanceof Be)return this.writeModel(t,e);if(t.constructor===Object)return this.writeObject(t,e,n);var a=this.writers.get(t.constructor);if(a)return a(t,e);throw Error("Don't know how to write ".concat(t.constructor.name," at ").concat(e));case"Null":return t;default:throw Error("Don't know how to write ".concat(r," at ").concat(e))}}}},{key:"writeModel",value:function(t,e){if(this.refs.has(t))return this.writeRef(t);var n={$model:Be.classToID(t.constructor)};this.refs.set(t,n);var r,o=ve(Object.keys(t).sort());try{for(o.s();!(r=o.n()).done;){var i=r.value;if("__realm"!==i){var a=t[i];void 0!==a&&this.writeInto(n,i,a,e)}}}catch(t){o.e(t)}finally{o.f()}return n}},{key:"writeObject",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.refs.has(t))return this.writeRef(t);var r={};this.refs.set(t,r);var o,i=ve(Object.keys(t).sort());try{for(i.s();!(o=i.n()).done;){var a=o.value,s=t[a];void 0!==s&&this.writeInto(r,a,s,e,n)}}catch(t){i.e(t)}finally{i.f()}return r}},{key:"writeArray",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.refs.has(t))return this.writeRef(t);var r=[];this.refs.set(t,r);for(var o=0;o<t.length;o++)this.writeInto(r,o,t[o],e,n);return r}},{key:"writeFloat",value:function(t){return t}},{key:"writeAs",value:function(t,e,n,r){if(void 0===n)return n;if(this.refs.has(e))return this.writeRef(e);var o={$class:t};this.refs.set(e,o);var a=this.write(n,r,!1);return"object"!==i(a)||Array.isArray(a)?o.$value=a:Object.assign(o,a),o}},{key:"writeRef",value:function(t){var e=this.refs.get(t);if("object"!==i(e))throw Error("Non-object in refs: "+t);return Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:o(this)}}),{$ref:e.$id||(e.$id=this.nextRef++)}}},{key:"writeInto",value:function(t,e,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("$"!==e[0])if(o&&"object"===i(n))this.todo.push({state:t,key:e,value:n,path:r});else{var a="string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i),s=r+(a?".".concat(e):"[".concat(JSON.stringify(e),"]")),c=this.write(n,s);void 0!==c&&(t[e]=c)}else Ut("snapshot: ignoring property ".concat(e),{only:"once"})}}]),t}(),Me=function(){function t(r){n(this,t),this.island=r,this.refs=new Map,this.todo=[],this.unresolved=[],this.readers=new Map,this.addReader("Teatime:Message",Oe);var o,i=ve(Be.allClassTypes());try{for(i.s();!(o=i.n()).done;){var a=e(o.value,2),s=a[0],c=a[1];this.addReader(s,c)}}catch(t){i.e(t)}finally{i.f()}this.readers.set("NaN",(function(){return NaN})),this.readers.set("Infinity",(function(t){return t*(1/0)})),this.readers.set("Set",(function(t){return new Set(t)})),this.readers.set("Map",(function(t){return new Map(t)})),this.readers.set("Array",(function(t){return t.slice(0)})),this.readers.set("Uint8Array",(function(t){return new Uint8Array(t)})),this.readers.set("Uint16Array",(function(t){return new Uint16Array(t)})),this.readers.set("Float32Array",(function(t){return new Float32Array(t)}))}return r(t,null,[{key:"newOrRecycled",value:function(t){var e=this.reusableInstance;return e?(e.island=t,e.refs=new Map,e.todo=[],e.unresolved=[]):e=this.reusableInstance=new this(t),e}},{key:"resetInstance",value:function(){this.reusableInstance=null}},{key:"reusableInstance",get:function(){return this[this.name+"-instance"]},set:function(t){this[this.name+"-instance"]=t}}]),r(t,[{key:"addReader",value:function(t,e){var n="object"===i(e)?e.read:function(t){return Object.assign(Object.create(e.prototype),t)};this.readers.set(t,n)}},{key:"readIsland",value:function(t,n){if("$"!==n)throw Error("Island must be root object");for(var r={_random:new h(null,{state:t._random})},o=0,i=Object.entries(t);o<i.length;o++){var a=e(i[o],2),s=a[0],c=a[1];r[s]||this.readInto(r,s,c,n)}return this.readDeferred(),this.resolveRefs(),r}},{key:"readDeferred",value:function(){for(;this.todo.length>0;){var t=this.todo.shift(),e=t.object,n=t.key,r=t.value,o=t.path;this.readInto(e,n,r,o,1)}}},{key:"resolveRefs",value:function(){var t,e=ve(this.unresolved);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.object,o=n.key,i=n.ref,a=n.path;if(!this.refs.has(i))throw Error("Unresolved ref: ".concat(i," at ").concat(a,"[").concat(JSON.stringify(o),"]"));r[o]=this.refs.get(i)}}catch(t){e.e(t)}finally{e.f()}}},{key:"read",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(i(t)){case"number":case"string":case"boolean":return t;default:var r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Array":return this.readArray(t,e,n);case"Null":return null;case"Object":var o=t.$class,a=t.$model,s=t.$ref;if(s)throw Error("refs should have been handled in readInto()");return a?this.readModel(t,e):o?this.readAs(o,t,e):this.readObject(Object,t,e,n);default:throw Error("Don't know how to read ".concat(r," at ").concat(e))}}}},{key:"readModel",value:function(t,n){var r=Be.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,r);for(var o=0,i=Object.entries(t);o<i.length;o++){var a=e(i[o],2),s=a[0],c=a[1];"id"!==s&&"$"!==s[0]&&this.readInto(r,s,c,n)}return r}},{key:"readObject",value:function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new t;n.$id&&this.refs.set(n.$id,i);for(var a=0,s=Object.entries(n);a<s.length;a++){var c=e(s[a],2),u=c[0],l=c[1];"$"!==u[0]&&this.readInto(i,u,l,r,o)}return i}},{key:"readArray",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];t.$id&&this.refs.set(t.$id,r);for(var o=0;o<t.length;o++)void 0!==t[o]&&this.readInto(r,o,t[o],e,n);return r}},{key:"readAs",value:function(t,n,r){var o={},i=new Map;if("$value"in n)o=this.read(n.$value,r,2);else for(var a=0,s=Object.entries(n);a<s.length;a++){var c=e(s[a],2),u=c[0],l=c[1];if("$"!==u[0]){var h=l&&l.$ref;h?this.refs.has(h)?o[u]=this.refs.get(h):(o[u]="<unresolved>",i.set(h,u)):this.readInto(o,u,l,r,1)}}var f=this.readers.get(t)(o,r);f||"NaN"===t||console.warn('Reading "'.concat(t,'" returned ').concat(f," at ").concat(r)),n.$id&&this.refs.set(n.$id,f);var d,p=ve(i.entries());try{for(p.s();!(d=p.n()).done;){var v=e(d.value,2),y=v[0],m=v[1];this.unresolved.push({object:f,key:m,ref:y,path:r})}}catch(t){p.e(t)}finally{p.f()}return f}},{key:"readRef",value:function(t,e,n,r){if(!n||!n.$ref)return!1;var o=n.$ref;return this.refs.has(o)?t[e]=this.refs.get(o):(t[e]="<unresolved>",this.unresolved.push({object:t,key:e,ref:o,path:r})),!0}},{key:"readInto",value:function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!this.readRef(t,e,n,r))if(0!==o||"object"!==i(n)){var a="string"==typeof e&&e.match(/^[_a-z][_a-z0-9]*$/i),s=r+(a?".".concat(e):"[".concat(JSON.stringify(e),"]"));t[e]=this.read(n,s,o>0?o-1:0)}else this.todo.push({object:t,key:e,value:n,path:r})}}]),t}(),je=function(t){d(o,Te);var e=de(o);function o(){return n(this,o),e.apply(this,arguments)}return r(o,[{key:"encode",value:function(t){var e=this.writeArray(t,"$");return this.writeDeferred(),e}},{key:"writeModel",value:function(t){return{$ref:t.id}}}]),o}(),Ie=function(t){d(o,Me);var e=de(o);function o(){return n(this,o),e.apply(this,arguments)}return r(o,[{key:"decode",value:function(t){var e=this.readArray(t,"$");return this.readDeferred(),this.resolveRefs(),e}},{key:"resolveRefs",value:function(){var t,e=ve(this.unresolved);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.object,o=n.key,i=n.ref,a=n.path;if(this.refs.has(i))r[o]=this.refs.get(i);else{var s=this.island.lookUpModel(i);if(!s)throw Error("Unresolved ref: ".concat(i," at ").concat(a,"[").concat(JSON.stringify(o),"]"));r[o]=s}}}catch(t){e.e(t)}finally{e.f()}}}]),o}();function qe(){Me.resetInstance(),Te.resetInstance(),je.resetInstance(),Ie.resetInstance()}function Pe(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return Ne(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ne(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function Ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var De=T.has("debug","classes",!1),Re=Symbol("SECRET"),Le=new WeakSet,Be=function(){function t(e){if(n(this,t),e!==Re)throw Error("You must create ".concat(this,' using create() not "new"!'))}return r(t,null,[{key:"__isTeatimeModelClass__",value:function(){return!0}},{key:"create",value:function(e,n){var r=le(),o=new this(Re);return Object.defineProperty(o,"__realm",{value:r}),Object.defineProperty(o,"id",{value:r.register(o),enumerable:!0}),Le.add(o),n&&o.beWellKnownAs(n),o.init(e),Le.has(o)&&(Le.delete(o),Object.getPrototypeOf(this)!==t&&console.warn("".concat(o," did not call super.init(options)"))),o}},{key:"createNoInit",value:function(t){var e=le(),n=new this(Re);return Object.defineProperty(n,"__realm",{value:e}),Object.defineProperty(n,"id",{value:t,enumerable:!0}),n}},{key:"allowConstructors",value:function(){Re=void 0,console.warn("disabling error reporting for Model constructors")}},{key:"register",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown-file";return qe(),ot(this),We(t,this.name,this),this}},{key:"registerIfNeeded",value:function(){Ve(this)||this.register()}},{key:"types",value:function(){return{}}},{key:"classToID",value:function(t){return function(t){if(Ve(t))return t[Fe];if(He(),Ve(t))return t[Fe];throw Error('Class "'.concat(t.name,'" not found, did you call ').concat(t.name,".register()?"))}(t)}},{key:"classFromID",value:function(t){return Je(t)}},{key:"allClasses",value:function(){return $e()}},{key:"allClassTypes",value:function(){return function(){var t,e={},n=Pe($e());try{for(n.s();!(t=n.n()).done;){var r=t.value;Object.prototype.hasOwnProperty.call(r,"types")&&Object.assign(e,r.types())}}catch(t){n.e(t)}finally{n.f()}return Object.entries(e)}()}},{key:"instantiateClassID",value:function(t,e){return Je(t).createNoInit(e)}}]),r(t,[{key:"init",value:function(t){Le.delete(this)}},{key:"destroy",value:function(){le().unsubscribeAll(this),le().deregister(this)}},{key:"publish",value:function(t,e,n){this.__realm||this.__realmError(),this.__realm.publish(e,n,t)}},{key:"subscribe",value:function(t,e,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,n)}},{key:"unsubscribe",value:function(t,e){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e)}},{key:"unsubscribeAll",value:function(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}},{key:"__realmError",value:function(){if(!this.id)throw Error("".concat(this," has no ID, did you call super.init(options)?"))}},{key:"future",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;this.__realm||this.__realmError();for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return this.__realm.future(this,t,e,r)}},{key:"random",value:function(){return le().random()}},{key:"now",value:function(){return le().now()}},{key:"beWellKnownAs",value:function(t){le().island.set(t,this)}},{key:"wellKnownModel",value:function(t){return this.__realm.island.get(t)}},{key:"modelOnly",value:function(t){var e="none";try{e=le()}catch(t){}if(e===this.__realm)return!0;var n=Error(t||"".concat(this,".modelOnly() called from outside a model!"));throw Ht("view code",n),n}},{key:Symbol.toPrimitive,value:function(){var t=this.constructor.name;return t.includes("Model")?t:"".concat(t,"[Model]")}},{key:"sessionId",get:function(){return this.__realm.island.id}}]),t}(),Ue={},Fe=Symbol("CLASS_ID");function He(){if(module.bundle)for(var t=0,n=Object.entries(module.bundle.cache);t<n.length;t++)for(var r=e(n[t],2),o=r[0],i=r[1],a=0,s=Object.entries(i.exports);a<s.length;a++){var c=e(s[a],2),u=c[0],l=c[1];l&&l.__isTeatimeModelClass__&&We(o,"default"===u?l.name:u,l)}}function $e(){return 0===Object.keys(Ue).length&&He(),Object.values(Ue).map((function(t){return t.cls}))}function Ve(t){return Object.prototype.hasOwnProperty.call(t,Fe)}function Je(t){if(Ue[t])return Ue[t].cls;if(He(),Ue[t])return Ue[t].cls;throw Error('Class "'.concat(t,'" in snapshot, but not found in current source?'))}function We(t,e,n){var r="".concat(t,":").concat(e),o=Ue[r];if(o&&o.cls!==n)throw Error("Duplicate class ".concat(e," in ").concat(t));return Ve(n)?De&&!o&&console.warn("ignoring re-exported class ".concat(e," from ").concat(t)):(De&&console.log("registering class ".concat(e," from ").concat(t)),n[Fe]=r),Ue[r]={cls:n,file:t},n}var ze=function(){function t(e){n(this,t),Object.defineProperty(this,"realm",{value:le()}),Object.defineProperty(this,"id",{value:this.realm.register(this),configurable:!0})}return r(t,null,[{key:"displayStatus",value:function(t,e){return Ft(t,e)}},{key:"displayWarning",value:function(t,e){return Ut(t,e)}},{key:"displayError",value:function(t,e){return Bt(t,e)}}]),r(t,[{key:"detach",value:function(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}},{key:"reattach",value:function(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}},{key:"publish",value:function(t,e,n){this.realm.publish(e,n,t)}},{key:"subscribe",value:function(t,e,n){n=n.bind(this);var r=e.event?e:{event:e},o=r.event,i=r.handling;this.realm.subscribe(o,this.id,n,t,i)}},{key:"unsubscribe",value:function(t,e){this.realm.unsubscribe(e,this.id,null,t)}},{key:"unsubscribeAll",value:function(){this.realm.unsubscribeAll(this.id)}},{key:"future",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.realm.future(this,t)}},{key:"random",value:function(){return le().random()}},{key:"now",value:function(){return this.realm.now()}},{key:"externalNow",value:function(){return this.realm.externalNow()}},{key:"update",value:function(t){}},{key:"wellKnownModel",value:function(t){return this.realm.island.get(t)}},{key:"inSameViewRealm",value:function(t){return fe(this.realm.island,t,!0)}},{key:Symbol.toPrimitive,value:function(){var t=this.constructor.name;return t.includes("View")?t:"".concat(t,"[View]")}},{key:"sessionId",get:function(){return this.realm.island.id}},{key:"viewId",get:function(){return this.realm.island.controller.viewId}}]),t}();function Ge(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var Ke=Symbol("hash");function Qe(t,e){return Ye.apply(this,arguments)}function Ye(){return(Ye=c(s.mark((function t(e,n){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n);case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Xe(t,e){return Ze.apply(this,arguments)}function Ze(){return(Ze=c(s.mark((function t(e,n){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n);case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tn(t){return T.has("debug",t,!1)}function en(t,e){return"https://croquet.io/files/v1/sessiondata/".concat(e)}function nn(t){return rn.apply(this,arguments)}function rn(){return(rn=c(s.mark((function t(e){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",J(e));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function on(t,e){return an.apply(this,arguments)}function an(){return(an=c(s.mark((function t(e,n){var r;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return tn("data")&&console.log("Uploading ".concat(n.byteLength," bytes to ").concat(e)),t.next=3,fetch(e,{method:"PUT",body:n});case 3:if((r=t.sent).ok){t.next=6;break}throw Error("Croquet.Data: failed to upload ".concat(e," (").concat(r.status," ").concat(r.statusText,")"));case 6:tn("data")&&console.log("Croquet.Data: uploaded (".concat(r.status," ").concat(r.statusText,") ").concat(n.byteLength," bytes to ").concat(e));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function sn(t){return cn.apply(this,arguments)}function cn(){return(cn=c(s.mark((function t(e){var n;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return tn("data")&&console.log("Downloading from ".concat(e)),t.next=3,fetch(e);case 3:if(!(n=t.sent).ok){t.next=6;break}return t.abrupt("return",n.arrayBuffer());case 6:throw Error("Croquet.Data: failed to download ".concat(e," (").concat(n.status," ").concat(n.statusText,")"));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var un=function(){var t,e;function o(t){n(this,o),Object.defineProperty(this,Ke,{value:t})}return r(o,null,[{key:"store",value:(e=c(s.mark((function t(e,n){var r,i,a;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ke.hasCurrent()){t.next=2;break}throw Error("Croquet.Data.store() called from Model code");case 2:return t.next=5,Qe(null,n);case 5:return r=t.sent,t.next=8,nn(r);case 8:return i=t.sent,a=en(0,i),t.next=12,on(a,r);case 12:return t.abrupt("return",new o(i));case 13:case"end":return t.stop()}}),t)}))),function(t,n){return e.apply(this,arguments)})},{key:"fetch",value:(t=c(s.mark((function t(e,n){var r,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ke.hasCurrent()){t.next=2;break}throw Error("Croquet.Data.fetch() called from Model code");case 2:return r=en(0,n[Ke]),t.next=5,sn(r);case 5:return o=t.sent,t.abrupt("return",Xe(null,o));case 8:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}]),o}();function ln(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return hn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hn(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function hn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function dn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fn(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}(function(t){d(i,Be);var e,o=(e=i,function(){var t,n=v(e);if(Ge()){var r=v(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return p(this,t)});function i(){return n(this,i),o.apply(this,arguments)}return r(i,null,[{key:"types",value:function(){return{"@croquet.data":{cls:un,write:function(t){return t[Ke]},read:function(t){return new un(t)}}}}}]),i})().register();var pn=require("pako"),vn=w;console.log("Croquet SDK "+vn);var yn=window.location.hostname.endsWith("croquet.io")?"".concat(window.location.host,"/reflector"):"croquet.io/reflector",mn="wss://".concat(yn,"/v").concat(1),gn=null;var bn=T.nocheat,wn=["tps"];function kn(){return Math.floor(Math.random()*Math.pow(2,53)).toString(36)}var Sn=new Set,xn=function(){function t(){n(this,t),this.reset()}var a,l,h,f,d,p,v,y;return r(t,[{key:"reset",value:function(){this.island=null,this.connection=this.connection||new Cn(this),this.networkQueue=new lt,this.time=0,this.session="",this.viewId=this.viewId||kn(),this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(window.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(window.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],ie.removeAllSubscriptionsFor(this.viewId),ie.addSubscription(this.viewId,"__users__",this.viewId,(function(t){return Ft("users now ".concat(t.count))}),"oncePerFrameWhileSynced"),Zt.showSyncWait(!0)}},{key:"checkForConnection",value:function(t){this.connection.checkForConnection(t)}},{key:"dormantDisconnect",value:function(){this.connected&&this.connection.dormantDisconnect()}},{key:"establishSession",value:(y=c(s.mark((function t(n,r){var a,c,l,h,f,d,p,v,y,m,g,b,w,k,S,x,C,E,O;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(gn={messages:T.has("debug","messages",!1),sends:T.has("debug","sends",!1),ticks:T.has("debug","ticks",!1),pong:T.has("debug","pong",!1),snapshot:T.has("debug","snapshot",!1),session:T.has("debug","session",!1),initsnapshot:T.has("debug","initsnapshot","localhost"),reflector:T.has("debug","reflector",T.dev||"localhost")},a=r.optionsFromUrl,c=r.multiRoom,l=r.autoSession,h=r.login,f=dn({},r.options),d=0,p=[].concat(wn,o(a||[]));d<p.length;d++)(v=p[d])in T&&(f[v]=T[v]);if(!h){t.next=7;break}return t.next=7,j();case 7:return l&&(y=n,m=T.getSession().split("/"),g=c?m[1]:m[0],b=c?m[2]:m[1],(w=!g||!b)&&(l.user&&(g=l.user),l.random&&(b=l.random),g||(g=M("name","").toLowerCase()||"GUEST"),b||(b=kn())),this.session=c?"".concat(y,"/").concat(g,"/").concat(b):"".concat(g,"/").concat(b),c||(T.setSession(this.session,w),Zt.sessionURL=window.location.href),n="".concat(y,"/").concat(g,"/").concat(b)),k=function(t){return"object"===i(t)?u(t):t},S=Object.keys(f).length?n+"?"+Object.entries(f).map((function(t){var n=e(t,2),r=n[0],o=n[1];return"".concat(r,"=").concat(k(o))})).sort().join("&"):n,t.next=12,it(S,vn);case 12:return x=t.sent,C=x.hash,E=x.codeHash,console.log('Session ID for "'.concat(n,'": ').concat(C)),this.islandCreator=dn({},r,{options:f,name:n,codeHash:E}),O=!1,this.islandCreator.snapshot?this.islandCreator.snapshot.id!==C&&(console.warn("Existing snapshot was for different code base!"),O=!0):O=!0,O&&(this.islandCreator.snapshot={id:C,time:0,meta:{id:C,codeHash:E,created:(new Date).toISOString()}}),t.next=22,this.join();case 22:return t.next=24,this.startedOrSynced();case 24:return t.abrupt("return",this.island.modelsByName);case 25:case"end":return t.stop()}}),t,this)}))),function(t,e){return y.apply(this,arguments)})},{key:"lastKnownTime",value:function(t){return Math.max(t.time,t.externalTime)}},{key:"handleSyncCheckVote",value:function(t){if(!0===this.synced){var e=t._local,n=t.tally,r=Object.keys(n);e&&r.includes(e)?r.length>1?console.log(r):console.log("ok"):console.log(this.id,"Sync: local vote not found",e,n)}}},{key:"takeSnapshot",value:function(){var t=this.island.snapshot(),e=this.lastKnownTime(t),n=t.externalSeq;return t.meta=dn({},this.islandCreator.snapshot.meta,{options:this.islandCreator.options,time:e,seq:n,date:(new Date).toISOString(),host:window.location.hostname,sdk:vn}),delete t.meta.hash,t}},{key:"scheduleSnapshot",value:function(){if(this.island){var t=this.island.time,e=t-this.island.lastSnapshotPoll;if(e<5e3)gn.snapshot&&console.log("not requesting snapshot poll (".concat(e,"ms since poll scheduled)"));else{var n=new Oe(t,0,this.island.id,"pollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),gn.snapshot&&console.log(this.id,"Controller scheduling snapshot via reflector")}}}},{key:"preparePollForSnapshot",value:function(){var t=this.triggeringCpuTime||this.cpuTime;return this.triggeringCpuTime=null,this.cpuTime=0,!0===this.synced?{cpuTime:t}:null}},{key:"pollForSnapshot",value:function(t,e,n){n.cpuTime+=Math.random();var r=[this.id,"handleSnapshotVote","snapshotVote"];this.sendTutti(t,e,n,null,!0,r)}},{key:"handleSnapshotVote",value:function(t){var e=this;if(!0===this.synced){var n=t._local,r=t.tally,o=Object.keys(r);if(!n||!o.includes(n))return gn.snapshot&&console.log(this.id,"Snapshot: local vote not found"),void(this.cpuTime=0);var i=o.map((function(t){return JSON.parse(t)})),a={};i.forEach((function(t,e){var n=t.hash;a[n]||(a[n]=[]),a[n].push(e)}));var s=Object.keys(a),c=s[0];s.length>1&&(gn.snapshot&&console.log(this.id,"Snapshots fall into ".concat(s.length," groups")),s.sort((function(t,e){return a[e].length-a[t].length})),a[s[0]].length===a[s[1]].length&&(gn.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),c=s[0]<s[1]?s[0]:s[1])),s.forEach((function(t){return function(t,r){var s=a[t];s.length>1&&s.sort((function(t,e){return i[t].cpuTime-i[e].cpuTime}));var c=s[0];o[c]===n&&e.serveSnapshot(r)}(t,t===c)}))}else gn.snapshot&&console.log("Ignoring snapshot vote during sync")}},{key:"serveSnapshot",value:function(t){var e=Tt.begin("snapshot"),n=this.takeSnapshot(),r=Tt.end("snapshot")-e;this.cpuTime-=r,gn.snapshot&&console.log(this.id,"Snapshotting took ".concat(Math.ceil(r)," ms")),this.uploadSnapshot(n,t)}},{key:"snapshotUrl",value:function(t,e,n,r,o){var i,a="".concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"code",e=T.has("dev","host","localhost"),n=e?"dev/".concat(M("name","GUEST"),"/"):"";return"".concat(L(),"/").concat(n).concat(t,"/")}("snapshots")).concat(this.id),s=".json".concat(o?"."+o:""),c="".concat((i=Math.round(e),(""+i).padStart(10,"0")),"_").concat(n,"-").concat(t,"-").concat(r).concat(s);return"".concat(a,"/").concat(c)}},{key:"hashSnapshot",value:function(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise((function(e){var n=dn({},t);delete n.meta,X(JSON.stringify(n)).then((function(n){t.meta.hash=n,delete t.meta.hashPromise,e(n)}))}))),t.meta.hashPromise)}},{key:"uploadSnapshot",value:(v=c(s.mark((function t(e){var n,r,o,i,a,c,u,l,h,f,d,p=arguments;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=!(p.length>1&&void 0!==p[1])||p[1],t.next=3,this.hashSnapshot(e);case 3:return r=Date.now(),o=JSON.stringify(e),i=Date.now()-r,a=e.meta,c=a.time,u=a.seq,l=a.hash,h=this.snapshotUrl("snap",c,u,l,"gz"),gn.snapshot&&console.log(this.id,"Controller uploading snapshot (".concat(o.length," bytes, ").concat(i,"ms) to ").concat(h)),f=this.connection.socket,t.next=12,this.uploadGzipped(h,o);case 12:if(d=t.sent,this.connection.socket===f){t.next=16;break}return console.error("Controller was reset while trying to upload snapshot"),t.abrupt("return",!1);case 16:if(d){t.next=19;break}return console.error("Failed to upload snapshot"),t.abrupt("return",!1);case 19:return n&&this.announceSnapshotUrl(c,u,l,h),t.abrupt("return",!0);case 21:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"announceSnapshotUrl",value:function(t,e,n,r){gn.snapshot&&console.log(this.id,"Controller sending snapshot url to reflector (time: ".concat(t,", seq: ").concat(e,", hash: ").concat(n,"): ").concat(r));try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:n,url:r}}))}catch(t){console.error("ERROR while sending",t)}}},{key:"fetchJSON",value:(p=c(s.mark((function t(e,n){var r,o,i;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{mode:"cors"});case 3:if(r=t.sent,!e.endsWith(".gz")){t.next=10;break}return t.next=7,r.arrayBuffer();case 7:return o=t.sent,i=pn.inflate(new Uint8Array(o),{to:"string"}),t.abrupt("return",JSON.parse(i));case 10:return t.next=12,r.json();case 12:return t.abrupt("return",t.sent);case 15:t.prev=15,t.t0=t.catch(0);case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}}),t,null,[[0,15]])}))),function(t,e){return p.apply(this,arguments)})},{key:"uploadJSON",value:(d=c(s.mark((function t(e,n){var r,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:n});case 3:return r=t.sent,o=r.ok,t.abrupt("return",o);case 8:t.prev=8,t.t0=t.catch(0);case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),function(t,e){return d.apply(this,arguments)})},{key:"uploadGzipped",value:(f=c(s.mark((function t(e,n){var r,o,i,a,c;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),o=(new TextEncoder).encode(n),i=pn.gzip(o,{level:1}),gn.snapshot&&console.log("Snapshot gzipping took ".concat(Date.now()-r,"ms")),t.prev=4,t.next=7,fetch(e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/octet-stream"},body:i});case 7:return a=t.sent,c=a.ok,t.abrupt("return",c);case 12:t.prev=12,t.t0=t.catch(4);case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[4,12]])}))),function(t,e){return f.apply(this,arguments)})},{key:"convertReflectorMessage",value:function(t){var n=this.id,r="noop",o=[];switch(t[2].what){case"users":var i=t[2],a=i.joined,s=i.left,c=i.active,u=i.total;this.users=c,this.usersTotal=u;var l,h=this.id,f={entered:a||[],exited:s||[],count:c},d=ln(f.entered);try{for(d.s();!(l=d.n()).done;){var p=l.value;p.length>2&&(p.length=2)}}catch(t){d.e(t)}finally{d.f()}n=this.id,r="publishFromModel",o=[h,"__users__",f],ie.handleEvent(this.viewId+":__users__",f);break;case"tally":var v=t[2],y=v.tuttiSeq,m=v.tally,g=v.tallyTarget,b={tuttiSeq:y,tally:m},w=this.tuttiHistory.find((function(t){return t.tuttiSeq===y}));w&&(b._local=w.payload);var k=e(g,3);n=k[0],r=k[1],o=[k[2],b]}var S=new Oe(0,0,n,r,o);t[2]=S.asState()[2]}},{key:"receive",value:(h=c(s.mark((function t(e,n){var r,o,i,a,c,u,l,h,f,d,p,v,y=this;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.lastReceived=this.connection.lastReceived,t.t0=e,t.next="START"===t.t0?4:"SYNC"===t.t0?13:"RECV"===t.t0?32:"TICK"===t.t0?40:"LEAVE"===t.t0?47:50;break;case 4:return gn.session&&console.log(this.id,"Controller received START"),this.install(),r=this.takeSnapshot(),t.next=9,this.uploadSnapshot(r,!0);case 9:return o=t.sent,this.islandCreator.startedOrSynced.resolve(this.island),o?this.requestTicks():this.connection.closeConnectionWithError("start","failed to establish session"),t.abrupt("return");case 13:i=n.messages,a=n.url,c=n.time,gn.session&&console.log(this.id,"Controller received SYNC: time ".concat(c,", ").concat(i.length," messages, ").concat(a)),u=ln(i);try{for(u.s();!(l=u.n()).done;)h=l.value,gn.messages&&console.log(this.id,"Controller received message in SYNC "+JSON.stringify(h)),h[1]>>>=0,"string"!=typeof h[2]&&this.convertReflectorMessage(h),this.networkQueue.put(h),this.timeFromReflector(h[0])}catch(t){u.e(t)}finally{u.f()}return this.timeFromReflector(c),gn.session&&console.log("".concat(this.id," fetching snapshot ").concat(a)),t.next=21,this.fetchJSON(a);case 21:if(f=t.sent,this.islandCreator.snapshot=f,this.connected){t.next=26;break}return console.log(this.id,"socket went away during SYNC"),t.abrupt("return");case 26:return this.install(),gn.session&&console.log("".concat(this.id," fast forwarding from ").concat(Math.round(this.island.time)," to ").concat(c)),this.getTickAndMultiplier(),d=function t(){y.simulate(Date.now()+200)?(gn.session&&console.log("".concat(y.id," fast forwarded to ").concat(Math.round(y.island.time))),y.islandCreator.startedOrSynced.resolve(y.island)):setTimeout(t,0)},setTimeout(d,0),t.abrupt("return");case 32:return gn.messages&&console.log(this.id,"Controller received RECV "+JSON.stringify(n)),"string"!=typeof(p=n)[2]&&this.convertReflectorMessage(p),p[1]>>>=0,p[3]===this.viewId&&this.addToStatistics(p[4],this.lastReceived),this.networkQueue.put(p),this.timeFromReflector(p[0]),t.abrupt("return");case 40:if(this.island){t.next=42;break}return t.abrupt("return");case 42:return v="number"==typeof n?n:n.time,gn.ticks&&console.log(this.id,"Controller received TICK "+v),this.timeFromReflector(v),this.tickMultiplier&&this.multiplyTick(v),t.abrupt("return");case 47:return console.log(this.id,"Controller received LEAVE"),this.leave(),t.abrupt("return");case 50:console.warn("Unknown action:",e,n);case 51:case"end":return t.stop()}}),t,this)}))),function(t,e){return h.apply(this,arguments)})},{key:"install",value:function(){gn.session&&console.log("".concat(this.id," installing island"));var t=this.islandCreator,e=t.snapshot,n=t.init,r=t.options,o=new ke(e,(function(){try{return n(r)}catch(t){throw Ht("init",t),t}}));if(gn.initsnapshot&&!e.modelsById){var i=JSON.stringify(o.snapshot());o=new ke(JSON.parse(i),(function(){return n(r)}))}var a=this.lastKnownTime(o);this.time=Math.max(this.time,a),this.setIsland(o)}},{key:"setIsland",value:function(t){this.island=t,this.island.controller=this}},{key:"createCleanIsland",value:function(){var t=this.islandCreator,e=t.options,n=t.init,r={id:this.id};return new ke(r,(function(){return n(e)}))}},{key:"join",value:(l=c(s.mark((function t(){var e,n,r,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkForConnection(!1),t.next=3,this.connection.connectionPromise;case 3:Sn.add(this),gn.session&&console.log(this.id,"Controller sending JOIN"),e=this.user,n=e.name,r=e.id,o={name:this.islandCreator.name,options:this.islandCreator.options,version:1,user:[r,n],url:Zt.sessionURL,codeHash:this.islandCreator.codeHash,sdk:vn},this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:o}));case 8:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},{key:"startedOrSynced",value:(a=c(s.mark((function t(){var e=this;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){return e.islandCreator.startedOrSynced={resolve:t,reject:n}})));case 1:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)})},{key:"leave",value:function(){this.connected&&(console.log(this.id,"Controller LEAVING session for ".concat(this.islandCreator.name)),this.connection.send(JSON.stringify({id:this.id,action:"LEAVING"}))),Sn.delete(this);var t=this.islandCreator.destroyerFn;if(this.reset(),!this.islandCreator)throw Error("do not discard islandCreator!");t&&t()}},{key:"sendMessage",value:function(t){this.connected&&(this.viewOnly||(gn.sends&&console.log(this.id,"Controller sending SEND ".concat(t.asState())),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[].concat(o(t.asState()),[this.viewId,this.lastSent,this.latency])}))))}},{key:"sendTagged",value:function(t,e){this.connected&&(this.viewOnly||(gn.sends&&console.log(this.id,"Controller sending tagged SEND ".concat(t.asState()," with tags ").concat(JSON.stringify(e))),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"SEND",args:[].concat(o(t.asState()),[this.viewId,this.lastSent]),tags:e}))))}},{key:"sendTutti",value:function(t,e,n,r,o,i){if(this.connected&&!this.viewOnly){var a=u(n);gn.sends&&console.log(this.id,"Controller sending TUTTI ".concat(a," ").concat(r&&r.asState()," ").concat(i)),this.tuttiHistory.push({tuttiSeq:e,payload:a}),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.lastSent=Date.now(),this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,e,a,r&&r.asState(),o,i]}))}}},{key:"sendVote",value:function(t,e,n){var r=[this.island.id,"handleModelEventInView",this.island.id+":"+e];this.sendTutti(this.island.time,t,n,null,!0,r)}},{key:"addToStatistics",value:function(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}},{key:"getTickAndMultiplier",value:function(){var t=this.islandCreator.options,n=(("tps"in t?t.tps:"tps"in this.islandCreator?this.islandCreator.tps:20)+"x").split("x").map((function(t){return Number.parseInt("0"+t,10)})),r=e(n,2),o=r[0],i=r[1],a=1e3/Math.max(1,Math.min(60,o)),s=Math.max(1,i);return s>1&&!bn&&(this.tickMultiplier={tick:a,multiplier:s}),{tick:a,multiplier:s}}},{key:"requestTicks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.connected&&this.island){var e=this.getTickAndMultiplier(),n=e.tick,r=e.multiplier;t.tick=n,t.delay=n*(r-1)/r,gn.session&&console.log(this.id,"Controller requesting TICKS",t);try{this.connection.send(JSON.stringify({id:this.id,action:"TICKS",args:t}))}catch(t){console.error("ERROR while sending",t)}}}},{key:"simulate",value:function(t){var e=this;if(!this.island)return!0;try{for(var n=Tt.begin("simulate"),r=!0;r;){var o=this.networkQueue.peek();if(!o)break;if(!(r=this.island.advanceTo(o[0],t)))break;this.networkQueue.nextNonBlocking();var i=this.island.scheduleExternalMessage(o);r=this.island.advanceTo(i.time,t),this.cpuTime+=5}r&&(r=this.island.advanceTo(this.time,t)),this.cpuTime+=Math.max(.01,Tt.end("simulate")-n);var a=this.backlog;if(Tt.backlog(a),"boolean"==typeof this.synced&&(this.synced&&a>1e3||!this.synced&&a<100))!this.synced?this.syncTimer||(this.syncTimer=setTimeout((function(){delete e.syncTimer,e.backlog<100&&e.applySyncChange(!0)}),200)):this.applySyncChange(!1);return r&&this.cpuTime>5e3&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,setTimeout((function(){return e.scheduleSnapshot()}),Math.floor(2e3*Math.random()))),r}catch(t){return Ht("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}},{key:"applySyncChange",value:function(t){this.synced=t,Zt.showSyncWait(!t),this.island.publishFromView(this.viewId,"synced",t)}},{key:"inViewRealm",value:function(t){var e=this;return fe(this.island,(function(){return t(e.island)}))}},{key:"processModelViewEvents",value:function(){return this.island?this.island.processModelViewEvents():0}},{key:"timeFromReflector",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reflector";t<this.time?("controller"!==e||gn.ticks)&&console.warn("time is ".concat(this.time,", ignoring time ").concat(t," from ").concat(e)):("boolean"!=typeof this.synced&&(this.synced=!1),this.time=t,this.island&&Tt.backlog(this.backlog),this.tickHook&&this.tickHook())}},{key:"multiplyTick",value:function(t){var e=this;this.localTicker&&window.clearInterval(this.localTicker);var n=this.tickMultiplier,r=n.tick,o=n.multiplier,i=r/o,a=1;this.localTicker=window.setInterval((function(){e.timeFromReflector(t+a*i,"controller"),gn.ticks&&console.log(e.id,"Controller generate TICK "+e.time,a),++a>=o&&(window.clearInterval(e.localTicker),e.localTicker=0)}),i)}},{key:"id",get:function(){return this.island?this.island.id:this.islandCreator.snapshot.id}},{key:"user",get:function(){return{id:this.viewId,name:M("name","GUEST")}}},{key:"viewOnly",get:function(){return this.islandCreator.viewOnly}},{key:"backlog",get:function(){return this.island?this.time-this.island.time:0}},{key:"starvation",get:function(){return Date.now()-this.lastReceived}},{key:"activity",get:function(){return Date.now()-this.lastSent}},{key:"connected",get:function(){return this.connection.connected}},{key:"latencies",get:function(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}}]),t}(),Cn=function(){function t(e){n(this,t),this.controller=e,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.setUpConnectionPromise()}var e;return r(t,[{key:"setUpConnectionPromise",value:function(){var t=this;this.connectionPromise=new Promise((function(e){return t.resolveConnection=e}))}},{key:"checkForConnection",value:function(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}},{key:"connectToReflector",value:(e=c(s.mark((function t(){var e,n=this;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1,(e=T.reflector||(gn.reflector?"wss://croquet.io/reflector-dev/dev":mn)).match(/^wss?:/)){t.next=6;break}throw Error("Cannot interpret reflector address "+e);case 6:return e.endsWith("/")||(e+="/"),t.abrupt("return",new Promise((function(t){var r=Object.assign(new WebSocket("".concat(e).concat(n.controller.id)),{onopen:function(e){n.socket=r,(gn.session||gn.reflector)&&console.log(n.socket.constructor.name,"connected to",n.socket.url),Tt.connected(!0),n.resolveConnection(null),t()},onmessage:function(t){n.receive(t.data)},onerror:function(t){Bt("Connection error"),console.log(r.constructor.name,"error")},onclose:function(t){var e=1e3!==t.code&&t.code<4100,o=4110===t.code;o||Bt("Connection closed: ".concat(t.code," ").concat(t.reason),{duration:e?void 0:36e5}),gn.session&&console.log(r.constructor.name,"closed:",t.code,t.reason),Tt.connected(!1),o?n.connectRestricted=!0:n.connectBlocked=!0,n.disconnected(),e&&(Ut("Reconnecting ..."),window.setTimeout((function(){return n.connectToReflector()}),2e3))}})})));case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"disconnected",value:function(){this.socket&&(this.socket=null,this.lastReceived=0,this.lastSent=0,this.connectHasBeenCalled=!1,this.setUpConnectionPromise(),this.controller.leave())}},{key:"send",value:function(t){this.lastSent=Date.now(),this.socket.send(t)}},{key:"receive",value:function(t){this.lastReceived=Date.now();var e=JSON.parse(t),n=e.id,r=e.action,o=e.args;if(n)try{this.controller.receive(r,o)}catch(t){this.closeConnectionWithError("receive",t)}else switch(r){case"PONG":gn.pong&&console.log("PONG after",Date.now()-o,"ms");break;default:console.warn("Unknown action",r)}}},{key:"dormantDisconnect",value:function(){this.connected&&(console.log("dormant; disconnecting from reflector"),this.socket.close(4110,"Going dormant"))}},{key:"closeConnectionWithError",value:function(t,e){console.error(e),console.warn("closing socket"),this.socket.close(4e3,"Error in "+t)}},{key:"PING",value:function(){this.connected&&(this.socket.bufferedAmount?console.log("Reflector connection stalled: ".concat(this.socket.bufferedAmount," bytes unsent")):this.send(JSON.stringify({action:"PING",args:Date.now()})))}},{key:"PULSE",value:function(){this.connected&&(this.socket.bufferedAmount&&console.log("Reflector connection stalled: ".concat(this.socket.bufferedAmount," bytes unsent")),this.send(JSON.stringify({action:"PULSE"})))}},{key:"keepAlive",value:function(){0!==this.lastReceived&&(Date.now()-this.lastReceived>100?this.PING():Date.now()-this.lastSent>2e4&&this.PULSE())}},{key:"connected",get:function(){return this.socket&&this.socket.readyState===WebSocket.OPEN}}]),t}();window.setInterval((function(){var t,e=ln(Sn);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.connected&&n.connection.keepAlive()}}catch(t){e.e(t)}finally{e.f()}}),100);var En=function(){function t(){n(this,t)}var i;return r(t,null,[{key:"join",value:(i=c(s.mark((function t(n){var r,i,a,u,l,h,f,d,p,v,y,m,g,b,w,k,S,x,C,E,O,_,A,M=arguments;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(A=function(){setInterval((function(){if("hidden"===document.visibilityState)if(!1===T.autoSleep)Tn(performance.now(),v,S.view);else{var t=Date.now();f?t-f>1e4&&v.dormantDisconnect():f=t}else f=null}),1e3)},_=function(t){return{modelRoot:r.create(t,"modelRoot")}},O=function(){S.model=null,S.view&&(T.has("debug","session",!1)&&console.log(S.id,"Detaching root view"),S.view.detach(),""!==S.view.id&&console.warn("".concat(S.view," did not call super.detach()")),S.view=null),Zt.clearSessionMoniker()},E=function(){return(E=c(s.mark((function t(r){var o,c,u,l,h,f;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(O(),o={snapshot:r,init:_,destroyerFn:C,options:y},c=0,u=Object.entries(a);c<u.length;c++)l=e(u[c],2),h=l[0],f=l[1],p.includes(h)&&(o[h]=f);return t.next=5,v.establishSession(n,o);case 5:S.model=t.sent.modelRoot,S.id=v.id,Zt.makeSessionWidgets(S.id),v.inViewRealm((function(){T.has("debug","session",!1)&&console.log(S.id,"Creating root view"),S.view=new i(S.model)}));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)},C=function(t){return E.apply(this,arguments)},u=function(t,e){return t===e||t.prototype instanceof e},r=M.length>1&&void 0!==M[1]?M[1]:Be,i=M.length>2&&void 0!==M[2]?M[2]:ze,a=M.length>3?M[3]:void 0,"string"!=typeof n?n=JSON.stringify(n)||"undefined":n||(n="unnamed"),u(r,Be)){t.next=12;break}throw Error("ModelRoot must inherit from Croquet.Model");case 12:if(u(i,ze)){t.next=19;break}if(!i||Object.getPrototypeOf(i)!==Object.prototype||void 0!==a){t.next=18;break}a=i,i=ze,t.next=19;break;case 18:throw Error("ViewRoot must inherit from Croquet.View");case 19:a||(a={}),(l=T.reflector||a.reflector)&&(l.includes("://")?T.reflector=l:console.warn('Not a valid websocket url, ignoring reflector "'.concat(l,'"'))),a.debug&&(h=function(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]},T.debug=[].concat(o(h(a.debug)),o(h(T.debug))).join(",")),f=null,"autoSleep"in a&&(T.autoSleep=a.autoSleep),A(),"expectedSimFPS"in a&&(An=Math.min(a.expectedSimFPS,_n)),d=["tps"],p=["optionsFromUrl","login","autoSession"],jn(),v=new xn,y={},a.options&&Object.assign(y,JSON.parse(JSON.stringify(a.options)));for(m=0,g=Object.entries(a);m<g.length;m++)b=e(g[m],2),w=b[0],k=b[1],d.includes(w)&&(y[w]=k);return t.t0=function(t){"hidden"!==document.visibilityState&&(f=null,Tn(t,v,S.view))},t.t1=function(){console.warn("Session leave not implemented yet!")},S={id:"",model:null,view:null,step:t.t0,leave:t.t1,get latency(){return v.latency},get latencies(){return v.latencies}},t.next=39,C();case 39:return"manual"!==a.step&&(x=function t(e){S.step(e),window.requestAnimationFrame(t)},window.requestAnimationFrame(x)),t.abrupt("return",S);case 41:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})}]),t}(),On=[0],_n=120,An=60;function Tn(t,e,n){e.checkForConnection(!0);var r=e.backlog,o=e.latency,i=e.starvation,a=e.activity;if(Tt.animationFrame(t,{backlog:r,starvation:i,latency:o,activity:a,users:e.users}),e.island){var s=Date.now(),c=On.reduce((function(t,e){return t+e}),0)/On.length;e.simulate(s+Math.min(c,200));var u=0===An?0:1e3/An*4;e.backlog>u&&e.simulate(s+200-c),On.push(Date.now()-s),On.length>4&&On.shift(),Tt.begin("update"),e.processModelViewEvents(),Tt.end("update"),n&&(Tt.begin("render"),e.inViewRealm((function(){return n.update(t)})),Tt.end("render"))}}var Mn={};function jn(){Object.isFrozen(Mn)||(function t(e){if(!Object.isFrozen(e)){Object.freeze(e);for(var n=0,r=Object.values(e);n<r.length;n++){var o=r[n];!o||"object"!==i(o)&&"function"!=typeof o||t(o)}}}(Mn),function(t){var e=JSON.stringify(t,(function(t,e){return"function"==typeof e?""+e:e}));if("{}"!==e){var n=JSON.parse(e),r=X(u(n));r.then((function(t){console.log("hashing Croquet.Constants(".concat(Object.keys(n).join(", "),"): ").concat(t)),z()&&(G[t].name="Croquet Constants")})),rt.push(r)}}(Mn))}exports.App=Zt,exports.Constants=Mn,exports.Data=un,exports.Model=Be,exports.Session=En,exports.View=ze,exports.gatherInternalClassTypes=function(t,e){var n={};return function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set,a=Object.values(e).filter((function(t){var e=Object.prototype.toString.call(t).slice(8,-1);return("Object"===e||"Array"===e)&&!i.has(t)})),s=ve(a);try{for(s.s();!(n=s.n()).done;){var c=n.value;i.add(c);var u=r+"."+c.constructor.name;if(o[u]){if(o[u]!==c.constructor)throw new Error("Class with name "+u+" already gathered, but new one has different identity")}else o[u]=c.constructor}}catch(t){s.e(t)}finally{s.f()}var l,h=ve(a);try{for(h.s();!(l=h.n()).done;){var f=l.value;t(f,r,o,i)}}catch(t){h.e(t)}finally{h.f()}}({root:t},e,n,new Set),n},exports.startSession=function(){return Zt.showMessage("Croquet.startSession() is deprecated, please use Croquet.Session.join()",{level:"warning",only:"once"}),En.join.apply(En,arguments)};
